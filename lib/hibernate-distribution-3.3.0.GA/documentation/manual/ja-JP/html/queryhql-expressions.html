<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>14.10. Expressions &#24335;</title>
      <link rel="stylesheet" href="css/html.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
      <link rel="start" href="index.html" title="HIBERNATE - Relational Persistence for Idiomatic Java">
      <link rel="up" href="queryhql.html" title="&#31532;14&#31456; HQL: The Hibernate Query Language">
      <link rel="prev" href="queryhql-where.html" title="14.9. where&#31680;">
      <link rel="next" href="queryhql-ordering.html" title="14.11. order by&#31680;">
   </head>
   <body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
      <div class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center">14.10. Expressions &#24335;</th>
            </tr>
            <tr>
               <td width="20%" align="left"><a accesskey="p" href="queryhql-where.html">&#21069;&#12398;&#12506;&#12540;&#12472;</a>&nbsp;
               </td>
               <th width="60%" align="center">&#31532;14&#31456; HQL: The Hibernate Query Language</th>
               <td width="20%" align="right">&nbsp;<a accesskey="n" href="queryhql-ordering.html">&#27425;&#12398;&#12506;&#12540;&#12472;</a></td>
            </tr>
         </table>
         <hr>
      </div>
      <div class="sect1" lang="ja-JP">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title" style="clear: both"><a name="queryhql-expressions"></a>14.10. Expressions &#24335;
                  </h2>
               </div>
            </div>
         </div>
         <p>SQL&#12398; <code class="literal">where</code> &#31680;&#12391;&#35352;&#36848;&#12377;&#12427;&#12371;&#12392;&#12364;&#20986;&#26469;&#12427;&#24335;&#12398;&#12411;&#12392;&#12435;&#12393;&#12434;HQL&#12391;&#12418;&#35352;&#36848;&#12391;&#12365;&#12414;&#12377;&#12290;: 
         </p>
         <div class="itemizedlist">
            <ul type="disc" compact>
               <li>
                  <p>&#31639;&#34899;&#28436;&#31639;&#23376;&#65306;<code class="literal">+, -, *, /</code> 
                  </p>
               </li>
               <li>
                  <p>2&#38917;&#27604;&#36611;&#28436;&#31639;&#23376;&#65306;<code class="literal">=, &gt;=, &lt;=, &lt;&gt;, !=, like</code> 
                  </p>
               </li>
               <li>
                  <p>&#35542;&#29702;&#28436;&#31639;&#23376;&#65306;<code class="literal">and, or, not</code> 
                  </p>
               </li>
               <li>
                  <p>&#12464;&#12523;&#12540;&#12503;&#20998;&#12369;&#12434;&#34920;&#12377;&#25324;&#24359;&#65306;<code class="literal">( )</code> 
                  </p>
               </li>
               <li>
                  <p><code class="literal">in</code>, <code class="literal">not in</code>, <code class="literal">between</code>, <code class="literal">is null</code>, <code class="literal">is not null</code>, <code class="literal">is empty</code>, <code class="literal">is not empty</code>, <code class="literal">member of</code> and <code class="literal">not member of</code> 
                  </p>
               </li>
               <li>
                  <p>"&#12471;&#12531;&#12503;&#12523;"&#12394;case <code class="literal">case ... when ... then ... else ... end</code>&#12289; "&#25506;&#32034;&#30340;"&#12394;case <code class="literal">case when ... then ... else ... end</code> 
                  </p>
               </li>
               <li>
                  <p>&#12473;&#12488;&#12522;&#12531;&#12464;&#12398;&#36899;&#32080; <code class="literal">...||...</code> &#12414;&#12383;&#12399; <code class="literal">concat(...,...)</code> 
                  </p>
               </li>
               <li>
                  <p><code class="literal">current_date()</code>, <code class="literal">current_time()</code>, <code class="literal">current_timestamp()</code> 
                  </p>
               </li>
               <li>
                  <p><code class="literal">second(...)</code>, <code class="literal">minute(...)</code>, <code class="literal">hour(...)</code>, <code class="literal">day(...)</code>, <code class="literal">month(...)</code>, <code class="literal">year(...)</code>, 
                  </p>
               </li>
               <li>
                  <p>EJB-QL 3.0&#12391;&#23450;&#32681;&#12373;&#12428;&#12390;&#12356;&#12427;&#38306;&#25968;&#12420;&#28436;&#31639;&#23376;: <code class="literal">substring(), trim(), lower(), upper(), length(), locate(), abs(), sqrt(), bit_length()</code> 
                  </p>
               </li>
               <li>
                  <p><code class="literal">coalesce()</code> &#12392; <code class="literal">nullif()</code> 
                  </p>
               </li>
               <li>
                  <p>&#25968;&#23383;&#12420;&#26178;&#38291;&#12398;&#20516;&#12434;String&#12395;&#12467;&#12531;&#12496;&#12540;&#12488;&#12377;&#12427; <code class="literal">str()</code>&#65289; 
                  </p>
               </li>
               <li>
                  <p>2&#30058;&#30446;&#12398;&#24341;&#25968;&#12364;Hibernate&#22411;&#12398;&#21517;&#21069;&#12391;&#12354;&#12427; <code class="literal">cast(... as ...)</code> &#12392; <code class="literal">extract(... from ...)</code>&#12290; &#12383;&#12384;&#12375;&#20351;&#29992;&#12377;&#12427;&#12487;&#12540;&#12479;&#12505;&#12540;&#12473;&#12364;ANSI <code class="literal">cast()</code> &#12392; <code class="literal">extract()</code> &#12434;&#12469;&#12509;&#12540;&#12488;&#12377;&#12427;&#22580;&#21512;&#12395;&#38480;&#12426;&#12414;&#12377;&#12290; 
                  </p>
               </li>
               <li>
                  <p>&#32080;&#21512;&#12375;&#12383;&#12452;&#12531;&#12487;&#12483;&#12463;&#12473;&#20184;&#12365;&#12398;&#12467;&#12524;&#12463;&#12471;&#12519;&#12531;&#12398;&#21029;&#21517;&#12395;&#36969;&#29992;&#12373;&#12428;&#12427;HQL&#12398; <code class="literal">index()</code> &#38306;&#25968;&#12290; 
                  </p>
               </li>
               <li>
                  <p>&#12467;&#12524;&#12463;&#12471;&#12519;&#12531;&#20516;&#12398;&#12497;&#12473;&#24335;&#12434;&#21462;&#12427;HQL&#38306;&#25968;&#65306; <code class="literal">size(), minelement(), maxelement(), minindex(), maxindex()</code> &#12290; <code class="literal">some, all, exists, any, in</code> &#12434;&#20351;&#12387;&#12390;&#20462;&#39166;&#12377;&#12427;&#12371;&#12392;&#12364;&#12391;&#12365;&#12427;&#29305;&#21029;&#12394; <code class="literal">elements()</code> &#12392; <code class="literal">indices</code> &#38306;&#25968;&#12392;&#19968;&#32210;&#12395;&#20351;&#12356;&#12414;&#12377;&#12290; 
                  </p>
               </li>
               <li>
                  <p><code class="literal">sign()</code>, <code class="literal">trunc()</code>, <code class="literal">rtrim()</code>, <code class="literal">sin()</code> &#12398;&#12424;&#12358;&#12394;&#12487;&#12540;&#12479;&#12505;&#12540;&#12473;&#12364;&#12469;&#12509;&#12540;&#12488;&#12377;&#12427;SQL&#12473;&#12459;&#12521;&#38306;&#25968;&#12290; 
                  </p>
               </li>
               <li>
                  <p>JDBC&#12473;&#12479;&#12452;&#12523;&#12398;&#20301;&#32622;&#12497;&#12521;&#12513;&#12540;&#12479; <code class="literal">?</code> 
                  </p>
               </li>
               <li>
                  <p>&#21517;&#21069;&#20184;&#12365;&#12497;&#12521;&#12513;&#12540;&#12479;: <code class="literal">:name</code>, <code class="literal">:start_date</code>, <code class="literal">:x1</code> 
                  </p>
               </li>
               <li>
                  <p>SQL&#12522;&#12486;&#12521;&#12523;&#65306;<code class="literal">'foo'</code>, <code class="literal">69</code>, <code class="literal">6.66E+2</code>, <code class="literal">'1970-01-01 10:00:01.0'</code> 
                  </p>
               </li>
               <li>
                  <p>Java&#12398; <code class="literal">public static final</code> &#23450;&#25968;&#65306;<code class="literal">eg.Color.TABBY</code> 
                  </p>
               </li>
            </ul>
         </div>
         <p><code class="literal">in</code> &#12392; <code class="literal">between</code> &#12399;&#20197;&#19979;&#12398;&#12424;&#12358;&#12395;&#20351;&#29992;&#12391;&#12365;&#12414;&#12377;&#12290;: 
         </p><pre class="programlisting">from DomesticCat cat where cat.name between 'A' and 'B'</pre><pre class="programlisting">from DomesticCat cat where cat.name in ( 'Foo', 'Bar', 'Baz' )</pre><p>&#12414;&#12383;&#12289;&#21542;&#23450;&#24418;&#12391;&#35352;&#36848;&#12377;&#12427;&#12371;&#12392;&#12418;&#12391;&#12365;&#12414;&#12377;&#12290; </p><pre class="programlisting">from DomesticCat cat where cat.name not between 'A' and 'B'</pre><pre class="programlisting">from DomesticCat cat where cat.name not in ( 'Foo', 'Bar', 'Baz' )</pre><p>&#21516;&#27096;&#12395; <code class="literal">is null</code> &#12420; <code class="literal">is not null</code> &#12399;null&#20516;&#12434;&#12486;&#12473;&#12488;&#12377;&#12427;&#12383;&#12417;&#12395;&#20351;&#29992;&#12391;&#12365;&#12414;&#12377;&#12290; 
         </p>
         <p>Hibernate&#35373;&#23450;&#12501;&#12449;&#12452;&#12523;&#12391;HQL query substitutions&#12434;&#23450;&#32681;&#12377;&#12428;&#12400;&#12289;boolean&#20516;&#12434;&#24335;&#12398;&#20013;&#12391;&#31777;&#21336;&#12395;&#20351;&#29992;&#12391;&#12365;&#12414;&#12290;&#65306; </p><pre class="programlisting">&lt;property name="hibernate.query.substitutions"&gt;true 1, false 0&lt;/property&gt;</pre><p>&#12371;&#12358;&#12377;&#12427;&#12371;&#12392;&#12391;&#19979;&#35352;&#12398;HQL&#12434;SQL&#12395;&#22793;&#25563;&#12377;&#12427;&#12392;&#12365;&#12395; <code class="literal">true</code> , <code class="literal">false</code> &#12461;&#12540;&#12527;&#12540;&#12489;&#12399; <code class="literal">1</code> , <code class="literal">0</code> &#12395;&#32622;&#12365;&#25563;&#12360;&#12425;&#12428;&#12414;&#12377;&#12290;: 
         </p><pre class="programlisting">from Cat cat where cat.alive = true</pre><p>&#29305;&#21029;&#12394;&#12503;&#12525;&#12497;&#12486;&#12451; <code class="literal">size</code>&#12289;&#12414;&#12383;&#12399;&#29305;&#21029;&#12394;&#38306;&#25968; <code class="literal">size()</code> &#12434;&#20351;&#12387;&#12390;&#12467;&#12524;&#12463;&#12471;&#12519;&#12531;&#12398;&#12469;&#12452;&#12474;&#12434;&#12486;&#12473;&#12488;&#12391;&#12365;&#12414;&#12377;&#12290;: 
         </p><pre class="programlisting">from Cat cat where cat.kittens.size &gt; 0</pre><pre class="programlisting">from Cat cat where size(cat.kittens) &gt; 0</pre><p>&#12452;&#12531;&#12487;&#12483;&#12463;&#12473;&#20184;&#12365;&#12398;&#12467;&#12524;&#12463;&#12471;&#12519;&#12531;&#12391;&#12399;&#12289;<code class="literal">minindex</code> &#12392; <code class="literal">maxindex</code> &#38306;&#25968;&#12434;&#20351;&#12387;&#12390;&#12289;&#12452;&#12531;&#12487;&#12483;&#12463;&#12473;&#12398;&#26368;&#23567;&#20516;&#12392;&#26368;&#22823;&#20516;&#12434;&#21442;&#29031;&#12391;&#12365;&#12414;&#12377;&#12290; &#21516;&#27096;&#12395;&#12289;<code class="literal">minelement</code> &#12392; <code class="literal">maxelement</code> &#12434;&#20351;&#12387;&#12390;&#12289; &#22522;&#26412;&#22411;&#12398;&#12467;&#12524;&#12463;&#12471;&#12519;&#12531;&#35201;&#32032;&#12398;&#26368;&#23567;&#20516;&#12392;&#26368;&#22823;&#20516;&#12434;&#21442;&#29031;&#12391;&#12365;&#12414;&#12377;&#12290; 
         </p><pre class="programlisting">from Calendar cal where maxelement(cal.holidays) &gt; current_date</pre><pre class="programlisting">from Order order where maxindex(order.items) &gt; 100</pre><pre class="programlisting">from Order order where minelement(order.items) &gt; 10000</pre><p>&#12467;&#12524;&#12463;&#12471;&#12519;&#12531;&#12398;&#35201;&#32032;&#12420;&#12452;&#12531;&#12487;&#12483;&#12463;&#12473;&#12398;&#12475;&#12483;&#12488;&#65288;<code class="literal">elements</code> &#12392; <code class="literal">indices</code> &#38306;&#25968;&#65289;&#12289;&#12414;&#12383;&#12399;&#21103;&#21839;&#12356;&#21512;&#12431;&#12379;&#65288;&#24460;&#36848;&#65289;&#12398;&#32080;&#26524;&#12364;&#21463;&#12369;&#21462;&#12428;&#12427;&#12392;&#12365;&#12399;&#12289; SQL&#38306;&#25968; <code class="literal">any, some, all, exists, in</code> &#12364;&#12469;&#12509;&#12540;&#12488;&#12373;&#12428;&#12414;&#12377;&#12290; 
         </p><pre class="programlisting">select mother from Cat as mother, Cat as kit
where kit in elements(foo.kittens)</pre><pre class="programlisting">select p from NameList list, Person p
where p.name = some elements(list.names)</pre><pre class="programlisting">from Cat cat where exists elements(cat.kittens)</pre><pre class="programlisting">from Player p where 3 &gt; all elements(p.scores)</pre><pre class="programlisting">from Show show where 'fizard' in indices(show.acts)</pre><p><code class="literal">size</code>, <code class="literal">elements</code>, <code class="literal">indices</code>, <code class="literal">minindex</code>, <code class="literal">maxindex</code>, <code class="literal">minelement</code>, <code class="literal">maxelement</code> &#12399;Hibernate3&#12398;where&#31680;&#12384;&#12369;&#12391;&#21033;&#29992;&#21487;&#33021;&#12391;&#12354;&#12427;&#12371;&#12392;&#12395;&#27880;&#24847;&#12375;&#12390;&#12367;&#12384;&#12373;&#12356;&#12290; 
         </p>
         <p>&#12452;&#12531;&#12487;&#12483;&#12463;&#12473;&#20184;&#12365;&#12398;&#12467;&#12524;&#12463;&#12471;&#12519;&#12531;&#65288;arrays, lists, maps&#65289;&#12398;&#35201;&#32032;&#12399;&#12289; &#12452;&#12531;&#12487;&#12483;&#12463;&#12473;&#12391;&#21442;&#29031;&#12391;&#12365;&#12414;&#12377;&#65288;where&#31680;&#20869;&#12391;&#12398;&#12415;&#65289;&#12290; </p><pre class="programlisting">from Order order where order.items[0].id = 1234</pre><pre class="programlisting">select person from Person person, Calendar calendar
where calendar.holidays['national day'] = person.birthDay
    and person.nationality.calendar = calendar</pre><pre class="programlisting">select item from Item item, Order order
where order.items[ order.deliveredItemIndices[0] ] = item and order.id = 11</pre><pre class="programlisting">select item from Item item, Order order
where order.items[ maxindex(order.items) ] = item and order.id = 11</pre><p><code class="literal">[]</code> &#20869;&#37096;&#12398;&#24335;&#12399;&#12289;&#31639;&#34899;&#24335;&#12391;&#12418;&#27083;&#12356;&#12414;&#12379;&#12435;&#12290; 
         </p><pre class="programlisting">select item from Item item, Order order
where order.items[ size(order.items) - 1 ] = item</pre><p>&#19968;&#23550;&#22810;&#38306;&#36899;&#12420;&#20516;&#12398;&#12467;&#12524;&#12463;&#12471;&#12519;&#12531;&#12398;&#35201;&#32032;&#12395;&#23550;&#12375;&#12390;&#12399;&#12289;HQL&#12399;&#32068;&#12415;&#36796;&#12415;&#12398; <code class="literal">index()</code> &#38306;&#25968;&#12418;&#29992;&#24847;&#12375;&#12390;&#12356;&#12414;&#12377;&#12290; 
         </p><pre class="programlisting">select item, index(item) from Order order
    join order.items item
where index(item) &lt; 5</pre><p>&#12505;&#12540;&#12473;&#12392;&#12394;&#12427;&#12487;&#12540;&#12479;&#12505;&#12540;&#12473;&#12364;&#12469;&#12509;&#12540;&#12488;&#12375;&#12390;&#12356;&#12427;&#12473;&#12459;&#12521;&#12540;SQL&#38306;&#25968;&#12364;&#20351;&#29992;&#12391;&#12365;&#12414;&#12377; </p><pre class="programlisting">from DomesticCat cat where upper(cat.name) like 'FRI%'</pre><p>&#12418;&#12375;&#12414;&#12384;&#20840;&#12390;&#12434;&#29702;&#35299;&#12375;&#12390;&#12356;&#12394;&#12356;&#12394;&#12425;&#12289;&#19979;&#12398;&#12463;&#12456;&#12522;&#12434;SQL&#12391;&#12393;&#12428;&#12384;&#12369;&#38263;&#12367;&#12289;&#35501;&#12415;&#12389;&#12425;&#12367;&#20986;&#26469;&#12427;&#12363;&#32771;&#12360;&#12390;&#12367;&#12384;&#12373;&#12356;&#12290;: </p><pre class="programlisting">select cust
from Product prod,
    Store store
    inner join store.customers cust
where prod.name = 'widget'
    and store.location.name in ( 'Melbourne', 'Sydney' )
    and prod = all elements(cust.currentOrder.lineItems)</pre><p><span class="emphasis"><em>&#12498;&#12531;&#12488;:</em></span> &#20363;&#12360;&#12400;&#12371;&#12398;&#12424;&#12358;&#12395;&#20986;&#26469;&#12414;&#12377;&#12290; 
         </p><pre class="programlisting">SELECT cust.name, cust.address, cust.phone, cust.id, cust.current_order
FROM customers cust,
    stores store,
    locations loc,
    store_customers sc,
    product prod
WHERE prod.name = 'widget'
    AND store.loc_id = loc.id
    AND loc.name IN ( 'Melbourne', 'Sydney' )
    AND sc.store_id = store.id
    AND sc.cust_id = cust.id
    AND prod.id = ALL(
        SELECT item.prod_id
        FROM line_items item, orders o
        WHERE item.order_id = o.id
            AND cust.current_order = o.id
    )</pre></div>
      <div class="navfooter">
         <hr>
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left"><a accesskey="p" href="queryhql-where.html">&#21069;&#12398;&#12506;&#12540;&#12472;</a>&nbsp;
               </td>
               <td width="20%" align="center"><a accesskey="u" href="queryhql.html">&#19978;&#12395;&#25147;&#12427;</a></td>
               <td width="40%" align="right">&nbsp;<a accesskey="n" href="queryhql-ordering.html">&#27425;&#12398;&#12506;&#12540;&#12472;</a></td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top">14.9. where&#31680;&nbsp;</td>
               <td width="20%" align="center"><a accesskey="h" href="index.html">&#12507;&#12540;&#12512;</a></td>
               <td width="40%" align="right" valign="top">&nbsp;14.11. order by&#31680;</td>
            </tr>
         </table>
      </div>
   </body>
</html>