<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>19.5.&nbsp;&#29702;&#35299;&#38598;&#21512;&#24615;&#33021;&#65288;Understanding Collection performance&#65289;</title>
      <link rel="stylesheet" href="css/html.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
      <link rel="start" href="index.html" title="HIBERNATE - &#31526;&#21512;Java&#20064;&#24815;&#30340;&#20851;&#31995;&#25968;&#25454;&#24211;&#25345;&#20037;&#21270;">
      <link rel="up" href="performance.html" title="&#31532;&nbsp;19&nbsp;&#31456;&nbsp;&#25552;&#21319;&#24615;&#33021;">
      <link rel="prev" href="performance-querycache.html" title="19.4.&nbsp;&#26597;&#35810;&#32531;&#23384;&#65288;The Query Cache&#65289;">
      <link rel="next" href="performance-monitoring.html" title="19.6.&nbsp;&#30417;&#27979;&#24615;&#33021;&#65288;Monitoring performance&#65289;">
   </head>
   <body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
      <div class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center">19.5.&nbsp;&#29702;&#35299;&#38598;&#21512;&#24615;&#33021;&#65288;Understanding Collection performance&#65289;</th>
            </tr>
            <tr>
               <td width="20%" align="left"><a accesskey="p" href="performance-querycache.html">&#19978;&#19968;&#39029;</a>&nbsp;
               </td>
               <th width="60%" align="center">&#31532;&nbsp;19&nbsp;&#31456;&nbsp;&#25552;&#21319;&#24615;&#33021;</th>
               <td width="20%" align="right">&nbsp;<a accesskey="n" href="performance-monitoring.html">&#19979;&#19968;&#39029;</a></td>
            </tr>
         </table>
         <hr>
      </div>
      <div class="sect1" lang="zh-CN">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title" style="clear: both"><a name="performance-collections"></a>19.5.&nbsp;&#29702;&#35299;&#38598;&#21512;&#24615;&#33021;&#65288;Understanding Collection performance&#65289;
                  </h2>
               </div>
            </div>
         </div>
         <p>&#21069;&#38754;&#25105;&#20204;&#24050;&#32463;&#23545;&#38598;&#21512;&#36827;&#34892;&#20102;&#36275;&#22815;&#30340;&#35752;&#35770;&#12290;&#26412;&#27573;&#20013;&#65292;&#25105;&#20204;&#23558;&#30528;&#37325;&#35762;&#36848;&#38598;&#21512;&#22312;&#36816;&#34892;&#26102;&#30340;&#20107;&#23452;&#12290; </p>
         <div class="sect2" lang="zh-CN">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="performance-collections-taxonomy"></a>19.5.1.&nbsp;&#20998;&#31867;&#65288;Taxonomy&#65289;
                     </h3>
                  </div>
               </div>
            </div>
            <p>Hibernate&#23450;&#20041;&#20102;&#19977;&#31181;&#22522;&#26412;&#31867;&#22411;&#30340;&#38598;&#21512;&#65306;</p>
            <div class="itemizedlist">
               <ul type="disc">
                  <li>
                     <p>&#20540;&#25968;&#25454;&#38598;&#21512;</p>
                  </li>
                  <li>
                     <p>&#19968;&#23545;&#22810;&#20851;&#32852;</p>
                  </li>
                  <li>
                     <p>&#22810;&#23545;&#22810;&#20851;&#32852;</p>
                  </li>
               </ul>
            </div>
            <p>&#36825;&#20010;&#20998;&#31867;&#26159;&#21306;&#20998;&#20102;&#19981;&#21516;&#30340;&#34920;&#21644;&#22806;&#38190;&#20851;&#31995;&#31867;&#22411;&#65292;&#20294;&#26159;&#23427;&#27809;&#26377;&#21578;&#35785;&#25105;&#20204;&#20851;&#31995;&#27169;&#22411;&#30340;&#25152;&#26377;&#20869;&#23481;&#12290; &#35201;&#23436;&#20840;&#29702;&#35299;&#20182;&#20204;&#30340;&#20851;&#31995;&#32467;&#26500;&#21644;&#24615;&#33021;&#29305;&#28857;&#65292;&#25105;&#20204;&#24517;&#39035;&#21516;&#26102;&#32771;&#34385;&#8220;&#29992;&#20110;Hibernate&#26356;&#26032;&#25110;&#21024;&#38500;&#38598;&#21512;&#34892;&#25968;&#25454;&#30340;&#20027;&#38190;&#30340;&#32467;&#26500;&#8221;&#12290; &#22240;&#27492;&#24471;&#21040;&#20102;&#22914;&#19979;&#30340;&#20998;&#31867;&#65306; </p>
            <div class="itemizedlist">
               <ul type="disc">
                  <li>
                     <p>&#26377;&#24207;&#38598;&#21512;&#31867;</p>
                  </li>
                  <li>
                     <p>&#38598;&#21512;&#65288;sets&#65289;</p>
                  </li>
                  <li>
                     <p>&#21253;&#65288;bags)</p>
                  </li>
               </ul>
            </div>
            <p>&#25152;&#26377;&#30340;&#26377;&#24207;&#38598;&#21512;&#31867;&#65288;maps, lists, arrays)&#37117;&#25317;&#26377;&#19968;&#20010;&#30001;<code class="literal">&lt;key&gt;</code>&#21644; <code class="literal">&lt;index&gt;</code>&#32452;&#25104;&#30340;&#20027;&#38190;&#12290; &#36825;&#31181;&#24773;&#20917;&#19979;&#38598;&#21512;&#31867;&#30340;&#26356;&#26032;&#26159;&#38750;&#24120;&#39640;&#25928;&#30340;&#8212;&#8212;&#20027;&#38190;&#24050;&#32463;&#34987;&#26377;&#25928;&#30340;&#32034;&#24341;&#65292;&#22240;&#27492;&#24403;Hibernate&#35797;&#22270;&#26356;&#26032;&#25110;&#21024;&#38500;&#19968;&#34892;&#26102;&#65292;&#21487;&#20197;&#36805;&#36895;&#25214;&#21040;&#35813;&#34892;&#25968;&#25454;&#12290; 
            </p>
            <p>Sets have a primary key consisting of <code class="literal">&lt;key&gt;</code> and element columns. This may be less efficient for some types of collection element, particularly composite elements or
               large text or binary fields; the database may not be able to index a complex primary key as efficiently. On the other hand,
               for one to many or many to many associations, particularly in the case of synthetic identifiers, it is likely to be just as
               efficient. (Side-note: if you want <code class="literal">SchemaExport</code> to actually create the primary key of a <code class="literal">&lt;set&gt;</code> for you, you must declare all columns as <code class="literal">not-null="true"</code>.) 
            </p>
            <p><code class="literal">&lt;idbag&gt;</code>&#26144;&#23556;&#23450;&#20041;&#20102;&#20195;&#29702;&#38190;&#65292;&#22240;&#27492;&#23427;&#24635;&#26159;&#21487;&#20197;&#24456;&#39640;&#25928;&#30340;&#34987;&#26356;&#26032;&#12290;&#20107;&#23454;&#19978;&#65292; <code class="literal">&lt;idbag&gt;</code>&#25317;&#26377;&#30528;&#26368;&#22909;&#30340;&#24615;&#33021;&#34920;&#29616;&#12290; 
            </p>
            <p>Bag&#26159;&#26368;&#24046;&#30340;&#12290;&#22240;&#20026;bag&#20801;&#35768;&#37325;&#22797;&#30340;&#20803;&#32032;&#20540;&#65292;&#20063;&#27809;&#26377;&#32034;&#24341;&#23383;&#27573;&#65292;&#22240;&#27492;&#19981;&#21487;&#33021;&#23450;&#20041;&#20027;&#38190;&#12290; Hibernate&#26080;&#27861;&#21028;&#26029;&#20986;&#37325;&#22797;&#30340;&#34892;&#12290;&#24403;&#36825;&#31181;&#38598;&#21512;&#34987;&#26356;&#25913;&#26102;&#65292;Hibernate&#23558;&#20250;&#20808;&#23436;&#25972;&#22320;&#31227;&#38500; &#65288;&#36890;&#36807;&#19968;&#20010;(in a single <code class="literal">DELETE</code>)&#65289;&#25972;&#20010;&#38598;&#21512;&#65292;&#28982;&#21518;&#20877;&#37325;&#26032;&#21019;&#24314;&#25972;&#20010;&#38598;&#21512;&#12290; &#22240;&#27492;Bag&#26159;&#38750;&#24120;&#20302;&#25928;&#30340;&#12290; 
            </p>
            <p>&#35831;&#27880;&#24847;&#65306;&#23545;&#20110;&#19968;&#23545;&#22810;&#20851;&#32852;&#26469;&#35828;&#65292;&#8220;&#20027;&#38190;&#8221;&#24456;&#21487;&#33021;&#24182;&#19981;&#26159;&#25968;&#25454;&#24211;&#34920;&#30340;&#29289;&#29702;&#20027;&#38190;&#12290; &#20294;&#23601;&#31639;&#22312;&#27492;&#24773;&#20917;&#19979;&#65292;&#19978;&#38754;&#30340;&#20998;&#31867;&#20173;&#28982;&#26159;&#26377;&#29992;&#30340;&#12290;&#65288;&#23427;&#20173;&#28982;&#21453;&#26144;&#20102;Hibernate&#22312;&#38598;&#21512;&#30340;&#21508;&#25968;&#25454;&#34892;&#20013;&#26159;&#22914;&#20309;&#36827;&#34892;&#8220;&#23450;&#20301;&#8221;&#30340;&#12290;&#65289; </p>
         </div>
         <div class="sect2" lang="zh-CN">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="performance-collections-mostefficientupdate"></a>19.5.2.&nbsp;Lists, maps &#21644;sets&#29992;&#20110;&#26356;&#26032;&#25928;&#29575;&#26368;&#39640;
                     </h3>
                  </div>
               </div>
            </div>
            <p>&#26681;&#25454;&#25105;&#20204;&#19978;&#38754;&#30340;&#35752;&#35770;&#65292;&#26174;&#28982;&#26377;&#24207;&#38598;&#21512;&#31867;&#22411;&#21644;&#22823;&#22810;&#25968;set&#37117;&#21487;&#20197;&#22312;&#22686;&#21152;&#12289;&#21024;&#38500;&#12289;&#20462;&#25913;&#20803;&#32032;&#20013;&#25317;&#26377;&#26368;&#22909;&#30340;&#24615;&#33021;&#12290; </p>
            <p>&#21487;&#35770;&#35777;&#30340;&#26159;&#23545;&#20110;&#22810;&#23545;&#22810;&#20851;&#32852;&#12289;&#20540;&#25968;&#25454;&#38598;&#21512;&#32780;&#35328;&#65292;&#26377;&#24207;&#38598;&#21512;&#31867;&#27604;&#38598;&#21512;(set)&#26377;&#19968;&#20010;&#22909;&#22788;&#12290;&#22240;&#20026;<code class="literal">Set</code>&#30340;&#20869;&#22312;&#32467;&#26500;&#65292; &#22914;&#26524;&#8220;&#25913;&#21464;&#8221;&#20102;&#19968;&#20010;&#20803;&#32032;&#65292;Hibernate&#24182;&#19981;&#20250;<code class="literal">&#26356;&#26032;&#65288;UPDATE&#65289;</code>&#36825;&#19968;&#34892;&#12290; &#23545;&#20110;<code class="literal">Set</code>&#26469;&#35828;&#65292;&#21482;&#26377;&#22312;<code class="literal">&#25554;&#20837;&#65288;INSERT&#65289;</code>&#21644;<code class="literal">&#21024;&#38500;&#65288;DELETE&#65289;</code> &#25805;&#20316;&#26102;&#8220;&#25913;&#21464;&#8221;&#25165;&#26377;&#25928;&#12290;&#20877;&#27425;&#24378;&#35843;&#65306;&#36825;&#27573;&#35752;&#35770;&#23545;&#8220;&#19968;&#23545;&#22810;&#20851;&#32852;&#8221;&#24182;&#19981;&#36866;&#29992;&#12290; 
            </p>
            <p>&#27880;&#24847;&#21040;&#25968;&#32452;&#26080;&#27861;&#24310;&#36831;&#36733;&#20837;&#65292;&#25105;&#20204;&#21487;&#20197;&#24471;&#20986;&#32467;&#35770;&#65292;list, map&#21644;idbags&#26159;&#26368;&#39640;&#25928;&#30340;&#65288;&#38750;&#21453;&#21521;&#65289;&#38598;&#21512;&#31867;&#22411;&#65292;set&#21017;&#32039;&#38543;&#20854;&#21518;&#12290; &#22312;Hibernate&#20013;&#65292;set&#24212;&#35813;&#26102;&#26368;&#36890;&#29992;&#30340;&#38598;&#21512;&#31867;&#22411;&#65292;&#36825;&#26102;&#22240;&#20026;&#8220;set&#8221;&#30340;&#35821;&#20041;&#22312;&#20851;&#31995;&#27169;&#22411;&#20013;&#26159;&#26368;&#33258;&#28982;&#30340;&#12290; </p>
            <p>&#20294;&#26159;&#65292;&#22312;&#35774;&#35745;&#33391;&#22909;&#30340;Hibernate&#39046;&#22495;&#27169;&#22411;&#20013;&#65292;&#25105;&#20204;&#36890;&#24120;&#21487;&#20197;&#30475;&#21040;&#26356;&#22810;&#30340;&#38598;&#21512;&#20107;&#23454;&#19978;&#26159;&#24102;&#26377;<code class="literal">inverse="true"</code> &#30340;&#19968;&#23545;&#22810;&#30340;&#20851;&#32852;&#12290;&#23545;&#20110;&#36825;&#20123;&#20851;&#32852;&#65292;&#26356;&#26032;&#25805;&#20316;&#23558;&#20250;&#22312;&#22810;&#23545;&#19968;&#30340;&#36825;&#19968;&#31471;&#36827;&#34892;&#22788;&#29702;&#12290;&#22240;&#27492;&#23545;&#20110;&#27492;&#31867;&#24773;&#20917;&#65292;&#26080;&#38656;&#32771;&#34385;&#20854;&#38598;&#21512;&#30340;&#26356;&#26032;&#24615;&#33021;&#12290; 
            </p>
         </div>
         <div class="sect2" lang="zh-CN">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="performance-collections-mostefficentinverse"></a>19.5.3.&nbsp;Bag&#21644;list&#26159;&#21453;&#21521;&#38598;&#21512;&#31867;&#20013;&#25928;&#29575;&#26368;&#39640;&#30340;
                     </h3>
                  </div>
               </div>
            </div>
            <p>&#22312;&#25226;bag&#25172;&#36827;&#27700;&#27807;&#20043;&#21069;&#65292;&#20320;&#24517;&#39035;&#20102;&#35299;&#65292;&#22312;&#19968;&#31181;&#24773;&#20917;&#19979;&#65292;bag&#30340;&#24615;&#33021;(&#21253;&#25324;list)&#35201;&#27604;set&#39640;&#24471;&#22810;&#65306; &#23545;&#20110;&#25351;&#26126;&#20102;<code class="literal">inverse="true"</code>&#30340;&#38598;&#21512;&#31867;&#65288;&#27604;&#22914;&#35828;&#65292;&#26631;&#20934;&#30340;&#21452;&#21521;&#30340;&#19968;&#23545;&#22810;&#20851;&#32852;&#65289;&#65292; &#25105;&#20204;&#21487;&#20197;&#22312;&#26410;&#21021;&#22987;&#21270;(fetch)&#21253;&#20803;&#32032;&#30340;&#24773;&#20917;&#19979;&#30452;&#25509;&#21521;bag&#25110;list&#28155;&#21152;&#26032;&#20803;&#32032;&#65281; &#36825;&#26159;&#22240;&#20026;<code class="literal">Collection.add()</code>)&#25110;&#32773;<code class="literal">Collection.addAll()</code> &#26041;&#27861; &#23545;bag&#25110;&#32773;List&#24635;&#26159;&#36820;&#22238;true&#65288;&#36825;&#28857;&#19982;&#19982;Set&#19981;&#21516;&#65289;&#12290;&#22240;&#27492;&#23545;&#20110;&#19979;&#38754;&#30340;&#30456;&#21516;&#20195;&#30721;&#26469;&#35828;&#65292;&#36895;&#24230;&#20250;&#24555;&#24471;&#22810;&#12290; 
            </p><pre class="programlisting">Parent p = (Parent) sess.load(Parent.class, id);
Child c = new Child();
c.setParent(p);
p.getChildren().add(c);  //no need to fetch the collection!
sess.flush();</pre></div>
         <div class="sect2" lang="zh-CN">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="performance-collections-oneshotdelete"></a>19.5.4.&nbsp;&#19968;&#27425;&#24615;&#21024;&#38500;&#65288;One shot delete&#65289;
                     </h3>
                  </div>
               </div>
            </div>
            <p>&#20598;&#23572;&#30340;&#65292;&#36880;&#20010;&#21024;&#38500;&#38598;&#21512;&#31867;&#20013;&#30340;&#20803;&#32032;&#26159;&#30456;&#24403;&#20302;&#25928;&#30340;&#12290;Hibernate&#24182;&#27809;&#37027;&#20040;&#31528;&#65292; &#22914;&#26524;&#20320;&#24819;&#35201;&#25226;&#25972;&#20010;&#38598;&#21512;&#37117;&#21024;&#38500;&#65288;&#27604;&#22914;&#35828;&#35843;&#29992;list.clear()&#65289;&#65292;Hibernate&#21482;&#38656;&#35201;&#19968;&#20010;DELETE&#23601;&#25630;&#23450;&#20102;&#12290; </p>
            <p>&#20551;&#35774;&#25105;&#20204;&#22312;&#19968;&#20010;&#38271;&#24230;&#20026;20&#30340;&#38598;&#21512;&#31867;&#20013;&#26032;&#22686;&#21152;&#20102;&#19968;&#20010;&#20803;&#32032;&#65292;&#28982;&#21518;&#20877;&#21024;&#38500;&#20004;&#20010;&#12290; Hibernate&#20250;&#23433;&#25490;&#19968;&#26465;<code class="literal">INSERT</code>&#35821;&#21477;&#21644;&#20004;&#26465;<code class="literal">DELETE</code>&#35821;&#21477;&#65288;&#38500;&#38750;&#38598;&#21512;&#31867;&#26159;&#19968;&#20010;bag)&#12290; &#36825;&#24403;&#28982;&#26159;&#26174;&#32780;&#26131;&#35265;&#30340;&#12290; 
            </p>
            <p>&#20294;&#26159;&#65292;&#20551;&#35774;&#25105;&#20204;&#21024;&#38500;&#20102;18&#20010;&#25968;&#25454;&#65292;&#21482;&#21097;&#19979;2&#20010;&#65292;&#28982;&#21518;&#26032;&#22686;3&#20010;&#12290;&#21017;&#26377;&#20004;&#31181;&#22788;&#29702;&#26041;&#24335;&#65306; </p>
            <div class="itemizedlist">
               <ul type="disc">
                  <li>
                     <p>&#36880;&#19968;&#30340;&#21024;&#38500;&#36825;18&#20010;&#25968;&#25454;&#65292;&#20877;&#26032;&#22686;&#19977;&#20010;&#65307;</p>
                  </li>
                  <li>
                     <p>&#21024;&#38500;&#25972;&#20010;&#38598;&#21512;&#31867;&#65288;&#21482;&#29992;&#19968;&#21477;DELETE&#35821;&#21477;&#65289;&#65292;&#28982;&#21518;&#22686;&#21152;5&#20010;&#25968;&#25454;&#12290;</p>
                  </li>
               </ul>
            </div>
            <p>Hibernate&#36824;&#27809;&#37027;&#20040;&#32874;&#26126;&#65292;&#30693;&#36947;&#31532;&#20108;&#31181;&#36873;&#25321;&#21487;&#33021;&#20250;&#27604;&#36739;&#24555;&#12290; &#65288;&#20063;&#35768;&#35753;Hibernate&#19981;&#36825;&#20040;&#32874;&#26126;&#20063;&#26159;&#22909;&#20107;&#65292;&#21542;&#21017;&#21487;&#33021;&#20250;&#24341;&#21457;&#24847;&#22806;&#30340;&#8220;&#25968;&#25454;&#24211;&#35302;&#21457;&#22120;&#8221;&#20043;&#31867;&#30340;&#38382;&#39064;&#12290;&#65289; </p>
            <p>&#24184;&#36816;&#30340;&#26159;&#65292;&#20320;&#21487;&#20197;&#24378;&#21046;&#20351;&#29992;&#31532;&#20108;&#31181;&#31574;&#30053;&#12290;&#20320;&#38656;&#35201;&#21462;&#28040;&#21407;&#26469;&#30340;&#25972;&#20010;&#38598;&#21512;&#31867;&#65288;&#35299;&#38500;&#20854;&#24341;&#29992;&#65289;&#65292; &#28982;&#21518;&#20877;&#36820;&#22238;&#19968;&#20010;&#26032;&#30340;&#23454;&#20363;&#21270;&#30340;&#38598;&#21512;&#31867;&#65292;&#21482;&#21253;&#21547;&#38656;&#35201;&#30340;&#20803;&#32032;&#12290;&#26377;&#20123;&#26102;&#20505;&#36825;&#26159;&#38750;&#24120;&#26377;&#29992;&#30340;&#12290; </p>
            <p>&#26174;&#28982;&#65292;&#19968;&#27425;&#24615;&#21024;&#38500;&#24182;&#19981;&#36866;&#29992;&#20110;&#34987;&#26144;&#23556;&#20026;<code class="literal">inverse="true"</code>&#30340;&#38598;&#21512;&#12290; 
            </p>
         </div>
      </div>
      <div class="navfooter">
         <hr>
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left"><a accesskey="p" href="performance-querycache.html">&#19978;&#19968;&#39029;</a>&nbsp;
               </td>
               <td width="20%" align="center"><a accesskey="u" href="performance.html">&#19978;&#19968;&#32423;</a></td>
               <td width="40%" align="right">&nbsp;<a accesskey="n" href="performance-monitoring.html">&#19979;&#19968;&#39029;</a></td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top">19.4.&nbsp;&#26597;&#35810;&#32531;&#23384;&#65288;The Query Cache&#65289;&nbsp;</td>
               <td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td>
               <td width="40%" align="right" valign="top">&nbsp;19.6.&nbsp;&#30417;&#27979;&#24615;&#33021;&#65288;Monitoring performance&#65289;</td>
            </tr>
         </table>
      </div>
   </body>
</html>