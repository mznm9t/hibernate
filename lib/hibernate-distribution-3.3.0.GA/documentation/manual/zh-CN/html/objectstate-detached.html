<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>10.6.&nbsp;&#20462;&#25913;&#33073;&#31649;(Detached)&#23545;&#35937;</title>
      <link rel="stylesheet" href="css/html.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
      <link rel="start" href="index.html" title="HIBERNATE - &#31526;&#21512;Java&#20064;&#24815;&#30340;&#20851;&#31995;&#25968;&#25454;&#24211;&#25345;&#20037;&#21270;">
      <link rel="up" href="objectstate.html" title="&#31532;&nbsp;10&nbsp;&#31456;&nbsp;&#19982;&#23545;&#35937;&#20849;&#20107;">
      <link rel="prev" href="objectstate-modifying.html" title="10.5.&nbsp;&#20462;&#25913;&#25345;&#20037;&#23545;&#35937;">
      <link rel="next" href="objectstate-saveorupdate.html" title="10.7.&nbsp;&#33258;&#21160;&#29366;&#24577;&#26816;&#27979;">
   </head>
   <body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
      <div class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center">10.6.&nbsp;&#20462;&#25913;&#33073;&#31649;(Detached)&#23545;&#35937;</th>
            </tr>
            <tr>
               <td width="20%" align="left"><a accesskey="p" href="objectstate-modifying.html">&#19978;&#19968;&#39029;</a>&nbsp;
               </td>
               <th width="60%" align="center">&#31532;&nbsp;10&nbsp;&#31456;&nbsp;&#19982;&#23545;&#35937;&#20849;&#20107;</th>
               <td width="20%" align="right">&nbsp;<a accesskey="n" href="objectstate-saveorupdate.html">&#19979;&#19968;&#39029;</a></td>
            </tr>
         </table>
         <hr>
      </div>
      <div class="sect1" lang="zh-CN">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title" style="clear: both"><a name="objectstate-detached"></a>10.6.&nbsp;&#20462;&#25913;&#33073;&#31649;(Detached)&#23545;&#35937;
                  </h2>
               </div>
            </div>
         </div>
         <p>&#24456;&#22810;&#31243;&#24207;&#38656;&#35201;&#22312;&#26576;&#20010;&#20107;&#21153;&#20013;&#33719;&#21462;&#23545;&#35937;&#65292;&#28982;&#21518;&#23558;&#23545;&#35937;&#21457;&#36865;&#21040;&#30028;&#38754;&#23618;&#21435;&#25805;&#20316;&#65292;&#26368;&#21518;&#22312;&#19968;&#20010;&#26032;&#30340;&#20107;&#21153;&#20445;&#23384;&#25152;&#20570;&#30340;&#20462;&#25913;&#12290; &#22312;&#39640;&#24182;&#21457;&#35775;&#38382;&#30340;&#29615;&#22659;&#20013;&#20351;&#29992;&#36825;&#31181;&#26041;&#24335;&#65292;&#36890;&#24120;&#20351;&#29992;&#38468;&#24102;&#29256;&#26412;&#20449;&#24687;&#30340;&#25968;&#25454;&#26469;&#20445;&#35777;&#36825;&#20123;&#8220;&#38271;&#8220;&#24037;&#20316;&#21333;&#20803;&#20043;&#38388;&#30340;&#38548;&#31163;&#12290; </p>
         <p>Hibernate&#36890;&#36807;&#25552;&#20379;<code class="literal">Session.update()</code>&#25110;<code class="literal">Session.merge()</code> &#37325;&#26032;&#20851;&#32852;&#33073;&#31649;&#23454;&#20363;&#30340;&#21150;&#27861;&#26469;&#25903;&#25345;&#36825;&#31181;&#27169;&#22411;&#12290; 
         </p><pre class="programlisting">// in the first session
Cat cat = (Cat) firstSession.load(Cat.class, catId);
Cat potentialMate = new Cat();
firstSession.save(potentialMate);

// in a higher layer of the application
cat.setMate(potentialMate);

// later, in a new session
secondSession.update(cat);  // update cat
secondSession.update(mate); // update mate</pre><p>&#22914;&#26524;&#20855;&#26377;<code class="literal">catId</code>&#25345;&#20037;&#21270;&#26631;&#35782;&#30340;<code class="literal">Cat</code>&#20043;&#21069;&#24050;&#32463;&#34987;<code class="literal">&#21478;&#19968;Session(secondSession)</code>&#35013;&#36733;&#20102;&#65292; &#24212;&#29992;&#31243;&#24207;&#36827;&#34892;&#37325;&#20851;&#32852;&#25805;&#20316;(reattach)&#30340;&#26102;&#20505;&#20250;&#25243;&#20986;&#19968;&#20010;&#24322;&#24120;&#12290; 
         </p>
         <p>&#22914;&#26524;&#20320;&#30830;&#23450;&#24403;&#21069;session&#27809;&#26377;&#21253;&#21547;&#19982;&#20043;&#20855;&#26377;&#30456;&#21516;&#25345;&#20037;&#21270;&#26631;&#35782;&#30340;&#25345;&#20037;&#23454;&#20363;&#65292;&#20351;&#29992;<code class="literal">update()</code>&#12290; &#22914;&#26524;&#24819;&#38543;&#26102;&#21512;&#24182;&#20320;&#30340;&#30340;&#25913;&#21160;&#32780;&#19981;&#32771;&#34385;session&#30340;&#29366;&#24577;&#65292;&#20351;&#29992;<code class="literal">merge()</code>&#12290; &#25442;&#21477;&#35805;&#35828;&#65292;&#22312;&#19968;&#20010;&#26032;session&#20013;&#36890;&#24120;&#31532;&#19968;&#20010;&#35843;&#29992;&#30340;&#26159;<code class="literal">update()</code>&#26041;&#27861;&#65292;&#20197;&#20415;&#20445;&#35777;&#37325;&#26032;&#20851;&#32852;&#33073;&#31649;(detached)&#23545;&#35937;&#30340;&#25805;&#20316;&#39318;&#20808;&#34987;&#25191;&#34892;&#12290; 
         </p>
         <p>&#22914;&#26524;&#24076;&#26395;&#30456;&#20851;&#32852;&#30340;&#33073;&#31649;&#23545;&#35937;&#65288;&#36890;&#36807;&#24341;&#29992;&#8220;&#21487;&#21040;&#36798;&#8221;&#30340;&#33073;&#31649;&#23545;&#35937;&#65289;&#30340;&#25968;&#25454;&#20063;&#35201;&#26356;&#26032;&#21040;&#25968;&#25454;&#24211;&#26102;&#65288;&#24182;&#19988;&#20063;<span class="emphasis"><em>&#20165;&#20165;</em></span>&#22312;&#36825;&#31181;&#24773;&#20917;&#65289;&#65292; &#21487;&#20197;&#23545;&#35813;&#30456;&#20851;&#32852;&#30340;&#33073;&#31649;&#23545;&#35937;&#21333;&#29420;&#35843;&#29992;<code class="literal">update()</code> &#24403;&#28982;&#36825;&#20123;&#21487;&#20197;&#33258;&#21160;&#23436;&#25104;&#65292;&#21363;&#36890;&#36807;&#20351;&#29992;<span class="emphasis"><em>&#20256;&#25773;&#24615;&#25345;&#20037;&#21270;(transitive persistence)</em></span>&#65292;&#35831;&#30475;<a href="objectstate-transitive.html" title="10.11.&nbsp;&#20256;&#25773;&#24615;&#25345;&#20037;&#21270;(transitive persistence)">&#31532;&nbsp;10.11&nbsp;&#33410; &#8220;&#20256;&#25773;&#24615;&#25345;&#20037;&#21270;(transitive persistence)&#8221;</a>&#12290; 
         </p>
         <p><code class="literal">lock()</code>&#26041;&#27861;&#20063;&#20801;&#35768;&#31243;&#24207;&#37325;&#26032;&#20851;&#32852;&#26576;&#20010;&#23545;&#35937;&#21040;&#19968;&#20010;&#26032;session&#19978;&#12290;&#19981;&#36807;&#65292;&#35813;&#33073;&#31649;(detached)&#30340;&#23545;&#35937;&#24517;&#39035;&#26159;&#27809;&#26377;&#20462;&#25913;&#36807;&#30340;&#65281; 
         </p><pre class="programlisting">//just reassociate:
sess.lock(fritz, LockMode.NONE);
//do a version check, then reassociate:
sess.lock(izi, LockMode.READ);
//do a version check, using SELECT ... FOR UPDATE, then reassociate:
sess.lock(pk, LockMode.UPGRADE);</pre><p>&#35831;&#27880;&#24847;&#65292;<code class="literal">lock()</code>&#21487;&#20197;&#25645;&#37197;&#22810;&#31181;<code class="literal">LockMode</code>&#65292; &#26356;&#22810;&#20449;&#24687;&#35831;&#38405;&#35835;API&#25991;&#26723;&#20197;&#21450;&#20851;&#20110;&#20107;&#21153;&#22788;&#29702;(transaction handling)&#30340;&#31456;&#33410;&#12290;&#37325;&#26032;&#20851;&#32852;&#19981;&#26159;<code class="literal">lock()</code>&#30340;&#21807;&#19968;&#29992;&#36884;&#12290; 
         </p>
         <p>&#20854;&#20182;&#29992;&#20110;&#38271;&#26102;&#38388;&#24037;&#20316;&#21333;&#20803;&#30340;&#27169;&#22411;&#20250;&#22312;<a href="transactions-optimistic.html" title="11.3.&nbsp;&#20048;&#35266;&#24182;&#21457;&#25511;&#21046;(Optimistic concurrency control)">&#31532;&nbsp;11.3&nbsp;&#33410; &#8220;&#20048;&#35266;&#24182;&#21457;&#25511;&#21046;(Optimistic concurrency control)&#8221;</a>&#20013;&#35752;&#35770;&#12290; 
         </p>
      </div>
      <div class="navfooter">
         <hr>
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left"><a accesskey="p" href="objectstate-modifying.html">&#19978;&#19968;&#39029;</a>&nbsp;
               </td>
               <td width="20%" align="center"><a accesskey="u" href="objectstate.html">&#19978;&#19968;&#32423;</a></td>
               <td width="40%" align="right">&nbsp;<a accesskey="n" href="objectstate-saveorupdate.html">&#19979;&#19968;&#39029;</a></td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top">10.5.&nbsp;&#20462;&#25913;&#25345;&#20037;&#23545;&#35937;&nbsp;</td>
               <td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td>
               <td width="40%" align="right" valign="top">&nbsp;10.7.&nbsp;&#33258;&#21160;&#29366;&#24577;&#26816;&#27979;</td>
            </tr>
         </table>
      </div>
   </body>
</html>