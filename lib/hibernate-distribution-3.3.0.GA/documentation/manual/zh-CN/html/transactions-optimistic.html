<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>11.3.&nbsp;&#20048;&#35266;&#24182;&#21457;&#25511;&#21046;(Optimistic concurrency control)</title>
      <link rel="stylesheet" href="css/html.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
      <link rel="start" href="index.html" title="HIBERNATE - &#31526;&#21512;Java&#20064;&#24815;&#30340;&#20851;&#31995;&#25968;&#25454;&#24211;&#25345;&#20037;&#21270;">
      <link rel="up" href="transactions.html" title="&#31532;&nbsp;11&nbsp;&#31456;&nbsp;&#20107;&#21153;&#21644;&#24182;&#21457;">
      <link rel="prev" href="transactions-demarcation.html" title="11.2.&nbsp;&#25968;&#25454;&#24211;&#20107;&#21153;&#22768;&#26126;">
      <link rel="next" href="transactions-locking.html" title="11.4.&nbsp;&#24754;&#35266;&#38145;&#23450;(Pessimistic Locking)">
   </head>
   <body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
      <div class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center">11.3.&nbsp;&#20048;&#35266;&#24182;&#21457;&#25511;&#21046;(Optimistic concurrency control)</th>
            </tr>
            <tr>
               <td width="20%" align="left"><a accesskey="p" href="transactions-demarcation.html">&#19978;&#19968;&#39029;</a>&nbsp;
               </td>
               <th width="60%" align="center">&#31532;&nbsp;11&nbsp;&#31456;&nbsp;&#20107;&#21153;&#21644;&#24182;&#21457;</th>
               <td width="20%" align="right">&nbsp;<a accesskey="n" href="transactions-locking.html">&#19979;&#19968;&#39029;</a></td>
            </tr>
         </table>
         <hr>
      </div>
      <div class="sect1" lang="zh-CN">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title" style="clear: both"><a name="transactions-optimistic"></a>11.3.&nbsp;&#20048;&#35266;&#24182;&#21457;&#25511;&#21046;(Optimistic concurrency control)
                  </h2>
               </div>
            </div>
         </div>
         <p>&#21807;&#19968;&#33021;&#22815;&#21516;&#26102;&#20445;&#25345;&#39640;&#24182;&#21457;&#21644;&#39640;&#21487;&#20280;&#32553;&#24615;&#30340;&#26041;&#27861;&#23601;&#26159;&#20351;&#29992;&#24102;&#29256;&#26412;&#21270;&#30340;&#20048;&#35266;&#24182;&#21457;&#25511;&#21046;&#12290;&#29256;&#26412;&#26816;&#26597;&#20351;&#29992;&#29256;&#26412;&#21495;&#12289; &#25110;&#32773;&#26102;&#38388;&#25139;&#26469;&#26816;&#27979;&#26356;&#26032;&#20914;&#31361;&#65288;&#24182;&#19988;&#38450;&#27490;&#26356;&#26032;&#20002;&#22833;&#65289;&#12290;Hibernate&#20026;&#20351;&#29992;&#20048;&#35266;&#24182;&#21457;&#25511;&#21046;&#30340;&#20195;&#30721;&#25552;&#20379;&#20102;&#19977;&#31181;&#21487; &#33021;&#30340;&#26041;&#27861;&#65292;&#24212;&#29992;&#31243;&#24207;&#22312;&#32534;&#20889;&#36825;&#20123;&#20195;&#30721;&#26102;&#65292;&#21487;&#20197;&#37319;&#29992;&#23427;&#20204;&#12290;&#25105;&#20204;&#24050;&#32463;&#22312;&#21069;&#38754;&#24212;&#29992;&#31243;&#24207;&#23545;&#35805;&#37027;&#37096;&#20998;&#23637;&#31034;&#20102;
            &#20048;&#35266;&#24182;&#21457;&#25511;&#21046;&#30340;&#24212;&#29992;&#22330;&#26223;&#65292;&#27492;&#22806;&#65292;&#22312;&#21333;&#20010;&#25968;&#25454;&#24211;&#20107;&#21153;&#33539;&#22260;&#20869;&#65292;&#29256;&#26412;&#26816;&#26597;&#20063;&#25552;&#20379;&#20102;&#38450;&#27490;&#26356;&#26032;&#20002;&#22833;&#30340;&#22909;&#22788;&#12290; 
         </p>
         <div class="sect2" lang="zh-CN">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="transactions-optimistic-manual"></a>11.3.1.&nbsp;&#24212;&#29992;&#31243;&#24207;&#32423;&#21035;&#30340;&#29256;&#26412;&#26816;&#26597;(Application version checking)
                     </h3>
                  </div>
               </div>
            </div>
            <p>&#26410;&#33021;&#20805;&#20998;&#21033;&#29992;Hibernate&#21151;&#33021;&#30340;&#23454;&#29616;&#20195;&#30721;&#20013;&#65292;&#27599;&#27425;&#21644;&#25968;&#25454;&#24211;&#20132;&#20114;&#37117;&#38656;&#35201;&#19968;&#20010;&#26032;&#30340; <code class="literal">Session</code>&#65292;&#32780;&#19988;&#24320;&#21457;&#20154;&#21592;&#24517;&#39035;&#22312;&#26174;&#31034;&#25968;&#25454;&#20043;&#21069;&#20174;&#25968;&#25454;&#24211;&#20013;&#37325; &#26032;&#36733;&#20837;&#25152;&#26377;&#30340;&#25345;&#20037;&#21270;&#23545;&#35937;&#23454;&#20363;&#12290;&#36825;&#31181;&#26041;&#24335;&#36843;&#20351;&#24212;&#29992;&#31243;&#24207;&#33258;&#24049;&#23454;&#29616;&#29256;&#26412;&#26816;&#26597;&#26469;&#30830;&#20445; &#23545;&#35805;&#20107;&#21153;&#30340;&#38548;&#31163;&#65292;&#20174;&#25968;&#25454;&#35775;&#38382;&#30340;&#35282;&#24230;&#26469;&#35828;&#26159;&#26368;&#20302;&#25928;&#30340;&#12290;&#36825;&#31181;&#20351;&#29992;&#26041;&#24335;&#21644; entity EJB&#26368;&#30456;&#20284;&#12290; 
            </p><pre class="programlisting">// foo is an instance loaded by a previous Session
session = factory.openSession();
Transaction t = session.beginTransaction();

int oldVersion = foo.getVersion();
session.load( foo, foo.getKey() ); // load the current state
if ( oldVersion != foo.getVersion() ) throw new StaleObjectStateException();
foo.setProperty("bar");

t.commit();
session.close();</pre><p><code class="literal">version</code> &#23646;&#24615;&#20351;&#29992; <code class="literal">&lt;version&gt;</code>&#26469;&#26144;&#23556;&#65292;&#22914;&#26524;&#23545;&#35937; &#26159;&#33039;&#25968;&#25454;&#65292;&#22312;&#21516;&#27493;&#30340;&#26102;&#20505;&#65292;Hibernate&#20250;&#33258;&#21160;&#22686;&#21152;&#29256;&#26412;&#21495;&#12290; 
            </p>
            <p>&#24403;&#28982;&#65292;&#22914;&#26524;&#20320;&#30340;&#24212;&#29992;&#26159;&#22312;&#19968;&#20010;&#20302;&#25968;&#25454;&#24182;&#21457;&#29615;&#22659;&#19979;&#65292;&#24182;&#19981;&#38656;&#35201;&#29256;&#26412;&#26816;&#26597;&#30340;&#35805;&#65292;&#20320;&#29031;&#26679;&#21487;&#20197;&#20351;&#29992; &#36825;&#31181;&#26041;&#24335;&#65292;&#21482;&#19981;&#36807;&#36339;&#36807;&#29256;&#26412;&#26816;&#26597;&#23601;&#26159;&#20102;&#12290;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;<span class="emphasis"><em>&#26368;&#26202;&#25552;&#20132;&#29983;&#25928;</em></span> &#65288;<span class="emphasis"><em>last commit wins</em></span>&#65289;&#23601;&#26159;&#20320;&#30340;&#38271;&#23545;&#35805;&#30340;&#40664;&#35748;&#22788;&#29702;&#31574;&#30053;&#12290; &#35831;&#35760;&#20303;&#36825;&#31181;&#31574;&#30053;&#21487;&#33021;&#20250;&#35753;&#24212;&#29992;&#36719;&#20214;&#30340;&#29992;&#25143;&#24863;&#21040;&#22256;&#24785;&#65292;&#22240;&#20026;&#20182;&#20204;&#26377;&#21487;&#33021;&#20250;&#30896;&#19978;&#26356;&#26032;&#20002;&#22833;&#25481;&#21364;&#27809; &#26377;&#20986;&#38169;&#20449;&#24687;&#65292;&#25110;&#32773;&#38656;&#35201;&#21512;&#24182;&#26356;&#25913;&#20914;&#31361;&#30340;&#24773;&#20917;&#12290; 
            </p>
            <p>Clearly, manual version checking is only feasible in very trivial circumstances and not practical for most applications. Often
               not only single instances, but complete graphs of modified objects have to be checked. Hibernate offers automatic version
               checking with either an extended <code class="literal">Session</code> or detached instances as the design paradigm. 
            </p>
         </div>
         <div class="sect2" lang="zh-CN">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="transactions-optimistic-longsession"></a>11.3.2.&nbsp;&#25193;&#23637;&#21608;&#26399;&#30340;session&#21644;&#33258;&#21160;&#29256;&#26412;&#21270;
                     </h3>
                  </div>
               </div>
            </div>
            <p>&#21333;&#20010; <code class="literal">Session</code>&#23454;&#20363;&#21644;&#23427;&#25152;&#20851;&#32852;&#30340;&#25152;&#26377;&#25345;&#20037;&#21270;&#23545;&#35937;&#23454;&#20363;&#37117;&#34987;&#29992;&#20110;&#25972;&#20010; &#23545;&#35805;&#65292;&#36825;&#34987;&#31216;&#20026;<span class="emphasis"><em>session-per-conversation</em></span>&#12290;Hibernate&#22312;&#21516;&#27493;&#30340;&#26102;&#20505;&#36827;&#34892;&#23545;&#35937;&#23454;&#20363;&#30340;&#29256;&#26412;&#26816;&#26597;&#65292;&#22914;&#26524;&#26816;&#27979;&#21040;&#24182;&#21457;&#20462; &#25913;&#21017;&#25243;&#20986;&#24322;&#24120;&#12290;&#30001;&#24320;&#21457;&#20154;&#21592;&#26469;&#20915;&#23450;&#26159;&#21542;&#38656;&#35201;&#25429;&#33719;&#21644;&#22788;&#29702;&#36825;&#20010;&#24322;&#24120;&#65288;&#36890;&#24120;&#30340;&#25225;&#25321;&#26159;&#32473;&#29992;&#25143; &#25552;&#20379;&#19968;&#20010;&#21512;&#24182;&#26356;&#25913;&#65292;&#25110;&#32773;&#22312;&#26080;&#33039;&#25968;&#25454;&#24773;&#20917;&#19979;&#37325;&#26032;&#36827;&#34892;&#19994;&#21153;&#23545;&#35805;&#30340;&#26426;&#20250;&#65289;&#12290; 
            </p>
            <p>&#22312;&#31561;&#24453;&#29992;&#25143;&#20132;&#20114;&#30340;&#26102;&#20505;&#65292; <code class="literal">Session</code> &#26029;&#24320;&#24213;&#23618;&#30340;JDBC&#36830;&#25509;&#12290;&#36825;&#31181;&#26041;&#24335; &#20197;&#25968;&#25454;&#24211;&#35775;&#38382;&#30340;&#35282;&#24230;&#26469;&#35828;&#26159;&#26368;&#39640;&#25928;&#30340;&#26041;&#24335;&#12290;&#24212;&#29992;&#31243;&#24207;&#19981;&#38656;&#35201;&#20851;&#24515;&#29256;&#26412;&#26816;&#26597;&#25110;&#33073;&#31649;&#23545;&#35937;&#23454;&#20363; &#30340;&#37325;&#26032;&#20851;&#32852;&#65292;&#22312;&#27599;&#20010;&#25968;&#25454;&#24211;&#20107;&#21153;&#20013;&#65292;&#24212;&#29992;&#31243;&#24207;&#20063;&#19981;&#38656;&#35201;&#36733;&#20837;&#35835;&#21462;&#23545;&#35937;&#23454;&#20363;&#12290; 
            </p><pre class="programlisting">// foo is an instance loaded earlier by the old session
Transaction t = session.beginTransaction(); // Obtain a new JDBC connection, start transaction

foo.setProperty("bar");

session.flush();    // Only for last transaction in conversation
t.commit();         // Also return JDBC connection
session.close();    // Only for last transaction in conversation</pre><p><code class="literal">foo</code>&#23545;&#35937;&#30693;&#36947;&#23427;&#26159;&#22312;&#21738;&#20010;<code class="literal">Session</code>&#20013;&#34987;&#35013;&#20837;&#30340;&#12290;&#22312;&#19968;&#20010;&#26087;session&#20013;&#24320;&#21551;&#19968;&#20010;&#26032;&#30340;&#25968;&#25454;&#24211;&#20107;&#21153;&#65292;&#20250;&#23548;&#33268;session&#33719;&#21462;&#19968;&#20010;&#26032;&#30340;&#36830;&#25509;&#65292;&#24182;&#24674;&#22797;session&#30340;&#21151;&#33021;&#12290;&#23558;&#25968;&#25454;&#24211;&#20107;&#21153;&#25552;&#20132;&#65292;&#20351;&#24471;session&#20174;JDBC&#36830;&#25509;&#26029;&#24320;&#65292;&#24182;&#23558;&#27492;&#36830;&#25509;&#20132;&#36824;&#32473;&#36830;&#25509;&#27744;&#12290;&#22312;&#37325;&#26032;&#36830;&#25509;&#20043;&#21518;&#65292;&#35201;&#24378;&#21046;&#23545;&#20320;&#27809;&#26377;&#26356;&#26032;&#30340;&#25968;&#25454;&#36827;&#34892;&#19968;&#27425;&#29256;&#26412;&#26816;&#26597;&#65292;&#20320;&#21487;&#20197;&#23545;&#25152;&#26377;&#21487;&#33021;&#34987;&#20854;&#20182;&#20107;&#21153;&#20462;&#25913;&#36807;&#30340;&#23545;&#35937;&#65292;&#20351;&#29992;&#21442;&#25968;<code class="literal">LockMode.READ</code>&#26469;&#35843;&#29992;<code class="literal">Session.lock()</code>&#12290;&#20320;&#19981;&#29992;lock&#20219;&#20309;&#20320;<span class="emphasis"><em>&#27491;&#22312;</em></span>&#26356;&#26032;&#30340;&#25968;&#25454;&#12290;&#19968;&#33324;&#20320;&#20250;&#22312;&#25193;&#23637;&#30340;<code class="literal">Session</code>&#19978;&#35774;&#32622;<code class="literal">FlushMode.MANUAL</code>&#65292;&#22240;&#27492;&#21482;&#26377;&#26368;&#21518;&#19968;&#20010;&#25968;&#25454;&#24211;&#20107;&#21153;&#24490;&#29615;&#25165;&#20250;&#30495;&#27491;&#30340;&#21543;&#25972;&#20010;&#23545;&#35805;&#20013;&#21457;&#29983;&#30340;&#20462;&#25913;&#21457;&#36865;&#21040;&#25968;&#25454;&#24211;&#12290;&#22240;&#27492;&#65292;&#21482;&#26377;&#36825;&#26368;&#21518;&#19968;&#27425;&#25968;&#25454;&#24211;&#20107;&#21153;&#25165;&#20250;&#21253;&#21547;<code class="literal">flush()</code>&#25805;&#20316;&#65292;&#28982;&#21518;&#22312;&#25972;&#20010;&#23545;&#35805;&#32467;&#26463;&#21518;&#65292;&#36824;&#35201;<code class="literal">close()</code>&#36825;&#20010;session&#12290; 
            </p>
            <p>&#22914;&#26524;&#22312;&#29992;&#25143;&#24605;&#32771;&#30340;&#36807;&#31243;&#20013;&#65292;<code class="literal">Session</code>&#22240;&#20026;&#22826;&#22823;&#20102;&#32780;&#19981;&#33021;&#20445;&#23384;&#65292;&#37027;&#20040;&#36825;&#31181;&#27169;&#24335;&#26159;&#26377; &#38382;&#39064;&#30340;&#12290;&#20030;&#20363;&#26469;&#35828;&#65292;&#19968;&#20010;<code class="literal">HttpSession</code>&#24212;&#35813;&#23613;&#21487;&#33021;&#30340;&#23567;&#12290;&#30001;&#20110; <code class="literal">Session</code>&#26159;&#19968;&#32423;&#32531;&#23384;&#65292;&#24182;&#19988;&#20445;&#25345;&#20102;&#25152;&#26377;&#34987;&#36733;&#20837;&#36807;&#30340;&#23545;&#35937;&#65292;&#22240;&#27492; &#25105;&#20204;&#21482;&#24212;&#35813;&#22312;&#37027;&#20123;&#23569;&#37327;&#30340;request/response&#24773;&#20917;&#19979;&#20351;&#29992;&#36825;&#31181;&#31574;&#30053;&#12290;&#20320;&#24212;&#35813;&#21482;&#25226;&#19968;&#20010;<code class="literal">Session</code>&#29992;&#20110;&#21333;&#20010;&#23545;&#35805;&#65292;&#22240;&#20026;&#23427;&#24456;&#24555;&#23601;&#20250;&#20986;&#29616;&#33039;&#25968;&#25454;&#12290; 
            </p>
            <p>&#65288;&#27880;&#24847;&#65292;&#26089;&#26399;&#30340;Hibernate&#29256;&#26412;&#38656;&#35201;&#26126;&#30830;&#30340;&#23545;<code class="literal">Session</code>&#36827;&#34892;disconnec&#21644;reconnect&#12290;&#36825;&#20123;&#26041;&#27861;&#29616;&#22312;&#24050;&#32463;&#36807;&#26102;&#20102;&#65292;&#25171;&#24320;&#20107;&#21153;&#21644;&#20851;&#38381;&#20107;&#21153;&#20250;&#36215;&#21040;&#21516;&#26679;&#30340;&#25928;&#26524;&#12290;&#65289; 
            </p>
            <p>&#27492;&#22806;&#65292;&#20063;&#35831;&#27880;&#24847;&#65292;&#20320;&#24212;&#35813;&#35753;&#19982;&#25968;&#25454;&#24211;&#36830;&#25509;&#26029;&#24320;&#30340;<code class="literal">Session</code>&#23545;&#25345;&#20037;&#23618;&#20445;&#25345; &#20851;&#38381;&#29366;&#24577;&#12290;&#25442;&#21477;&#35805;&#35828;&#65292;&#22312;&#19977;&#23618;&#29615;&#22659;&#20013;&#65292;&#20351;&#29992;&#26377;&#29366;&#24577;&#30340;EJB session bean&#26469;&#25345;&#26377;<code class="literal">Session</code>&#65292; &#32780;&#19981;&#35201;&#25226;&#23427;&#20256;&#36882;&#21040;web&#23618;&#65288;&#29978;&#33267;&#25226;&#23427;&#24207;&#21015;&#21270;&#21040;&#19968;&#20010;&#21333;&#29420;&#30340;&#23618;&#65289;&#65292;&#20445;&#23384;&#22312;<code class="literal">HttpSession</code>&#20013;&#12290; 
            </p>
            <p>&#25193;&#23637;session&#27169;&#24335;&#65292;&#25110;&#32773;&#34987;&#31216;&#20026;<span class="emphasis"><em>&#27599;&#27425;&#23545;&#35805;&#19968;&#20010;session(session-per-conversation)</em></span>, &#22312;&#19982;&#33258;&#21160;&#31649;&#29702;&#24403;&#21069;session&#19978;&#19979;&#25991;&#32852;&#29992;&#30340;&#26102;&#20505;&#20250;&#26356;&#22256;&#38590;&#12290;&#20320;&#38656;&#35201;&#25552;&#20379;&#20320;&#33258;&#24049;&#30340;<code class="literal">CurrentSessionContext</code>&#23454;&#29616;&#12290;&#35831;&#21442;&#38405;Hibernate Wiki&#20197;&#33719;&#24471;&#31034;&#20363;&#12290; 
            </p>
         </div>
         <div class="sect2" lang="zh-CN">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="transactions-optimistic-detached"></a>11.3.3.&nbsp;&#33073;&#31649;&#23545;&#35937;(deatched object)&#21644;&#33258;&#21160;&#29256;&#26412;&#21270;
                     </h3>
                  </div>
               </div>
            </div>
            <p>&#36825;&#31181;&#26041;&#24335;&#19979;&#65292;&#19982;&#25345;&#20037;&#21270;&#23384;&#20648;&#30340;&#27599;&#27425;&#20132;&#20114;&#37117;&#21457;&#29983;&#22312;&#19968;&#20010;&#26032;&#30340;<code class="literal">Session</code>&#20013;&#12290; &#28982;&#32780;&#65292;&#21516;&#19968;&#25345;&#20037;&#21270;&#23545;&#35937;&#23454;&#20363;&#21487;&#20197;&#22312;&#22810;&#27425;&#19982;&#25968;&#25454;&#24211;&#30340;&#20132;&#20114;&#20013;&#37325;&#29992;&#12290;&#24212;&#29992;&#31243;&#24207;&#25805;&#32437;&#33073;&#31649;&#23545;&#35937;&#23454;&#20363; &#30340;&#29366;&#24577;&#65292;&#36825;&#20010;&#33073;&#31649;&#23545;&#35937;&#23454;&#20363;&#26368;&#21021;&#26159;&#22312;&#21478;&#19968;&#20010;<code class="literal">Session</code> &#20013;&#36733;&#20837;&#30340;&#65292;&#28982;&#21518; &#35843;&#29992; <code class="literal">Session.update()</code>&#65292;<code class="literal">Session.saveOrUpdate()</code>, &#25110;&#32773; <code class="literal">Session.merge()</code> &#26469;&#37325;&#26032;&#20851;&#32852;&#35813;&#23545;&#35937;&#23454;&#20363;&#12290; 
            </p><pre class="programlisting">// foo is an instance loaded by a previous Session
foo.setProperty("bar");
session = factory.openSession();
Transaction t = session.beginTransaction();
session.saveOrUpdate(foo); // Use merge() if "foo" might have been loaded already
t.commit();
session.close();</pre><p>Again, Hibernate will check instance versions during flush, throwing an exception if conflicting updates occurred. </p>
            <p>&#22914;&#26524;&#20320;&#30830;&#20449;&#23545;&#35937;&#27809;&#26377;&#34987;&#20462;&#25913;&#36807;&#65292;&#20320;&#20063;&#21487;&#20197;&#35843;&#29992;<code class="literal">lock()</code> &#26469;&#35774;&#32622; <code class="literal">LockMode.READ</code>&#65288;&#32469;&#36807;&#25152;&#26377;&#30340;&#32531;&#23384;&#65292;&#25191;&#34892;&#29256;&#26412;&#26816;&#26597;&#65289;&#65292;&#20174;&#32780;&#21462; &#20195; <code class="literal">update()</code>&#25805;&#20316;&#12290; 
            </p>
         </div>
         <div class="sect2" lang="zh-CN">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="transactions-optimistic-customizing"></a>11.3.4.&nbsp;&#23450;&#21046;&#33258;&#21160;&#29256;&#26412;&#21270;&#34892;&#20026;
                     </h3>
                  </div>
               </div>
            </div>
            <p>&#23545;&#20110;&#29305;&#23450;&#30340;&#23646;&#24615;&#21644;&#38598;&#21512;&#65292;&#36890;&#36807;&#20026;&#23427;&#20204;&#35774;&#32622;&#26144;&#23556;&#23646;&#24615;<code class="literal">optimistic-lock</code>&#30340;&#20540; &#20026;<code class="literal">false</code>&#65292;&#26469;&#31105;&#27490;Hibernate&#30340;&#29256;&#26412;&#33258;&#21160;&#22686;&#21152;&#12290;&#36825;&#26679;&#30340;&#35805;&#65292;&#22914;&#26524;&#35813;&#23646;&#24615; &#33039;&#25968;&#25454;&#65292;Hibernate&#23558;&#19981;&#20877;&#22686;&#21152;&#29256;&#26412;&#21495;&#12290; 
            </p>
            <p>Legacy database schemas are often static and can't be modified. Or, other applications might also access the same database
               and don't know how to handle version numbers or even timestamps. In both cases, versioning can't rely on a particular column
               in a table. To force a version check without a version or timestamp property mapping, with a comparison of the state of all
               fields in a row, turn on <code class="literal">optimistic-lock="all"</code> in the <code class="literal">&lt;class&gt;</code> mapping. Note that this conceptually only works if Hibernate can compare the old and new state, i.e. if you use a single
               long <code class="literal">Session</code> and not session-per-request-with-detached-objects. 
            </p>
            <p>&#26377;&#20123;&#24773;&#20917;&#19979;&#65292;&#21482;&#35201;&#26356;&#25913;&#19981;&#21457;&#29983;&#20132;&#38169;&#65292;&#24182;&#21457;&#20462;&#25913;&#20063;&#26159;&#20801;&#35768;&#30340;&#12290;&#24403;&#20320;&#22312;<code class="literal">&lt;class&gt;</code> &#30340;&#26144;&#23556;&#20013;&#35774;&#32622;<code class="literal">optimistic-lock="dirty"</code>&#65292;Hibernate&#22312;&#21516;&#27493;&#30340;&#26102;&#20505;&#23558;&#21482;&#27604;&#36739;&#26377;&#33039; &#25968;&#25454;&#30340;&#23383;&#27573;&#12290; 
            </p>
            <p>In both cases, with dedicated version/timestamp columns or with full/dirty field comparison, Hibernate uses a single <code class="literal">UPDATE</code> statement (with an appropriate <code class="literal">WHERE</code> clause) per entity to execute the version check and update the information. If you use transitive persistence to cascade
               reattachment to associated entities, Hibernate might execute unnecessary updates. This is usually not a problem, but <span class="emphasis"><em>on update</em></span> triggers in the database might be executed even when no changes have been made to detached instances. You can customize this
               behavior by setting <code class="literal">select-before-update="true"</code> in the <code class="literal">&lt;class&gt;</code> mapping, forcing Hibernate to <code class="literal">SELECT</code> the instance to ensure that changes did actually occur, before updating the row. 
            </p>
         </div>
      </div>
      <div class="navfooter">
         <hr>
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left"><a accesskey="p" href="transactions-demarcation.html">&#19978;&#19968;&#39029;</a>&nbsp;
               </td>
               <td width="20%" align="center"><a accesskey="u" href="transactions.html">&#19978;&#19968;&#32423;</a></td>
               <td width="40%" align="right">&nbsp;<a accesskey="n" href="transactions-locking.html">&#19979;&#19968;&#39029;</a></td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top">11.2.&nbsp;&#25968;&#25454;&#24211;&#20107;&#21153;&#22768;&#26126;&nbsp;</td>
               <td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td>
               <td width="40%" align="right" valign="top">&nbsp;11.4.&nbsp;&#24754;&#35266;&#38145;&#23450;(Pessimistic Locking)</td>
            </tr>
         </table>
      </div>
   </body>
</html>