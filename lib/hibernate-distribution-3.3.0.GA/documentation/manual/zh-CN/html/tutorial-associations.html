<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>1.3.&nbsp;&#31532;&#20108;&#37096;&#20998; &#65293; &#20851;&#32852;&#26144;&#23556;</title>
      <link rel="stylesheet" href="css/html.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
      <link rel="start" href="index.html" title="HIBERNATE - &#31526;&#21512;Java&#20064;&#24815;&#30340;&#20851;&#31995;&#25968;&#25454;&#24211;&#25345;&#20037;&#21270;">
      <link rel="up" href="tutorial.html" title="&#31532;&nbsp;1&nbsp;&#31456;&nbsp;Hibernate&#20837;&#38376;">
      <link rel="prev" href="tutorial-firstapp.html" title="1.2.&nbsp;&#31532;&#19968;&#37096;&#20998; &#65293; &#31532;&#19968;&#20010;Hibernate&#24212;&#29992;&#31243;&#24207;">
      <link rel="next" href="tutorial-webapp.html" title="1.4.&nbsp;&#31532;&#19977;&#37096;&#20998; - EventManager web&#24212;&#29992;&#31243;&#24207;">
   </head>
   <body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
      <div class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center">1.3.&nbsp;&#31532;&#20108;&#37096;&#20998; &#65293; &#20851;&#32852;&#26144;&#23556;</th>
            </tr>
            <tr>
               <td width="20%" align="left"><a accesskey="p" href="tutorial-firstapp.html">&#19978;&#19968;&#39029;</a>&nbsp;
               </td>
               <th width="60%" align="center">&#31532;&nbsp;1&nbsp;&#31456;&nbsp;Hibernate&#20837;&#38376;</th>
               <td width="20%" align="right">&nbsp;<a accesskey="n" href="tutorial-webapp.html">&#19979;&#19968;&#39029;</a></td>
            </tr>
         </table>
         <hr>
      </div>
      <div class="sect1" lang="zh-CN">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title" style="clear: both"><a name="tutorial-associations"></a>1.3.&nbsp;&#31532;&#20108;&#37096;&#20998; &#65293; &#20851;&#32852;&#26144;&#23556;
                  </h2>
               </div>
            </div>
         </div>
         <p>&#25105;&#20204;&#24050;&#32463;&#26144;&#23556;&#20102;&#19968;&#20010;&#25345;&#20037;&#21270;&#23454;&#20307;&#31867;&#21040;&#34920;&#19978;&#12290;&#35753;&#25105;&#20204;&#22312;&#36825;&#20010;&#22522;&#30784;&#19978;&#22686;&#21152;&#19968;&#20123;&#31867;&#20043;&#38388;&#30340;&#20851;&#32852;&#12290;&#39318;&#20808;&#25105;&#20204;&#24448;&#24212;&#29992;&#31243;&#24207;&#37324;&#22686;&#21152;&#20154;&#65288;people&#65289;&#30340;&#27010;&#24565;&#65292;&#24182;&#23384;&#20648;&#20182;&#20204;&#25152;&#21442;&#19982;&#30340;&#19968;&#20010;Event&#21015;&#34920;&#12290;&#65288;&#35793;&#32773;&#27880;&#65306;&#19982;Event&#19968;&#26679;&#65292;&#25105;&#20204;&#22312;&#21518;&#38754;&#23558;&#30452;&#25509;&#20351;&#29992;person&#26469;&#34920;&#31034;&#8220;&#20154;&#8221;&#32780;&#19981;&#26159;&#23427;&#30340;&#20013;&#25991;&#32763;&#35793;&#65289;
            
         </p>
         <div class="sect2" lang="zh-CN">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="tutorial-associations-mappinguser"></a>1.3.1.&nbsp;&#26144;&#23556;Person&#31867;
                     </h3>
                  </div>
               </div>
            </div>
            <p>&#26368;&#21021;&#31616;&#21333;&#30340;<code class="literal">Person</code>&#31867;&#65306; 
            </p><pre class="programlisting">package events;

public class Person {

    private Long id;
    private int age;
    private String firstname;
    private String lastname;

    public Person() {}

    // Accessor methods for all properties, private setter for 'id'

}</pre><p>&#21019;&#24314;&#19968;&#20010;&#21517;&#20026;<code class="literal">Person.hbm.xml</code>&#30340;&#26032;&#26144;&#23556;&#25991;&#20214;&#65288;&#21035;&#24536;&#20102;&#26368;&#19978;&#38754;&#30340;DTD&#24341;&#29992;&#65289;&#65306; 
            </p><pre class="programlisting">&lt;hibernate-mapping&gt;

    &lt;class name="events.Person" table="PERSON"&gt;
        &lt;id name="id" column="PERSON_ID"&gt;
            &lt;generator class="native"/&gt;
        &lt;/id&gt;
        &lt;property name="age"/&gt;
        &lt;property name="firstname"/&gt;
        &lt;property name="lastname"/&gt;
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre><p>&#26368;&#21518;&#65292;&#25226;&#26032;&#30340;&#26144;&#23556;&#21152;&#20837;&#21040;Hibernate&#30340;&#37197;&#32622;&#20013;&#65306; </p><pre class="programlisting">&lt;mapping resource="events/Event.hbm.xml"/&gt;
&lt;mapping resource="events/Person.hbm.xml"/&gt;</pre><p>&#29616;&#22312;&#25105;&#20204;&#22312;&#36825;&#20004;&#20010;&#23454;&#20307;&#20043;&#38388;&#21019;&#24314;&#19968;&#20010;&#20851;&#32852;&#12290;&#26174;&#28982;&#65292;persons&#21487;&#20197;&#21442;&#19982;&#19968;&#31995;&#21015;events&#65292;&#32780;events&#20063;&#26377;&#19981;&#21516;&#30340;&#21442;&#21152;&#32773;&#65288;persons&#65289;&#12290;&#25105;&#20204;&#38656;&#35201;&#22788;&#29702;&#30340;&#35774;&#35745;&#38382;&#39064;&#26159;&#20851;&#32852;&#26041;&#21521;&#65288;directionality&#65289;&#65292;&#38454;&#25968;&#65288;multiplicity&#65289;&#21644;&#38598;&#21512;&#65288;collection&#65289;&#30340;&#34892;&#20026;&#12290;
               
            </p>
         </div>
         <div class="sect2" lang="zh-CN">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="tutorial-associations-unidirset"></a>1.3.2.&nbsp;&#21333;&#21521;Set-based&#30340;&#20851;&#32852;
                     </h3>
                  </div>
               </div>
            </div>
            <p>&#25105;&#20204;&#23558;&#21521;<code class="literal">Person</code>&#31867;&#22686;&#21152;&#19968;&#36830;&#20018;&#30340;events&#12290;&#37027;&#26679;&#65292;&#36890;&#36807;&#35843;&#29992;<code class="literal">aPerson.getEvents()</code>&#65292;&#23601;&#21487;&#20197;&#36731;&#26494;&#22320;&#23548;&#33322;&#21040;&#29305;&#23450;person&#25152;&#21442;&#19982;&#30340;events&#65292;&#32780;&#19981;&#29992;&#21435;&#25191;&#34892;&#19968;&#20010;&#26174;&#24335;&#30340;&#26597;&#35810;&#12290;&#25105;&#20204;&#20351;&#29992;Java&#30340;&#38598;&#21512;&#31867;&#65288;collection&#65289;&#65306;<code class="literal">Set</code>&#65292;&#22240;&#20026;set &#19981;&#21253;&#21547;&#37325;&#22797;&#30340;&#20803;&#32032;&#21450;&#19982;&#25105;&#20204;&#26080;&#20851;&#30340;&#25490;&#24207;&#12290; 
            </p>
            <p>&#25105;&#20204;&#38656;&#35201;&#29992;set &#23454;&#29616;&#19968;&#20010;&#21333;&#21521;&#22810;&#20540;&#20851;&#32852;&#12290;&#35753;&#25105;&#20204;&#22312;Java&#31867;&#37324;&#20026;&#36825;&#20010;&#20851;&#32852;&#32534;&#30721;&#65292;&#25509;&#30528;&#26144;&#23556;&#23427;&#65306; </p><pre class="programlisting">public class Person {

    private Set events = new HashSet();

    public Set getEvents() {
        return events;
    }

    public void setEvents(Set events) {
        this.events = events;
    }
}</pre><p>&#22312;&#26144;&#23556;&#36825;&#20010;&#20851;&#32852;&#20043;&#21069;&#65292;&#20808;&#32771;&#34385;&#19968;&#19979;&#27492;&#20851;&#32852;&#30340;&#21478;&#22806;&#19968;&#31471;&#12290;&#24456;&#26174;&#28982;&#65292;&#25105;&#20204;&#21487;&#20197;&#20445;&#25345;&#36825;&#20010;&#20851;&#32852;&#26159;&#21333;&#21521;&#30340;&#12290;&#25110;&#32773;&#65292;&#25105;&#20204;&#21487;&#20197;&#22312;<code class="literal">Event</code>&#37324;&#21019;&#24314;&#21478;&#22806;&#19968;&#20010;&#38598;&#21512;&#65292;&#22914;&#26524;&#24076;&#26395;&#33021;&#22815;&#21452;&#21521;&#22320;&#23548;&#33322;&#65292;&#22914;&#65306;<code class="literal">anEvent.getParticipants()</code>&#12290;&#20174;&#21151;&#33021;&#30340;&#35282;&#24230;&#26469;&#35828;&#65292;&#36825;&#24182;&#19981;&#26159;&#24517;&#39035;&#30340;&#12290;&#22240;&#20026;&#20320;&#24635;&#21487;&#20197;&#26174;&#24335;&#22320;&#25191;&#34892;&#19968;&#20010;&#26597;&#35810;&#65292;&#20197;&#33719;&#24471;&#26576;&#20010;&#29305;&#23450;event&#30340;&#25152;&#26377;&#21442;&#19982;&#32773;&#12290;&#36825;&#26159;&#20010;&#22312;&#35774;&#35745;&#26102;&#38656;&#35201;&#20570;&#20986;&#30340;&#36873;&#25321;&#65292;&#23436;&#20840;&#30001;&#20320;&#26469;&#20915;&#23450;&#65292;&#20294;&#27492;&#35752;&#35770;&#20013;&#20851;&#20110;&#20851;&#32852;&#30340;&#38454;&#25968;&#26159;&#28165;&#26970;&#30340;&#65306;&#21363;&#20004;&#31471;&#37117;&#26159;&#8220;&#22810;&#8221;&#20540;&#30340;&#65292;&#25105;&#20204;&#25226;&#23427;&#21483;&#20570;<span class="emphasis"><em>&#22810;&#23545;&#22810;(many-to-many)</em></span>&#20851;&#32852;&#12290;&#22240;&#32780;&#65292;&#25105;&#20204;&#20351;&#29992;Hibernate&#30340;&#22810;&#23545;&#22810;&#26144;&#23556;&#65306; 
            </p><pre class="programlisting">&lt;class name="events.Person" table="PERSON"&gt;
    &lt;id name="id" column="PERSON_ID"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;property name="age"/&gt;
    &lt;property name="firstname"/&gt;
    &lt;property name="lastname"/&gt;

    &lt;set name="events" table="PERSON_EVENT"&gt;
        &lt;key column="PERSON_ID"/&gt;
        &lt;many-to-many column="EVENT_ID" class="events.Event"/&gt;
    &lt;/set&gt;

&lt;/class&gt;</pre><p>Hibernate&#25903;&#25345;&#21508;&#31181;&#21508;&#26679;&#30340;&#38598;&#21512;&#26144;&#23556;&#65292;<code class="literal">&lt;set&gt;</code>&#20351;&#29992;&#30340;&#26368;&#20026;&#26222;&#36941;&#12290;&#23545;&#20110;&#22810;&#23545;&#22810;&#20851;&#32852;&#65288;&#25110;&#21483;<span class="emphasis"><em>n:m</em></span>&#23454;&#20307;&#20851;&#31995;&#65289;, &#38656;&#35201;&#19968;&#20010;&#20851;&#32852;&#34920;&#65288;association table&#65289;&#12290;<code class="literal">&#34920;</code>&#37324;&#38754;&#30340;&#27599;&#19968;&#34892;&#20195;&#34920;&#20174;person&#21040;event&#30340;&#19968;&#20010;&#20851;&#32852;&#12290;&#34920;&#21517;&#26159;&#30001;<code class="literal">set</code>&#20803;&#32032;&#30340;<code class="literal">table</code>&#23646;&#24615;&#37197;&#32622;&#30340;&#12290;&#20851;&#32852;&#37324;&#38754;&#30340;&#26631;&#35782;&#31526;&#23383;&#27573;&#21517;&#65292;&#23545;&#20110;person&#30340;&#19968;&#31471;&#65292;&#26159;&#30001;<code class="literal">&lt;key&gt;</code>&#20803;&#32032;&#23450;&#20041;&#65292;&#32780;event&#19968;&#31471;&#30340;&#23383;&#27573;&#21517;&#26159;&#30001;<code class="literal">&lt;many-to-many&gt;</code>&#20803;&#32032;&#30340;<code class="literal">column</code>&#23646;&#24615;&#23450;&#20041;&#12290;&#20320;&#20063;&#24517;&#39035;&#21578;&#35785;Hibernate&#38598;&#21512;&#20013;&#23545;&#35937;&#30340;&#31867;&#65288;&#20063;&#23601;&#26159;&#20301;&#20110;&#36825;&#20010;&#38598;&#21512;&#25152;&#20195;&#34920;&#30340;&#20851;&#32852;&#21478;&#22806;&#19968;&#31471;&#30340;&#31867;&#65289;&#12290; 
            </p>
            <p>&#22240;&#32780;&#36825;&#20010;&#26144;&#23556;&#30340;&#25968;&#25454;&#24211;schema&#26159;&#65306; </p><pre class="programlisting">
    _____________        __________________
   |             |      |                  |       _____________
   |   EVENTS    |      |   PERSON_EVENT   |      |             |
   |_____________|      |__________________|      |    PERSON   |
   |             |      |                  |      |_____________|
   | *EVENT_ID   | &lt;--&gt; | *EVENT_ID        |      |             |
   |  EVENT_DATE |      | *PERSON_ID       | &lt;--&gt; | *PERSON_ID  |
   |  TITLE      |      |__________________|      |  AGE        |
   |_____________|                                |  FIRSTNAME  |
                                                  |  LASTNAME   |
                                                  |_____________|
 </pre></div>
         <div class="sect2" lang="zh-CN">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="tutorial-associations-working"></a>1.3.3.&nbsp;&#20351;&#20851;&#32852;&#24037;&#20316;
                     </h3>
                  </div>
               </div>
            </div>
            <p>&#25105;&#20204;&#25226;&#19968;&#20123;people&#21644;events &#19968;&#36215;&#25918;&#21040;<code class="literal">EventManager</code>&#30340;&#26032;&#26041;&#27861;&#20013;&#65306; 
            </p><pre class="programlisting">private void addPersonToEvent(Long personId, Long eventId) {

    Session session = HibernateUtil.getSessionFactory().getCurrentSession();
    session.beginTransaction();

    Person aPerson = (Person) session.load(Person.class, personId);
    Event anEvent = (Event) session.load(Event.class, eventId);

    aPerson.getEvents().add(anEvent);

    session.getTransaction().commit();
}</pre><p>&#22312;&#21152;&#36733;&#19968;<code class="literal">Person</code>&#21644;<code class="literal">Event</code>&#21518;&#65292;&#20351;&#29992;&#26222;&#36890;&#30340;&#38598;&#21512;&#26041;&#27861;&#23601;&#21487;&#23481;&#26131;&#22320;&#20462;&#25913;&#25105;&#20204;&#23450;&#20041;&#30340;&#38598;&#21512;&#12290;&#22914;&#20320;&#25152;&#35265;&#65292;&#27809;&#26377;&#26174;&#24335;&#30340;<code class="literal">update()</code>&#25110;<code class="literal">save()</code>&#65292;Hibernate&#20250;&#33258;&#21160;&#26816;&#27979;&#21040;&#38598;&#21512;&#24050;&#32463;&#34987;&#20462;&#25913;&#24182;&#38656;&#35201;&#26356;&#26032;&#22238;&#25968;&#25454;&#24211;&#12290;&#36825;&#21483;&#20570;&#33258;&#21160;&#33039;&#26816;&#26597;&#65288;<span class="emphasis"><em>automatic dirty checking</em></span>&#65289;&#65292;&#20320;&#20063;&#21487;&#20197;&#23581;&#35797;&#20462;&#25913;&#20219;&#20309;&#23545;&#35937;&#30340;name&#25110;&#32773;date&#23646;&#24615;&#65292;&#21482;&#35201;&#20182;&#20204;&#22788;&#20110;<span class="emphasis"><em>&#25345;&#20037;&#21270;</em></span>&#29366;&#24577;&#65292;&#20063;&#23601;&#26159;&#34987;&#32465;&#23450;&#21040;&#26576;&#20010;Hibernate &#30340;<code class="literal">Session</code>&#19978;&#65288;&#22914;&#65306;&#20182;&#20204;&#21018;&#21018;&#22312;&#19968;&#20010;&#21333;&#20803;&#25805;&#20316;&#34987;&#21152;&#36733;&#25110;&#32773;&#20445;&#23384;&#65289;&#65292;Hibernate&#30417;&#35270;&#20219;&#20309;&#25913;&#21464;&#24182;&#22312;&#21518;&#21488;&#38544;&#24335;&#20889;&#30340;&#26041;&#24335;&#25191;&#34892;SQL&#12290;&#21516;&#27493;&#20869;&#23384;&#29366;&#24577;&#21644;&#25968;&#25454;&#24211;&#30340;&#36807;&#31243;&#65292;&#36890;&#24120;&#21482;&#22312;&#21333;&#20803;&#25805;&#20316;&#32467;&#26463;&#30340;&#26102;&#20505;&#21457;&#29983;&#65292;&#31216;&#27492;&#36807;&#31243;&#20026;&#28165;&#29702;&#32531;&#23384;<span class="emphasis"><em>&#65288;flushing&#65289;</em></span>&#12290;&#22312;&#25105;&#20204;&#30340;&#20195;&#30721;&#20013;&#65292;&#24037;&#20316;&#21333;&#20803;&#30001;&#25968;&#25454;&#24211;&#20107;&#21153;&#30340;&#25552;&#20132;&#65288;&#25110;&#32773;&#22238;&#28378;&#65289;&#26469;&#32467;&#26463;&#8212;&#8212;&#36825;&#26159;&#30001;<code class="literal">CurrentSessionContext</code>&#31867;&#30340;<code class="literal">thread</code>&#37197;&#32622;&#36873;&#39033;&#23450;&#20041;&#30340;&#12290; 
            </p>
            <p>&#24403;&#28982;&#65292;&#20320;&#20063;&#21487;&#20197;&#22312;&#19981;&#21516;&#30340;&#21333;&#20803;&#25805;&#20316;&#37324;&#38754;&#21152;&#36733;person&#21644;event&#12290;&#25110;&#22312;<code class="literal">Session</code>&#20197;&#22806;&#20462;&#25913;&#19981;&#26159;&#22788;&#22312;&#25345;&#20037;&#21270;&#65288;persistent&#65289;&#29366;&#24577;&#19979;&#30340;&#23545;&#35937;&#65288;&#22914;&#26524;&#35813;&#23545;&#35937;&#20197;&#21069;&#26366;&#32463;&#34987;&#25345;&#20037;&#21270;&#65292;&#37027;&#20040;&#25105;&#20204;&#31216;&#36825;&#20010;&#29366;&#24577;&#20026;<span class="emphasis"><em>&#33073;&#31649;&#65288;detached&#65289;</em></span>&#65289;&#12290;&#20320;&#29978;&#33267;&#21487;&#20197;&#22312;&#19968;&#20010;&#38598;&#21512;&#34987;&#33073;&#31649;&#26102;&#20462;&#25913;&#23427;&#65306; 
            </p><pre class="programlisting">private void addPersonToEvent(Long personId, Long eventId) {

    Session session = HibernateUtil.getSessionFactory().getCurrentSession();
    session.beginTransaction();

    Person aPerson = (Person) session
            .createQuery("select p from Person p left join fetch p.events where p.id = :pid")
            .setParameter("pid", personId)
            .uniqueResult(); // Eager fetch the collection so we can use it detached

    Event anEvent = (Event) session.load(Event.class, eventId);

    session.getTransaction().commit();

    // End of first unit of work

    aPerson.getEvents().add(anEvent); // aPerson (and its collection) is detached

    // Begin second unit of work

    Session session2 = HibernateUtil.getSessionFactory().getCurrentSession();
    session2.beginTransaction();

    session2.update(aPerson); // Reattachment of aPerson

    session2.getTransaction().commit();
}</pre><p>&#23545;<code class="literal">update</code>&#30340;&#35843;&#29992;&#20351;&#19968;&#20010;&#33073;&#31649;&#23545;&#35937;&#37325;&#26032;&#25345;&#20037;&#21270;&#65292;&#20320;&#21487;&#20197;&#35828;&#23427;&#34987;&#32465;&#23450;&#21040;&#19968;&#20010;&#26032;&#30340;&#21333;&#20803;&#25805;&#20316;&#19978;&#65292;&#25152;&#20197;&#22312;&#33073;&#31649;&#29366;&#24577;&#19979;&#23545;&#23427;&#25152;&#20570;&#30340;&#20219;&#20309;&#20462;&#25913;&#37117;&#20250;&#34987;&#20445;&#23384;&#21040;&#25968;&#25454;&#24211;&#37324;&#12290;&#36825;&#20063;&#21253;&#25324;&#20320;&#23545;&#36825;&#20010;&#23454;&#20307;&#23545;&#35937;&#30340;&#38598;&#21512;&#25152;&#20316;&#30340;&#20219;&#20309;&#25913;&#21160;&#65288;&#22686;&#21152;/&#21024;&#38500;&#65289;&#12290; 
            </p>
            <p>&#36825;&#23545;&#25105;&#20204;&#24403;&#21069;&#30340;&#24773;&#24418;&#19981;&#26159;&#24456;&#26377;&#29992;&#65292;&#20294;&#23427;&#26159;&#38750;&#24120;&#37325;&#35201;&#30340;&#27010;&#24565;&#65292;&#20320;&#21487;&#20197;&#25226;&#23427;&#34701;&#20837;&#21040;&#20320;&#33258;&#24049;&#30340;&#24212;&#29992;&#31243;&#24207;&#35774;&#35745;&#20013;&#12290;&#22312;<code class="literal">EventManager</code>&#30340;main&#26041;&#27861;&#20013;&#28155;&#21152;&#19968;&#20010;&#26032;&#30340;&#21160;&#20316;&#65292;&#24182;&#20174;&#21629;&#20196;&#34892;&#36816;&#34892;&#23427;&#26469;&#23436;&#25104;&#25105;&#20204;&#25152;&#20570;&#30340;&#32451;&#20064;&#12290;&#22914;&#26524;&#20320;&#38656;&#35201;person&#21450;event&#30340;&#26631;&#35782;&#31526; &#8212; &#37027;&#23601;&#29992;<code class="literal">save()</code>&#26041;&#27861;&#36820;&#22238;&#23427;&#65288;&#20320;&#21487;&#33021;&#38656;&#35201;&#20462;&#25913;&#21069;&#38754;&#30340;&#19968;&#20123;&#26041;&#27861;&#26469;&#36820;&#22238;&#37027;&#20010;&#26631;&#35782;&#31526;&#65289;&#65306; 
            </p><pre class="programlisting">else if (args[0].equals("addpersontoevent")) {
    Long eventId = mgr.createAndStoreEvent("My Event", new Date());
    Long personId = mgr.createAndStorePerson("Foo", "Bar");
    mgr.addPersonToEvent(personId, eventId);
    System.out.println("Added person " + personId + " to event " + eventId);
}</pre><p>&#19978;&#38754;&#26159;&#20010;&#20851;&#20110;&#20004;&#20010;&#21516;&#31561;&#37325;&#35201;&#30340;&#23454;&#20307;&#31867;&#38388;&#20851;&#32852;&#30340;&#20363;&#23376;&#12290;&#20687;&#21069;&#38754;&#25152;&#25552;&#21040;&#30340;&#37027;&#26679;&#65292;&#22312;&#29305;&#23450;&#30340;&#27169;&#22411;&#20013;&#20063;&#23384;&#22312;&#20854;&#23427;&#30340;&#31867;&#21644;&#31867;&#22411;&#65292;&#36825;&#20123;&#31867;&#21644;&#31867;&#22411;&#36890;&#24120;&#26159;&#8220;&#27425;&#35201;&#30340;&#8221;&#12290;&#20320;&#24050;&#30475;&#21040;&#36807;&#20854;&#20013;&#30340;&#19968;&#20123;&#65292;&#20687;<code class="literal">int</code>&#25110;<code class="literal">String</code>&#12290;&#25105;&#20204;&#31216;&#36825;&#20123;&#31867;&#20026;<span class="emphasis"><em>&#20540;&#31867;&#22411;&#65288;value type&#65289;</em></span>&#65292;&#23427;&#20204;&#30340;&#23454;&#20363;<span class="emphasis"><em>&#20381;&#36182;&#65288;depend&#65289;</em></span>&#22312;&#26576;&#20010;&#29305;&#23450;&#30340;&#23454;&#20307;&#19978;&#12290;&#36825;&#20123;&#31867;&#22411;&#30340;&#23454;&#20363;&#27809;&#26377;&#23427;&#20204;&#33258;&#24049;&#30340;&#26631;&#35782;&#65288;identity&#65289;&#65292;&#20063;&#19981;&#33021;&#22312;&#23454;&#20307;&#38388;&#34987;&#20849;&#20139;&#65288;&#27604;&#22914;&#65292;&#20004;&#20010;person&#19981;&#33021;&#24341;&#29992;&#21516;&#19968;&#20010;<code class="literal">firstname</code>&#23545;&#35937;&#65292;&#21363;&#20351;&#20182;&#20204;&#26377;&#30456;&#21516;&#30340;first name&#65289;&#12290;&#24403;&#28982;&#65292;&#20540;&#31867;&#22411;&#24182;&#19981;&#20165;&#20165;&#22312;JDK&#20013;&#23384;&#22312;&#65288;&#20107;&#23454;&#19978;&#65292;&#22312;&#19968;&#20010;Hibernate&#24212;&#29992;&#31243;&#24207;&#20013;&#65292;&#25152;&#26377;&#30340;JDK&#31867;&#37117;&#34987;&#35270;&#20026;&#20540;&#31867;&#22411;&#65289;&#65292;&#32780;&#19988;&#20320;&#20063;&#21487;&#20197;&#32534;&#20889;&#20320;&#33258;&#24049;&#30340;&#20381;&#36182;&#31867;&#65292;&#20363;&#22914;<code class="literal">Address</code>&#65292;<code class="literal">MonetaryAmount</code>&#12290; 
            </p>
            <p>&#20320;&#20063;&#21487;&#20197;&#35774;&#35745;&#19968;&#20010;&#20540;&#31867;&#22411;&#30340;&#38598;&#21512;&#65292;&#36825;&#22312;&#27010;&#24565;&#19978;&#19982;&#24341;&#29992;&#20854;&#23427;&#23454;&#20307;&#30340;&#38598;&#21512;&#26377;&#24456;&#22823;&#30340;&#19981;&#21516;&#65292;&#20294;&#26159;&#22312;Java&#37324;&#38754;&#30475;&#36215;&#26469;&#20960;&#20046;&#26159;&#19968;&#26679;&#30340;&#12290; </p>
         </div>
         <div class="sect2" lang="zh-CN">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="tutorial-associations-valuecollections"></a>1.3.4.&nbsp;&#20540;&#31867;&#22411;&#30340;&#38598;&#21512;
                     </h3>
                  </div>
               </div>
            </div>
            <p>&#25105;&#20204;&#25226;&#19968;&#20010;&#20540;&#31867;&#22411;&#23545;&#35937;&#30340;&#38598;&#21512;&#21152;&#20837;<code class="literal">Person</code>&#23454;&#20307;&#20013;&#12290;&#25105;&#20204;&#24076;&#26395;&#20445;&#23384;email&#22320;&#22336;&#65292;&#25152;&#20197;&#20351;&#29992;<code class="literal">String</code>&#31867;&#22411;&#65292;&#32780;&#19988;&#36825;&#27425;&#30340;&#38598;&#21512;&#31867;&#22411;&#21448;&#26159;<code class="literal">Set</code>&#65306; 
            </p><pre class="programlisting">private Set emailAddresses = new HashSet();

public Set getEmailAddresses() {
    return emailAddresses;
}

public void setEmailAddresses(Set emailAddresses) {
    this.emailAddresses = emailAddresses;
}</pre><p>&#36825;&#20010;<code class="literal">Set</code>&#30340;&#26144;&#23556; 
            </p><pre class="programlisting">&lt;set name="emailAddresses" table="PERSON_EMAIL_ADDR"&gt;
    &lt;key column="PERSON_ID"/&gt;
    &lt;element type="string" column="EMAIL_ADDR"/&gt;
&lt;/set&gt;</pre><p>&#27604;&#36739;&#36825;&#27425;&#21644;&#27492;&#21069;&#26144;&#23556;&#30340;&#24046;&#21035;&#65292;&#20027;&#35201;&#22312;&#20110;<code class="literal">element</code>&#37096;&#20998;&#65292;&#36825;&#27425;&#24182;&#27809;&#26377;&#21253;&#21547;&#23545;&#20854;&#23427;&#23454;&#20307;&#24341;&#29992;&#30340;&#38598;&#21512;&#65292;&#32780;&#26159;&#20803;&#32032;&#31867;&#22411;&#20026;<code class="literal">String</code>&#30340;&#38598;&#21512;&#65288;&#22312;&#26144;&#23556;&#20013;&#20351;&#29992;&#23567;&#20889;&#30340;&#21517;&#23383;&#8221;string&#8220;&#26159;&#21521;&#20320;&#34920;&#26126;&#23427;&#26159;&#19968;&#20010;Hibernate&#30340;&#26144;&#23556;&#31867;&#22411;&#25110;&#32773;&#31867;&#22411;&#36716;&#25442;&#22120;&#65289;&#12290;&#21644;&#20043;&#21069;&#19968;&#26679;&#65292;<code class="literal">set</code>&#20803;&#32032;&#30340;<code class="literal">table</code>&#23646;&#24615;&#20915;&#23450;&#20102;&#29992;&#20110;&#38598;&#21512;&#30340;&#34920;&#21517;&#12290;<code class="literal">key</code>&#20803;&#32032;&#23450;&#20041;&#20102;&#22312;&#38598;&#21512;&#34920;&#20013;&#22806;&#38190;&#30340;&#23383;&#27573;&#21517;&#12290;<code class="literal">element</code>&#20803;&#32032;&#30340;<code class="literal">column</code>&#23646;&#24615;&#23450;&#20041;&#29992;&#20110;&#23454;&#38469;&#20445;&#23384;<code class="literal">String</code>&#20540;&#30340;&#23383;&#27573;&#21517;&#12290; 
            </p>
            <p>&#30475;&#19968;&#19979;&#20462;&#25913;&#21518;&#30340;&#25968;&#25454;&#24211;schema&#12290; </p><pre class="programlisting">
  _____________        __________________
 |             |      |                  |       _____________
 |   EVENTS    |      |   PERSON_EVENT   |      |             |       ___________________
 |_____________|      |__________________|      |    PERSON   |      |                   |
 |             |      |                  |      |_____________|      | PERSON_EMAIL_ADDR |
 | *EVENT_ID   | &lt;--&gt; | *EVENT_ID        |      |             |      |___________________|
 |  EVENT_DATE |      | *PERSON_ID       | &lt;--&gt; | *PERSON_ID  | &lt;--&gt; |  *PERSON_ID       |
 |  TITLE      |      |__________________|      |  AGE        |      |  *EMAIL_ADDR      |
 |_____________|                                |  FIRSTNAME  |      |___________________|
                                                |  LASTNAME   |
                                                |_____________|
 </pre><p>&#20320;&#21487;&#20197;&#30475;&#21040;&#38598;&#21512;&#34920;&#30340;&#20027;&#38190;&#23454;&#38469;&#19978;&#26159;&#20010;&#22797;&#21512;&#20027;&#38190;&#65292;&#21516;&#26102;&#20351;&#29992;&#20102;2&#20010;&#23383;&#27573;&#12290;&#36825;&#20063;&#26263;&#31034;&#20102;&#23545;&#20110;&#21516;&#19968;&#20010;person&#19981;&#33021;&#26377;&#37325;&#22797;&#30340;email&#22320;&#22336;&#65292;&#36825;&#27491;&#26159;Java&#37324;&#38754;&#20351;&#29992;Set&#26102;&#20505;&#25152;&#38656;&#35201;&#30340;&#35821;&#20041;&#65288;Set&#37324;&#20803;&#32032;&#19981;&#33021;&#37325;&#22797;&#65289;&#12290; </p>
            <p>&#20320;&#29616;&#22312;&#21487;&#20197;&#35797;&#30528;&#25226;&#20803;&#32032;&#21152;&#20837;&#21040;&#36825;&#20010;&#38598;&#21512;&#65292;&#23601;&#20687;&#25105;&#20204;&#22312;&#20043;&#21069;&#20851;&#32852;person&#21644;event&#30340;&#37027;&#26679;&#12290;&#20854;&#23454;&#29616;&#30340;Java&#20195;&#30721;&#26159;&#30456;&#21516;&#30340;&#65306; </p><pre class="programlisting">private void addEmailToPerson(Long personId, String emailAddress) {

    Session session = HibernateUtil.getSessionFactory().getCurrentSession();
    session.beginTransaction();

    Person aPerson = (Person) session.load(Person.class, personId);

    // The getEmailAddresses() might trigger a lazy load of the collection
    aPerson.getEmailAddresses().add(emailAddress);

    session.getTransaction().commit();
}</pre><p>This time we didn't use a <span class="emphasis"><em>fetch</em></span> query to initialize the collection. Hence, the call to its getter method will trigger an additional select to initialize
               it, so we can add an element to it. Monitor the SQL log and try to optimize this with an eager fetch. 
            </p>
         </div>
         <div class="sect2" lang="zh-CN">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="tutorial-associations-bidirectional"></a>1.3.5.&nbsp;&#21452;&#21521;&#20851;&#32852;
                     </h3>
                  </div>
               </div>
            </div>
            <p>&#25509;&#19979;&#26469;&#25105;&#20204;&#23558;&#26144;&#23556;&#21452;&#21521;&#20851;&#32852;&#65288;bi-directional association&#65289;&#65293; &#22312;Java&#37324;&#35753;person&#21644;event&#21487;&#20197;&#20174;&#20851;&#32852;&#30340;&#20219;&#20309;&#19968;&#31471;&#35775;&#38382;&#21478;&#19968;&#31471;&#12290;&#24403;&#28982;&#65292;&#25968;&#25454;&#24211;schema&#27809;&#26377;&#25913;&#21464;&#65292;&#25105;&#20204;&#20173;&#28982;&#38656;&#35201;&#22810;&#23545;&#22810;&#30340;&#38454;&#25968;&#12290;&#19968;&#20010;&#20851;&#31995;&#22411;&#25968;&#25454;&#24211;&#35201;&#27604;&#32593;&#32476;&#32534;&#31243;&#35821;&#35328;
               &#26356;&#21152;&#28789;&#27963;&#65292;&#25152;&#20197;&#23427;&#24182;&#19981;&#38656;&#35201;&#20219;&#20309;&#20687;&#23548;&#33322;&#26041;&#21521;&#65288;navigation direction&#65289;&#30340;&#19996;&#35199; &#65293; &#25968;&#25454;&#21487;&#20197;&#29992;&#20219;&#20309;&#21487;&#33021;&#30340;&#26041;&#24335;&#36827;&#34892;&#26597;&#30475;&#21644;&#33719;&#21462;&#12290; 
            </p>
            <p>&#39318;&#20808;&#65292;&#25226;&#19968;&#20010;&#21442;&#19982;&#32773;&#65288;person&#65289;&#30340;&#38598;&#21512;&#21152;&#20837;<code class="literal">Event</code>&#31867;&#20013;&#65306; 
            </p><pre class="programlisting">private Set participants = new HashSet();

public Set getParticipants() {
    return participants;
}

public void setParticipants(Set participants) {
    this.participants = participants;
}</pre><p>&#22312;<code class="literal">Event.hbm.xml</code>&#37324;&#38754;&#20063;&#26144;&#23556;&#36825;&#20010;&#20851;&#32852;&#12290; 
            </p><pre class="programlisting">&lt;set name="participants" table="PERSON_EVENT" inverse="true"&gt;
    &lt;key column="EVENT_ID"/&gt;
    &lt;many-to-many column="PERSON_ID" class="events.Person"/&gt;
&lt;/set&gt;</pre><p>&#22914;&#20320;&#25152;&#35265;&#65292;&#20004;&#20010;&#26144;&#23556;&#25991;&#20214;&#37324;&#37117;&#26377;&#26222;&#36890;&#30340;<code class="literal">set</code>&#26144;&#23556;&#12290;&#27880;&#24847;&#22312;&#20004;&#20010;&#26144;&#23556;&#25991;&#20214;&#20013;&#65292;&#20114;&#25442;&#20102;<code class="literal">key</code>&#21644;<code class="literal">many-to-many</code>&#30340;&#23383;&#27573;&#21517;&#12290;&#36825;&#37324;&#26368;&#37325;&#35201;&#30340;&#26159;<code class="literal">Event</code>&#26144;&#23556;&#25991;&#20214;&#37324;&#22686;&#21152;&#20102;<code class="literal">set</code>&#20803;&#32032;&#30340;<code class="literal">inverse="true"</code>&#23646;&#24615;&#12290; 
            </p>
            <p>&#36825;&#24847;&#21619;&#30528;&#22312;&#38656;&#35201;&#30340;&#26102;&#20505;&#65292;Hibernate&#33021;&#22312;&#20851;&#32852;&#30340;&#21478;&#19968;&#31471; &#65293; <code class="literal">Person</code>&#31867;&#24471;&#21040;&#20004;&#20010;&#23454;&#20307;&#38388;&#20851;&#32852;&#30340;&#20449;&#24687;&#12290;&#36825;&#23558;&#20250;&#26497;&#22823;&#22320;&#24110;&#21161;&#20320;&#29702;&#35299;&#21452;&#21521;&#20851;&#32852;&#26159;&#22914;&#20309;&#22312;&#20004;&#20010;&#23454;&#20307;&#38388;&#34987;&#21019;&#24314;&#30340;&#12290; 
            </p>
         </div>
         <div class="sect2" lang="zh-CN">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="tutorial-associations-usingbidir"></a>1.3.6.&nbsp;&#20351;&#21452;&#21521;&#36830;&#36215;&#26469;
                     </h3>
                  </div>
               </div>
            </div>
            <p>&#39318;&#20808;&#35831;&#35760;&#20303;&#65292;Hibernate&#24182;&#19981;&#24433;&#21709;&#36890;&#24120;&#30340;Java&#35821;&#20041;&#12290; &#22312;&#21333;&#21521;&#20851;&#32852;&#30340;&#20363;&#23376;&#20013;&#65292;&#25105;&#20204;&#26159;&#24590;&#26679;&#22312;<code class="literal">Person</code>&#21644;<code class="literal">Event</code>&#20043;&#38388;&#21019;&#24314;&#32852;&#31995;&#30340;&#65311;&#25105;&#20204;&#25226;<code class="literal">Event</code>&#23454;&#20363;&#28155;&#21152;&#21040;<code class="literal">Person</code>&#23454;&#20363;&#20869;&#30340;event&#24341;&#29992;&#38598;&#21512;&#37324;&#12290;&#22240;&#27492;&#24456;&#26174;&#28982;&#65292;&#22914;&#26524;&#25105;&#20204;&#35201;&#35753;&#36825;&#20010;&#20851;&#32852;&#21487;&#20197;&#21452;&#21521;&#22320;&#24037;&#20316;&#65292;&#25105;&#20204;&#38656;&#35201;&#22312;&#21478;&#22806;&#19968;&#31471;&#20570;&#21516;&#26679;&#30340;&#20107;&#24773; &#65293; &#25226;<code class="literal">Person</code>&#23454;&#20363;&#21152;&#20837;<code class="literal">Event</code>&#31867;&#20869;&#30340;Person&#24341;&#29992;&#38598;&#21512;&#12290;&#36825;&#8220;&#22312;&#20851;&#32852;&#30340;&#20004;&#31471;&#35774;&#32622;&#32852;&#31995;&#8221;&#26159;&#23436;&#20840;&#24517;&#35201;&#30340;&#32780;&#19988;&#20320;&#37117;&#24471;&#36825;&#20040;&#20570;&#12290; 
            </p>
            <p>Many developers program defensively and create link management methods to correctly set both sides, e.g. in <code class="literal">Person</code>: 
            </p><pre class="programlisting">protected Set getEvents() {
    return events;
}

protected void setEvents(Set events) {
    this.events = events;
}

public void addToEvent(Event event) {
    this.getEvents().add(event);
    event.getParticipants().add(this);
}

public void removeFromEvent(Event event) {
    this.getEvents().remove(event);
    event.getParticipants().remove(this);
}</pre><p>&#27880;&#24847;&#29616;&#22312;&#23545;&#20110;&#38598;&#21512;&#30340;get&#21644;set&#26041;&#27861;&#30340;&#35775;&#38382;&#32423;&#21035;&#26159;protected - &#36825;&#20801;&#35768;&#22312;&#20301;&#20110;&#21516;&#19968;&#20010;&#21253;&#65288;package&#65289;&#20013;&#30340;&#31867;&#20197;&#21450;&#32487;&#25215;&#33258;&#36825;&#20010;&#31867;&#30340;&#23376;&#31867;&#21487;&#20197;&#35775;&#38382;&#36825;&#20123;&#26041;&#27861;&#65292;&#20294;&#31105;&#27490;&#20854;&#20182;&#20219;&#20309;&#20154;&#30340;&#30452;&#25509;&#35775;&#38382;&#65292;&#36991;&#20813;&#20102;&#38598;&#21512;&#20869;&#23481;&#30340;&#28151;&#20081;&#12290;&#20320;&#24212;&#23613;&#21487;&#33021;&#22320;&#22312;&#21478;&#19968;&#31471;&#20063;&#25226;&#38598;&#21512;&#30340;&#35775;&#38382;&#32423;&#21035;&#35774;&#25104;protected&#12290;
               
            </p>
            <p><code class="literal">inverse</code>&#26144;&#23556;&#23646;&#24615;&#31350;&#31455;&#34920;&#31034;&#20160;&#20040;&#21602;&#65311;&#23545;&#20110;&#20320;&#21644;Java&#26469;&#35828;&#65292;&#19968;&#20010;&#21452;&#21521;&#20851;&#32852;&#20165;&#20165;&#26159;&#22312;&#20004;&#31471;&#31616;&#21333;&#22320;&#27491;&#30830;&#35774;&#32622;&#24341;&#29992;&#12290;&#28982;&#32780;&#65292;Hibernate&#24182;&#27809;&#26377;&#36275;&#22815;&#30340;&#20449;&#24687;&#21435;&#27491;&#30830;&#22320;&#25191;&#34892;<code class="literal">INSERT</code>&#21644;<code class="literal">UPDATE</code>&#35821;&#21477;&#65288;&#20197;&#36991;&#20813;&#36829;&#21453;&#25968;&#25454;&#24211;&#32422;&#26463;&#65289;&#65292;&#25152;&#20197;&#23427;&#38656;&#35201;&#19968;&#20123;&#24110;&#21161;&#26469;&#27491;&#30830;&#30340;&#22788;&#29702;&#21452;&#21521;&#20851;&#32852;&#12290;&#25226;&#20851;&#32852;&#30340;&#19968;&#31471;&#35774;&#32622;&#20026;<code class="literal">inverse</code>&#23558;&#21578;&#35785;Hibernate&#24573;&#30053;&#20851;&#32852;&#30340;&#36825;&#19968;&#31471;&#65292;&#25226;&#36825;&#31471;&#30475;&#25104;&#26159;&#21478;&#22806;&#19968;&#31471;&#30340;&#19968;&#20010;<span class="emphasis"><em>&#38236;&#35937;&#65288;mirror&#65289;</em></span>&#12290;&#36825;&#23601;&#26159;&#25152;&#38656;&#30340;&#20840;&#37096;&#20449;&#24687;&#65292;Hibernate&#21033;&#29992;&#36825;&#20123;&#20449;&#24687;&#26469;&#22788;&#29702;&#25226;&#19968;&#20010;&#26377;&#21521;&#23548;&#33322;&#27169;&#22411;&#36716;&#31227;&#21040;&#25968;&#25454;&#24211;schema&#26102;&#30340;&#25152;&#26377;&#38382;&#39064;&#12290;&#20320;&#21482;&#38656;&#35201;&#35760;&#20303;&#36825;&#20010;&#30452;&#35266;&#30340;&#35268;&#21017;&#65306;&#25152;&#26377;&#30340;&#21452;&#21521;&#20851;&#32852;&#38656;&#35201;&#26377;&#19968;&#31471;&#34987;&#35774;&#32622;&#20026;<code class="literal">inverse</code>&#12290;&#22312;&#19968;&#23545;&#22810;&#20851;&#32852;&#20013;&#23427;&#24517;&#39035;&#26159;&#20195;&#34920;&#22810;&#65288;many&#65289;&#30340;&#37027;&#31471;&#12290;&#32780;&#22312;&#22810;&#23545;&#22810;&#65288;many-to-many&#65289;&#20851;&#32852;&#20013;&#65292;&#20320;&#21487;&#20197;&#20219;&#24847;&#36873;&#21462;&#19968;&#31471;&#65292;&#22240;&#20026;&#20004;&#31471;&#20043;&#38388;&#24182;&#27809;&#26377;&#24046;&#21035;&#12290; 
            </p>
         </div>
      </div>
      <div class="navfooter">
         <hr>
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left"><a accesskey="p" href="tutorial-firstapp.html">&#19978;&#19968;&#39029;</a>&nbsp;
               </td>
               <td width="20%" align="center"><a accesskey="u" href="tutorial.html">&#19978;&#19968;&#32423;</a></td>
               <td width="40%" align="right">&nbsp;<a accesskey="n" href="tutorial-webapp.html">&#19979;&#19968;&#39029;</a></td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top">1.2.&nbsp;&#31532;&#19968;&#37096;&#20998; &#65293; &#31532;&#19968;&#20010;Hibernate&#24212;&#29992;&#31243;&#24207;&nbsp;</td>
               <td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td>
               <td width="40%" align="right" valign="top">&nbsp;1.4.&nbsp;&#31532;&#19977;&#37096;&#20998; - EventManager web&#24212;&#29992;&#31243;&#24207;</td>
            </tr>
         </table>
      </div>
   </body>
</html>