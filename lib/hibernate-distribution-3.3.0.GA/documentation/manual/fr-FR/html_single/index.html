<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>HIBERNATE - Persistance relationnelle en Java standard</title>
      <link rel="stylesheet" href="css/html.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
   </head>
   <body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
      <div class="book" lang="fr-FR">
         <div class="titlepage">
            <div>
               <div>
                  <h1 class="title"><a name="d0e2"></a>HIBERNATE - Persistance relationnelle en Java standard
                  </h1>
               </div>
               <div>
                  <h2 class="subtitle">Documentation de r&eacute;f&eacute;rence d'Hibernate</h2>
               </div>
               <div>
                  <p class="releaseinfo">3.3.0.GA</p>
               </div>
               <div>
                  <p class="copyright">Copyright &copy; 2004 Red Hat Middleware, LLC.</p>
               </div>
               <div>
                  <div class="legalnotice"><a name="Legal_Notice"></a><p class="legalnotice-title"><b>Legal Notice</b></p>
                     <p>
                                
                     </p>
                     <div class="address">
                        <p><span class="street">1801&nbsp;Varsity&nbsp;Drive</span>&nbsp;<span class="city">Raleigh</span>,&nbsp;<span class="state">NC</span><span class="postcode">27606-2072</span><span class="country">USA</span>&nbsp;<span class="phone">Phone:&nbsp;+1&nbsp;919&nbsp;754&nbsp;3700</span>&nbsp;<span class="phone">Phone:&nbsp;888&nbsp;733&nbsp;4281</span>&nbsp;<span class="fax">Fax:&nbsp;+1&nbsp;919&nbsp;754&nbsp;3701</span>&nbsp;<span class="pob">PO&nbsp;Box&nbsp;13588</span><span class="city">Research&nbsp;Triangle&nbsp;Park</span>,&nbsp;<span class="state">NC</span><span class="postcode">27709</span><span class="country">USA</span>&nbsp;
                        </p>
                     </div>
                     <p>
                            
                     </p>
                     <p>Copyright <span class="trademark"></span>&copy; 2007 by Red Hat, Inc. This copyrighted material is made available to anyone wishing to use, modify, copy, or redistribute
                        it subject to the terms and conditions of the GNU <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.gnu.org/licenses/lgpl-2.1.html" target="_top">Lesser General Public License</a>, as published by the Free Software Foundation. 
                     </p>
                     <p>Red Hat and the Red Hat "Shadow Man" logo are registered trademarks of Red Hat, Inc. in the United States and other countries.
                        
                     </p>
                     <p>All other trademarks referenced herein are the property of their respective owners. </p>
                     <p>The GPG fingerprint of the security@redhat.com key is: </p>
                     <p>CA 20 86 86 2B D6 9D FC 65 F6 EC C4 21 91 80 CD DB 42 A6 0E </p>
                  </div>
               </div>
            </div>
            <hr>
         </div>
         <div class="toc">
            <dl>
               <dt><span class="preface"><a href="#preface">Pr&eacute;face</a></span></dt>
               <dt><span class="chapter"><a href="#tutorial">1.  Introduction &agrave; Hibernate</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#tutorial-intro">1.1.  Pr&eacute;face</a></span></dt>
                     <dt><span class="sect1"><a href="#tutorial-firstapp">1.2.  Partie 1 - Premi&egrave;re application Hibernate</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#tutorial-firstapp-firstclass">1.2.1.  La premi&egrave;re classe</a></span></dt>
                           <dt><span class="sect2"><a href="#tutorial-firstapp-mapping">1.2.2.  Le fichier de mapping</a></span></dt>
                           <dt><span class="sect2"><a href="#tutorial-firstapp-configuration">1.2.3.  Configuration d'Hibernate</a></span></dt>
                           <dt><span class="sect2"><a href="#tutorial-firstapp-ant">1.2.4.  Construction avec Ant</a></span></dt>
                           <dt><span class="sect2"><a href="#tutorial-firstapp-helpers">1.2.5.  D&eacute;marrage et aides</a></span></dt>
                           <dt><span class="sect2"><a href="#tutorial-firstapp-workingpersistence">1.2.6.  Charger et stocker des objets</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#tutorial-associations">1.3.  Partie 2 - Mapper des associations</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#tutorial-associations-mappinguser">1.3.1.  Mapper la classe Person</a></span></dt>
                           <dt><span class="sect2"><a href="#tutorial-associations-unidirset">1.3.2.  Une association unidirectionnelle bas&eacute;e sur Set</a></span></dt>
                           <dt><span class="sect2"><a href="#tutorial-associations-working">1.3.3.  Travailler avec l'association</a></span></dt>
                           <dt><span class="sect2"><a href="#tutorial-associations-valuecollections">1.3.4.  Collection de valeurs</a></span></dt>
                           <dt><span class="sect2"><a href="#tutorial-associations-bidirectional">1.3.5.  Associations bidirectionnelles</a></span></dt>
                           <dt><span class="sect2"><a href="#tutorial-associations-usingbidir">1.3.6.  Travailler avec des liens bidirectionnels</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#tutorial-webapp">1.4.  Part 3 - L'application web EventManager</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#tutorial-webapp-servlet">1.4.1.  Ecrire la servlet de base</a></span></dt>
                           <dt><span class="sect2"><a href="#tutorial-webapp-processing">1.4.2.  Proc&eacute;der et rendre</a></span></dt>
                           <dt><span class="sect2"><a href="#tutorial-webapp-deploy">1.4.3.  D&eacute;ployer et tester</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#tutorial-summary">1.5.  R&eacute;sum&eacute;</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#architecture">2.  Architecture</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#architecture-overview">2.1.  G&eacute;n&eacute;ralit&eacute;s</a></span></dt>
                     <dt><span class="sect1"><a href="#architecture-states">2.2.  Etats des instances</a></span></dt>
                     <dt><span class="sect1"><a href="#architecture-jmx">2.3.  Int&eacute;gration JMX</a></span></dt>
                     <dt><span class="sect1"><a href="#architecture-jca">2.4.  Support JCA</a></span></dt>
                     <dt><span class="sect1"><a href="#architecture-current-session">2.5.  Sessions Contextuelles</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#session-configuration">3.  Configuration</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#configuration-programmatic">3.1.  Configuration par programmation</a></span></dt>
                     <dt><span class="sect1"><a href="#configuration-sessionfactory">3.2.  Obtenir une SessionFactory</a></span></dt>
                     <dt><span class="sect1"><a href="#configuration-hibernatejdbc">3.3.  Connexions JDBC</a></span></dt>
                     <dt><span class="sect1"><a href="#configuration-optional">3.4.  Propri&eacute;t&eacute;s de configuration optionnelles</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#configuration-optional-dialects">3.4.1.  Dialectes SQL</a></span></dt>
                           <dt><span class="sect2"><a href="#configuration-optional-outerjoin">3.4.2.  Chargement par Jointure Ouverte</a></span></dt>
                           <dt><span class="sect2"><a href="#configuration-optional-binarystreams">3.4.3.  Flux binaires</a></span></dt>
                           <dt><span class="sect2"><a href="#configuration-optional-cacheprovider">3.4.4.  Cache de second niveau et cache de requ&ecirc;tes</a></span></dt>
                           <dt><span class="sect2"><a href="#configuration-optional-querysubstitution">3.4.5.  Substitution dans le langage de requ&ecirc;tage</a></span></dt>
                           <dt><span class="sect2"><a href="#configuration-optional-statistics">3.4.6.  Statistiques Hibernate</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#configuration-logging">3.5.  Tracer</a></span></dt>
                     <dt><span class="sect1"><a href="#configuration-namingstrategy">3.6.  Impl&eacute;menter une <code class="literal">NamingStrategy</code></a></span></dt>
                     <dt><span class="sect1"><a href="#configuration-xmlconfig">3.7.  Fichier de configuration XML</a></span></dt>
                     <dt><span class="sect1"><a href="#configuration-j2ee">3.8.  Int&eacute;gration &agrave; un serveur d'application J2EE</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#configuration-optional-transactionstrategy">3.8.1.  Configuration de la strat&eacute;gie transactionnelle</a></span></dt>
                           <dt><span class="sect2"><a href="#configuration-optional-jndi">3.8.2.  <code class="literal">SessionFactory</code> associ&eacute;e au JNDI</a></span></dt>
                           <dt><span class="sect2"><a href="#configuration-j2ee-currentsession">3.8.3.  Association automatique de la Session &agrave; JTA</a></span></dt>
                           <dt><span class="sect2"><a href="#configuration-j2ee-jmx">3.8.4.  D&eacute;ploiement JMX</a></span></dt>
                        </dl>
                     </dd>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#persistent-classes">4.  Classes persistantes</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#persistent-classes-pojo">4.1.  Un exemple simple de POJO</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#persistent-classes-pojo-constructor">4.1.1.  Impl&eacute;menter un constructeur sans argument</a></span></dt>
                           <dt><span class="sect2"><a href="#persistent-classes-pojo-identifier">4.1.2.  Fournir une propri&eacute;t&eacute; d'indentifiant (optionnel)</a></span></dt>
                           <dt><span class="sect2"><a href="#persistent-classes-pojo-final">4.1.3.  Favoriser les classes non finales (optionnel)</a></span></dt>
                           <dt><span class="sect2"><a href="#persistent-classes-pojo-accessors">4.1.4.  D&eacute;clarer les accesseurs et mutateurs des attributs persistants (optionnel)</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#persistent-classes-inheritance">4.2.  Impl&eacute;menter l'h&eacute;ritage</a></span></dt>
                     <dt><span class="sect1"><a href="#persistent-classes-equalshashcode">4.3.  Impl&eacute;menter <code class="literal">equals()</code> et <code class="literal">hashCode()</code></a></span></dt>
                     <dt><span class="sect1"><a href="#persistent-classes-dynamicmodels">4.4.  Mod&egrave;les dynamiques</a></span></dt>
                     <dt><span class="sect1"><a href="#persistent-classes-tuplizers">4.5.  Tuplizers</a></span></dt>
                     <dt><span class="sect1"><a href="#persistent-classes-extensions">4.6.  Extentsions</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#mapping">5.  Mapping O/R basique</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#mapping-declaration">5.1.  D&eacute;claration de Mapping</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#mapping-declaration-doctype">5.1.1.  Doctype</a></span></dt>
                           <dd>
                              <dl>
                                 <dt><span class="sect3"><a href="#mapping-declaration-entity-resolution">5.1.1.1.  EntityResolver</a></span></dt>
                              </dl>
                           </dd>
                           <dt><span class="sect2"><a href="#mapping-declaration-mapping">5.1.2.  hibernate-mapping</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-class">5.1.3.  class</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-id">5.1.4.  id</a></span></dt>
                           <dd>
                              <dl>
                                 <dt><span class="sect3"><a href="#mapping-declaration-id-generator">5.1.4.1.  Generator</a></span></dt>
                                 <dt><span class="sect3"><a href="#mapping-declaration-id-hilo">5.1.4.2.  algorithme Hi/lo</a></span></dt>
                                 <dt><span class="sect3"><a href="#mapping-declaration-id-uuid">5.1.4.3.  UUID algorithm</a></span></dt>
                                 <dt><span class="sect3"><a href="#mapping-declaration-id-sequences">5.1.4.4.  Colonnes identifiantes et s&eacute;quences</a></span></dt>
                                 <dt><span class="sect3"><a href="#mapping-declaration-id-assigned">5.1.4.5.  Identifiants assign&eacute;s</a></span></dt>
                                 <dt><span class="sect3"><a href="#mapping-declaration-id-select">5.1.4.6.  Clefs primaires assign&eacute;es par trigger</a></span></dt>
                              </dl>
                           </dd>
                           <dt><span class="sect2"><a href="#mapping-declaration-id-enhanced">5.1.5.  Enhanced identifier generators</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-id-enhanced-optimizers">5.1.6.  Identifier generator optimization</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-compositeid">5.1.7.  composite-id</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-discriminator">5.1.8.  discriminator</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-version">5.1.9.  version (optionnel)</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-timestamp">5.1.10.  timestamp (optionnel)</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-property">5.1.11.  property</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-manytoone">5.1.12.  many-to-one</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-onetoone">5.1.13.  Une association one-to-one vers une autre classe persistante est d&eacute;clar&eacute;e avec l'&eacute;l&eacute;ment <code class="literal">one-to-one</code>.</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-naturalid">5.1.14.  Bien que nous recommandions l'utilisation de cl&eacute; primaire g&eacute;n&eacute;r&eacute;e, vous devriez toujours essayer d'identifier des
                                    cl&eacute; m&eacute;tier (naturelles) pour toutes vos entit&eacute;s. Une cl&eacute; naturelle est une propri&eacute;t&eacute; ou une combinaison de propri&eacute;t&eacute;s uniques
                                    et non nulles. Si elle est aussi immuable, c'est encore mieux. Mappez les propri&eacute;t&eacute;s de la cl&eacute; naturelle dans l'&eacute;l&eacute;ment <code class="literal">&lt;natural-id&gt;</code>. Hibernate g&eacute;n&eacute;rera la cl&eacute; unique n&eacute;cessaire et les contraintes de non-nullit&eacute;, et votre mapping s'auto-documentera.</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-component">5.1.15.  L'&eacute;l&eacute;ment <code class="literal">&lt;component&gt;</code> mappe les propri&eacute;t&eacute;s d'un objet fils aux colonnes d'une classe parente. Les composants peuvent en retour d&eacute;clarer leurs propres
                                    propri&eacute;t&eacute;s, composants ou collections. Voir "Components" plus bas.</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-properties">5.1.16.  L'&eacute;l&eacute;ment <code class="literal">&lt;properties&gt;</code> permet la d&eacute;finition d'un groupement logique nomm&eacute; des propri&eacute;t&eacute;s d'une classe. L'utilisation la plus importante de cette
                                    construction est la possibilit&eacute; pour une combinaison de propri&eacute;t&eacute;s d'&ecirc;tre la cible d'un <code class="literal">property-ref</code>. C'est aussi un moyen pratique de d&eacute;finir une contrainte d'unicit&eacute; multi-colonnes.</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-subclass">5.1.17.  Pour finir, la persistance polymorphique n&eacute;cessite la d&eacute;claration de chaque sous-classe de la classe persistante
                                    de base. pour la strat&eacute;gie de mapping de type table-per-class-hierarchy, on utilise la d&eacute;claration <code class="literal">&lt;subclass&gt;</code>.</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-joinedsubclass">5.1.18.  joined-subclass</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-unionsubclass">5.1.19.  union-subclass</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-join">5.1.20.  join</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-key">5.1.21.  key</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-column">5.1.22.  &eacute;l&eacute;ments column et formula</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-declaration-import">5.1.23.  import</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-types-anymapping">5.1.24.  any</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#mapping-types">5.2.  Hibernate Types</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#mapping-types-entitiesvalues">5.2.1.  Entit&eacute;s et valeurs</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-types-basictypes">5.2.2.  Basic value types</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-types-custom">5.2.3.  Types de valeur d&eacute;finis par l'utilisateur</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#mapping-entityname">5.3.  Mapper une classe plus d'une fois</a></span></dt>
                     <dt><span class="sect1"><a href="#mapping-quotedidentifiers">5.4.  SQL quoted identifiers</a></span></dt>
                     <dt><span class="sect1"><a href="#mapping-alternatives">5.5.  alternatives Metadata</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#mapping-xdoclet">5.5.1.  utilisation de XDoclet</a></span></dt>
                           <dt><span class="sect2"><a href="#mapping-annotations">5.5.2.  Utilisation des annotations JDK 5.0</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#mapping-generated">5.6.  Propri&eacute;t&eacute;s g&eacute;n&eacute;r&eacute;es</a></span></dt>
                     <dt><span class="sect1"><a href="#mapping-database-object">5.7.  Objets auxiliaires de la base de donn&eacute;es</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#collections">6.  Mapping des collections</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#collections-persistent">6.1.  Collections persistantes</a></span></dt>
                     <dt><span class="sect1"><a href="#collections-mapping">6.2.  Mapper une collection</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#collections-foreignkeys">6.2.1.  Les clefs &eacute;trang&egrave;res d'une collection</a></span></dt>
                           <dt><span class="sect2"><a href="#collections-elements">6.2.2.  Les &eacute;l&eacute;ments d'une collection</a></span></dt>
                           <dt><span class="sect2"><a href="#collections-indexed">6.2.3.  Collections index&eacute;es</a></span></dt>
                           <dt><span class="sect2"><a href="#collections-ofvalues">6.2.4.  Collections de valeurs et associations plusieurs-vers-plusieurs</a></span></dt>
                           <dt><span class="sect2"><a href="#collections-onetomany">6.2.5.  Association un-vers-plusieurs</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#collections-advancedmappings">6.3.  Mappings de collection avanc&eacute;s</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#collections-sorted">6.3.1.  Collections tri&eacute;es</a></span></dt>
                           <dt><span class="sect2"><a href="#collections-bidirectional">6.3.2.  Associations bidirectionnelles</a></span></dt>
                           <dt><span class="sect2"><a href="#collections-indexedbidirectional">6.3.3.  Associations bidirectionnelles avec des collections index&eacute;es</a></span></dt>
                           <dt><span class="sect2"><a href="#collections-ternary">6.3.4.  Associations ternaires</a></span></dt>
                           <dt><span class="sect2"><a href="#collections-idbag">6.3.5.  <code class="literal">Utiliser un <code class="literal">&lt;idbag&gt;</code></code></a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#collections-example">6.4.  Exemples de collections</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#associations">7.  Mapper les associations</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#assoc-intro">7.1.  Introduction</a></span></dt>
                     <dt><span class="sect1"><a href="#assoc-unidirectional">7.2.  Association unidirectionnelle</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#assoc-unidirectional-m21">7.2.1.  plusieurs &agrave; un</a></span></dt>
                           <dt><span class="sect2"><a href="#assoc-unidirectional-121">7.2.2.  one to one</a></span></dt>
                           <dt><span class="sect2"><a href="#assoc-unidirectional-12m">7.2.3.  un &agrave; plusieurs</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#assoc-unidirectional-join">7.3.  Associations unidirectionnelles avec tables de jointure</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#assoc-unidirectional-join-12m">7.3.1.  un &agrave; plusieurs</a></span></dt>
                           <dt><span class="sect2"><a href="#assoc-unidirectional-join-m21">7.3.2.  plusieurs &agrave; un</a></span></dt>
                           <dt><span class="sect2"><a href="#assoc-unidirectional-join-121">7.3.3.  one to one</a></span></dt>
                           <dt><span class="sect2"><a href="#assoc-unidirectional-join-m2m">7.3.4.  plusieurs &agrave; plusieurs</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#assoc-bidirectional">7.4.  Associations bidirectionnelles</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#assoc-bidirectional-m21">7.4.1.  un &agrave; plusieurs / plusieurs &agrave; un</a></span></dt>
                           <dt><span class="sect2"><a href="#assoc-bidirectional-121">7.4.2.  one to one</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#assoc-bidirectional-join">7.5.  Associations bidirectionnelles avec table de jointure</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#assoc-bidirectional-join-12m">7.5.1.  un &agrave; plusieurs / plusieurs &agrave; un</a></span></dt>
                           <dt><span class="sect2"><a href="#assoc-bidirectional-join-121">7.5.2.  one to one</a></span></dt>
                           <dt><span class="sect2"><a href="#assoc-bidirectional-join-m2m">7.5.3.  plusieurs &agrave; plusieurs</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#assoc-complex">7.6.  Des mappings plus complexes</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#components">8.  Mapping de composants</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#components-dependentobjects">8.1.  Objects d&eacute;pendants</a></span></dt>
                     <dt><span class="sect1"><a href="#components-incollections">8.2.  Collection d'objets d&eacute;pendants</a></span></dt>
                     <dt><span class="sect1"><a href="#components-asmapindex">8.3.  Utiliser les composants comme index de map</a></span></dt>
                     <dt><span class="sect1"><a href="#components-compositeid">8.4.  Utiliser un composant comme identifiant</a></span></dt>
                     <dt><span class="sect1"><a href="#components-dynamic">8.5.  Composant Dynamique</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#inheritance">9.  Mapping d'h&eacute;ritage de classe</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#inheritance-strategies">9.1.  Les trois strat&eacute;gies</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#inheritance-tableperclass">9.1.1.  Une table par hi&eacute;rarchie de classe</a></span></dt>
                           <dt><span class="sect2"><a href="#inheritance-tablepersubclass">9.1.2.  Une table par classe fille</a></span></dt>
                           <dt><span class="sect2"><a href="#inheritance-tablepersubclass-discriminator">9.1.3.  Une table par classe fille, en utilisant un discriminant</a></span></dt>
                           <dt><span class="sect2"><a href="#inheritance-mixing-tableperclass-tablepersubclass">9.1.4.  M&eacute;lange d'une table par hi&eacute;rarchie de classe avec une table par classe fille</a></span></dt>
                           <dt><span class="sect2"><a href="#inheritance-tableperconcrete">9.1.5.  Une table par classe concr&egrave;te</a></span></dt>
                           <dt><span class="sect2"><a href="#inheritance-tableperconcreate-polymorphism">9.1.6.  Une table par classe concr&egrave;te, en utilisant le polymorphisme implicite</a></span></dt>
                           <dt><span class="sect2"><a href="#inheritace-mixingpolymorphism">9.1.7.  M&eacute;lange du polymorphisme implicite avec d'autres mappings d'h&eacute;ritage</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#inheritance-limitations">9.2.  Limitations</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#objectstate">10.  Travailler avec des objets</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#objectstate-overview">10.1.  &Eacute;tats des objets Hibernate</a></span></dt>
                     <dt><span class="sect1"><a href="#objectstate-makingpersistent">10.2.  Rendre des objets persistants</a></span></dt>
                     <dt><span class="sect1"><a href="#objectstate-loading">10.3.  Chargement d'un objet</a></span></dt>
                     <dt><span class="sect1"><a href="#objectstate-querying">10.4.  Requ&ecirc;tage</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#objectstate-querying-executing">10.4.1.  Ex&eacute;cution de requ&ecirc;tes</a></span></dt>
                           <dd>
                              <dl>
                                 <dt><span class="sect3"><a href="#objectstate-querying-executing-iterate">10.4.1.1.  It&eacute;ration de r&eacute;sultats</a></span></dt>
                                 <dt><span class="sect3"><a href="#objectstate-querying-executing-tuples">10.4.1.2.  Requ&ecirc;tes qui retournent des tuples</a></span></dt>
                                 <dt><span class="sect3"><a href="#objectstate-querying-executing-scalar">10.4.1.3.  R&eacute;sultats scalaires</a></span></dt>
                                 <dt><span class="sect3"><a href="#objectstate-querying-executing-parameters">10.4.1.4.  Lier des param&egrave;tres</a></span></dt>
                                 <dt><span class="sect3"><a href="#objectstate-querying-executing-pagination">10.4.1.5.  Pagination</a></span></dt>
                                 <dt><span class="sect3"><a href="#objectstate-querying-executing-scrolling">10.4.1.6.  It&eacute;ration "scrollable"</a></span></dt>
                                 <dt><span class="sect3"><a href="#objectstate-querying-executing-named">10.4.1.7.  Externaliser des requ&ecirc;tes nomm&eacute;es</a></span></dt>
                              </dl>
                           </dd>
                           <dt><span class="sect2"><a href="#objectstate-filtering">10.4.2.  Filtrer des collections</a></span></dt>
                           <dt><span class="sect2"><a href="#objecstate-querying-criteria">10.4.3.  Requ&ecirc;tes Criteria</a></span></dt>
                           <dt><span class="sect2"><a href="#objectstate-querying-nativesql">10.4.4.  Requ&ecirc;tes en SQL natif</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#objectstate-modifying">10.5.  Modifier des objets persistants</a></span></dt>
                     <dt><span class="sect1"><a href="#objectstate-detached">10.6.  Modifier des objets d&eacute;tach&eacute;s</a></span></dt>
                     <dt><span class="sect1"><a href="#objectstate-saveorupdate">10.7.  D&eacute;tection automatique d'un &eacute;tat</a></span></dt>
                     <dt><span class="sect1"><a href="#objectstate-deleting">10.8.  Suppression d'objets persistants</a></span></dt>
                     <dt><span class="sect1"><a href="#objectstate-replicating">10.9.  R&eacute;plication d'objets entre deux entrep&ocirc;ts de donn&eacute;es</a></span></dt>
                     <dt><span class="sect1"><a href="#objectstate-flushing">10.10.  Flush de la session</a></span></dt>
                     <dt><span class="sect1"><a href="#objectstate-transitive">10.11.  Persistance transitive</a></span></dt>
                     <dt><span class="sect1"><a href="#objectstate-metadata">10.12.  Utilisation des m&eacute;ta-donn&eacute;es</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#transactions">11.  Transactions et acc&egrave;s concurrents</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#transactions-basics">11.1.  Gestion de session et d&eacute;limitation de transactions</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#transactions-basics-uow">11.1.1.  Unit&eacute; de travail</a></span></dt>
                           <dt><span class="sect2"><a href="#transactions-basics-apptx">11.1.2.  Longue conversation</a></span></dt>
                           <dt><span class="sect2"><a href="#transactions-basics-identity">11.1.3.  L'identit&eacute; des objets</a></span></dt>
                           <dt><span class="sect2"><a href="#transactions-basics-issues">11.1.4.  Probl&egrave;mes communs</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#transactions-demarcation">11.2.  D&eacute;marcation des transactions</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#transactions-demarcation-nonmanaged">11.2.1.  Environnement non manag&eacute;</a></span></dt>
                           <dt><span class="sect2"><a href="#transactions-demarcation-jta">11.2.2.  Utilisation de JTA</a></span></dt>
                           <dt><span class="sect2"><a href="#transactions-demarcation-exceptions">11.2.3.  Gestion des exceptions</a></span></dt>
                           <dt><span class="sect2"><a href="#transactions-demarcation-timeout">11.2.4.  Timeout de transaction</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#transactions-optimistic">11.3.  Contr&ocirc;le de consurrence optimiste</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#transactions-optimistic-manual">11.3.1.  Gestion du versionnage au niveau applicatif</a></span></dt>
                           <dt><span class="sect2"><a href="#transactions-optimistic-longsession">11.3.2.  Les sessions longues et le versionnage automatique.</a></span></dt>
                           <dt><span class="sect2"><a href="#transactions-optimistic-detached">11.3.3.  Les objets d&eacute;tach&eacute;s et le versionnage automatique</a></span></dt>
                           <dt><span class="sect2"><a href="#transactions-optimistic-customizing">11.3.4.  Personnaliser le versionnage automatique</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#transactions-locking">11.4.  Verouillage pessimiste</a></span></dt>
                     <dt><span class="sect1"><a href="#transactions-connection-release">11.5.  Mode de lib&eacute;ration de Connection</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#events">12.  Les intercepteurs et les &eacute;v&eacute;nements</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#objectstate-interceptors">12.1.  Intercepteurs</a></span></dt>
                     <dt><span class="sect1"><a href="#objectstate-events">12.2.  Syst&egrave;me d'&eacute;v&eacute;nements</a></span></dt>
                     <dt><span class="sect1"><a href="#objectstate-decl-security">12.3.  S&eacute;curit&eacute; d&eacute;clarative d'Hibernate</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#batch">13.  Traitement par paquet</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#batch-inserts">13.1.  Paquet de mises &Atilde;&nbsp; jour</a></span></dt>
                     <dt><span class="sect1"><a href="#batch-update">13.2.  L'interface StatelessSession</a></span></dt>
                     <dt><span class="sect1"><a href="#batch-statelesssession">13.3.  Notez que dans le code de l'exemple, les intances de <code class="literal">Customer</code> retourn&Atilde;&copy;es par la requ&Atilde;&ordf;te sont imm&Atilde;&copy;diatement d&Atilde;&copy;tach&Atilde;&copy;es. Elles ne sont jamais associ&Atilde;&copy;es &Atilde;&nbsp; un contexte de persistance.</a></span></dt>
                     <dt><span class="sect1"><a href="#batch-direct">13.4.  La pseudo-syntaxe pour les expressions <code class="literal">UPDATE</code> et <code class="literal">DELETE</code> est : <code class="literal">( UPDATE | DELETE ) FROM? EntityName (WHERE where_conditions)?</code>. Certains points sont &Atilde;&nbsp; noter :</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#queryhql">14.  HQL: Langage de requ&ecirc;tage d'Hibernate</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#queryhql-casesensitivity">14.1.  Sensibilit&eacute; &agrave; la casse</a></span></dt>
                     <dt><span class="sect1"><a href="#queryhql-from">14.2.  La clause from</a></span></dt>
                     <dt><span class="sect1"><a href="#queryhql-joins">14.3.  Associations et jointures</a></span></dt>
                     <dt><span class="sect1"><a href="#queryhql-joins-forms">14.4.  Formes de syntaxes pour les jointures</a></span></dt>
                     <dt><span class="sect1"><a href="#queryhql-identifier-property">14.5.  Refering to identifier property</a></span></dt>
                     <dt><span class="sect1"><a href="#queryhql-select">14.6.  La clause select</a></span></dt>
                     <dt><span class="sect1"><a href="#queryhql-aggregation">14.7.  Fonctions d'aggr&eacute;gation</a></span></dt>
                     <dt><span class="sect1"><a href="#queryhql-polymorphism">14.8.  Requ&ecirc;tes polymorphiques</a></span></dt>
                     <dt><span class="sect1"><a href="#queryhql-where">14.9.  La clause where</a></span></dt>
                     <dt><span class="sect1"><a href="#queryhql-expressions">14.10.  Expressions</a></span></dt>
                     <dt><span class="sect1"><a href="#queryhql-ordering">14.11.  La clause order by</a></span></dt>
                     <dt><span class="sect1"><a href="#queryhql-grouping">14.12.  La clause group by</a></span></dt>
                     <dt><span class="sect1"><a href="#queryhql-subqueries">14.13.  Sous-requ&ecirc;tes</a></span></dt>
                     <dt><span class="sect1"><a href="#queryhql-examples">14.14.  Exemples HQL</a></span></dt>
                     <dt><span class="sect1"><a href="#queryhql-bulk">14.15.  Mise &agrave; jour et suppression</a></span></dt>
                     <dt><span class="sect1"><a href="#queryhql-tipstricks">14.16.  Trucs &amp; Astuces</a></span></dt>
                     <dt><span class="sect1"><a href="#queryhql-components">14.17.  translator-credits</a></span></dt>
                     <dt><span class="sect1"><a href="#queryhql-tuple">14.18.  Row value constructor syntax</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#querycriteria">15.  Requ&ecirc;tes par crit&egrave;res</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#querycriteria-creating">15.1.  Cr&eacute;er une instance de <code class="literal">Criteria</code></a></span></dt>
                     <dt><span class="sect1"><a href="#querycriteria-narrowing">15.2.  Restriction du r&eacute;sultat</a></span></dt>
                     <dt><span class="sect1"><a href="#querycriteria-ordering">15.3.  Trier les r&eacute;sultats</a></span></dt>
                     <dt><span class="sect1"><a href="#querycriteria-associations">15.4.  Associations</a></span></dt>
                     <dt><span class="sect1"><a href="#querycriteria-dynamicfetching">15.5.  Peuplement d'associations de mani&egrave;re dynamique</a></span></dt>
                     <dt><span class="sect1"><a href="#querycriteria-examples">15.6.  Requ&ecirc;tes par l'exemple</a></span></dt>
                     <dt><span class="sect1"><a href="#querycriteria-projection">15.7.  Projections, agr&eacute;gation et regroupement</a></span></dt>
                     <dt><span class="sect1"><a href="#querycriteria-detachedqueries">15.8.  Requ&ecirc;tes et sous-requ&ecirc;tes d&eacute;tach&eacute;es</a></span></dt>
                     <dt><span class="sect1"><a href="#query-criteria-naturalid">15.9.  Requ&ecirc;tes par identifiant naturel</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#querysql">16.  SQL natif</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#querysql-creating">16.1.  Utiliser une <code class="literal">SQLQuery</code></a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#d0e13156">16.1.1.  Scalar queries</a></span></dt>
                           <dt><span class="sect2"><a href="#d0e13206">16.1.2.  Entity queries</a></span></dt>
                           <dt><span class="sect2"><a href="#d0e13242">16.1.3.  Handling associations and collections</a></span></dt>
                           <dt><span class="sect2"><a href="#d0e13273">16.1.4.  Returning multiple entities</a></span></dt>
                           <dd>
                              <dl>
                                 <dt><span class="sect3"><a href="#querysql-aliasreferences">16.1.4.1.  Alias and property references</a></span></dt>
                              </dl>
                           </dd>
                           <dt><span class="sect2"><a href="#d0e13414">16.1.5.  Returning non-managed entities</a></span></dt>
                           <dt><span class="sect2"><a href="#d0e13435">16.1.6.  Handling inheritance</a></span></dt>
                           <dt><span class="sect2"><a href="#d0e13440">16.1.7.  Parameters</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#querysql-namedqueries">16.2.  Requ&ecirc;tes SQL nomm&eacute;es</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#propertyresults">16.2.1.  Utilisation de return-property pour sp&eacute;cifier explicitement les noms des colonnes/alias</a></span></dt>
                           <dt><span class="sect2"><a href="#sp_query">16.2.2.  Utilisation de proc&eacute;dures stock&eacute;es pour les requ&ecirc;tes</a></span></dt>
                           <dd>
                              <dl>
                                 <dt><span class="sect3"><a href="#querysql-limits-storedprocedures">16.2.2.1.  R&egrave;gles/limitations lors de l'utilisation des proc&eacute;dures stock&eacute;es</a></span></dt>
                              </dl>
                           </dd>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#querysql-cud">16.3.  SQL personnalis&eacute; pour cr&eacute;er, mettre &agrave; jour et effacer</a></span></dt>
                     <dt><span class="sect1"><a href="#querysql-load">16.4.  SQL personnalis&eacute; pour le chargement</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#filters">17.  Filtrer les donn&eacute;es</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#objectstate-filters">17.1.  Filtres Hibernate</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#xml">18.  Mapping XML</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#xml-intro">18.1.  Travailler avec des donn&eacute;es XML</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#xml-intro-mapping">18.1.1.  Sp&eacute;cifier le mapping XML et le mapping d'une classe ensemble</a></span></dt>
                           <dt><span class="sect2"><a href="#xml-onlyxml">18.1.2.  Sp&eacute;cifier seulement un mapping XML</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#xml-mapping">18.2.  M&eacute;tadonn&eacute;es du mapping XML</a></span></dt>
                     <dt><span class="sect1"><a href="#xml-manipulation">18.3.  Manipuler des donn&eacute;es XML</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#performance">19.  Am&eacute;liorer les performances</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#performance-fetching">19.1.  Strat&eacute;gies de chargement</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#performance-fetching-lazy">19.1.1.  Travailler avec des associations charg&eacute;es tardivement</a></span></dt>
                           <dt><span class="sect2"><a href="#performance-fetching-custom">19.1.2.  Personnalisation des strat&eacute;gies de chargement</a></span></dt>
                           <dt><span class="sect2"><a href="#performance-fetching-proxies">19.1.3.  Proxys pour des associations vers un seul objet</a></span></dt>
                           <dt><span class="sect2"><a href="#performance-fetching-initialization">19.1.4.  Initialisation des collections et des proxys</a></span></dt>
                           <dt><span class="sect2"><a href="#performance-fetching-batch">19.1.5.  Utiliser le chargement par lot</a></span></dt>
                           <dt><span class="sect2"><a href="#performance-fetching-subselect">19.1.6.  Utilisation du chargement par sous select</a></span></dt>
                           <dt><span class="sect2"><a href="#performance-fetching-lazyproperties">19.1.7.  Utiliser le chargement tardif des propri&eacute;t&eacute;s</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#performance-cache">19.2.  Le cache de second niveau</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#performance-cache-mapping">19.2.1.  Mapping de Cache</a></span></dt>
                           <dt><span class="sect2"><a href="#performance-cache-readonly">19.2.2.  Strategie : lecture seule</a></span></dt>
                           <dt><span class="sect2"><a href="#performance-cache-readwrite">19.2.3.  Strat&eacute;gie : lecture/&eacute;criture</a></span></dt>
                           <dt><span class="sect2"><a href="#performance-cache-nonstrict">19.2.4.  Strat&eacute;gie : lecture/&eacute;criture non stricte</a></span></dt>
                           <dt><span class="sect2"><a href="#performance-cache-transactional">19.2.5.  Strat&eacute;gie : transactionelle</a></span></dt>
                           <dt><span class="sect2"><a href="#performance-cache-compat-matrix">19.2.6.  Cache-provider/concurrency-strategy compatibility</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#performance-sessioncache">19.3.  G&eacute;rer les caches</a></span></dt>
                     <dt><span class="sect1"><a href="#performance-querycache">19.4.  Le cache de requ&ecirc;tes</a></span></dt>
                     <dt><span class="sect1"><a href="#performance-collections">19.5.  Comprendre les performances des Collections</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#performance-collections-taxonomy">19.5.1.  Classification</a></span></dt>
                           <dt><span class="sect2"><a href="#performance-collections-mostefficientupdate">19.5.2.  Les lists, les maps, les idbags et les sets sont les collections les plus efficaces pour la mise &agrave; jour</a></span></dt>
                           <dt><span class="sect2"><a href="#performance-collections-mostefficentinverse">19.5.3.  Les Bags et les lists sont les plus efficaces pour les collections inverse</a></span></dt>
                           <dt><span class="sect2"><a href="#performance-collections-oneshotdelete">19.5.4.  Suppression en un coup</a></span></dt>
                        </dl>
                     </dd>
                     <dt><span class="sect1"><a href="#performance-monitoring">19.6.  Moniteur de performance</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#performance-monitoring-sf">19.6.1.  Suivi d'une SessionFactory</a></span></dt>
                           <dt><span class="sect2"><a href="#performance-monitoring-metrics">19.6.2.  M&eacute;triques</a></span></dt>
                        </dl>
                     </dd>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#toolsetguide">20.  Guide des outils</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#toolsetguide-s1">20.1.  G&eacute;n&eacute;ration automatique du sch&eacute;ma</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#toolsetguide-s1-2">20.1.1.  Personnaliser le sch&eacute;ma</a></span></dt>
                           <dt><span class="sect2"><a href="#toolsetguide-s1-3">20.1.2.  Ex&eacute;cuter l'outil</a></span></dt>
                           <dt><span class="sect2"><a href="#toolsetguide-s1-4">20.1.3.  Propri&eacute;t&eacute;s</a></span></dt>
                           <dt><span class="sect2"><a href="#toolsetguide-s1-5">20.1.4.  Utiliser Ant</a></span></dt>
                           <dt><span class="sect2"><a href="#toolsetguide-s1-6">20.1.5.  Mises &agrave; jour incr&eacute;mentales du sch&eacute;ma</a></span></dt>
                           <dt><span class="sect2"><a href="#toolsetguide-s1-7">20.1.6.  Utiliser Ant pour des mises &agrave; jour de sch&eacute;ma par incr&eacute;ment</a></span></dt>
                           <dt><span class="sect2"><a href="#toolsetguide-s1-8">20.1.7.  Validation du sch&eacute;ma</a></span></dt>
                           <dt><span class="sect2"><a href="#toolsetguide-s1-9">20.1.8.  Utiliser Ant pour la validation du Sch&eacute;ma</a></span></dt>
                        </dl>
                     </dd>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#example-parentchild">21.  Exemple : P&egrave;re/Fils</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#example-parentchild-collections">21.1.  Une note &agrave; propos des collections</a></span></dt>
                     <dt><span class="sect1"><a href="#example-parentchild-bidir">21.2.  un-vers-plusieurs bidirectionnel</a></span></dt>
                     <dt><span class="sect1"><a href="#example-parentchild-cascades">21.3.  Cycle de vie en cascade</a></span></dt>
                     <dt><span class="sect1"><a href="#example-parentchild-update">21.4.  Cascades et <code class="literal">unsaved-value</code></a></span></dt>
                     <dt><span class="sect1"><a href="#example-parentchild-conclusion">21.5.  Conclusion</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#example-weblog">22.  Exemple : application Weblog</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#example-weblog-classes">22.1.  Classes persistantes</a></span></dt>
                     <dt><span class="sect1"><a href="#example-weblog-mappings">22.2.  Mappings Hibernate</a></span></dt>
                     <dt><span class="sect1"><a href="#example-weblog-code">22.3.  Code Hibernate</a></span></dt>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#example-mappings">23.  Exemple : quelques mappings</a></span></dt>
               <dd>
                  <dl>
                     <dt><span class="sect1"><a href="#example-mappings-emp">23.1.  Employeur/Employ&eacute; (Employer/Employee)</a></span></dt>
                     <dt><span class="sect1"><a href="#example-mappings-authorwork">23.2.  Auteur/Travail (Author/Work)</a></span></dt>
                     <dt><span class="sect1"><a href="#example-mappings-customerorderproduct">23.3.  Client/Commande/Produit (Customer/Order/Product)</a></span></dt>
                     <dt><span class="sect1"><a href="#misc">23.4.  Divers mappings d'exemple</a></span></dt>
                     <dd>
                        <dl>
                           <dt><span class="sect2"><a href="#example-mappings-typed-onetone">23.4.1.  "Typed" one-to-one association</a></span></dt>
                           <dt><span class="sect2"><a href="#example-mappings-composite-key">23.4.2.  Exemple de clef compos&eacute;e</a></span></dt>
                           <dt><span class="sect2"><a href="#example-mappings-composite-key-manytomany">23.4.3.  Many-to-many avec une clef compos&eacute;e partag&eacute;e</a></span></dt>
                           <dt><span class="sect2"><a href="#example-mappings-content-discrimination">23.4.4.  Contenu bas&eacute; sur une discrimination</a></span></dt>
                           <dt><span class="sect2"><a href="#example-mappings-association-alternatekeys">23.4.5.  Associations sur des clefs altern&eacute;es</a></span></dt>
                        </dl>
                     </dd>
                  </dl>
               </dd>
               <dt><span class="chapter"><a href="#best-practices">24.  Meilleures pratiques</a></span></dt>
            </dl>
         </div>
         <div class="preface" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="preface"></a>Pr&eacute;face
                     </h2>
                  </div>
               </div>
            </div>
            <p>Travailler dans les deux univers que sont l'orient&eacute; objet et la base de donn&eacute;es relationnelle peut &ecirc;tre lourd et consommateur
               en temps dans le monde de l'entreprise d'aujourd'hui. Hibernate est un outil de mapping objet/relationnel pour le monde Java.
               Le terme mapping objet/relationnel (ORM) d&eacute;crit la technique consistant &agrave; faire le lien entre la repr&eacute;sentation objet des
               donn&eacute;es et sa repr&eacute;sentation relationnelle bas&eacute;e sur un sch&eacute;ma SQL. 
            </p>
            <p>Non seulement, Hibernate s'occupe du transfert des classes Java dans les tables de la base de donn&eacute;es (et des types de donn&eacute;es
               Java dans les types de donn&eacute;es SQL), mais il permet de requ&ecirc;ter les donn&eacute;es et propose des moyens de les r&eacute;cup&eacute;rer. Il peut
               donc r&eacute;duire de mani&egrave;re significative le temps de d&eacute;veloppement qui aurait &eacute;t&eacute; autrement perdu dans une manipulation manuelle
               des donn&eacute;es via SQL et JDBC. 
            </p>
            <p>Le but d'Hibernate est de lib&eacute;rer le d&eacute;veloppeur de 95 pourcent des t&acirc;ches de programmation li&eacute;es &agrave; la persistance des donn&eacute;es
               communes. Hibernate n'est probablement pas la meilleure solution pour les applications centr&eacute;es sur les donn&eacute;es qui n'utilisent
               que les proc&eacute;dures stock&eacute;es pour impl&eacute;menter la logique m&eacute;tier dans la base de donn&eacute;es, il est le plus utile dans les mod&egrave;les
               m&eacute;tier orient&eacute;s objets dont la logique m&eacute;tier est impl&eacute;ment&eacute;e dans la couche Java dite interm&eacute;diaire. Cependant, Hibernate
               vous aidera &agrave; supprimer ou &agrave; encapsuler le code SQL sp&eacute;cifique &agrave; votre base de donn&eacute;es et vous aidera sur la t&acirc;che commune
               qu'est la transformation des donn&eacute;es d'une repr&eacute;sentation tabulaire &agrave; une repr&eacute;sentation sous forme de graphe d'objets. 
            </p>
            <p>Si vous &ecirc;tes nouveau dans Hibernate et le mapping Objet/Relationnel voire m&ecirc;me en Java, suivez ces quelques &eacute;tapes : </p>
            <div class="orderedlist">
               <ol type="1">
                  <li>
                     <p>Lisez <a href="#tutorial" title="Chapitre&nbsp;1.&nbsp;Introduction &agrave; Hibernate">Chapitre&nbsp;1, <i xmlns:xlink="http://www.w3.org/1999/xlink">Introduction &agrave; Hibernate</i></a> pour un didacticiel plus long avec plus d'instructions &eacute;tape par &eacute;tape. 
                     </p>
                  </li>
                  <li>
                     <p>Lisez <a href="#architecture" title="Chapitre&nbsp;2.&nbsp;Architecture">Chapitre&nbsp;2, <i xmlns:xlink="http://www.w3.org/1999/xlink">Architecture</i></a> pour comprendre les environnements dans lesquels Hibernate peut &ecirc;tre utilis&eacute;. 
                     </p>
                  </li>
                  <li>
                     <p>Regardez le r&eacute;pertoire <code class="literal">eg</code> de la distribution Hibernate, il contient une application simple et autonome. Copiez votre pilote JDBC dans le r&eacute;pertoire
                        <code class="literal">lib/</code> et &eacute;ditez <code class="literal">src/hibernate.properties</code>, en positionnant correctement les valeurs pour votre base de donn&eacute;es. A partir d'une invite de commande dans le r&eacute;pertoire
                        de la distribution, tapez <code class="literal">ant eg</code> (cela utilise Ant), ou sous Windows tapez <code class="literal">build eg</code>. 
                     </p>
                  </li>
                  <li>
                     <p>Fa&icirc;tes de cette documentation de r&eacute;f&eacute;rence votre principale source d'information. Pensez &agrave; lire <span class="emphasis"><em>Java Persistence with Hibernate</em></span> (http://www.manning.com/bauer2) si vous avez besoin de plus d'aide avec le design d'applications ou si vous pr&eacute;f&eacute;rez un tutoriel
                        pas &agrave; pas. Visitez aussi http://caveatemptor.hibernate.org et t&eacute;l&eacute;chargez l'application exemple pour Java Persistence with
                        Hibernate. 
                     </p>
                  </li>
                  <li>
                     <p>Les questions les plus fr&eacute;quemment pos&eacute;es (FAQs) trouvent leur r&eacute;ponse sur le site web Hibernate. </p>
                  </li>
                  <li>
                     <p>Des d&eacute;mos, exemples et tutoriaux de tierces personnes sont r&eacute;f&eacute;renc&eacute;s sur le site web Hibernate. </p>
                  </li>
                  <li>
                     <p>La zone communautaire (Community Area) du site web Hibernate est une bonne source d'information sur les design patterns et
                        sur diff&eacute;rentes solutions d'int&eacute;gration d'Hibernate (Tomcat, JBoss, Spring Framework, Struts, EJB, etc). 
                     </p>
                  </li>
               </ol>
            </div>
            <p>Si vous avez des questions, utilisez le forum utilisateurs du site web Hibernate. Nous utilisons &eacute;galement l'outil de gestion
               des incidents JIRA pour tout ce qui est rapports de bogue et demandes d'&eacute;volution. Si vous &ecirc;tes int&eacute;ress&eacute; par le d&eacute;veloppement
               d'Hibernate, joignez-vous &agrave; la liste de diffusion de d&eacute;veloppement. 
            </p>
            <p>Le d&eacute;veloppement commercial, le support de production et les formations &agrave; Hibernate sont propos&eacute;s par JBoss Inc (voir http://www.hibernate.org/SupportTraining/).
               Hibernate est un projet Open Source professionnel et un composant critique de la suite de produits JBoss Enterprise Middleware
               System (JEMS). 
            </p>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="tutorial"></a>Chapitre&nbsp;1.&nbsp;Introduction &agrave; Hibernate
                     </h2>
                  </div>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="tutorial-intro"></a>1.1.&nbsp;Pr&eacute;face
                        </h2>
                     </div>
                  </div>
               </div>
               <p>This chapter is an introduction to Hibernate by way of a tutorial, intended for new users of Hibernate. We start with a simple
                  application using an in-memory database. We build the application in small, easy to understand steps. The tutorial is based
                  on another, earlier one developed by Michael Gloegl. All code is contained in the <code class="filename">tutorials/web</code> directory of the project source. 
               </p>
            </div>
            <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
               <h3 class="title">Important</h3>
               <p>This tutorial expects the user have knowledge of both Java and SQL. If you are new or uncomfortable with either, it is advised
                  that you start with a good introduction to that technology prior to attempting to learn Hibernate. It will save time and effort
                  in the long run. 
               </p>
            </div>
            <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
               <h3 class="title">Note</h3>
               <p>There is another tutorial/example application in the <code class="filename">/tutorials/eg</code> directory of the project source. That example is console based and as such would not have the dependency on a servlet container
                  to execute. The basic setup is the same as the instructions below. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="tutorial-firstapp"></a>1.2.&nbsp;Partie 1 - Premi&egrave;re application Hibernate
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Let's assume we need a small database application that can store events we want to attend, and information about the host(s)
                  of these events. We will use an in-memory, Java database named HSQLDB to avoid describing installation/setup of any particular
                  database servers. Feel free to tweak this tutorial to use whatever database you feel comfortable using. 
               </p>
               <p>The first thing we need to do is set up our development environment, and specifically to setup all the required dependencies
                  to Hibernate as well as other libraries. Hibernate is built using Maven which amongst other features provides <code class="literal">dependecy management</code>; moreover it provides <span class="emphasis"><em>transitive</em></span> <code class="literal">dependecy management</code> which simply means that to use Hibernate we can simply define our dependency on Hibernate, Hibernate itself defines the dependencies
                  it needs which then become transitive dependencies of our project. 
               </p><pre class="programlisting">.
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;

    ...

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;${groupId}&lt;/groupId&gt;
            &lt;artifactId&gt;hibernate-core&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- Because this is a web app, we also have a dependency on the servlet api. --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

&lt;/project&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
                  <h3 class="title">Note</h3>
                  <p>Essentially we are describing here the <code class="filename">/tutorials/web/pom.xml</code> file. See the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://maven.org" target="_top">Maven</a> site for more information. 
                  </p>
               </div>
               <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
                  <h3 class="title">Astuce</h3>
                  <p>While not strictly necessary, most IDEs have integration with Maven to read these POM files and automatically set up a project
                     for you which can save lots of time and effort. 
                  </p>
               </div>
               <p>Ensuite, nous cr&eacute;ons une classe qui r&eacute;pr&eacute;sente l'&eacute;v&eacute;nement que nous voulons stocker dans notre base de donn&eacute;es. </p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="tutorial-firstapp-firstclass"></a>1.2.1.&nbsp;La premi&egrave;re classe
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Notre premi&egrave;re classe persistante est une simple classe JavaBean avec quelques propri&eacute;t&eacute;s : </p><pre class="programlisting">package org.hibernate.tutorial.domain;

import java.util.Date;

public class Event {
    private Long id;

    private String title;
    private Date date;

    public Event() {}

    public Long getId() {
        return id;
    }

    private void setId(Long id) {
        this.id = id;
    }

    public Date getDate() {
        return date;
    }

    public void setDate(Date date) {
        this.date = date;
    }

    public String getTitle() {
        return title;
    }

    public void setTitle(String title) {
        this.title = title;
    }
}</pre><p>Vous pouvez voir que cette classe utilise les conventions de nommage standard JavaBean pour les m&eacute;thodes getter/setter des
                     propri&eacute;t&eacute;s, ainsi qu'une visibilit&eacute; priv&eacute;e pour les champs. Ceci est la conception recommand&eacute;e - mais pas obligatoire. Hibernate
                     peut aussi acc&eacute;der aux champs directement, le b&eacute;n&eacute;fice des m&eacute;thodes d'acc&egrave;s est la robustesse pour la refonte de code. Le
                     constructeur sans argument est requis pour instancier un objet de cette classe via reflexion. 
                  </p>
                  <p>La propri&eacute;t&eacute; <code class="literal">id</code> contient la valeur d'un identifiant unique pour un &eacute;v&eacute;nement particulier. Toutes les classes d'entit&eacute;s persistantes (ainsi
                     que les classes d&eacute;pendantes de moindre importance) auront besoin d'une telle propri&eacute;t&eacute; identifiante si nous voulons utiliser
                     l'ensemble complet des fonctionnalit&eacute;s d'Hibernate. En fait, la plupart des applications (surtout les applications web) ont
                     besoin de distinguer des objets par des identifiants, donc vous devriez consid&eacute;rer &ccedil;a comme une fonctionnalit&eacute; plut&ocirc;t que
                     comme une limitation. Cependant, nous ne manipulons g&eacute;n&eacute;ralement pas l'identit&eacute; d'un objet, dor&eacute;navant la m&eacute;thode setter devrait
                     &ecirc;tre priv&eacute;e. Seul Hibernate assignera les identifiants lorsqu'un objet est sauvegard&eacute;. Vous pouvez voir qu'Hibernate peut
                     acc&eacute;der aux m&eacute;thodes publiques, priv&eacute;es et prot&eacute;g&eacute;es, ainsi qu'aux champs (publics, priv&eacute;s, prot&eacute;g&eacute;s) directement. Le choix
                     vous est laiss&eacute;, et vous pouvez l'ajuster &agrave; la conception de votre application. 
                  </p>
                  <p>Le constructeur sans argument est requis pour toutes les classes persistantes ; Hibernate doit cr&eacute;er des objets pour vous
                     en utilisant la r&eacute;flexion Java. Le constructeur peut &ecirc;tre priv&eacute;, cependant, la visibilit&eacute; du paquet est requise pour la g&eacute;n&eacute;ration
                     de proxy &agrave; l'ex&eacute;cution et une r&eacute;cup&eacute;ration des donn&eacute;es efficaces sans instrumentation du bytecode. 
                  </p>
                  <p>Placez ce fichier source Java dans un r&eacute;pertoire appel&eacute; <code class="literal">src</code> dans le dossier de d&eacute;veloppement. Ce r&eacute;pertoire devrait maintenant ressembler &agrave; &ccedil;a : 
                  </p><pre class="programlisting">.
+lib
  &lt;Hibernate and third-party libraries&gt;
+src
  +events
    Event.java</pre><p>Dans la prochaine &eacute;tape, nous informons Hibernate de cette classe persistante. </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="tutorial-firstapp-mapping"></a>1.2.2.&nbsp;Le fichier de mapping
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Hibernate a besoin de savoir comment charger et stocker des objets d'une classe persistante. C'est l&agrave; qu'intervient le fichier
                     de mapping Hibernate. Le fichier de mapping indique &agrave; Hibernate &agrave; quelle table dans la base de donn&eacute;es il doit acc&eacute;der, et
                     quelles colonnes de cette table il devra utiliser. 
                  </p>
                  <p>La structure basique de ce fichier de mapping ressemble &agrave; &ccedil;a : </p><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"&gt;

&lt;hibernate-mapping&gt;
[...]
&lt;/hibernate-mapping&gt;</pre><p>Notez que la DTD Hibernate est tr&egrave;s sophistiqu&eacute;e. Vous pouvez l'utiliser pour l'auto-compl&eacute;tement des &eacute;l&eacute;ments et des attributs
                     de mapping XML dans votre &eacute;diteur ou votre IDE. Vous devriez aussi ouvrir le fichier DTD dans votre &eacute;diteur de texte - c'est
                     le moyen le plus facile d'obtenir une vue d'ensemble de tous les &eacute;l&eacute;ments et attributs, et de voir les valeurs par d&eacute;faut,
                     ainsi que quelques commentaires. Notez qu'Hibernate ne chargera pas le fichier DTD &agrave; partir du web, mais regardera d'abord
                     dans le classpath de l'application. Le fichier DTD est inclus dans <code class="literal">hibernate3.jar</code> ainsi que dans le r&eacute;pertoire <code class="literal">src</code> de la distribution Hibernate. 
                  </p>
                  <p>Nous omettrons la d&eacute;claration de la DTD dans les exemples futurs pour raccourcir le code. Bien s&ucirc;r il n'est pas optionnel.
                     
                  </p>
                  <p>Entre les deux balises <code class="literal">hibernate-mapping</code>, incluez un &eacute;l&eacute;ment <code class="literal">class</code>. Toutes les classes d'entit&eacute;s persistantes (encore une fois, il pourrait y avoir des classes d&eacute;pendantes plus tard, qui ne
                     sont pas des entit&eacute;s m&egrave;re) ont besoin d'un mapping vers une table de la base de donn&eacute;es SQL : 
                  </p><pre class="programlisting">&lt;hibernate-mapping&gt;

    &lt;class name="events.Event" table="EVENTS"&gt;

    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre><p>Plus loin, nous disons &agrave; Hibernate comment persister et charger un objet de la classe <code class="literal">Event</code> dans la table <code class="literal">EVENTS</code>, chaque instance est repr&eacute;sent&eacute;e par une ligne dans cette table. Maintenant nous continuons avec le mapping de la propri&eacute;t&eacute;
                     de l'identifiant unique vers la clef primaire de la table. De plus, comme nous ne voulons pas nous occuper de la gestion de
                     cet identifiant, nous utilisons une strat&eacute;gie de g&eacute;n&eacute;ration d'identifiant d'Hibernate pour la colonne de la clef primaire
                     subrog&eacute;e : 
                  </p><pre class="programlisting">&lt;hibernate-mapping&gt;

    &lt;class name="events.Event" table="EVENTS"&gt;
        &lt;id name="id" column="EVENT_ID"&gt;
            &lt;generator class="native"/&gt;
        &lt;/id&gt;
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre><p>The <code class="literal">id</code> element is the declaration of the identifier property, <code class="literal">name="id"</code> declares the name of the Java property - Hibernate will use the getter and setter methods to access the property. The column
                     attribute tells Hibernate which column of the <code class="literal">EVENTS</code> table we use for this primary key. The nested <code class="literal">generator</code> element specifies the identifier generation strategy, in this case we used <code class="literal">native</code>, which picks the best strategy depending on the configured database (dialect). Hibernate supports database generated, globally
                     unique, as well as application assigned identifiers (or any strategy you have written an extension for). 
                  </p>
                  <p>Finalement nous incluons des d&eacute;clarations pour les propri&eacute;t&eacute;s persistantes de la classe dans le fichier de mapping. Par d&eacute;faut,
                     aucune propri&eacute;t&eacute; de la classe n'est consid&eacute;r&eacute;e comme persistante : 
                  </p><pre class="programlisting">
&lt;hibernate-mapping&gt;

    &lt;class name="events.Event" table="EVENTS"&gt;
        &lt;id name="id" column="EVENT_ID"&gt;
            &lt;generator class="native"/&gt;
        &lt;/id&gt;
        &lt;property name="date" type="timestamp" column="EVENT_DATE"/&gt;
        &lt;property name="title"/&gt;
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre><p>Comme avec l'&eacute;l&eacute;ment <code class="literal">id</code>, l'attribut <code class="literal">name</code> de l'&eacute;l&eacute;ment <code class="literal">property</code> indique &agrave; Hibernate quels getters/setters utiliser. 
                  </p>
                  <p>Pourquoi le mapping de la propri&eacute;t&eacute; <code class="literal">date</code> inclut l'attribut <code class="literal">column</code>, mais pas <code class="literal">title</code> ? Sans l'attribut <code class="literal">column</code> Hibernate utilise par d&eacute;faut le nom de la propri&eacute;t&eacute; comme nom de colonne. Ca fonctionne bien pour <code class="literal">title</code>. Cependant, <code class="literal">date</code> est un mot clef r&eacute;serv&eacute; dans la plupart des bases de donn&eacute;es, donc nous utilisons un nom diff&eacute;rent pour le mapping. 
                  </p>
                  <p>La prochaine chose int&eacute;ressante est que le mapping de <code class="literal">title</code> manque aussi d'un attribut <code class="literal">type</code>. Les types que nous d&eacute;clarons et utilisons dans les fichiers de mapping ne sont pas, comme vous pourriez vous y attendre,
                     des types de donn&eacute;es Java. Ce ne sont pas, non plus, des types de base de donn&eacute;es SQL. Ces types sont donc appel&eacute;s des <span class="emphasis"><em>types de mapping Hibernate</em></span>, des convertisseurs qui peuvent traduire des types Java en types SQL et vice versa. De plus, Hibernate tentera de d&eacute;terminer
                     la bonne conversion et le type de mapping lui-m&ecirc;me si l'attribut <code class="literal">type</code> n'est pas pr&eacute;sent dans le mapping. Dans certains cas, cette d&eacute;tection automatique (utilisant la r&eacute;flexion sur la classe Java)
                     pourrait ne pas donner la valeur attendue ou dont vous avez besoin. C'est le cas avec la propri&eacute;t&eacute; <code class="literal">date</code>. Hibernate ne peut pas savoir si la propri&eacute;t&eacute; "mappera" une colonne SQL de type <code class="literal">date</code>, <code class="literal">timestamp</code> ou <code class="literal">time</code>. Nous d&eacute;clarons que nous voulons conserver des informations avec une date compl&egrave;te et l'heure en mappant la propri&eacute;t&eacute; avec
                     un <code class="literal">timestamp</code>. 
                  </p>
                  <p>Ce fichier de mapping devrait &ecirc;tre sauvegard&eacute; en tant que <code class="literal">Event.hbm.xml</code>, juste dans le r&eacute;pertoire &agrave; c&ocirc;t&eacute; du fichier source de la classe Java <code class="literal">Event</code>. Le nommage des fichiers de mapping peut &ecirc;tre arbitraire, cependant le suffixe <code class="literal">hbm.xml</code> est devenu une convention dans la communaut&eacute; des d&eacute;veloppeurs Hibernate. La structure du r&eacute;pertoire devrait ressembler &agrave;
                     &ccedil;a : 
                  </p><pre class="programlisting">.
+lib
  &lt;Hibernate and third-party libraries&gt;
+src
  +events
    Event.java
    Event.hbm.xml</pre><p>Nous poursuivons avec la configuration principale d'Hibernate. </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="tutorial-firstapp-configuration"></a>1.2.3.&nbsp;Configuration d'Hibernate
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Nous avons maintenant une classe persistante et son fichier de mapping. Il est temps de configurer Hibernate. Avant &ccedil;a, nous
                     avons besoin d'une base de donn&eacute;es. HSQL DB, un SGBD SQL bas&eacute; sur Java et travaillant en m&eacute;moire, peut &ecirc;tre t&eacute;l&eacute;charg&eacute; &agrave; partir
                     du site web de HSQL. En fait, vous avez seulement besoin de <code class="literal">hsqldb.jar</code>. Placez ce fichier dans le r&eacute;pertoire <code class="literal">lib/</code> du dossier de d&eacute;veloppement. 
                  </p>
                  <p>Cr&eacute;ez un r&eacute;pertoire appel&eacute; <code class="literal">data</code> &agrave; la racine du r&eacute;pertoire de d&eacute;veloppement - c'est l&agrave; que HSQL DB stockera ses fichiers de donn&eacute;es. D&eacute;marrez maintenant votre
                     base de donn&eacute;es en ex&eacute;cutant <code class="literal">java -classpath lib/hsqldb.jar org.hsqldb.Server</code> dans votre r&eacute;pertoire de travail. Vous observez qu'elle d&eacute;marre et ouvre une socket TCP/IP, c'est l&agrave; que notre application
                     se connectera plus tard. Si vous souhaitez d&eacute;marrez &agrave; partir d'une nouvelle base de donn&eacute;es pour ce tutoriel (faites <code class="literal">CTRL + C</code> dans la fen&ecirc;tre the window), effacez le r&eacute;pertoire <code class="literal">data/</code> et red&eacute;marrez HSQL DB &agrave; nouveau. 
                  </p>
                  <p>Hibernate est la couche de votre application qui se connecte &agrave; cette base de donn&eacute;es, donc il a besoin des informations de
                     connexion. Les connexions sont &eacute;tablies &agrave; travers un pool de connexions JDBC, que nous devons aussi configurer. La distribution
                     Hibernate contient diff&eacute;rents outils de gestion de pools de connexions JDBC open source, mais pour ce didacticiel nous utiliserons
                     le pool de connexions int&eacute;gr&eacute; &agrave; Hibernate. Notez que vous devez copier les biblioth&egrave;ques requises dans votre classpath et
                     utiliser une configuration de pool de connexions diff&eacute;rente si vous voulez utiliser un logiciel de gestion de pools JDBC tiers
                     avec une qualit&eacute; de production. 
                  </p>
                  <p>Pour la configuration d'Hibernate, nous pouvons utiliser un simple fichier <code class="literal">hibernate.properties</code>, un fichier <code class="literal">hibernate.cfg.xml</code> l&eacute;g&egrave;rement plus sophistiqu&eacute;, ou m&ecirc;me une configuration compl&egrave;te par programmation. La plupart des utilisateurs pr&eacute;f&egrave;rent
                     le fichier de configuration XML : 
                  </p><pre class="programlisting">&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;!DOCTYPE hibernate-configuration PUBLIC
        "-//Hibernate/Hibernate Configuration DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"&gt;

&lt;hibernate-configuration&gt;

    &lt;session-factory&gt;

        &lt;!-- Database connection settings --&gt;
        &lt;property name="connection.driver_class"&gt;org.hsqldb.jdbcDriver&lt;/property&gt;
        &lt;property name="connection.url"&gt;jdbc:hsqldb:hsql://localhost&lt;/property&gt;
        &lt;property name="connection.username"&gt;sa&lt;/property&gt;
        &lt;property name="connection.password"&gt;&lt;/property&gt;

        &lt;!-- JDBC connection pool (use the built-in) --&gt;
        &lt;property name="connection.pool_size"&gt;1&lt;/property&gt;

        &lt;!-- SQL dialect --&gt;
        &lt;property name="dialect"&gt;org.hibernate.dialect.HSQLDialect&lt;/property&gt;

        &lt;!-- Enable Hibernate's automatic session context management --&gt;
        &lt;property name="current_session_context_class"&gt;thread&lt;/property&gt;

        &lt;!-- Disable the second-level cache  --&gt;
        &lt;property name="cache.provider_class"&gt;org.hibernate.cache.NoCacheProvider&lt;/property&gt;

        &lt;!-- Echo all executed SQL to stdout --&gt;
        &lt;property name="show_sql"&gt;true&lt;/property&gt;

        &lt;!-- Drop and re-create the database schema on startup --&gt;
        &lt;property name="hbm2ddl.auto"&gt;create&lt;/property&gt;

        &lt;mapping resource="events/Event.hbm.xml"/&gt;

    &lt;/session-factory&gt;

&lt;/hibernate-configuration&gt;</pre><p>Notez que cette configuration XML utilise une DTD diff&eacute;rente. Nous configurons une <code class="literal">SessionFactory</code> d'Hibernate - une fabrique globale responsable d'une base de donn&eacute;es particuli&egrave;re. Si vous avez plusieurs base de donn&eacute;es,
                     utilisez plusieurs configurations <code class="literal">&lt;session-factory&gt;</code>, g&eacute;n&eacute;ralement dans des fichiers de configuration diff&eacute;rents (pour un d&eacute;marrage plus facile). 
                  </p>
                  <p>Les quatre premiers &eacute;l&eacute;ments <code class="literal">property</code> contiennent la configuration n&eacute;cessaire pour la connexion JDBC. L'&eacute;l&eacute;ment <code class="literal">property</code> du dialecte sp&eacute;cifie quelle variante du SQL Hibernate va g&eacute;n&eacute;rer. La gestion automatique des sessions d'Hibernate pour les
                     contextes de persistance sera d&eacute;taill&eacute;e tr&egrave;s vite. L'option <code class="literal">hbm2ddl.auto</code> active la g&eacute;n&eacute;ration automatique des sch&eacute;mas de base de donn&eacute;es - directement dans la base de donn&eacute;es. Cela peut bien s&ucirc;r
                     aussi &ecirc;tre d&eacute;sactiv&eacute; (en supprimant l'option de configuration) ou redirig&eacute; vers un fichier avec l'aide de la t&acirc;che Ant <code class="literal">SchemaExport</code>. Finalement, nous ajoutons le(s) fichier(s) de mapping pour les classes persistantes. 
                  </p>
                  <p>Copiez ce fichier dans le r&eacute;pertoire source, il terminera dans la racine du classpath. Hibernate cherchera automatiquement,
                     au d&eacute;marrage, un fichier appel&eacute; <code class="literal">hibernate.cfg.xml</code> dans la racine du classpath. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="tutorial-firstapp-ant"></a>1.2.4.&nbsp;Construction avec Ant
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Nous allons maintenant construire le didacticiel avec Ant. Vous aurez besoin d'avoir Ant d'install&eacute; - r&eacute;cup&eacute;rez-le &agrave; partir
                     de <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://ant.apache.org/bindownload.cgi" target="_top"> la page de t&eacute;l&eacute;chargement de Ant</a>. Comment installer Ant ne sera pas couvert ici. R&eacute;f&eacute;rez-vous au <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://ant.apache.org/manual/index.html" target="_top">manuel d'Ant</a>. Apr&egrave;s que vous aurez install&eacute; Ant, nous pourrons commencer &agrave; cr&eacute;er le fichier de construction. Il s'appellera <code class="literal">build.xml</code> et sera plac&eacute; directement dans le r&eacute;pertoire de d&eacute;veloppement. 
                  </p>
                  <p>Un fichier de construction basique ressemble &agrave; &ccedil;a : </p><pre class="programlisting">&lt;project name="hibernate-tutorial" default="compile"&gt;

    &lt;property name="sourcedir" value="${basedir}/src"/&gt;
    &lt;property name="targetdir" value="${basedir}/bin"/&gt;
    &lt;property name="librarydir" value="${basedir}/lib"/&gt;

    &lt;path id="libraries"&gt;
        &lt;fileset dir="${librarydir}"&gt;
            &lt;include name="*.jar"/&gt;
        &lt;/fileset&gt;
    &lt;/path&gt;

    &lt;target name="clean"&gt;
        &lt;delete dir="${targetdir}"/&gt;
        &lt;mkdir dir="${targetdir}"/&gt;
    &lt;/target&gt;

    &lt;target name="compile" depends="clean, copy-resources"&gt;
      &lt;javac srcdir="${sourcedir}"
             destdir="${targetdir}"
             classpathref="libraries"/&gt;
    &lt;/target&gt;

    &lt;target name="copy-resources"&gt;
        &lt;copy todir="${targetdir}"&gt;
            &lt;fileset dir="${sourcedir}"&gt;
                &lt;exclude name="**/*.java"/&gt;
            &lt;/fileset&gt;
        &lt;/copy&gt;
    &lt;/target&gt;

&lt;/project&gt;</pre><p>Cela dira &agrave; Ant d'ajouter tous les fichiers du r&eacute;pertoire lib finissant par <code class="literal">.jar</code> dans le classpath utilis&eacute; pour la compilation. Cela copiera aussi tous les fichiers source non Java dans le r&eacute;pertoire cible,
                     par exemple les fichiers de configuration et de mapping d'Hibernate. Si vous lancez Ant maintenant, vous devriez obtenir cette
                     sortie : 
                  </p><pre class="programlisting">C:\hibernateTutorial\&gt;ant
Buildfile: build.xml

copy-resources:
     [copy] Copying 2 files to C:\hibernateTutorial\bin

compile:
    [javac] Compiling 1 source file to C:\hibernateTutorial\bin

BUILD SUCCESSFUL
Total time: 1 second </pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="tutorial-firstapp-helpers"></a>1.2.5.&nbsp;D&eacute;marrage et aides
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Il est temps de charger et de stocker quelques objets <code class="literal">Event</code>, mais d'abord nous devons compl&eacute;ter la configuration avec du code d'infrastructure. Nous devons d&eacute;marrer Hibernate. Ce d&eacute;marrage
                     inclut la construction d'un objet <code class="literal">SessionFactory</code> global et le stocker quelque part facile d'acc&egrave;s dans le code de l'application. Une <code class="literal">SessionFactory</code> peut ouvrir des nouvelles <code class="literal">Session</code>s. Une <code class="literal">Session</code> repr&eacute;sente une unit&eacute; de travail simplement "thread&eacute;e", la <code class="literal">SessionFactory</code> est un objet global "thread-safe", instanci&eacute; une seule fois. 
                  </p>
                  <p>Nous cr&eacute;erons une classe d'aide <code class="literal">HibernateUtil</code> qui s'occupe du d&eacute;marrage et rend la gestion des <code class="literal">Session</code>s plus facile. Regardons l'impl&eacute;mentation : 
                  </p><pre class="programlisting">package util;

import org.hibernate.*;
import org.hibernate.cfg.*;

public class HibernateUtil {

    private static final SessionFactory sessionFactory;

    static {
        try {
            // Create the SessionFactory from hibernate.cfg.xml
            sessionFactory = new Configuration().configure().buildSessionFactory();
        } catch (Throwable ex) {
            // Make sure you log the exception, as it might be swallowed
            System.err.println("Initial SessionFactory creation failed." + ex);
            throw new ExceptionInInitializerError(ex);
        }
    }

    public static SessionFactory getSessionFactory() {
        return sessionFactory;
    }

}</pre><p>Cette classe ne produit pas seulement la <code class="literal">SessionFactory</code> globale dans un initialiseur statique (appel&eacute; une seule fois par la JVM lorsque la classe est charg&eacute;e), elle masque le fait
                     qu'elle exploite un singleton. Elle pourrait aussi obtenir la <code class="literal">SessionFactory</code> depuis JNDI dans un serveur d'applications. 
                  </p>
                  <p>Si vous nommez la <code class="literal">SessionFactory</code> dans votre fichier de configuration, Hibernate tentera la r&eacute;cup&eacute;ration depuis JNDI. Pour &eacute;viter ce code, vous pouvez aussi
                     utiliser un d&eacute;ploiement JMX et laisser le conteneur (compatible JMX) instancier et lier un <code class="literal">HibernateService</code> &agrave; JNDI. Ces options avanc&eacute;es sont d&eacute;taill&eacute;es dans la documentation de r&eacute;f&eacute;rence Hibernate. 
                  </p>
                  <p>Placez <code class="literal">HibernateUtil.java</code> dans le r&eacute;pertoire source de d&eacute;veloppement, et ensuite <code class="literal">Event.java</code> : 
                  </p><pre class="programlisting">.
+lib
  &lt;Hibernate and third-party libraries&gt;
+src
  +events
    Event.java
    Event.hbm.xml
  +util
    HibernateUtil.java
  hibernate.cfg.xml
+data
build.xml</pre><p>Cela devrait encore compiler sans probl&egrave;me. Nous avons finalement besoin de configurer le syst&egrave;me de "logs" - Hibernate utilise
                     commons-logging et vous laisse le choix entre log4j et le syst&egrave;me de logs du JDK 1.4. La plupart des d&eacute;veloppeurs pr&eacute;f&egrave;rent
                     log4j : copiez <code class="literal">log4j.properties</code> de la distribution d'Hibernate (il est dans le r&eacute;pertoire <code class="literal">etc/</code>) dans votre r&eacute;pertoire <code class="literal">src</code>, puis faites de m&ecirc;me avec <code class="literal">hibernate.cfg.xml</code>. Regardez la configuration d'exemple et changez les param&egrave;tres si vous voulez une sortie plus verbeuse. Par d&eacute;faut, seul
                     le message de d&eacute;marrage d'Hibernate est affich&eacute; sur la sortie standard. 
                  </p>
                  <p>L'infrastructure de ce didacticiel est compl&egrave;te - et nous sommes pr&ecirc;ts &agrave; effectuer un travail r&eacute;el avec Hibernate. </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="tutorial-firstapp-workingpersistence"></a>1.2.6.&nbsp;Charger et stocker des objets
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Finalement nous pouvons utiliser Hibernate pour charger et stocker des objets. Nous &eacute;crivons une classe <code class="literal">EventManager</code> avec une m&eacute;thode <code class="literal">main()</code> : 
                  </p><pre class="programlisting">package events;
import org.hibernate.Session;

import java.util.Date;

import util.HibernateUtil;

public class EventManager {

    public static void main(String[] args) {
        EventManager mgr = new EventManager();

        if (args[0].equals("store")) {
            mgr.createAndStoreEvent("My Event", new Date());
        }

        HibernateUtil.getSessionFactory().close();
    }

    private void createAndStoreEvent(String title, Date theDate) {

        Session session = HibernateUtil.getSessionFactory().getCurrentSession();

        session.beginTransaction();

        Event theEvent = new Event();
        theEvent.setTitle(title);
        theEvent.setDate(theDate);

        session.save(theEvent);

        session.getTransaction().commit();
    }

}</pre><p>Nous cr&eacute;ons un nouvel objet <code class="literal">Event</code>, et le remettons &agrave; Hibernate. Hibernate s'occupe maintenant du SQL et ex&eacute;cute les <code class="literal">INSERT</code>s dans la base de donn&eacute;es. Regardons le code de gestion de la <code class="literal">Session</code> et de la <code class="literal">Transaction</code> avant de lancer &ccedil;a. 
                  </p>
                  <p>Une <code class="literal">Session</code> est une unit&eacute; de travail. Pour le moment, nous allons faire les choses simplement et assumer une granularit&eacute; un-un entre
                     une <code class="literal">Session</code> hibernate et une transaction &agrave; la base de donn&eacute;es. Pour isoler notre code du syst&egrave;me de transaction sous-jacent (dans notre
                     cas, du pure JDBC, mais cela pourrait &ecirc;tre JTA), nous utilisons l'API <code class="literal">Transaction</code> qui est disponible depuis la <code class="literal">Session</code> Hibernate. 
                  </p>
                  <p>Que fait <code class="literal">sessionFactory.getCurrentSession()</code> ? Premi&egrave;rement, vous pouvez l'invoquer autant de fois que vous le voulez et n'importe o&ugrave; du moment que vous avez votre <code class="literal">SessionFactory</code> (facile gr&acirc;ce &agrave; <code class="literal">HibernateUtil</code>). La m&eacute;thode <code class="literal">getCurrentSession()</code> renvoie toujours l'unit&eacute; de travail courante. Souvenez vous que nous avons bascul&eacute; notre option de configuration au m&eacute;canisme
                     bas&eacute; sur le "thread" dans <code class="literal">hibernate.cfg.xml</code>. Par cons&eacute;quent, le scope de l'unit&eacute; de travail courante est le thread java courant d'ex&eacute;cution. Ceci n'est pas totalement
                     vrai. 
                  </p>
                  <p>Une <code class="literal">Session</code> commence lorsqu'elle est vraiment utilis&eacute;e la premi&egrave;re fois, Lorsque nous appelons pour la premi&egrave;re fois <code class="literal">getCurrentSession()</code>. Ensuite, elle est li&eacute;e, par Hibernate, au thread courant. Lorsque la transaction s'ach&egrave;ve (commit ou rollback), Hibernate
                     d&eacute;lie la <code class="literal">Session</code> du thread et la ferme pour vous. Si vous invoquez <code class="literal">getCurrentSession()</code> une autre fois, vous obtenez une nouvelle <code class="literal">Session</code> et pouvez entamer une nouvelle unit&eacute; de travail. Ce mod&egrave;le de programmation "<span class="emphasis"><em>thread-bound</em></span>" est le moyen le plus populaire d'utiliser Hibernate. 
                  </p>
                  <p>UNTRANSLATED ! Related to the unit of work scope, should the Hibernate <code class="literal">Session</code> be used to execute one or several database operations? The above example uses one <code class="literal">Session</code> for one operation. This is pure coincidence, the example is just not complex enough to show any other approach. The scope
                     of a Hibernate <code class="literal">Session</code> is flexible but you should never design your application to use a new Hibernate <code class="literal">Session</code> for <span class="emphasis"><em>every</em></span> database operation. So even if you see it a few more times in the following (very trivial) examples, consider <span class="emphasis"><em>session-per-operation</em></span> an anti-pattern. A real (web) application is shown later in this tutorial. 
                  </p>
                  <p>Lisez <a href="#transactions" title="Chapitre&nbsp;11.&nbsp;Transactions et acc&egrave;s concurrents">Chapitre&nbsp;11, <i xmlns:xlink="http://www.w3.org/1999/xlink">Transactions et acc&egrave;s concurrents</i></a> pour plus d'informations sur la gestion des transactions et leur d&eacute;marcations. Nous n'avons pas g&eacute;r&eacute; les erreurs et rollback
                     sur l'exemple pr&eacute;c&eacute;dent. 
                  </p>
                  <p>Pour lancer cette premi&egrave;re routine, nous devons ajouter une cible appelable dans le fichier de construction de Ant : </p><pre class="programlisting">&lt;target name="run" depends="compile"&gt;
    &lt;java fork="true" classname="events.EventManager" classpathref="libraries"&gt;
        &lt;classpath path="${targetdir}"/&gt;
        &lt;arg value="${action}"/&gt;
    &lt;/java&gt;
&lt;/target&gt;</pre><p>La valeur de l'argument <code class="literal">action</code> correspond &agrave; la ligne de commande qui appelle la cible : 
                  </p><pre class="programlisting">C:\hibernateTutorial\&gt;ant run -Daction=store</pre><p>Vous devriez voir, apr&egrave;s la compilation, Hibernate d&eacute;marrer et, en fonction de votre configuration, beaucoup de traces sur
                     la sortie. &Agrave; la fin vous trouverez la ligne suivante : 
                  </p><pre class="programlisting">[java] Hibernate: insert into EVENTS (EVENT_DATE, title, EVENT_ID) values (?, ?, ?)</pre><p>C'est l'<code class="literal">INSERT</code> ex&eacute;cut&eacute; par Hibernate, les points d'interrogation repr&eacute;sentent les param&egrave;tres JDBC li&eacute;s. Pour voir les valeurs li&eacute;es aux
                     arguments, ou pour r&eacute;duire la verbosit&eacute; des traces, v&eacute;rifier votre <code class="literal">log4j.properties</code>. 
                  </p>
                  <p>Maintenant nous aimerions aussi lister les &eacute;v&eacute;nements stock&eacute;s, donc nous ajoutons une option &agrave; la m&eacute;thode principale : </p><pre class="programlisting">if (args[0].equals("store")) {
    mgr.createAndStoreEvent("My Event", new Date());
}
else if (args[0].equals("list")) {
    List events = mgr.listEvents();
    for (int i = 0; i &lt; events.size(); i++) {
        Event theEvent = (Event) events.get(i);
        System.out.println("Event: " + theEvent.getTitle() +
                           " Time: " + theEvent.getDate());
    }
}</pre><p>Nous ajoutons aussi une nouvelle m&eacute;thode <code class="literal">listEvents()</code> : 
                  </p><pre class="programlisting">private List listEvents() {

    Session session = HibernateUtil.getSessionFactory().getCurrentSession();

    session.beginTransaction();

    List result = session.createQuery("from Event").list();

    session.getTransaction().commit();

    return result;
}</pre><p>Ce que nous faisons ici c'est utiliser une requ&ecirc;te HQL (Hibernate Query Language) pour charger tous les objets <code class="literal">Event</code> existants de la base de donn&eacute;es. Hibernate g&eacute;n&eacute;rera le SQL appropri&eacute;, l'enverra &agrave; la base de donn&eacute;es et peuplera des objets
                     <code class="literal">Event</code> avec les donn&eacute;es. Vous pouvez cr&eacute;er des requ&ecirc;tes plus complexes avec HQL, bien s&ucirc;r. 
                  </p>
                  <p>Maintenant, pour ex&eacute;cuter et tester tout &ccedil;a, suivez ces &eacute;tapes : </p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p>Ex&eacute;cutez <code class="literal">ant run -Daction=store</code> pour stocker quelque chose dans la base de donn&eacute;es et, bien s&ucirc;r, pour g&eacute;n&eacute;rer, avant, le sch&eacute;ma de la base de donn&eacute;es gr&acirc;ce
                              &agrave; hbm2ddl. 
                           </p>
                        </li>
                        <li>
                           <p>Now disable hbm2ddl by commenting out the property in your <code class="literal">hibernate.cfg.xml</code> file. Usually you only leave it turned on in continuous unit testing, but another run of hbm2ddl would <span class="emphasis"><em>drop</em></span> everything you have stored - the <code class="literal">create</code> configuration setting actually translates into "drop all tables from the schema, then re-create all tables, when the SessionFactory
                              is build". 
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>Si maintenant vous appelez Ant avec <code class="literal">-Daction=list</code>, vous devriez voir les &eacute;v&eacute;nements que vous avez stock&eacute;s jusque l&agrave;. Vous pouvez bien s&ucirc;r aussi appeler l'action <code class="literal">store</code> plusieurs fois. 
                  </p>
                  <p>UNTRANSLATED! Note: Most new Hibernate users fail at this point and we see questions about <span class="emphasis"><em>Table not found</em></span> error messages regularly. However, if you follow the steps outlined above you will not have this problem, as hbm2ddl creates
                     the database schema on the first run, and subsequent application restarts will use this schema. If you change the mapping
                     and/or database schema, you have to re-enable hbm2ddl once again. 
                  </p>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="tutorial-associations"></a>1.3.&nbsp;Partie 2 - Mapper des associations
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Nous avons mapp&eacute; une classe d'une entit&eacute; persistante vers une table. Partons de l&agrave; et ajoutons quelques associations de classe.
                  D'abord nous ajouterons des gens &agrave; notre application, et stockerons une liste d'&eacute;v&eacute;nements auxquels ils participent. 
               </p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="tutorial-associations-mappinguser"></a>1.3.1.&nbsp;Mapper la classe Person
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>La premi&egrave;re version de la classe <code class="literal">Person</code> est simple : 
                  </p><pre class="programlisting">package events;

public class Person {

    private Long id;
    private int age;
    private String firstname;
    private String lastname;

    public Person() {}

    // Accessor methods for all properties, private setter for 'id'

}</pre><p>Cr&eacute;ez un nouveau fichier de mapping appel&eacute; <code class="literal">Person.hbm.xml</code> (n'oubliez pas la r&eacute;f&eacute;rence &agrave; la DTD) 
                  </p><pre class="programlisting">&lt;hibernate-mapping&gt;

    &lt;class name="events.Person" table="PERSON"&gt;
        &lt;id name="id" column="PERSON_ID"&gt;
            &lt;generator class="native"/&gt;
        &lt;/id&gt;
        &lt;property name="age"/&gt;
        &lt;property name="firstname"/&gt;
        &lt;property name="lastname"/&gt;
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre><p>Finalement, ajoutez la nouveau mapping &agrave; la configuration d'Hibernate : </p><pre class="programlisting">&lt;mapping resource="events/Event.hbm.xml"/&gt;
&lt;mapping resource="events/Person.hbm.xml"/&gt;</pre><p>Nous allons maintenant cr&eacute;er une association entre ces deux entit&eacute;s. &Eacute;videmment, des personnes peuvent participer aux &eacute;v&eacute;nements,
                     et des &eacute;v&eacute;nements ont des participants. Les questions de conception que nous devons traiter sont : direction, cardinalit&eacute;
                     et comportement de la collection. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="tutorial-associations-unidirset"></a>1.3.2.&nbsp;Une association unidirectionnelle bas&eacute;e sur Set
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Nous allons ajouter une collection d'&eacute;v&eacute;nements &agrave; la classe <code class="literal">Person</code>. De cette mani&egrave;re nous pouvons facilement naviguer dans les &eacute;v&eacute;nements d'une personne particuli&egrave;re, sans ex&eacute;cuter une requ&ecirc;te
                     explicite - en appelant <code class="literal">aPerson.getEvents()</code>. Nous utilisons une collection Java, un <code class="literal">Set</code>, parce que la collection ne contiendra pas d'&eacute;l&eacute;ments dupliqu&eacute;s et l'ordre ne nous importe pas. 
                  </p>
                  <p>Nous avons besoin d'une association unidirectionnelle, pluri-valu&eacute;e, impl&eacute;ment&eacute;e avec un <code class="literal">Set</code>. &Eacute;crivons le code pour &ccedil;a dans les classes Java et mappons les : 
                  </p><pre class="programlisting">public class Person {

    private Set events = new HashSet();

    public Set getEvents() {
        return events;
    }

    public void setEvents(Set events) {
        this.events = events;
    }
}</pre><p>D'abord nous mappons cette association, mais pensez &agrave; l'autre c&ocirc;t&eacute;. Clairement, nous pouvons la laisser unidirectionnelle.
                     Ou alors, nous pourrions cr&eacute;er une autre collection sur <code class="literal">Event</code>, si nous voulons &ecirc;tre capable de la parcourir de mani&egrave;re bidirectionnelle, c'est-&agrave;-dire avoir <code class="literal">anEvent.getParticipants()</code>. Ce n'est pas n&eacute;cessaire d'un point de vue fonctionnel. Vous pourrez toujours ex&eacute;cuter une requ&ecirc;te explicite pour r&eacute;cup&eacute;rer
                     les participants d'un "event" particulier. Ce choix de conception vous est laiss&eacute;, mais ce qui reste certains est la cardinalit&eacute;
                     de l'association: "plusieurs" des deux c&ocirc;t&eacute;s, nous appelons cela une association <span class="emphasis"><em>many-to-many</em></span>. Par cons&eacute;quent nous utilisons un mapping Hibernate many-to-many: 
                  </p><pre class="programlisting">&lt;class name="events.Person" table="PERSON"&gt;
    &lt;id name="id" column="PERSON_ID"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;property name="age"/&gt;
    &lt;property name="firstname"/&gt;
    &lt;property name="lastname"/&gt;

    &lt;set name="events" table="PERSON_EVENT"&gt;
        &lt;key column="PERSON_ID"/&gt;
        &lt;many-to-many column="EVENT_ID" class="events.Event"/&gt;
    &lt;/set&gt;

&lt;/class&gt;</pre><p>Hibernate supporte toutes sortes de mapping de collection, un <code class="literal">&lt;set&gt;</code> &eacute;tant le plus commun. Pour une association many-to-many (ou une relation d'entit&eacute; <span class="emphasis"><em>n:m</em></span>), une table d'association est requise. Chaque ligne dans cette table repr&eacute;sente un lien entre une personne et un &eacute;v&eacute;nement.
                     Le nom de la table est configur&eacute; avec l'attribut <code class="literal">table</code> de l'&eacute;l&eacute;ment <code class="literal">set</code>. Le nom de la colonne identifiant dans l'association, du c&ocirc;t&eacute; de la personne, est d&eacute;fini avec l'&eacute;l&eacute;ment <code class="literal">&lt;key&gt;</code>, et le nom de la colonne pour l'&eacute;v&eacute;nement dans l'attribut <code class="literal">column</code> de <code class="literal">&lt;many-to-many&gt;</code>. Vous devez aussi donner &agrave; Hibernate la classe des objets de votre collection (c'est-&agrave;-dire : la classe de l'autre c&ocirc;t&eacute; de
                     la collection). 
                  </p>
                  <p>Le sch&eacute;ma de base de donn&eacute;es pour ce mapping est donc : </p><pre class="programlisting">
    _____________        __________________
   |             |      |                  |       _____________
   |   EVENTS    |      |   PERSON_EVENT   |      |             |
   |_____________|      |__________________|      |    PERSON   |
   |             |      |                  |      |_____________|
   | *EVENT_ID   | &lt;--&gt; | *EVENT_ID        |      |             |
   |  EVENT_DATE |      | *PERSON_ID       | &lt;--&gt; | *PERSON_ID  |
   |  TITLE      |      |__________________|      |  AGE        |
   |_____________|                                |  FIRSTNAME  |
                                                  |  LASTNAME   |
                                                  |_____________|
 </pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="tutorial-associations-working"></a>1.3.3.&nbsp;Travailler avec l'association
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>R&eacute;unissons quelques personnes et quelques &eacute;v&eacute;nements dans une nouvelle m&eacute;thode dans <code class="literal">EventManager</code> : 
                  </p><pre class="programlisting">private void addPersonToEvent(Long personId, Long eventId) {

    Session session = HibernateUtil.getSessionFactory().getCurrentSession();
    session.beginTransaction();

    Person aPerson = (Person) session.load(Person.class, personId);
    Event anEvent = (Event) session.load(Event.class, eventId);

    aPerson.getEvents().add(anEvent);

    session.getTransaction().commit();
}</pre><p>Apr&egrave;s le chargement d'une <code class="literal">Person</code> et d'un <code class="literal">Event</code>, modifiez simplement la collection en utilisant les m&eacute;thodes normales de la collection. Comme vous pouvez le voir, il n'y
                     a pas d'appel explicite &agrave; <code class="literal">update()</code> ou <code class="literal">save()</code>, Hibernate d&eacute;tecte automatiquement que la collection a &eacute;t&eacute; modifi&eacute;e et a besoin d'&ecirc;tre mise &agrave; jour. Ceci est appel&eacute; <span class="emphasis"><em>la v&eacute;rification sale automatique</em></span> (NdT : "automatic dirty checking"), et vous pouvez aussi l'essayer en modifiant le nom ou la propri&eacute;t&eacute; date de n'importe
                     lequel de vos objets. Tant qu'ils sont dans un &eacute;tat <span class="emphasis"><em>persistant</em></span>, c'est-&agrave;-dire, li&eacute;s &agrave; une <code class="literal">Session</code> Hibernate particuli&egrave;re (c-&agrave;-d qu'ils ont juste &eacute;t&eacute; charg&eacute;s ou sauvegard&eacute;s dans une unit&eacute; de travail), Hibernate surveille
                     les changements et ex&eacute;cute le SQL correspondant. Le processus de synchronisation de l'&eacute;tat de la m&eacute;moire avec la base de donn&eacute;es,
                     g&eacute;n&eacute;ralement seulement &agrave; la fin d'une unit&eacute; de travail, est appel&eacute; <span class="emphasis"><em>flushing</em></span>. Dans notre code, l'unit&eacute; de travail s'ach&egrave;ve par un commit (ou rollback) de la transaction avec la base de donn&eacute;es - comme
                     d&eacute;fini par notre option <code class="literal">thread</code> de configuration pour la classe <code class="literal">CurrentSessionContext</code>. 
                  </p>
                  <p>Vous pourriez bien s&ucirc;r charger une personne et un &eacute;v&eacute;nement dans diff&eacute;rentes unit&eacute;s de travail. Ou vous modifiez un objet
                     &agrave; l'ext&eacute;rieur d'une <code class="literal">Session</code>, s'il n'est pas dans un &eacute;tat persistant (s'il &eacute;tait persistant avant, nous appelons cet &eacute;tat <span class="emphasis"><em>d&eacute;tach&eacute;</em></span>). Vous pouvez m&ecirc;me modifier une collection lorsqu'elle est d&eacute;tach&eacute;e: 
                  </p><pre class="programlisting">private void addPersonToEvent(Long personId, Long eventId) {

    Session session = HibernateUtil.getSessionFactory().getCurrentSession();
    session.beginTransaction();

    Person aPerson = (Person) session
            .createQuery("select p from Person p left join fetch p.events where p.id = :pid")
            .setParameter("pid", personId)
            .uniqueResult(); // Eager fetch the collection so we can use it detached

    Event anEvent = (Event) session.load(Event.class, eventId);

    session.getTransaction().commit();

    // End of first unit of work

    aPerson.getEvents().add(anEvent); // aPerson (and its collection) is detached

    // Begin second unit of work

    Session session2 = HibernateUtil.getSessionFactory().getCurrentSession();
    session2.beginTransaction();

    session2.update(aPerson); // Reattachment of aPerson

    session2.getTransaction().commit();
}</pre><p>L'appel &agrave; <code class="literal">update</code> rend un objet d&eacute;tach&eacute; &agrave; nouveau persistant, vous pourriez dire qu'il le lie &agrave; une unit&eacute; de travail, ainsi toutes les modifications
                     (ajout, suppression) que vous avez faites pendant qu'il &eacute;tait d&eacute;tach&eacute; peuvent &ecirc;tre sauvegard&eacute;es dans la base de donn&eacute;es (il
                     se peut que vous ayez besoin de modifier quelques unes des m&eacute;thodes pr&eacute;c&eacute;dentes pour retourner cet identifiant). 
                  </p>
                  <p>Ce n'est pas tr&egrave;s utile dans notre situation actuelle, mais c'est un concept important que vous pouvez mettre dans votre propre
                     application. Pour le moment, compl&eacute;tez cet exercice en ajoutant une nouvelle action &agrave; la m&eacute;thode principale des <code class="literal">EventManager</code>s et appelez la &agrave; partir de la ligne de commande. Si vous avez besoin des identifiants d'une personne et d'un &eacute;v&eacute;nement -
                     la m&eacute;thode <code class="literal">save()</code> les retourne. 
                  </p><pre class="programlisting">else if (args[0].equals("addpersontoevent")) {
    Long eventId = mgr.createAndStoreEvent("My Event", new Date());
    Long personId = mgr.createAndStorePerson("Foo", "Bar");
    mgr.addPersonToEvent(personId, eventId);
    System.out.println("Added person " + personId + " to event " + eventId);
}</pre><p>C'&eacute;tait un exemple d'une association entre deux classes de m&ecirc;me importance, deux entit&eacute;s. Comme mentionn&eacute; plus t&ocirc;t, il y a
                     d'autres classes et d'autres types dans un mod&egrave;le typique, g&eacute;n&eacute;ralement "moins importants". Vous en avez d&eacute;j&agrave; vu certains,
                     comme un <code class="literal">int</code> ou une <code class="literal">String</code>. Nous appelons ces classes des <span class="emphasis"><em>types de valeur</em></span>, et leurs instances <span class="emphasis"><em>d&eacute;pendent</em></span> d'une entit&eacute; particuli&egrave;re. Des instances de ces types n'ont pas leur propre identit&eacute;, elles ne sont pas non plus partag&eacute;es
                     entre des entit&eacute;s (deux personnes ne r&eacute;f&eacute;rencent pas le m&ecirc;me objet <code class="literal">firstname</code>, m&ecirc;me si elles ont le m&ecirc;me pr&eacute;nom). Bien s&ucirc;r, des types de valeur ne peuvent pas seulement &ecirc;tre trouv&eacute;s dans le JDK (en fait,
                     dans une application Hibernate toutes les classes du JDK sont consid&eacute;r&eacute;es comme des types de valeur), vous pouvez aussi &eacute;crire
                     vous-m&ecirc;me des classes d&eacute;pendantes, <code class="literal">Address</code> ou <code class="literal">MonetaryAmount</code>, par exemple. 
                  </p>
                  <p>Vous pouvez aussi concevoir une collection de types de valeur. C'est conceptuellement tr&egrave;s diff&eacute;rent d'une collection de r&eacute;f&eacute;rences
                     vers d'autres entit&eacute;s, mais tr&egrave;s ressemblant en Java. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="tutorial-associations-valuecollections"></a>1.3.4.&nbsp;Collection de valeurs
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Nous ajoutons une collection d'objets de type de valeur &agrave; l'entit&eacute; <code class="literal">Person</code>. Nous voulons stocker des adresses email, donc le type que nous utilisons est <code class="literal">String</code>, et la collection est encore un <code class="literal">Set</code> : 
                  </p><pre class="programlisting">private Set emailAddresses = new HashSet();

public Set getEmailAddresses() {
    return emailAddresses;
}

public void setEmailAddresses(Set emailAddresses) {
    this.emailAddresses = emailAddresses;
}</pre><p>Le mapping de ce <code class="literal">Set</code> : 
                  </p><pre class="programlisting">&lt;set name="emailAddresses" table="PERSON_EMAIL_ADDR"&gt;
    &lt;key column="PERSON_ID"/&gt;
    &lt;element type="string" column="EMAIL_ADDR"/&gt;
&lt;/set&gt;</pre><p>La diff&eacute;rence compar&eacute;e au mapping vu plus t&ocirc;t est la partie <code class="literal">element</code>, laquelle dit &agrave; Hibernate que la collection ne contient pas de r&eacute;f&eacute;rences vers une autre entit&eacute;, mais une collection d'&eacute;l&eacute;ments
                     de type <code class="literal">String</code> (le nom en minuscule vous indique que c'est un type/convertisseur du mapping Hibernate). Une fois encore, l'attribut <code class="literal">table</code> de l'&eacute;l&eacute;ment <code class="literal">set</code> d&eacute;termine le nom de la table pour la collection. L'&eacute;l&eacute;ment <code class="literal">key</code> d&eacute;finit le nom de la colonne de la clef &eacute;trang&egrave;re dans la table de la collection. L'attribut <code class="literal">column</code> dans l'&eacute;l&eacute;ment <code class="literal">element</code> d&eacute;finit le nom de la colonne o&ugrave; les valeurs de <code class="literal">String</code> seront r&eacute;ellement stock&eacute;es. 
                  </p>
                  <p>Regardons le sch&eacute;ma mis &agrave; jour : </p><pre class="programlisting">
  _____________        __________________
 |             |      |                  |       _____________
 |   EVENTS    |      |   PERSON_EVENT   |      |             |       ___________________
 |_____________|      |__________________|      |    PERSON   |      |                   |
 |             |      |                  |      |_____________|      | PERSON_EMAIL_ADDR |
 | *EVENT_ID   | &lt;--&gt; | *EVENT_ID        |      |             |      |___________________|
 |  EVENT_DATE |      | *PERSON_ID       | &lt;--&gt; | *PERSON_ID  | &lt;--&gt; |  *PERSON_ID       |
 |  TITLE      |      |__________________|      |  AGE        |      |  *EMAIL_ADDR      |
 |_____________|                                |  FIRSTNAME  |      |___________________|
                                                |  LASTNAME   |
                                                |_____________|
 </pre><p>Vous pouvez voir que la clef primaire de la table de la collection est en fait une clef compos&eacute;e, utilisant deux colonnes.
                     Ceci implique aussi qu'il ne peut pas y avoir d'adresses email dupliqu&eacute;es par personne, ce qui est exactement la s&eacute;mantique
                     dont nous avons besoin pour un ensemble en Java. 
                  </p>
                  <p>Vous pouvez maintenant tester et ajouter des &eacute;l&eacute;ments &agrave; cette collection, juste comme nous l'avons fait avant en liant des
                     personnes et des &eacute;v&eacute;nements. C'est le m&ecirc;me code en Java. 
                  </p><pre class="programlisting">private void addEmailToPerson(Long personId, String emailAddress) {

    Session session = HibernateUtil.getSessionFactory().getCurrentSession();
    session.beginTransaction();

    Person aPerson = (Person) session.load(Person.class, personId);

    // The getEmailAddresses() might trigger a lazy load of the collection
    aPerson.getEmailAddresses().add(emailAddress);

    session.getTransaction().commit();
}</pre><p>This time we didn't use a <span class="emphasis"><em>fetch</em></span> query to initialize the collection. Hence, the call to its getter method will trigger an additional select to initialize
                     it, so we can add an element to it. Monitor the SQL log and try to optimize this with an eager fetch. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="tutorial-associations-bidirectional"></a>1.3.5.&nbsp;Associations bidirectionnelles
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Ensuite nous allons mapper une association bidirectionnelle - faire fonctionner l'association entre une personne et un &eacute;v&eacute;nement
                     &agrave; partir des deux c&ocirc;t&eacute;s en Java. Bien s&ucirc;r, le sch&eacute;ma de la base de donn&eacute;es ne change pas, nous avons toujours une pluralit&eacute;
                     many-to-many. Une base de donn&eacute;es relationnelle est plus flexible qu'un langage de programmation r&eacute;seau, donc elle n'a pas
                     besoin de direction de navigation - les donn&eacute;es peuvent &ecirc;tre vues et r&eacute;cup&eacute;r&eacute;es de toutes les mani&egrave;res possibles. 
                  </p>
                  <p>D'abord, ajouter une collection de participants &agrave; la classe <code class="literal">Event</code> : 
                  </p><pre class="programlisting">private Set participants = new HashSet();

public Set getParticipants() {
    return participants;
}

public void setParticipants(Set participants) {
    this.participants = participants;
}</pre><p>Maintenant mapper ce c&ocirc;t&eacute; de l'association aussi, dans <code class="literal">Event.hbm.xml</code>. 
                  </p><pre class="programlisting">&lt;set name="participants" table="PERSON_EVENT" inverse="true"&gt;
    &lt;key column="EVENT_ID"/&gt;
    &lt;many-to-many column="PERSON_ID" class="events.Person"/&gt;
&lt;/set&gt;</pre><p>Comme vous le voyez, ce sont des mappings de <code class="literal">set</code>s normaux dans les deux documents de mapping. Notez que les noms de colonne dans <code class="literal">key</code> et <code class="literal">many-to-many</code> sont invers&eacute;s dans les 2 documents de mapping. L'ajout le plus important ici est l'attribut <code class="literal">inverse="true"</code> dans l'&eacute;l&eacute;ment <code class="literal">set</code> du mapping de la collection des <code class="literal">Event</code>s. 
                  </p>
                  <p>Ce que signifie qu'Hibernate devrait prendre l'autre c&ocirc;t&eacute; - la classe <code class="literal">Person</code> - s'il a besoin de renseigner des informations &agrave; propos du lien entre les deux. Ce sera beaucoup plus facile &agrave; comprendre
                     une fois que vous verrez comment le lien bidirectionnel entre les deux entit&eacute;s est cr&eacute;&eacute;. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="tutorial-associations-usingbidir"></a>1.3.6.&nbsp;Travailler avec des liens bidirectionnels
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Premi&egrave;rement, gardez &agrave; l'esprit qu'Hibernate n'affecte pas la s&eacute;mantique normale de Java. Comment avons-nous cr&eacute;&eacute; un lien
                     entre une <code class="literal">Person</code> et un <code class="literal">Event</code> dans l'exemple unidirectionnel ? Nous avons ajout&eacute; une instance de <code class="literal">Event</code> &agrave; la collection des r&eacute;f&eacute;rences d'&eacute;v&eacute;nement d'une instance de <code class="literal">Person</code>. Donc, &eacute;videmment, si vous voulons rendre ce lien bidirectionnel, nous devons faire la m&ecirc;me chose de l'autre c&ocirc;t&eacute; - ajouter
                     une r&eacute;f&eacute;rence de <code class="literal">Person</code> &agrave; la collection d'un <code class="literal">Event</code>. Cette "configuration du lien des deux c&ocirc;t&eacute;s" est absolument n&eacute;cessaire et vous ne devriez jamais oublier de le faire. 
                  </p>
                  <p>Many developers program defensively and create link management methods to correctly set both sides, e.g. in <code class="literal">Person</code>: 
                  </p><pre class="programlisting">protected Set getEvents() {
    return events;
}

protected void setEvents(Set events) {
    this.events = events;
}

public void addToEvent(Event event) {
    this.getEvents().add(event);
    event.getParticipants().add(this);
}

public void removeFromEvent(Event event) {
    this.getEvents().remove(event);
    event.getParticipants().remove(this);
}</pre><p>Notez que les m&eacute;thodes get et set pour la collection sont maintenant prot&eacute;g&eacute;es - ceci permet &agrave; des classes du m&ecirc;me paquet
                     et aux sous-classes d'acc&eacute;der encore aux m&eacute;thodes, mais emp&ecirc;che n'importe qui d'autre de mettre le d&eacute;sordre directement dans
                     les collections (enfin, presque). Vous devriez probablement faire de m&ecirc;me avec la collection de l'autre c&ocirc;t&eacute;. 
                  </p>
                  <p>Et &agrave; propos de l'attribut de mapping <code class="literal">inverse</code> ? Pour vous, et pour Java, un lien bidirectionnel est simplement une mani&egrave;re de configurer correctement les r&eacute;f&eacute;rences des
                     deux c&ocirc;t&eacute;s. Hibernate n'a cependant pas assez d'informations pour ordonner correctement les expressions SQL <code class="literal">INSERT</code> et <code class="literal">UPDATE</code> (pour &eacute;viter les violations de contrainte), et a besoin d'aide pour g&eacute;rer proprement les associations bidirectionnelles.
                     Rendre <code class="literal">inverse</code> un c&ocirc;t&eacute; d'une assocation dit &agrave; Hibernate de l'ignorer essentiellement, pour le consid&eacute;rer comme un <span class="emphasis"><em>miroir</em></span> de l'autre c&ocirc;t&eacute;. C'est tout ce qui est n&eacute;cessaire &agrave; Hibernate pour d&eacute;couvrir tout des probl&egrave;mes de transformation d'un mod&egrave;le
                     de navigation directionnelle vers un sch&eacute;ma SQL de base de donn&eacute;es. Les r&egrave;gles dont vous devez vous souvenir sont : toutes
                     les associations bidirectionnelles ont besoin d'un c&ocirc;t&eacute; marqu&eacute; <code class="literal">inverse</code>. Dans une association un-vers-plusieurs vous pouvez choisir n'importe quel c&ocirc;t&eacute;, il n'y a pas de diff&eacute;rence. 
                  </p>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="tutorial-webapp"></a>1.4.&nbsp;Part 3 - L'application web EventManager
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Let's turn the following discussion into a small web application... </p>
               <p>Une application web Hibernate utilise la <code class="literal">Session</code> et <code class="literal">Transaction</code> comme une application standalone. Cependant, quelques patterns sont utiles. Nous allons coder une <code class="literal">EventManagerServlet</code>. Cette servlet peut lister tous les &eacute;v&egrave;nements stock&eacute;s dans la base de donn&eacute;es, et fournir une formulaire HTML pour saisir
                  d'autres &eacute;v&egrave;nements. 
               </p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="tutorial-webapp-servlet"></a>1.4.1.&nbsp;Ecrire la servlet de base
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Cr&eacute;ons une nouvelle classe dans notre r&eacute;pertoire source, dans le package <code class="literal">events</code>: 
                  </p><pre class="programlisting">package events;

// Imports

public class EventManagerServlet extends HttpServlet {

    // Servlet code
}</pre><p>The servlet handles HTTP <code class="literal">GET</code> requests only, hence, the method we implement is <code class="literal">doGet()</code>: 
                  </p><pre class="programlisting">protected void doGet(HttpServletRequest request,
                     HttpServletResponse response)
        throws ServletException, IOException {

    SimpleDateFormat dateFormatter = new SimpleDateFormat("dd.MM.yyyy");

    try {
        // Begin unit of work
        HibernateUtil.getSessionFactory()
                .getCurrentSession().beginTransaction();

        // Process request and render page...

        // End unit of work
        HibernateUtil.getSessionFactory()
                .getCurrentSession().getTransaction().commit();

    } catch (Exception ex) {
        HibernateUtil.getSessionFactory()
                .getCurrentSession().getTransaction().rollback();
        throw new ServletException(ex);
    }

}</pre><p>The pattern we are applying here is called <span class="emphasis"><em>session-per-request</em></span>. When a request hits the servlet, a new Hibernate <code class="literal">Session</code> is opened through the first call to <code class="literal">getCurrentSession()</code> on the <code class="literal">SessionFactory</code>. Then a database transaction is started-all data access as to occur inside a transaction, no matter if data is read or written
                     (we don't use the auto-commit mode in applications). 
                  </p>
                  <p>UNTRANSLATED Do <span class="emphasis"><em>not</em></span> use a new Hibernate <code class="literal">Session</code> for every database operation. Use one Hibernate <code class="literal">Session</code> that is scoped to the whole request. Use <code class="literal">getCurrentSession()</code>, so that it is automatically bound to the current Java thread. 
                  </p>
                  <p>Ensuite, les actions possibles de la requ&ecirc;tes sont ex&eacute;cut&eacute;es et la r&eacute;ponse HTML est rendue. Nous en parlerons plus tard. </p>
                  <p>Finally, the unit of work ends when processing and rendering is complete. If any problem occurred during processing or rendering,
                     an exception will be thrown and the database transaction rolled back. This completes the <code class="literal">session-per-request</code> pattern. Instead of the transaction demarcation code in every servlet you could also write a servlet filter. See the Hibernate
                     website and Wiki for more information about this pattern, called <span class="emphasis"><em>Open Session in View</em></span>-you'll need it as soon as you consider rendering your view in JSP, not in a servlet. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="tutorial-webapp-processing"></a>1.4.2.&nbsp;Proc&eacute;der et rendre
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Impl&eacute;mentons l'ex&eacute;cution de la requ&ecirc;te et le rendu de la page. </p><pre class="programlisting">// Write HTML header
PrintWriter out = response.getWriter();
out.println("&lt;html&gt;&lt;head&gt;&lt;title&gt;Event Manager&lt;/title&gt;&lt;/head&gt;&lt;body&gt;");

// Handle actions
if ( "store".equals(request.getParameter("action")) ) {

    String eventTitle = request.getParameter("eventTitle");
    String eventDate = request.getParameter("eventDate");

    if ( "".equals(eventTitle) || "".equals(eventDate) ) {
        out.println("&lt;b&gt;&lt;i&gt;Please enter event title and date.&lt;/i&gt;&lt;/b&gt;");
    } else {
        createAndStoreEvent(eventTitle, dateFormatter.parse(eventDate));
        out.println("&lt;b&gt;&lt;i&gt;Added event.&lt;/i&gt;&lt;/b&gt;");
    }
}

// Print page
printEventForm(out);
listEvents(out, dateFormatter);

// Write HTML footer
out.println("&lt;/body&gt;&lt;/html&gt;");
out.flush();
out.close();</pre><p>Granted, this coding style with a mix of Java and HTML would not scale in a more complex application-keep in mind that we
                     are only illustrating basic Hibernate concepts in this tutorial. The code prints an HTML header and a footer. Inside this
                     page, an HTML form for event entry and a list of all events in the database are printed. The first method is trivial and only
                     outputs HTML: 
                  </p><pre class="programlisting">private void printEventForm(PrintWriter out) {
    out.println("&lt;h2&gt;Add new event:&lt;/h2&gt;");
    out.println("&lt;form&gt;");
    out.println("Title: &lt;input name='eventTitle' length='50'/&gt;&lt;br/&gt;");
    out.println("Date (e.g. 24.12.2009): &lt;input name='eventDate' length='10'/&gt;&lt;br/&gt;");
    out.println("&lt;input type='submit' name='action' value='store'/&gt;");
    out.println("&lt;/form&gt;");
}</pre><p>La m&eacute;thode <code class="literal">listEvents()</code> utilise la <code class="literal">Session</code> Hibernate li&eacute;e au thread courant pour ex&eacute;cuter la requ&ecirc;te: 
                  </p><pre class="programlisting">private void listEvents(PrintWriter out, SimpleDateFormat dateFormatter) {

    List result = HibernateUtil.getSessionFactory()
                    .getCurrentSession().createCriteria(Event.class).list();
    if (result.size() &gt; 0) {
        out.println("&lt;h2&gt;Events in database:&lt;/h2&gt;");
        out.println("&lt;table border='1'&gt;");
        out.println("&lt;tr&gt;");
        out.println("&lt;th&gt;Event title&lt;/th&gt;");
        out.println("&lt;th&gt;Event date&lt;/th&gt;");
        out.println("&lt;/tr&gt;");
        for (Iterator it = result.iterator(); it.hasNext();) {
            Event event = (Event) it.next();
            out.println("&lt;tr&gt;");
            out.println("&lt;td&gt;" + event.getTitle() + "&lt;/td&gt;");
            out.println("&lt;td&gt;" + dateFormatter.format(event.getDate()) + "&lt;/td&gt;");
            out.println("&lt;/tr&gt;");
        }
        out.println("&lt;/table&gt;");
    }
}</pre><p>FEnfin, l'action <code class="literal">store</code> renvoie &agrave; la m&eacute;thode <code class="literal">createAndStoreEvent()</code>, qui utilise aussi la <code class="literal">Session</code> du thread courant: 
                  </p><pre class="programlisting">protected void createAndStoreEvent(String title, Date theDate) {
    Event theEvent = new Event();
    theEvent.setTitle(title);
    theEvent.setDate(theDate);

    HibernateUtil.getSessionFactory()
                    .getCurrentSession().save(theEvent);
}</pre><p>That's it, the servlet is complete. A request to the servlet will be processed in a single <code class="literal">Session</code> and <code class="literal">Transaction</code>. As earlier in the standalone application, Hibernate can automatically bind these objects to the current thread of execution.
                     This gives you the freedom to layer your code and access the <code class="literal">SessionFactory</code> in any way you like. Usually you'd use a more sophisticated design and move the data access code into data access objects
                     (the DAO pattern). See the Hibernate Wiki for more examples. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="tutorial-webapp-deploy"></a>1.4.3.&nbsp;D&eacute;ployer et tester
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Pour d&eacute;ployer cette application, vous devez cr&eacute;er une archive Web, un War. Ajoutez la cible Ant suivante dans votre <code class="literal">build.xml</code>: 
                  </p><pre class="programlisting">&lt;target name="war" depends="compile"&gt;
    &lt;war destfile="hibernate-tutorial.war" webxml="web.xml"&gt;
        &lt;lib dir="${librarydir}"&gt;
          &lt;exclude name="jsdk*.jar"/&gt;
        &lt;/lib&gt;

        &lt;classes dir="${targetdir}"/&gt;
    &lt;/war&gt;
&lt;/target&gt;</pre><p>Cette cible cr&eacute;&eacute; un fichier nomm&eacute; <code class="literal">hibernate-tutorial.war</code> dans le r&eacute;pertoire de votre projet. Elle package les biblioth&egrave;ques et le descripteur <code class="literal">web.xml</code> qui est attendu dans le r&eacute;pertoire racine de votre projet: 
                  </p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app version="2.4"
    xmlns="http://java.sun.com/xml/ns/j2ee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;Event Manager&lt;/servlet-name&gt;
        &lt;servlet-class&gt;events.EventManagerServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;Event Manager&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/eventmanager&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</pre><p>Before you compile and deploy the web application, note that an additional library is required: <code class="literal">jsdk.jar</code>. This is the Java servlet development kit, if you don't have this library already, get it from the Sun website and copy it
                     to your library directory. However, it will be only used for compilation and excluded from the WAR package. 
                  </p>
                  <p>Pour construire et d&eacute;ployer, appelez <code class="literal">ant war</code> dans votre projet et copier le fichier <code class="literal">hibernate-tutorial.war</code> dans le r&eacute;pertoire <code class="literal">webapp</code> de tomcat Si vous n'avez pas install&eacute; Tomcat, t&eacute;l&eacute;chargez le et suivez la notice d'installation. Vous n'avez pas &agrave; modifier
                     la configuration Tomcat pour d&eacute;ployer cette application. 
                  </p>
                  <p>Une fois l'application d&eacute;ploy&eacute;e et Tomcat lanc&eacute;, acc&eacute;dez &agrave; l'application via <code class="literal">http://localhost:8080/hibernate-tutorial/eventmanager</code>. Assurez vous de consulter les traces tomcat pour observer l'initialisation d'Hibernate &agrave; la premi&egrave;re requ&ecirc;te touchant votre
                     servlet (l'initialisation statique dans <code class="literal">HibernateUtil</code> est invoqu&eacute;e) et pour v&eacute;rifier qu'aucune exception ne survienne. 
                  </p>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="tutorial-summary"></a>1.5.&nbsp;R&eacute;sum&eacute;
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Ce didacticiel a couvert les bases de l'&eacute;criture d'une simple application Hibernate ainsi qu'une petite application web. </p>
               <p>Si vous &ecirc;tes d&eacute;j&agrave; confiants avec Hibernate, continuez &agrave; parcourir les sujets que vous trouvez int&eacute;ressants &agrave; travers la table
                  des mati&egrave;res de la documentation de r&eacute;f&eacute;rence - les plus demand&eacute;s sont le traitement transactionnel (<a href="#transactions" title="Chapitre&nbsp;11.&nbsp;Transactions et acc&egrave;s concurrents">Chapitre&nbsp;11, <i xmlns:xlink="http://www.w3.org/1999/xlink">Transactions et acc&egrave;s concurrents</i></a>), la performance des r&eacute;cup&eacute;rations d'information (<a href="#performance" title="Chapitre&nbsp;19.&nbsp;Am&eacute;liorer les performances">Chapitre&nbsp;19, <i xmlns:xlink="http://www.w3.org/1999/xlink">Am&eacute;liorer les performances</i></a>), ou l'utilisation de l'API (<a href="#objectstate" title="Chapitre&nbsp;10.&nbsp;Travailler avec des objets">Chapitre&nbsp;10, <i xmlns:xlink="http://www.w3.org/1999/xlink">Travailler avec des objets</i></a>) et les fonctionnalit&eacute;s des requ&ecirc;tes (<a href="#objectstate-querying" title="10.4.&nbsp;Requ&ecirc;tage">Section&nbsp;10.4, &laquo;&nbsp;Requ&ecirc;tage&nbsp;&raquo;</a>). 
               </p>
               <p>N'oubliez pas de v&eacute;rifier le site web d'Hibernate pour d'autres didacticiels (plus sp&eacute;cialis&eacute;s). </p>
            </div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="architecture"></a>Chapitre&nbsp;2.&nbsp;Architecture
                     </h2>
                  </div>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="architecture-overview"></a>2.1.&nbsp;G&eacute;n&eacute;ralit&eacute;s
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Voici une vue (tr&egrave;s) haut niveau de l'architecture d'Hibernate : </p>
               <div class="mediaobject" align="center"><img src="images/overview.png" align="middle"></div>
               <p>Ce diagramme montre Hibernate utilisant une base de donn&eacute;es et des donn&eacute;es de configuration pour fournir un service de persistance
                  (et des objets persistants) &agrave; l'application. 
               </p>
               <p>Nous aimerions d&eacute;crire une vue plus d&eacute;taill&eacute;e de l'architecture. Malheureusement, Hibernate est flexible et supporte diff&eacute;rentes
                  approches. Nous allons en montrer les deux extr&ecirc;mes. L'architecture l&eacute;g&egrave;re laisse l'application fournir ses propres connexions
                  JDBC et g&eacute;rer ses propres transactions. Cette approche utilise le minimum des APIs Hibernate : 
               </p>
               <div class="mediaobject" align="center"><img src="images/lite.png" align="middle"></div>
               <p>L'architecture la plus compl&egrave;te abstrait l'application des APIs JDBC/JTA sous-jacentes et laisse Hibernate s'occuper des d&eacute;tails.
                  
               </p>
               <div class="mediaobject" align="center"><img src="images/full_cream.png" align="middle"></div>
               <p>Heres some definitions of the objects in the diagrams: </p>
               <div class="variablelist">
                  <dl>
                     <dt><span class="term">SessionFactory (<code class="literal">org.hibernate.SessionFactory</code>)</span></dt>
                     <dd>
                        <p>Un cache threadsafe (immuable) des mappings vers une (et une seule) base de donn&eacute;es. Une factory (fabrique) de <code class="literal">Session</code> et un client de <code class="literal">ConnectionProvider</code>. Peut contenir un cache optionnel de donn&eacute;es (de second niveau) qui est r&eacute;utilisable entre les diff&eacute;rentes transactions que
                           cela soit au sein du m&ecirc;me processus (JVLM) ou par plusieurs n&#339;uds d'un cluster. 
                        </p>
                     </dd>
                     <dt><span class="term">Session (<code class="literal">org.hibernate.Session</code>)</span></dt>
                     <dd>
                        <p>Un objet mono-thread&eacute;, &agrave; dur&eacute;e de vie courte, qui repr&eacute;sente une conversation entre l'application et l'entrep&ocirc;t de persistance.
                           Encapsule une connexion JDBC. Factory (fabrique) des objets <code class="literal">Transaction</code>. Contient un cache (de premier niveau) des objets persistants, ce cache est obligatoire. Il est utilis&eacute; lors de la navigation
                           dans le graphe d'objets ou lors de la r&eacute;cup&eacute;ration d'objets par leur identifiant. 
                        </p>
                     </dd>
                     <dt><span class="term">Objets et Collections persistants</span></dt>
                     <dd>
                        <p>Objets mono-thread&eacute;s &agrave; vie courte contenant l'&eacute;tat de persistance et la fonction m&eacute;tier. Ceux-ci sont en g&eacute;n&eacute;ral les objets
                           de type JavaBean (ou POJOs) ; la seule particularit&eacute; est qu'ils sont associ&eacute;s avec une (et une seule) <code class="literal">Session</code>. D&egrave;s que la <code class="literal">Session</code> est ferm&eacute;e, ils seront d&eacute;tach&eacute;s et libres d'&ecirc;tre utilis&eacute;s par n'importe laquelle des couches de l'application (ie. de et
                           vers la pr&eacute;sentation en tant que Data Transfer Objects - DTO : objet de transfert de donn&eacute;es). 
                        </p>
                     </dd>
                     <dt><span class="term">Objets et collections transients</span></dt>
                     <dd>
                        <p>Instances de classes persistantes qui ne sont actuellement pas associ&eacute;es &agrave; une <code class="literal">Session</code>. Elles ont pu &ecirc;tre instanci&eacute;es par l'application et ne pas avoir (encore) &eacute;t&eacute; persist&eacute;es ou elle ont pu &ecirc;tre instanci&eacute;es
                           par une <code class="literal">Session</code> ferm&eacute;e. 
                        </p>
                     </dd>
                     <dt><span class="term">Transaction (<code class="literal">org.hibernate.Transaction</code>)</span></dt>
                     <dd>
                        <p>(Optionnel) Un objet mono-thread&eacute; &agrave; vie courte utilis&eacute; par l'application pour d&eacute;finir une unit&eacute; de travail atomique. Abstrait
                           l'application des transactions sous-jacentes qu'elles soient JDBC, JTA ou CORBA. Une <code class="literal">Session</code> peut fournir plusieurs <code class="literal">Transaction</code>s dans certains cas. Toutefois, la d&eacute;limitation des transactions, via l'API d'Hibernate ou par la <code class="literal">Transaction</code> sous-jacente, n'est jamais optionnelle! 
                        </p>
                     </dd>
                     <dt><span class="term">ConnectionProvider (<code class="literal">org.hibernate.connection.ConnectionProvider</code>)</span></dt>
                     <dd>
                        <p>(Optionnel) Une fabrique de (pool de) connexions JDBC. Abstrait l'application de la <code class="literal">Datasource</code> ou du <code class="literal">DriverManager</code> sous-jacent. Non expos&eacute; &agrave; l'application, mais peut &ecirc;tre &eacute;tendu/impl&eacute;ment&eacute; par le d&eacute;veloppeur. 
                        </p>
                     </dd>
                     <dt><span class="term">TransactionFactory (<code class="literal">org.hibernate.TransactionFactory</code>)</span></dt>
                     <dd>
                        <p>(Optionnel) Une fabrique d'instances de <code class="literal">Transaction</code>. Non expos&eacute; &agrave; l'application, mais peut &ecirc;tre &eacute;tendu/impl&eacute;ment&eacute; par le d&eacute;veloppeur. 
                        </p>
                     </dd>
                     <dt><span class="term"><span class="emphasis"><em>Interfaces d'extension</em></span></span></dt>
                     <dd>
                        <p>Hibernate fournit de nombreuses interfaces d'extensions optionnelles que vous pouvez impl&eacute;menter pour personnaliser le comportement
                           de votre couche de persistance. Reportez vous &agrave; la documentation de l'API pour plus de d&eacute;tails. 
                        </p>
                     </dd>
                  </dl>
               </div>
               <p>
                  
               </p>
               <p>Dans une architecture l&eacute;g&egrave;re, l'application n'aura pas &agrave; utiliser les APIs <code class="literal">Transaction</code>/<code class="literal">TransactionFactory</code> et/ou n'utilisera pas les APIs <code class="literal">ConnectionProvider</code> pour utiliser JTA ou JDBC. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="architecture-states"></a>2.2.&nbsp;Etats des instances
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Une instance d'une classe persistante peut &ecirc;tre dans l'un des trois &eacute;tats suivants, d&eacute;finis par rapport &agrave; un <span class="emphasis"><em>contexte de persistance</em></span>. L'objet <code class="literal">Session</code> d'hibernate correspond &agrave; ce concept de contexte de persistance : 
               </p>
               <div class="variablelist">
                  <dl>
                     <dt><span class="term">passager (transient)</span></dt>
                     <dd>
                        <p>L'instance n'est pas et n'a jamais &eacute;t&eacute; associ&eacute;e &agrave; un contexte de persistance. Elle ne poss&egrave;de pas d'identit&eacute; persistante (valeur
                           de cl&eacute; primaire) 
                        </p>
                     </dd>
                     <dt><span class="term">persistant</span></dt>
                     <dd>
                        <p>L'instance est associ&eacute;e au contexte de persistance. Elle poss&egrave;de une identit&eacute; persistante (valeur de cl&eacute; primaire) et, peut-&ecirc;tre,
                           un enregistrement correspondant dans la base. Pour un contexte de persistance particulier, Hibernate <span class="emphasis"><em>garantit</em></span> que l'identit&eacute; persistante est &eacute;quivalente &agrave; l'identit&eacute; Java (emplacement m&eacute;moire de l'objet) 
                        </p>
                     </dd>
                     <dt><span class="term">d&eacute;tach&eacute;</span></dt>
                     <dd>
                        <p>The instance was once associated with a persistence context, but that context was closed, or the instance was serialized to
                           another process. It has a persistent identity and, perhaps, a corresponding row in the database. For detached instances, Hibernate
                           makes no guarantees about the relationship between persistent identity and Java identity. 
                        </p>
                     </dd>
                  </dl>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="architecture-jmx"></a>2.3.&nbsp;Int&eacute;gration JMX
                        </h2>
                     </div>
                  </div>
               </div>
               <p>JMX est le standard J2EE de gestion des composants Java. Hibernate peut &ecirc;tre g&eacute;r&eacute; via un service JMX standard. Nous fournissons
                  une impl&eacute;mentation d'un MBean dans la distribution : <code class="literal">org.hibernate.jmx.HibernateService</code>. 
               </p>
               <p>Pour avoir un exemple sur la mani&egrave;re de d&eacute;ployer Hibernate en tant que service JMX dans le serveur d'application JBoss Application
                  Server, r&eacute;f&eacute;rez vous au guide utilisateur JBoss (JBoss User Guide). Si vous d&eacute;ployez Hibernate via JMX sur JBoss AS, vous
                  aurez &eacute;galement les b&eacute;n&eacute;fices suivants : 
               </p>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        <p><span class="emphasis"><em>Gestion de la session :</em></span> Le cycle de vie de la <code class="literal">Session</code> Hibernate peut &ecirc;tre automatiquement limit&eacute;e &agrave; la port&eacute;e d'une transaction JTA. Cela signifie que vous n'avez plus besoin
                           d'ouvrir et de fermer la <code class="literal">Session</code> manuellement, cela devient le travail de l'intercepteur EJB de JBoss. Vous n'avez pas non plus &agrave; vous occuper des d&eacute;marcations
                           des transactions dans votre code (sauf si vous voulez &eacute;crire une couche de persistance qui soit portable, dans ce cas vous
                           pouvez utiliser l'API optionnelle <code class="literal">Transaction</code> d'Hibernate). Vous appelez l'<code class="literal">HibernateContext</code> pour acc&eacute;der &agrave; la <code class="literal">Session</code>. 
                        </p>
                     </li>
                     <li>
                        <p><span class="emphasis"><em>D&eacute;ploiement HAR :</em></span> Habituellement vous d&eacute;ployez le service JMX Hibernate en utilisant le descripteur de d&eacute;ploiement de JBoss (dans un fichier
                           EAR et/ou un SAR), il supporte toutes les options de configuration usuelles d'une <code class="literal">SessionFactory</code> Hibernate. Cependant, vous devez toujours nommer tous vos fichiers de mapping dans le descripteur de d&eacute;ploiement. Si vous
                           d&eacute;cidez d'utiliser le d&eacute;ploiement optionnel sous forme de HAR, JBoss d&eacute;tectera automatiquement tous vos fichiers de mapping
                           dans votre fichier HAR. 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Consultez le guide d'utilisation de JBoss AS pour plus d'informations sur ces options. </p>
               <p>Les statistiques pendant l'ex&eacute;cution d'Hibernate (au runtime) sont une autre fonctionnalit&eacute; disponible en tant que service
                  JMX. Voyez pour cela <a href="#configuration-optional-statistics" title="3.4.6.&nbsp;Statistiques Hibernate">Section&nbsp;3.4.6, &laquo;&nbsp;Statistiques Hibernate&nbsp;&raquo;</a>. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="architecture-jca"></a>2.4.&nbsp;Support JCA
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Hibernate peut aussi &ecirc;tre configur&eacute; en tant que connecteur JCA. R&eacute;f&eacute;rez-vous au site web pour de plus amples d&eacute;tails. Il est
                  important de noter que le support JCA d'Hibernate est encore consid&eacute;r&eacute; comme exp&eacute;rimental. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="architecture-current-session"></a>2.5.&nbsp;Sessions Contextuelles
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Certaines applications utilisant Hibernate ont besoin d'une sorte de session "contextuelle", o&ugrave; une session est li&eacute;e &agrave; la
                  port&eacute;e d'un contexte particulier. Cependant, les applications ne d&eacute;finissent pas toutes la notion de contexte de la m&ecirc;me mani&egrave;re,
                  et diff&eacute;rents contextes d&eacute;finissent diff&eacute;rentes port&eacute;es &agrave; la notion de "courant". Les applications &agrave; base d'Hibernate, versions
                  pr&eacute;c&eacute;dentes &agrave; la 3.0 utilisaient g&eacute;n&eacute;ralement un principe maison de sessions contextuelles bas&eacute;es sur le <code class="literal">ThreadLocal</code>, ainsi que sur des classes utilitaires comme <code class="literal">HibernateUtil</code>, ou utilisaient des framework tiers (comme Spring ou Pico) qui fournissaient des sessions contextuelles bas&eacute;es sur l'utilisation
                  de proxy/interception. 
               </p>
               <p>A partir de la version 3.0.1, Hibernate a ajout&eacute; la m&eacute;thode <code class="literal">SessionFactory.getCurrentSession()</code>. Initialement, cela demandait l'usage de transactions <code class="literal">JTA</code>, o&ugrave; la transaction <code class="literal">JTA</code> d&eacute;finissait la port&eacute;e et le contexte de la session courante. L'&eacute;quipe Hibernate pense que, &eacute;tant donn&eacute;e la maturit&eacute; des impl&eacute;mentations
                  de <code class="literal">JTA TransactionManager</code> , la plupart (sinon toutes) des applications devraient utiliser la gestion des transactions par <code class="literal">JTA</code> qu'elles soient ou non d&eacute;ploy&eacute;es dans un conteneur <code class="literal">J2EE</code>. Par cons&eacute;quent, vous devriez toujours contextualiser vos sessions, si vous en avez besoin, via la m&eacute;thode bas&eacute;e sur JTA.
                  
               </p>
               <p>Cependant, depuis la version 3.1, la logique derri&egrave;re <code class="literal">SessionFactory.getCurrentSession()</code> est d&eacute;sormais branchable. A cette fin, une nouvelle interface d'extension (<code class="literal">org.hibernate.context.CurrentSessionContext</code>) et un nouveau param&egrave;tre de configuration (<code class="literal">hibernate.current_session_context_class</code>) ont &eacute;t&eacute; ajout&eacute;s pour permettre de configurer d'autres moyens de d&eacute;finir la port&eacute;e et le contexte des sessions courantes.
                  
               </p>
               <p>Allez voir les Javadocs de l'interface <code class="literal">org.hibernate.context.CurrentSessionContext</code> pour une description d&eacute;taill&eacute;e de son contrat. Elle d&eacute;finit une seule m&eacute;thode, <code class="literal">currentSession()</code>, depuis laquelle l'impl&eacute;mentation est responsable de traquer la session courante du contexte. Hibernate fournit deux impl&eacute;mentation
                  de cette interface. 
               </p>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        <p><code class="literal">org.hibernate.context.JTASessionContext</code> - les sessions courantes sont associ&eacute;es &agrave; une transaction <code class="literal">JTA</code>. La logique est la m&ecirc;me que l'ancienne approche bas&eacute;e sur JTA. Voir les javadocs pour les d&eacute;tails. 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">org.hibernate.context.ThreadLocalSessionContext</code> - les sessions courantes sont associ&eacute;es au thread d'ex&eacute;cution. Voir les javadocs pour les d&eacute;tails. 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">org.hibernate.context.ManagedSessionContext</code> - current sessions are tracked by thread of execution. However, you are responsible to bind and unbind a <code class="literal">Session</code> instance with static methods on this class, it does never open, flush, or close a <code class="literal">Session</code>. 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>The first two implementations provide a "one session - one database transaction" programming model, also known and used as
                  <span class="emphasis"><em>session-per-request</em></span>. The beginning and end of a Hibernate session is defined by the duration of a database transaction. If you use programmatic
                  transaction demarcation in plain JSE without JTA, you are advised to use the Hibernate <code class="literal">Transaction</code> API to hide the underlying transaction system from your code. If you use JTA, use the JTA interfaces to demarcate transactions.
                  If you execute in an EJB container that supports CMT, transaction boundaries are defined declaratively and you don't need
                  any transaction or session demarcation operations in your code. Refer to <a href="#transactions" title="Chapitre&nbsp;11.&nbsp;Transactions et acc&egrave;s concurrents">Chapitre&nbsp;11, <i xmlns:xlink="http://www.w3.org/1999/xlink">Transactions et acc&egrave;s concurrents</i></a> for more information and code examples. 
               </p>
               <p>Le param&egrave;tre de configuration <code class="literal">hibernate.current_session_context_class</code> d&eacute;finit quelle impl&eacute;mentation de <code class="literal">org.hibernate.context.CurrentSessionContext</code> doit &ecirc;tre utilis&eacute;e. Notez que pour assurer la compatibilit&eacute; avec les versions pr&eacute;c&eacute;dentes, si ce param&egrave;tre n'est pas d&eacute;fini
                  mais qu'un <code class="literal">org.hibernate.transaction.TransactionManagerLookup</code> est configur&eacute;, Hibernate utilisera le <code class="literal">org.hibernate.context.JTASessionContext</code>. La valeur de ce param&egrave;tre devrait juste nommer la classe d'impl&eacute;mentation &agrave; utiliser, pour les deux impl&eacute;mentations fournies,
                  il y a cependant deux alias correspondant: "jta" et "thread". 
               </p>
            </div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="session-configuration"></a>Chapitre&nbsp;3.&nbsp;Configuration
                     </h2>
                  </div>
               </div>
            </div>
            <p>Parce qu'Hibernate est con&ccedil;u pour fonctionner dans diff&eacute;rents environnements, il existe beaucoup de param&egrave;tres de configuration.
               Heureusement, la plupart ont des valeurs par d&eacute;faut appropri&eacute;es et la distribution d'Hibernate contient un exemple de fichier
               <code class="literal">hibernate.properties</code> dans le r&eacute;pertoire <code class="literal">etc/</code> qui montre les diff&eacute;rentes options. Vous n'avez qu'&agrave; placer ce fichier dans votre classpath et &agrave; l'adapter. 
            </p>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="configuration-programmatic"></a>3.1.&nbsp;Configuration par programmation
                        </h2>
                     </div>
                  </div>
               </div>
               <p>An instance of <code class="classname">org.hibernate.cfg.Configuration</code> represents an entire set of mappings of an application's Java types to an SQL database. The <code class="classname">org.hibernate.cfg.Configuration</code> is used to build an (immutable) <code class="interfacename">org.hibernate.SessionFactory</code>. The mappings are compiled from various XML mapping files. 
               </p>
               <p>You may obtain a <code class="classname">org.hibernate.cfg.Configuration</code> instance by instantiating it directly and specifying XML mapping documents. If the mapping files are in the classpath, use
                  <code class="literal">addResource()</code>: 
               </p><pre class="programlisting">Configuration cfg = new Configuration()
    .addResource("Item.hbm.xml")
    .addResource("Bid.hbm.xml");</pre><p>Une alternative (parfois meilleure) est de sp&eacute;cifier les classes mapp&eacute;es et de laisser Hibernate trouver les documents de
                  mapping pour vous : 
               </p><pre class="programlisting">Configuration cfg = new Configuration()
    .addClass(org.hibernate.auction.Item.class)
    .addClass(org.hibernate.auction.Bid.class);</pre><p>Then Hibernate will look for mapping files named <code class="filename">/org/hibernate/auction/Item.hbm.xml</code> and <code class="filename">/org/hibernate/auction/Bid.hbm.xml</code> in the classpath. This approach eliminates any hardcoded filenames. 
               </p>
               <p>A <code class="classname">org.hibernate.cfg.Configuration</code> also allows you to specify configuration properties: 
               </p><pre class="programlisting">Configuration cfg = new Configuration()
    .addClass(org.hibernate.auction.Item.class)
    .addClass(org.hibernate.auction.Bid.class)
    .setProperty("hibernate.dialect", "org.hibernate.dialect.MySQLInnoDBDialect")
    .setProperty("hibernate.connection.datasource", "java:comp/env/jdbc/test")
    .setProperty("hibernate.order_updates", "true");</pre><p>Ce n'est pas le seul moyen de passer des propri&eacute;t&eacute;s de configuration &agrave; Hibernate. Les diff&eacute;rentes options sont : </p>
               <div class="orderedlist">
                  <ol type="1" compact>
                     <li>
                        <p>Pass an instance of <code class="classname">java.util.Properties</code> to <code class="literal">Configuration.setProperties()</code>. 
                        </p>
                     </li>
                     <li>
                        <p>Place a file named <code class="filename">hibernate.properties</code> in a root directory of the classpath. 
                        </p>
                     </li>
                     <li>
                        <p>Positionner les propri&eacute;t&eacute;s <code class="literal">System</code> en utilisant <code class="literal">java -Dproperty=value</code>. 
                        </p>
                     </li>
                     <li>
                        <p>Inclure des &eacute;l&eacute;ments <code class="literal">&lt;property&gt;</code> dans le fichier <code class="literal">hibernate.cfg.xml</code> (voir plus loin). 
                        </p>
                     </li>
                  </ol>
               </div>
               <p><code class="filename">hibernate.properties</code> is the easiest approach if you want to get started quickly. 
               </p>
               <p>The <code class="classname">org.hibernate.cfg.Configuration</code> is intended as a startup-time object, to be discarded once a <code class="literal">SessionFactory</code> is created. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="configuration-sessionfactory"></a>3.2.&nbsp;Obtenir une SessionFactory
                        </h2>
                     </div>
                  </div>
               </div>
               <p>When all mappings have been parsed by the <code class="classname">org.hibernate.cfg.Configuration</code>, the application must obtain a factory for <code class="interfacename">org.hibernate.Session</code> instances. This factory is intended to be shared by all application threads: 
               </p><pre class="programlisting">SessionFactory sessions = cfg.buildSessionFactory();</pre><p>Hibernate does allow your application to instantiate more than one <code class="interfacename">org.hibernate.SessionFactory</code>. This is useful if you are using more than one database. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="configuration-hibernatejdbc"></a>3.3.&nbsp;Connexions JDBC
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Usually, you want to have the <code class="interfacename">org.hibernate.SessionFactory</code> create and pool JDBC connections for you. If you take this approach, opening a <code class="interfacename">org.hibernate.Session</code> is as simple as: 
               </p><pre class="programlisting">Session session = sessions.openSession(); // open a new Session</pre><p>D&egrave;s que vous ferez quelquechose qui requiert un acc&egrave;s &agrave; la base de donn&eacute;es, une connexion JDBC sera r&eacute;cup&eacute;r&eacute;e dans le pool.
                  
               </p>
               <p>For this to work, we need to pass some JDBC connection properties to Hibernate. All Hibernate property names and semantics
                  are defined on the class <code class="classname">org.hibernate.cfg.Environment</code>. We will now describe the most important settings for JDBC connection configuration. 
               </p>
               <p>Hibernate will obtain (and pool) connections using <code class="classname">java.sql.DriverManager</code> if you set the following properties: 
               </p>
               <div class="table"><a name="d0e1696"></a><p class="title"><b>Tableau&nbsp;3.1.&nbsp;Propri&eacute;t&eacute;s JDBC d'Hibernate</b></p>
                  <div class="table-contents">
                     <table summary="Propri&eacute;t&eacute;s JDBC d'Hibernate" border="1">
                        <colgroup>
                           <col>
                           <col>
                        </colgroup>
                        <thead>
                           <tr>
                              <th>Property name</th>
                              <th>Purpose</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr>
                              <td>
                                                     <span class="property">hibernate.connection.driver_class</span>
                                                 
                              </td>
                              <td>
                                                     <span class="emphasis"><em>Classe du driver jdbc</em></span>
                                                 
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                     <span class="property">hibernate.connection.url</span>
                                                 
                              </td>
                              <td>
                                                     <span class="emphasis"><em>URL jdbc</em></span>
                                                 
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                     <span class="property">hibernate.connection.username</span>
                                                 
                              </td>
                              <td>
                                                     <span class="emphasis"><em>utilisateur de la base de donn&eacute;es</em></span>
                                                 
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                     <span class="property">hibernate.connection.password</span>
                                                 
                              </td>
                              <td>
                                                     <span class="emphasis"><em>mot de passe de la base de donn&eacute;es</em></span>
                                                 
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                     <span class="property">hibernate.connection.pool_size</span>
                                                 
                              </td>
                              <td>
                                                     <span class="emphasis"><em>nombre maximum de connexions dans le pool</em></span>
                                                 
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
               </div><br class="table-break"><p>Hibernate's own connection pooling algorithm is however quite rudimentary. It is intended to help you get started and is <span class="emphasis"><em>not intended for use in a production system</em></span> or even for performance testing. You should use a third party pool for best performance and stability. Just replace the <span class="property">hibernate.connection.pool_size</span> property with connection pool specific settings. This will turn off Hibernate's internal pool. For example, you might like
                  to use C3P0. 
               </p>
               <p>C3P0 is an open source JDBC connection pool distributed along with Hibernate in the <code class="filename">lib</code> directory. Hibernate will use its <code class="classname">org.hibernate.connection.C3P0ConnectionProvider</code> for connection pooling if you set <span class="property">hibernate.c3p0.*</span> properties. If you'd like to use Proxool refer to the packaged <code class="filename">hibernate.properties</code> and the Hibernate web site for more information. 
               </p>
               <p>Here is an example <code class="filename">hibernate.properties</code> file for C3P0: 
               </p><a name="c3p0-configuration"></a><pre class="programlisting">hibernate.connection.driver_class = org.postgresql.Driver
hibernate.connection.url = jdbc:postgresql://localhost/mydatabase
hibernate.connection.username = myuser
hibernate.connection.password = secret
hibernate.c3p0.min_size=5
hibernate.c3p0.max_size=20
hibernate.c3p0.timeout=1800
hibernate.c3p0.max_statements=50
hibernate.dialect = org.hibernate.dialect.PostgreSQLDialect</pre><p>For use inside an application server, you should almost always configure Hibernate to obtain connections from an application
                  server <code class="interfacename">javax.sql.Datasource</code> registered in JNDI. You'll need to set at least one of the following properties: 
               </p>
               <div class="table"><a name="d0e1798"></a><p class="title"><b>Tableau&nbsp;3.2.&nbsp;Propri&eacute;t&eacute; d'une Datasource Hibernate</b></p>
                  <div class="table-contents">
                     <table summary="Propri&eacute;t&eacute; d'une Datasource Hibernate" border="1">
                        <colgroup>
                           <col>
                           <col>
                        </colgroup>
                        <thead>
                           <tr>
                              <th>Property name</th>
                              <th>Purpose</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr>
                              <td>
                                                     <span class="property">hibernate.connection.datasource</span>
                                                 
                              </td>
                              <td>
                                                     <span class="emphasis"><em>Nom JNDI de la datasource</em></span>
                                                 
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                     <span class="property">hibernate.jndi.url</span>
                                                 
                              </td>
                              <td><span class="emphasis"><em>URL of the JNDI provider</em></span> (optional) 
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                     <span class="property">hibernate.jndi.class</span>
                                                 
                              </td>
                              <td><span class="emphasis"><em>class of the JNDI <code class="literal">InitialContextFactory</code></em></span> (optional) 
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                     <span class="property">hibernate.connection.username</span>
                                                 
                              </td>
                              <td><span class="emphasis"><em>database user</em></span> (optional) 
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                     <span class="property">hibernate.connection.password</span>
                                                 
                              </td>
                              <td><span class="emphasis"><em>database user password</em></span> (optional) 
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
               </div><br class="table-break"><p>Here's an example <code class="filename">hibernate.properties</code> file for an application server provided JNDI datasource: 
               </p><pre class="programlisting">hibernate.connection.datasource = java:/comp/env/jdbc/test
hibernate.transaction.factory_class = \
    org.hibernate.transaction.JTATransactionFactory
hibernate.transaction.manager_lookup_class = \
    org.hibernate.transaction.JBossTransactionManagerLookup
hibernate.dialect = org.hibernate.dialect.PostgreSQLDialect</pre><p>Les connexions JDBC obtenues &agrave; partir d'une datasource JNDI participeront automatiquement aux transactions g&eacute;r&eacute;es par le conteneur
                  du serveur d'applications. 
               </p>
               <p>Arbitrary connection properties may be given by prepending "<code class="literal">hibernate.connection</code>" to the connection property name. For example, you may specify a <span class="property">charSet</span> connection property using <span class="property">hibernate.connection.charSet</span>. 
               </p>
               <p>You may define your own plugin strategy for obtaining JDBC connections by implementing the interface <code class="interfacename">org.hibernate.connection.ConnectionProvider</code>, and specifying your custom implementation via the <span class="property">hibernate.connection.provider_class</span> property. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="configuration-optional"></a>3.4.&nbsp;Propri&eacute;t&eacute;s de configuration optionnelles
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Il y a un certain nombre d'autres propri&eacute;t&eacute;s qui contr&ocirc;lent le fonctionnement d'Hibernate &agrave; l'ex&eacute;cution. Toutes sont optionnelles
                  et ont comme valeurs par d&eacute;faut des valeurs "raisonnables" pour un fonctionnement nominal. 
               </p>
               <p><span class="emphasis"><em>Warning: some of these properties are "system-level" only.</em></span> System-level properties can be set only via <code class="literal">java -Dproperty=value</code> or <code class="filename">hibernate.properties</code>. They may <span class="emphasis"><em>not</em></span> be set by the other techniques described above. 
               </p>
               <div class="table"><a name="configuration-optional-properties"></a><p class="title"><b>Tableau&nbsp;3.3.&nbsp;Propri&eacute;t&eacute;s de configuration d'Hibernate</b></p>
                  <div class="table-contents">
                     <table summary="Propri&eacute;t&eacute;s de configuration d'Hibernate" border="1">
                        <colgroup>
                           <col>
                           <col>
                        </colgroup>
                        <thead>
                           <tr>
                              <th>Property name</th>
                              <th>Purpose</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.dialect</span>
                                                         
                              </td>
                              <td>The classname of a Hibernate <code class="classname">org.hibernate.dialect.Dialect</code> which allows Hibernate to generate SQL optimized for a particular relational database. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">full.classname.of.Dialect</code> 
                                 </p>
                                                             
                                 <p>In most cases Hibernate will actually be able to chose the correct <code class="classname">org.hibernate.dialect.Dialect</code> implementation to use based on the <code class="literal">JDBC metadata</code> returned by the JDBC driver. 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.show_sql</span>
                                                         
                              </td>
                              <td>Write all SQL statements to console. This is an alternative to setting the log category <code class="literal">org.hibernate.SQL</code> to <code class="literal">debug</code>. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true</code> | <code class="literal">false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.format_sql</span>
                                                         
                              </td>
                              <td>Pretty print the SQL in the log and console. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true</code> | <code class="literal">false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.default_schema</span>
                                                         
                              </td>
                              <td>Qualify unqualified table names with the given schema/tablespace in generated SQL. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">SCHEMA_NAME</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.default_catalog</span>
                                                         
                              </td>
                              <td>Qualify unqualified table names with the given catalog in generated SQL. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">CATALOG_NAME</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.session_factory_name</span>
                                                         
                              </td>
                              <td>The <code class="interfacename">org.hibernate.SessionFactory</code> will be automatically bound to this name in JNDI after it has been created. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">jndi/composite/name</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.max_fetch_depth</span>
                                                         
                              </td>
                              <td>Set a maximum "depth" for the outer join fetch tree for single-ended associations (one-to-one, many-to-one). A <code class="literal">0</code> disables default outer join fetching. 
                                 <p><span class="strong"><strong>ex.</strong></span> valeurs recommand&eacute;es entre <code class="literal">0</code> et <code class="literal">3</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.default_batch_fetch_size</span>
                                                         
                              </td>
                              <td>Set a default size for Hibernate batch fetching of associations. 
                                 <p><span class="strong"><strong>ex.</strong></span> Valeurs recommand&eacute;es : <code class="literal">4</code>, <code class="literal">8</code>, <code class="literal">16</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.default_entity_mode</span>
                                                         
                              </td>
                              <td>Set a default mode for entity representation for all sessions opened from this <code class="literal">SessionFactory</code> 
                                 <p><code class="literal">dynamic-map</code>, <code class="literal">dom4j</code>, <code class="literal">pojo</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.order_updates</span>
                                                         
                              </td>
                              <td>Force Hibernate to order SQL updates by the primary key value of the items being updated. This will result in fewer transaction
                                 deadlocks in highly concurrent systems. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true</code> | <code class="literal">false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.generate_statistics</span>
                                                         
                              </td>
                              <td>If enabled, Hibernate will collect statistics useful for performance tuning. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true</code> | <code class="literal">false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.use_identifer_rollback</span>
                                                         
                              </td>
                              <td>If enabled, generated identifier properties will be reset to default values when objects are deleted. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true</code> | <code class="literal">false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.use_sql_comments</span>
                                                         
                              </td>
                              <td>If turned on, Hibernate will generate comments inside the SQL, for easier debugging, defaults to <code class="literal">false</code>. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true</code> | <code class="literal">false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
               </div><br class="table-break"><div class="table"><a name="configuration-jdbc-properties"></a><p class="title"><b>Tableau&nbsp;3.4.&nbsp;Propri&eacute;t&eacute;s Hibernate li&eacute;es &agrave; JDBC et aux connexions</b></p>
                  <div class="table-contents">
                     <table summary="Propri&eacute;t&eacute;s Hibernate li&eacute;es &agrave; JDBC et aux connexions" border="1">
                        <colgroup>
                           <col>
                           <col>
                        </colgroup>
                        <thead>
                           <tr>
                              <th>Property name</th>
                              <th>Purpose</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.jdbc.fetch_size</span>
                                                         
                              </td>
                              <td>A non-zero value determines the JDBC fetch size (calls <code class="literal">Statement.setFetchSize()</code>). 
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.jdbc.batch_size</span>
                                                         
                              </td>
                              <td>A non-zero value enables use of JDBC2 batch updates by Hibernate. 
                                 <p><span class="strong"><strong>ex.</strong></span> les valeurs recommand&eacute;es entre <code class="literal">5</code> et <code class="literal">30</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.jdbc.batch_versioned_data</span>
                                                         
                              </td>
                              <td>Set this property to <code class="literal">true</code> if your JDBC driver returns correct row counts from <code class="literal">executeBatch()</code> (it is usually safe to turn this option on). Hibernate will then use batched DML for automatically versioned data. Defaults
                                 to <code class="literal">false</code>. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true</code> | <code class="literal">false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.jdbc.factory_class</span>
                                                         
                              </td>
                              <td>Select a custom <code class="interfacename">org.hibernate.jdbc.Batcher</code>. Most applications will not need this configuration property. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">classname.of.BatcherFactory</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.jdbc.use_scrollable_resultset</span>
                                                         
                              </td>
                              <td>Enables use of JDBC2 scrollable resultsets by Hibernate. This property is only necessary when using user supplied JDBC connections,
                                 Hibernate uses connection metadata otherwise. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true</code> | <code class="literal">false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.jdbc.use_streams_for_binary</span>
                                                         
                              </td>
                              <td>Use streams when writing/reading <code class="literal">binary</code> or <code class="literal">serializable</code> types to/from JDBC. <span class="emphasis"><em>*system-level property*</em></span> 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true</code> | <code class="literal">false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.jdbc.use_get_generated_keys</span>
                                                         
                              </td>
                              <td>Enable use of JDBC3 <code class="literal">PreparedStatement.getGeneratedKeys()</code> to retrieve natively generated keys after insert. Requires JDBC3+ driver and JRE1.4+, set to false if your driver has problems
                                 with the Hibernate identifier generators. By default, tries to determine the driver capabilities using connection metadata.
                                 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true|false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.connection.provider_class</span>
                                                         
                              </td>
                              <td>The classname of a custom <code class="interfacename">org.hibernate.connection.ConnectionProvider</code> which provides JDBC connections to Hibernate. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">classname.of.ConnectionProvider</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                         <span class="property">hibernate.connection.isolation</span>
                                                     
                              </td>
                              <td>Set the JDBC transaction isolation level. Check <code class="interfacename">java.sql.Connection</code> for meaningful values but note that most databases do not support all isolation levels and some define additional, non-standard
                                 isolations. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">1, 2, 4, 8</code> 
                                 </p>
                                                     
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.connection.autocommit</span>
                                                         
                              </td>
                              <td>Enables autocommit for JDBC pooled connections (not recommended). 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true</code> | <code class="literal">false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <span class="property">hibernate.connection.release_mode</span>
                                                         
                              </td>
                              <td>Specify when Hibernate should release JDBC connections. By default, a JDBC connection is held until the session is explicitly
                                 closed or disconnected. For an application server JTA datasource, you should use <code class="literal">after_statement</code> to aggressively release connections after every JDBC call. For a non-JTA connection, it often makes sense to release the
                                 connection at the end of each transaction, by using <code class="literal">after_transaction</code>. <code class="literal">auto</code> will choose <code class="literal">after_statement</code> for the JTA and CMT transaction strategies and <code class="literal">after_transaction</code> for the JDBC transaction strategy. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">auto</code> (default) | <code class="literal">on_close</code> | <code class="literal">after_transaction</code> | <code class="literal">after_statement</code> 
                                 </p>
                                                             
                                 <p>Note that this setting only affects <code class="literal">Session</code>s returned from <code class="literal">SessionFactory.openSession</code>. For <code class="literal">Session</code>s obtained through <code class="literal">SessionFactory.getCurrentSession</code>, the <code class="literal">CurrentSessionContext</code> implementation configured for use controls the connection release mode for those <code class="literal">Session</code>s. See <a href="#architecture-current-session" title="2.5.&nbsp;Sessions Contextuelles">Section&nbsp;2.5, &laquo;&nbsp;Sessions Contextuelles&nbsp;&raquo;</a> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td><span class="property">hibernate.connection.</span><span class="emphasis"><em>&lt;propertyName&gt;</em></span> 
                              </td>
                              <td>Pass the JDBC property <span class="emphasis"><em>&lt;propertyName&gt;</em></span> to <code class="literal">DriverManager.getConnection()</code>. 
                              </td>
                           </tr>
                           <tr>
                              <td><span class="property">hibernate.jndi.</span><span class="emphasis"><em>&lt;propertyName&gt;</em></span> 
                              </td>
                              <td>Pass the property <span class="emphasis"><em>&lt;propertyName&gt;</em></span> to the JNDI <code class="literal">InitialContextFactory</code>. 
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
               </div><br class="table-break"><div class="table"><a name="configuration-cache-properties"></a><p class="title"><b>Tableau&nbsp;3.5.&nbsp;Propri&eacute;t&eacute;s du Cache d'Hibernate</b></p>
                  <div class="table-contents">
                     <table summary="Propri&eacute;t&eacute;s du Cache d'Hibernate" border="1">
                        <colgroup>
                           <col>
                           <col>
                        </colgroup>
                        <thead>
                           <tr>
                              <th>Property name</th>
                              <th>Purpose</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr>
                              <td>
                                                             <code class="literal">hibernate.cache.provider_class</code>
                                                         
                              </td>
                              <td>The classname of a custom <code class="literal">CacheProvider</code>. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">classname.of.CacheProvider</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <code class="literal">hibernate.cache.use_minimal_puts</code>
                                                         
                              </td>
                              <td>Optimize second-level cache operation to minimize writes, at the cost of more frequent reads. This setting is most useful
                                 for clustered caches and, in Hibernate3, is enabled by default for clustered cache implementations. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true|false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <code class="literal">hibernate.cache.use_query_cache</code>
                                                         
                              </td>
                              <td>Enable the query cache, individual queries still have to be set cachable. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true|false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <code class="literal">hibernate.cache.use_second_level_cache</code>
                                                         
                              </td>
                              <td>May be used to completely disable the second level cache, which is enabled by default for classes which specify a <code class="literal">&lt;cache&gt;</code> mapping. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true|false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <code class="literal">hibernate.cache.query_cache_factory</code>
                                                         
                              </td>
                              <td>The classname of a custom <code class="literal">QueryCache</code> interface, defaults to the built-in <code class="literal">StandardQueryCache</code>. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">classname.of.QueryCache</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <code class="literal">hibernate.cache.region_prefix</code>
                                                         
                              </td>
                              <td>A prefix to use for second-level cache region names. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">prefix</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <code class="literal">hibernate.cache.use_structured_entries</code>
                                                         
                              </td>
                              <td>Forces Hibernate to store data in the second-level cache in a more human-friendly format. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true|false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
               </div><br class="table-break"><div class="table"><a name="configuration-transaction-properties"></a><p class="title"><b>Tableau&nbsp;3.6.&nbsp;Propri&eacute;t&eacute;s des transactions Hibernate</b></p>
                  <div class="table-contents">
                     <table summary="Propri&eacute;t&eacute;s des transactions Hibernate" border="1">
                        <colgroup>
                           <col>
                           <col>
                        </colgroup>
                        <thead>
                           <tr>
                              <th>Property name</th>
                              <th>Purpose</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr>
                              <td>
                                                             <code class="literal">hibernate.transaction.factory_class</code>
                                                         
                              </td>
                              <td>The classname of a <code class="literal">TransactionFactory</code> to use with Hibernate <code class="literal">Transaction</code> API (defaults to <code class="literal">JDBCTransactionFactory</code>). 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">classname.of.TransactionFactory</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <code class="literal">jta.UserTransaction</code>
                                                         
                              </td>
                              <td>A JNDI name used by <code class="literal">JTATransactionFactory</code> to obtain the JTA <code class="literal">UserTransaction</code> from the application server. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">jndi/composite/name</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <code class="literal">hibernate.transaction.manager_lookup_class</code>
                                                         
                              </td>
                              <td>The classname of a <code class="literal">TransactionManagerLookup</code> - required when JVM-level caching is enabled or when using hilo generator in a JTA environment. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">classname.of.TransactionManagerLookup</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <code class="literal">hibernate.transaction.flush_before_completion</code>
                                                         
                              </td>
                              <td>If enabled, the session will be automatically flushed during the before completion phase of the transaction. Built-in and
                                 automatic session context management is preferred, see <a href="#architecture-current-session" title="2.5.&nbsp;Sessions Contextuelles">Section&nbsp;2.5, &laquo;&nbsp;Sessions Contextuelles&nbsp;&raquo;</a>. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true</code> | <code class="literal">false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <code class="literal">hibernate.transaction.auto_close_session</code>
                                                         
                              </td>
                              <td>If enabled, the session will be automatically closed during the after completion phase of the transaction. Built-in and utomatic
                                 session context management is preferred, see <a href="#architecture-current-session" title="2.5.&nbsp;Sessions Contextuelles">Section&nbsp;2.5, &laquo;&nbsp;Sessions Contextuelles&nbsp;&raquo;</a>. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true</code> | <code class="literal">false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
               </div><br class="table-break"><div class="table"><a name="configuration-misc-properties"></a><p class="title"><b>Tableau&nbsp;3.7.&nbsp;Propri&eacute;t&eacute;s diverses</b></p>
                  <div class="table-contents">
                     <table summary="Propri&eacute;t&eacute;s diverses" border="1">
                        <colgroup>
                           <col>
                           <col>
                        </colgroup>
                        <thead>
                           <tr>
                              <th>Property name</th>
                              <th>Purpose</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr>
                              <td>
                                                             <code class="literal">hibernate.current_session_context_class</code>
                                                         
                              </td>
                              <td>Supply a (custom) strategy for the scoping of the "current" <code class="literal">Session</code>. See <a href="#architecture-current-session" title="2.5.&nbsp;Sessions Contextuelles">Section&nbsp;2.5, &laquo;&nbsp;Sessions Contextuelles&nbsp;&raquo;</a> for more information about the built-in strategies. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">jta</code> | <code class="literal">thread</code> | <code class="literal">managed</code> | <code class="literal">custom.Class</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <code class="literal">hibernate.query.factory_class</code>
                                                         
                              </td>
                              <td>Chooses the HQL parser implementation. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">org.hibernate.hql.ast.ASTQueryTranslatorFactory</code> or <code class="literal">org.hibernate.hql.classic.ClassicQueryTranslatorFactory</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <code class="literal">hibernate.query.substitutions</code>
                                                         
                              </td>
                              <td>Mapping from tokens in Hibernate queries to SQL tokens (tokens might be function or literal names, for example). 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">hqlLiteral=SQL_LITERAL, hqlFunction=SQLFUNC</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <code class="literal">hibernate.hbm2ddl.auto</code>
                                                         
                              </td>
                              <td>Automatically validate or export schema DDL to the database when the <code class="literal">SessionFactory</code> is created. With <code class="literal">create-drop</code>, the database schema will be dropped when the <code class="literal">SessionFactory</code> is closed explicitly. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">validate</code> | <code class="literal">update</code> | <code class="literal">create</code> | <code class="literal">create-drop</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                           <tr>
                              <td>
                                                             <code class="literal">hibernate.cglib.use_reflection_optimizer</code>
                                                         
                              </td>
                              <td>Enables use of CGLIB instead of runtime reflection (System-level property). Reflection can sometimes be useful when troubleshooting,
                                 note that Hibernate always requires CGLIB even if you turn off the optimizer. You can not set this property in <code class="literal">hibernate.cfg.xml</code>. 
                                 <p><span class="strong"><strong>eg.</strong></span> <code class="literal">true</code> | <code class="literal">false</code> 
                                 </p>
                                                         
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
               </div><br class="table-break"><div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="configuration-optional-dialects"></a>3.4.1.&nbsp;Dialectes SQL
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Vous devriez toujours positionner la propri&eacute;t&eacute; <code class="literal">hibernate.dialect</code> &agrave; la sous-classe de <code class="literal">org.hibernate.dialect.Dialect</code> appropri&eacute;e &agrave; votre base de donn&eacute;es. Si vous sp&eacute;cifiez un dialecte, Hibernate utilisera des valeurs adapt&eacute;es pour certaines
                     autres propri&eacute;t&eacute;s list&eacute;es ci-dessus, vous &eacute;vitant l'effort de le faire &agrave; la main. 
                  </p>
                  <div class="table"><a name="sql-dialects"></a><p class="title"><b>Tableau&nbsp;3.8.&nbsp;Dialectes SQL d'Hibernate (<code class="literal">hibernate.dialect</code>)</b></p>
                     <div class="table-contents">
                        <table summary="Dialectes SQL d'Hibernate (hibernate.dialect)" border="1">
                           <colgroup>
                              <col>
                              <col>
                           </colgroup>
                           <thead>
                              <tr>
                                 <th>SGBD</th>
                                 <th>Dialect</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr>
                                 <td>DB2</td>
                                 <td><code class="literal">org.hibernate.dialect.DB2Dialect</code></td>
                              </tr>
                              <tr>
                                 <td>DB2 AS/400</td>
                                 <td><code class="literal">org.hibernate.dialect.DB2400Dialect</code></td>
                              </tr>
                              <tr>
                                 <td>DB2 OS390</td>
                                 <td><code class="literal">org.hibernate.dialect.DB2390Dialect</code></td>
                              </tr>
                              <tr>
                                 <td>PostgreSQL</td>
                                 <td><code class="literal">org.hibernate.dialect.PostgreSQLDialect</code></td>
                              </tr>
                              <tr>
                                 <td>MySQL</td>
                                 <td><code class="literal">org.hibernate.dialect.MySQLDialect</code></td>
                              </tr>
                              <tr>
                                 <td>MySQL with InnoDB</td>
                                 <td><code class="literal">org.hibernate.dialect.MySQLInnoDBDialect</code></td>
                              </tr>
                              <tr>
                                 <td>MySQL with MyISAM</td>
                                 <td><code class="literal">org.hibernate.dialect.MySQLMyISAMDialect</code></td>
                              </tr>
                              <tr>
                                 <td>Oracle (any version)</td>
                                 <td><code class="literal">org.hibernate.dialect.OracleDialect</code></td>
                              </tr>
                              <tr>
                                 <td>Oracle 9i/10g</td>
                                 <td><code class="literal">org.hibernate.dialect.Oracle9Dialect</code></td>
                              </tr>
                              <tr>
                                 <td>Sybase</td>
                                 <td><code class="literal">org.hibernate.dialect.SybaseDialect</code></td>
                              </tr>
                              <tr>
                                 <td>Sybase Anywhere</td>
                                 <td><code class="literal">org.hibernate.dialect.SybaseAnywhereDialect</code></td>
                              </tr>
                              <tr>
                                 <td>Microsoft SQL Server</td>
                                 <td><code class="literal">org.hibernate.dialect.SQLServerDialect</code></td>
                              </tr>
                              <tr>
                                 <td>SAP DB</td>
                                 <td><code class="literal">org.hibernate.dialect.SAPDBDialect</code></td>
                              </tr>
                              <tr>
                                 <td>Informix</td>
                                 <td><code class="literal">org.hibernate.dialect.InformixDialect</code></td>
                              </tr>
                              <tr>
                                 <td>HypersonicSQL</td>
                                 <td><code class="literal">org.hibernate.dialect.HSQLDialect</code></td>
                              </tr>
                              <tr>
                                 <td>Ingres</td>
                                 <td><code class="literal">org.hibernate.dialect.IngresDialect</code></td>
                              </tr>
                              <tr>
                                 <td>Progress</td>
                                 <td><code class="literal">org.hibernate.dialect.ProgressDialect</code></td>
                              </tr>
                              <tr>
                                 <td>Mckoi SQL</td>
                                 <td><code class="literal">org.hibernate.dialect.MckoiDialect</code></td>
                              </tr>
                              <tr>
                                 <td>Interbase</td>
                                 <td><code class="literal">org.hibernate.dialect.InterbaseDialect</code></td>
                              </tr>
                              <tr>
                                 <td>Pointbase</td>
                                 <td><code class="literal">org.hibernate.dialect.PointbaseDialect</code></td>
                              </tr>
                              <tr>
                                 <td>FrontBase</td>
                                 <td><code class="literal">org.hibernate.dialect.FrontbaseDialect</code></td>
                              </tr>
                              <tr>
                                 <td>Firebird</td>
                                 <td><code class="literal">org.hibernate.dialect.FirebirdDialect</code></td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                  </div><br class="table-break"></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="configuration-optional-outerjoin"></a>3.4.2.&nbsp;Chargement par Jointure Ouverte
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Si votre base de donn&eacute;es supporte les outer joins de type ANSI, Oracle ou Sybase, <span class="emphasis"><em>le chargement par jointure ouverte</em></span> devrait am&eacute;liorer les performances en limitant le nombre d'aller-retour avec la base de donn&eacute;es (la base de donn&eacute;es effectuant
                     donc potentiellement plus de travail). Le chargement par jointure ouverte permet &agrave; un graphe entier d'objets connect&eacute;s par
                     une relation plusieurs-&agrave;-un, un-&agrave;-plusieurs ou un-&agrave;-un d'&ecirc;tre charg&eacute; en un seul <code class="literal">SELECT</code> SQL. 
                  </p>
                  <p>Le chargement par jointure ouverte peut &ecirc;tre d&eacute;sactiver <span class="emphasis"><em>globalement</em></span> en mettant la propri&eacute;t&eacute; <code class="literal">hibernate.max_fetch_depth</code> &agrave; <code class="literal">0</code>. Une valeur de <code class="literal">1</code> ou plus active le chargement par jointure ouverte pour les associatiosn un-&agrave;-un et plusieurs-&agrave;-un qui ont &eacute;t&eacute; mapp&eacute;e avec
                     <code class="literal">fetch="join"</code>. 
                  </p>
                  <p>Reportez vous &agrave; <a href="#performance-fetching" title="19.1.&nbsp;Strat&eacute;gies de chargement">Section&nbsp;19.1, &laquo;&nbsp;Strat&eacute;gies de chargement&nbsp;&raquo;</a> pour plus d'information. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="configuration-optional-binarystreams"></a>3.4.3.&nbsp;Flux binaires
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Oracle limite la taille d'un tableau de <code class="literal">byte</code> qui peuvent &ecirc;tre pass&eacute;es &agrave; et vers son pilote JDBC. Si vous souhaitez utiliser des instances larges de type <code class="literal">binary</code> ou <code class="literal">serializable</code>, vous devez activer la propri&eacute;t&eacute; <code class="literal">hibernate.jdbc.use_streams_for_binary</code>. <span class="emphasis"><em>C'est une fonctionalit&eacute; de niveau syst&egrave;me uniquement.</em></span> 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="configuration-optional-cacheprovider"></a>3.4.4.&nbsp;Cache de second niveau et cache de requ&ecirc;tes
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Les propri&eacute;t&eacute;s pr&eacute;fix&eacute;es par <code class="literal">hibernate.cache</code> vous permettent d'utiliser un syst&egrave;me de cache de second niveau. Ce cache peut avoir une port&eacute;e dans le processus ou m&ecirc;me
                     &ecirc;tre utilisable dans un syst&egrave;me distribu&eacute;. R&eacute;f&eacute;rez vous au chapitre <a href="#performance-cache" title="19.2.&nbsp;Le cache de second niveau">Section&nbsp;19.2, &laquo;&nbsp;Le cache de second niveau&nbsp;&raquo;</a> pour plus de d&eacute;tails. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="configuration-optional-querysubstitution"></a>3.4.5.&nbsp;Substitution dans le langage de requ&ecirc;tage
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Vous pouvez d&eacute;finir de nouveaux tokens dans les requ&ecirc;tes Hibernate en utilisant la propri&eacute;t&eacute; <code class="literal">hibernate.query.substitutions</code>. Par exemple : 
                  </p><pre class="programlisting">hibernate.query.substitutions vrai=1, faux=0</pre><p>remplacerait les tokens <code class="literal">vrai</code> et <code class="literal">faux</code> par des entiers dans le SQL g&eacute;n&eacute;r&eacute;. 
                  </p><pre class="programlisting">hibernate.query.substitutions toLowercase=LOWER</pre><p>permettrait de renommer la fonction SQL <code class="literal">LOWER</code> en <code class="literal">toLowercase</code> 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="configuration-optional-statistics"></a>3.4.6.&nbsp;Statistiques Hibernate
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Si vous activez <code class="literal">hibernate.generate_statistics</code>, Hibernate va fournir un certains nombre de m&eacute;triques utiles pour r&eacute;gler les performances d'une application qui tourne via
                     <code class="literal">SessionFactory.getStatistics()</code>. Hibernate peut aussi &ecirc;tre configur&eacute; pour exposer ces statistiques via JMX. Lisez les Javadoc des interfaces dans le package
                     <code class="literal">org.hibernate.stats</code> pour plus d'informations. 
                  </p>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="configuration-logging"></a>3.5.&nbsp;Tracer
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Hibernate utilizes <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.slf4j.org/" target="_top">Simple Logging Facade for Java</a> (SLF4J) in order to log various system events. SLF4J can direct your logging output to several logging frameworks (NOP, Simple,
                  log4j version 1.2, JDK 1.4 logging, JCL or logback) depending on your chosen binding. In order to setup logging properly you
                  will need <code class="filename">slf4j-api.jar</code> in your classpath together with the jar file for your preferred binding - <code class="filename">slf4j-log4j12.jar</code> in the case of Log4J. See the SLF4J <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.slf4j.org/manual.html" target="_top">documentation</a> for more detail. To use Log4j you will also need to place a <code class="filename">log4j.properties</code> file in your classpath, an example properties file is distributed with Hibernate in the <code class="literal">src/</code> directory. 
               </p>
               <p>Nous vous recommandons fortement de vous familiariser avec les messages des traces d'Hibernate. Beaucoup de soins a &eacute;t&eacute; apport&eacute;
                  pour donner le plus de d&eacute;tails possible sans les rendre illisibles. C'est un outil essentiel en cas de soucis. Les cat&eacute;gories
                  de trace les plus int&eacute;ressantes sont les suivantes : 
               </p>
               <div class="table"><a name="log-categories"></a><p class="title"><b>Tableau&nbsp;3.9.&nbsp;Cat&eacute;gories de trace d'Hibernate</b></p>
                  <div class="table-contents">
                     <table summary="Cat&eacute;gories de trace d'Hibernate" border="1">
                        <colgroup>
                           <col>
                           <col>
                        </colgroup>
                        <thead>
                           <tr>
                              <th>Cat&eacute;gorie</th>
                              <th>Fonction</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr>
                              <td><code class="literal">org.hibernate.SQL</code></td>
                              <td>Trace toutes les requ&ecirc;ts SQL de type DML (gestion des donn&eacute;es) qui sont ex&eacute;cut&eacute;es</td>
                           </tr>
                           <tr>
                              <td><code class="literal">org.hibernate.type</code></td>
                              <td>Trace tous les param&egrave;tres JDBC</td>
                           </tr>
                           <tr>
                              <td><code class="literal">org.hibernate.tool.hbm2ddl</code></td>
                              <td>Trace toutes les requ&ecirc;ts SQL de type DDL (gestion de la structure de la base) qui sont ex&eacute;cut&eacute;es</td>
                           </tr>
                           <tr>
                              <td><code class="literal">org.hibernate.pretty</code></td>
                              <td>Trace l'&eacute;tat de toutes les entit&eacute;s (20 entit&eacute;s maximum) qui sont associ&eacute;es avec la session hibernate au moment du flush </td>
                           </tr>
                           <tr>
                              <td><code class="literal">org.hibernate.cache</code></td>
                              <td>Trace toute l'activit&eacute; du cache de second niveau</td>
                           </tr>
                           <tr>
                              <td><code class="literal">org.hibernate.transaction</code></td>
                              <td>Trace toute l'activit&eacute; relative aux transactions</td>
                           </tr>
                           <tr>
                              <td><code class="literal">org.hibernate.jdbc</code></td>
                              <td>Trace toute acquisition de ressource JDBC</td>
                           </tr>
                           <tr>
                              <td><code class="literal">org.hibernate.hql.ast.AST</code></td>
                              <td>Trace l'arbre syntaxique des requ&ecirc;tes HQL et SQL durant l'analyse syntaxique des requ&ecirc;tes </td>
                           </tr>
                           <tr>
                              <td><code class="literal">org.hibernate.secure</code></td>
                              <td>Trace toutes les demandes d'autorisation JAAS</td>
                           </tr>
                           <tr>
                              <td><code class="literal">org.hibernate</code></td>
                              <td>Trace tout (beaucoupe d'informations, mais tr&egrave;s utile pour r&eacute;soudre les probl&egrave;mes). </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
               </div><br class="table-break"><p>Lorsque vous d&eacute;veloppez des applications avec Hibernate, vous devriez quasiment toujours travailler avec le niveau <code class="literal">debug</code> activ&eacute; pour la cat&eacute;gorie <code class="literal">org.hibernate.SQL</code>, ou sinon avec la propri&eacute;t&eacute; <code class="literal">hibernate.show_sql</code> activ&eacute;e. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="configuration-namingstrategy"></a>3.6.&nbsp;Impl&eacute;menter une <code class="literal">NamingStrategy</code></h2>
                     </div>
                  </div>
               </div>
               <p>L'interface <code class="literal">org.hibernate.cfg.NamingStrategy</code> vous permet de sp&eacute;cifier une "strat&eacute;gie de nommage" des objets et &eacute;l&eacute;ments de la base de donn&eacute;es. 
               </p>
               <p>Vous pouvez fournir des r&egrave;gles pour automatiquement g&eacute;n&eacute;rer les identifiants de base de donn&eacute;es &agrave; partir des identifiants
                  Java, ou transformer une colonne ou table "logique" donn&eacute;e dans le fichier de mapping en une colonne ou table "physique".
                  Cette fonctionnalit&eacute; aide &agrave; r&eacute;duire la verbosit&eacute; de documents de mapping, en &eacute;liminant le bruit r&eacute;p&eacute;titif (les pr&eacute;fixes <code class="literal">TBL_</code> par exemple). La strat&eacute;gie par d&eacute;faut utilis&eacute;e par Hibernate est minimale. 
               </p>
               <p>Vous pouvez d&eacute;finir une strat&eacute;gie diff&eacute;rente en appelant <code class="literal">Configuration.setNamingStrategy()</code> avant d'ajouter des mappings : 
               </p><pre class="programlisting">SessionFactory sf = new Configuration()
    .setNamingStrategy(ImprovedNamingStrategy.INSTANCE)
    .addFile("Item.hbm.xml")
    .addFile("Bid.hbm.xml")
    .buildSessionFactory();</pre><p><code class="literal">net.sf.hibernate.cfg.ImprovedNamingStrategy</code> est une strat&eacute;gie fournie qui peut &ecirc;tre utile comme point de d&eacute;part de quelques applications. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="configuration-xmlconfig"></a>3.7.&nbsp;Fichier de configuration XML
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Une approche alternative est de sp&eacute;cifier toute la configuration dans un fichier nomm&eacute; <code class="literal">hibernate.cfg.xml</code>. Ce fichier peut &ecirc;tre utilis&eacute; &agrave; la place du fichier <code class="literal">hibernate.properties</code>, voire m&ecirc;me peut servir &agrave; surcharger les propri&eacute;t&eacute;s si les deux fichiers sont pr&eacute;sents. 
               </p>
               <p>Le fichier de configuration XML doit par d&eacute;faut se placer &agrave; la racine du <code class="literal">CLASSPATH</code>. En voici un exemple : 
               </p><pre class="programlisting">&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;!DOCTYPE hibernate-configuration PUBLIC
    "-//Hibernate/Hibernate Configuration DTD//EN"
    "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"&gt;

&lt;hibernate-configuration&gt;

    &lt;!-- a SessionFactory instance listed as /jndi/name --&gt;
    &lt;session-factory
        name="java:hibernate/SessionFactory"&gt;

        &lt;!-- properties --&gt;
        &lt;property name="connection.datasource"&gt;java:/comp/env/jdbc/MyDB&lt;/property&gt;
        &lt;property name="dialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/property&gt;
        &lt;property name="show_sql"&gt;false&lt;/property&gt;
        &lt;property name="transaction.factory_class"&gt;
            org.hibernate.transaction.JTATransactionFactory
        &lt;/property&gt;
        &lt;property name="jta.UserTransaction"&gt;java:comp/UserTransaction&lt;/property&gt;

        &lt;!-- mapping files --&gt;
        &lt;mapping resource="org/hibernate/auction/Item.hbm.xml"/&gt;
        &lt;mapping resource="org/hibernate/auction/Bid.hbm.xml"/&gt;

        &lt;!-- cache settings --&gt;
        &lt;class-cache class="org.hibernate.auction.Item" usage="read-write"/&gt;
        &lt;class-cache class="org.hibernate.auction.Bid" usage="read-only"/&gt;
        &lt;collection-cache collection="org.hibernate.auction.Item.bids" usage="read-write"/&gt;

    &lt;/session-factory&gt;

&lt;/hibernate-configuration&gt;</pre><p>Commme vous pouvez le voir, l'avantage de cette approche est l'externalisation des noms des fichiers de mapping de la configuration.
                  Le fichier <code class="literal">hibernate.cfg.xml</code> est &eacute;galement plus pratique quand on commence &agrave; r&eacute;gler le cache d'Hibernate. Notez que vous pouvez choisir entre utiliser
                  <code class="literal">hibernate.properties</code> ou <code class="literal">hibernate.cfg.xml</code>, les deux sont &eacute;quivalents, sauf en ce qui concerne les b&eacute;n&eacute;fices de l'utilisation de la syntaxe XML mentionn&eacute;s ci-dessus.
                  
               </p>
               <p>Avec la configuration XML, d&eacute;marrer Hibernate devient donc aussi simple que ceci : </p><pre class="programlisting">SessionFactory sf = new Configuration().configure().buildSessionFactory();</pre><p>You can pick a different XML configuration file using </p><pre class="programlisting">SessionFactory sf = new Configuration()
    .configure("catdb.cfg.xml")
    .buildSessionFactory();</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="configuration-j2ee"></a>3.8.&nbsp;Int&eacute;gration &agrave; un serveur d'application J2EE
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Hibernate poss&egrave;de les points suivants d'int&eacute;gration &agrave; l'infrastructure J2EE : </p>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        <p><span class="emphasis"><em>Source de donn&eacute;es g&eacute;r&eacute;e par le conteneur</em></span> : Hibernate peut utiliser des connexions JDBC g&eacute;r&eacute;es par le conteneur et fournie par l'interm&eacute;diaire de JNDI. Souvent, un
                           <code class="literal">TransactionManager</code> compatible JTA et un <code class="literal">ResourceManager</code> s'occupent de la gestion des transactions (CMT). Ils sont particuli&egrave;rement pr&eacute;vus pour pouvoir g&eacute;rer des transactions distribu&eacute;es
                           sur plusieurs sources de donn&eacute;es. Vous pouvez bien s&ucirc;r &eacute;galement d&eacute;finir vos limites de transaction dans votre programme (BMT)
                           ou vous pouvez sinon aussi utiliser l'API optionnelle <code class="literal">Transaction</code> d'Hibernate qui vous garantira la portabilit&eacute; de votre code entre plusieurs serveurs d'application. 
                        </p>
                     </li>
                  </ul>
               </div>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        <p><span class="emphasis"><em>Association JNDI automatique</em></span>: Hibernate peut associer sa <code class="literal">SessionFactory</code> &agrave; JNDI apr&egrave;s le d&eacute;marrage. 
                        </p>
                     </li>
                  </ul>
               </div>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        <p><span class="emphasis"><em>Association de la Session &agrave; JTA:</em></span> La <code class="literal">Session</code> Hibernate peut &ecirc;tre associ&eacute;e automatiquement &agrave; une transaction JTA si vous utilisez les EJBs. Vous avez juste &agrave; r&eacute;cup&eacute;rer
                           la <code class="literal">SessionFactory</code> depuis JNDI et &agrave; r&eacute;cup&eacute;rer la <code class="literal">Session</code> courante. Hibernate s'occupe de vider et fermer la <code class="literal">Session</code> lorsque le transaction JTA se termine. La d&eacute;marcation des transactions se fait de mani&egrave;re d&eacute;clarative dans les descripteurs
                           de d&eacute;ploiement. 
                        </p>
                     </li>
                  </ul>
               </div>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        <p><span class="emphasis"><em>D&eacute;ploiement JMX :</em></span>Si vous avez un serveur d'application compatible JMX (JBoss AS par exemple), vous pouvez choisir de d&eacute;ployer Hibernate en
                           temps que MBean g&eacute;r&eacute; par le serveur. Cela vous &eacute;vite de coder la ligne de d&eacute;marrage qui permet de construire la <code class="literal">SessionFactory</code> depuis la <code class="literal">Configuration</code>. Le conteneur va d&eacute;marrer votre <code class="literal">HibernateService</code>, et va id&eacute;alement s'occuper des d&eacute;pendances entre les services (la source de donn&eacute;es doit &ecirc;tre disponible avant qu'Hibernate
                           ne d&eacute;marre, etc). 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>En fonction de votre environnement, vous devrez peut &ecirc;tre mettre l'option de configuration <code class="literal">hibernate.connection.aggressive_release</code> &agrave; vrai si le serveur d'application affiche des exceptions de type "connection containment". 
               </p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="configuration-optional-transactionstrategy"></a>3.8.1.&nbsp;Configuration de la strat&eacute;gie transactionnelle
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>L'API de la <code class="literal">Session</code> Hibernate est ind&eacute;pendante de tout syst&egrave;me de d&eacute;marcation des transactions qui peut &ecirc;tre pr&eacute;sent dans votre architecture.
                     Si vous laissez Hibernate utiliser l'API JDBC directement via un pool de connexion, vous devrez commencer et terminer vos
                     transactions en utilisant l'API JDBC. Si votre application tourne &agrave; l'int&eacute;rieur d'un serveur d'application J2EE, vous voudrez
                     peut &ecirc;tre utiliser les transactions g&eacute;r&eacute;es par les beans (BMT) et appeller l'API JTA et <code class="literal">UserTransaction</code> lorsque cela est n&eacute;cessaire. 
                  </p>
                  <p>Pour conserver votre code portable entre ces deux environnements (et d'autres &eacute;ventuels) nous vous recommandons d'utiliser
                     l'API optionnelle <code class="literal">Transaction</code> d'Hibernate, qui va encapsuler et masquer le syst&egrave;me de transaction sous-jacent. Pour cela, vous devez pr&eacute;ciser une classe
                     de fabrique d'instances de <code class="literal">Transaction</code> en positionnant la propri&eacute;t&eacute; <code class="literal">hibernate.transaction.factory_class</code>. 
                  </p>
                  <p>Il existe trois choix standards (fournis) : </p>
                  <div class="variablelist">
                     <dl>
                        <dt><span class="term"><code class="literal">net.sf.hibernate.transaction.JDBCTransactionFactory</code></span></dt>
                        <dd>
                           <p>d&eacute;l&egrave;gue aux transactions de la base de donn&eacute;es (JDBC). Valeur par d&eacute;faut.</p>
                        </dd>
                        <dt><span class="term"><code class="literal">org.hibernate.transaction.JTATransactionFactory</code></span></dt>
                        <dd>
                           <p>d&eacute;l&egrave;gue &agrave; CMT si une transaction existante est sous ce contexte (ex: m&eacute;thode d'un EJB session), sinon une nouvelle transaction
                              est entam&eacute;e et une transaction g&eacute;r&eacute;e par le bean est utilis&eacute;e. 
                           </p>
                        </dd>
                        <dt><span class="term"><code class="literal">org.hibernate.transaction.CMTTransactionFactory</code></span></dt>
                        <dd>
                           <p>d&eacute;l&egrave;gue &agrave; aux transactions JTA g&eacute;r&eacute;es par le conteneur</p>
                        </dd>
                     </dl>
                  </div>
                  <p>Vous pouvez &eacute;galement d&eacute;finir votre propre strat&eacute;gie transactionnelle (pour un service de transaction CORBA par exemple).
                     
                  </p>
                  <p>Certaines fonctionnalit&eacute;s d'Hibernate (i.e. le cache de second niveau, l'association automatique des Session &agrave; JTA, etc.)
                     n&eacute;cessitent l'acc&egrave;s au <code class="literal">TransactionManager</code> JTA dans un environnement "manag&eacute;". Dans un serveur d'application, vous devez indiquer comment Hibernate peut obtenir une
                     r&eacute;f&eacute;rence vers le <code class="literal">TransactionManager</code>, car J2EE ne fournit pas un seul m&eacute;canisme standard. 
                  </p>
                  <div class="table"><a name="jtamanagerlookup"></a><p class="title"><b>Tableau&nbsp;3.10.&nbsp;TransactionManagers JTA</b></p>
                     <div class="table-contents">
                        <table summary="TransactionManagers JTA" border="1">
                           <colgroup>
                              <col>
                              <col>
                           </colgroup>
                           <thead>
                              <tr>
                                 <th>Fabrique de Transaction</th>
                                 <th align="center">Serveur d'application</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr>
                                 <td><code class="literal">org.hibernate.transaction.JBossTransactionManagerLookup</code></td>
                                 <td align="center">JBoss</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">org.hibernate.transaction.WeblogicTransactionManagerLookup</code></td>
                                 <td align="center">Weblogic</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">org.hibernate.transaction.WebSphereTransactionManagerLookup</code></td>
                                 <td align="center">WebSphere</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">org.hibernate.transaction.WebSphereExtendedJTATransactionLookup</code></td>
                                 <td align="center">WebSphere 6</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">org.hibernate.transaction.OrionTransactionManagerLookup</code></td>
                                 <td align="center">Orion</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">org.hibernate.transaction.ResinTransactionManagerLookup</code></td>
                                 <td align="center">Resin</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">org.hibernate.transaction.JOTMTransactionManagerLookup</code></td>
                                 <td align="center">JOTM</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">org.hibernate.transaction.JOnASTransactionManagerLookup</code></td>
                                 <td align="center">JOnAS</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">org.hibernate.transaction.JRun4TransactionManagerLookup</code></td>
                                 <td align="center">JRun4</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">org.hibernate.transaction.BESTransactionManagerLookup</code></td>
                                 <td align="center">Borland ES</td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                  </div><br class="table-break"></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="configuration-optional-jndi"></a>3.8.2.&nbsp;<code class="literal">SessionFactory</code> associ&eacute;e au JNDI
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une <code class="literal">SessionFactory</code> Hibernate associ&eacute;e au JNDI peut simplifier l'acc&egrave;s &agrave; la fabrique et donc la cr&eacute;ation de nouvelles <code class="literal">Session</code>s. Notez que cela n'est pas li&eacute; avec les <code class="literal">Datasource</code> associ&eacute;es au JNDI, elles utilisent juste le m&ecirc;me registre. 
                  </p>
                  <p>Si vous d&eacute;sirez associer la <code class="literal">SessionFactory</code> &agrave; un nom JNDI, sp&eacute;cifiez un nom (ex. <code class="literal">java:hibernate/SessionFactory</code>) en utilisant la propri&eacute;t&eacute; <code class="literal">hibernate.session_factory_name</code>. Si cette propri&eacute;t&eacute; est omise, la <code class="literal">SessionFactory</code> ne sera pas associ&eacute;e au JNDI (c'est particuli&egrave;rement pratique dans les environnements ayant une impl&eacute;mentation de JNDI en
                     lecture seule, comme c'est le cas pour Tomcat). 
                  </p>
                  <p>Lorsqu'il associe la <code class="literal">SessionFactory</code> au JNDI, Hibernate utilisera les valeurs de <code class="literal">hibernate.jndi.url</code>, <code class="literal">hibernate.jndi.class</code> pour instancier un contexte d'initialisation. S'ils ne sont pas sp&eacute;cifi&eacute;s, l'<code class="literal">InitialContext</code> par d&eacute;faut sera utilis&eacute;. 
                  </p>
                  <p>Hibernate va automatiquement placer la <code class="literal">SessionFactory</code> dans JNDI apr&egrave;s avoir appel&eacute; <code class="literal">cfg.buildSessionFactory()</code>. Cela signifie que vous devez avoir cet appel dans un code de d&eacute;marrage (ou dans une classe utilitaire) dans votre application
                     sauf si vous utilisez le d&eacute;ploiement JMX avec le service <code class="literal">HibernateService</code> pr&eacute;sent&eacute; plus tard dans ce document. 
                  </p>
                  <p>Si vous utilisez <code class="literal">SessionFactory</code> JNDI, un EJB ou n'importe quelle autre classe peut obtenir la <code class="literal">SessionFactory</code> en utilisant un lookup JNDI. 
                  </p>
                  <p>Nous recommandons que vous liiez la <code class="literal">SessionFactory</code> &agrave; JNDI dans les environnements manag&eacute;s et que vous utilisiez un singleton <code class="literal">static</code> si ce n'est pas le cas. Pour isoler votre application de ces d&eacute;tails, nous vous recommandons aussi de masquer le code de
                     lookup actuel pour une <code class="literal">SessionFactory</code> dans une classe helper, comme <code class="literal">HibernateUtil.getSessionFactory()</code>. Notez qu'une telle classe est aussi un moyen efficace de d&eacute;marrer Hibernatevoir chapitre 1. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="configuration-j2ee-currentsession"></a>3.8.3.&nbsp;Association automatique de la Session &agrave; JTA
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Le moyen le plus simple de g&eacute;rer les <code class="literal">Session</code>s et transactions est la gestion automatique de session "courante" offerte par Hibernate. Voir d&eacute;tail &agrave; <a href="#architecture-current-session" title="2.5.&nbsp;Sessions Contextuelles">Section&nbsp;2.5, &laquo;&nbsp;Sessions Contextuelles&nbsp;&raquo;</a>. En utilisant le contexte de session <code class="literal">"jta"</code> session context, s'il n'y a pas de <code class="literal">Session</code> associ&eacute;e &agrave; la transaction JTA courante, une session sera d&eacute;marr&eacute;e et associ&eacute;e &agrave; la transaction JTA courante la premi&egrave;re fois
                     que vous appelez <code class="literal">sessionFactory.getCurrentSession()</code>. Les <code class="literal">Session</code>s obtenue via <code class="literal">getCurrentSession()</code> dans une contexte <code class="literal">"jta"</code> seront automatiquement flush&eacute;es avant la validation de la transaction, ferm&eacute;es une fois la transaction compl&eacute;t&eacute;e, et lib&eacute;reront
                     les connexions JDBC de mani&egrave;re aggressive apr&egrave;s chaque statement. Ceci permet aux <code class="literal">Session</code>s d'&ecirc;tre g&eacute;r&eacute;es par le cycle de vie de la transaction JTA &agrave; la quelle est sont associ&eacute;es, laissant le code de l'utilisateur
                     propre de ce type de gestion. Votre code peut soit utiliser JTA de mani&egrave;re programmatique via <code class="literal">UserTransaction</code>, ou (ce qui est recommand&eacute; pour la portabilit&eacute; du code) utiliser l'API <code class="literal">Transaction</code> API pour marquer les limites. Si vous ex&eacute;cutez sous un conteneur EJB, la d&eacute;marcation d&eacute;clarative des transactions avec CMT
                     est recommand&eacute;e. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="configuration-j2ee-jmx"></a>3.8.4.&nbsp;D&eacute;ploiement JMX
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>La ligne <code class="literal">cfg.buildSessionFactory()</code> doit toujours &ecirc;tre ex&eacute;cut&eacute;e quelque part pour avoir une <code class="literal">SessionFactory</code> dans JNDI. Vous pouvez faire cela dans un bloc d'initialisation <code class="literal">static</code> (comme celui qui se trouve dans la classe <code class="literal">HibernateUtil</code>) ou vous pouvez d&eacute;ployer Hibernate en temps que <span class="emphasis"><em>service manag&eacute;</em></span>. 
                  </p>
                  <p>Hibernate est distribu&eacute; avec <code class="literal">org.hibernate.jmx.HibernateService</code> pour le d&eacute;ploiement sur un serveur d'application avec le support de JMX comme JBoss AS. Le d&eacute;ploiement et la configuration
                     sont sp&eacute;cifiques &agrave; chaque vendeur. Voici un fichier <code class="literal">jboss-service.xml</code> d'exemple pour JBoss 4.0.x: 
                  </p><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;server&gt;

&lt;mbean code="org.hibernate.jmx.HibernateService"
    name="jboss.jca:service=HibernateFactory,name=HibernateFactory"&gt;

    &lt;!-- Required services --&gt;
    &lt;depends&gt;jboss.jca:service=RARDeployer&lt;/depends&gt;
    &lt;depends&gt;jboss.jca:service=LocalTxCM,name=HsqlDS&lt;/depends&gt;

    &lt;!-- Bind the Hibernate service to JNDI --&gt;
    &lt;attribute name="JndiName"&gt;java:/hibernate/SessionFactory&lt;/attribute&gt;

    &lt;!-- Datasource settings --&gt;
    &lt;attribute name="Datasource"&gt;java:HsqlDS&lt;/attribute&gt;
    &lt;attribute name="Dialect"&gt;org.hibernate.dialect.HSQLDialect&lt;/attribute&gt;

    &lt;!-- Transaction integration --&gt;
    &lt;attribute name="TransactionStrategy"&gt;
        org.hibernate.transaction.JTATransactionFactory&lt;/attribute&gt;
    &lt;attribute name="TransactionManagerLookupStrategy"&gt;
        org.hibernate.transaction.JBossTransactionManagerLookup&lt;/attribute&gt;
    &lt;attribute name="FlushBeforeCompletionEnabled"&gt;true&lt;/attribute&gt;
    &lt;attribute name="AutoCloseSessionEnabled"&gt;true&lt;/attribute&gt;

    &lt;!-- Fetching options --&gt;
    &lt;attribute name="MaximumFetchDepth"&gt;5&lt;/attribute&gt;

    &lt;!-- Second-level caching --&gt;
    &lt;attribute name="SecondLevelCacheEnabled"&gt;true&lt;/attribute&gt;
    &lt;attribute name="CacheProviderClass"&gt;org.hibernate.cache.EhCacheProvider&lt;/attribute&gt;
    &lt;attribute name="QueryCacheEnabled"&gt;true&lt;/attribute&gt;

    &lt;!-- Logging --&gt;
    &lt;attribute name="ShowSqlEnabled"&gt;true&lt;/attribute&gt;

    &lt;!-- Mapping files --&gt;
    &lt;attribute name="MapResources"&gt;auction/Item.hbm.xml,auction/Category.hbm.xml&lt;/attribute&gt;

&lt;/mbean&gt;

&lt;/server&gt;</pre><p>Ce fichier est d&eacute;ploy&eacute; dans un r&eacute;pertoire <code class="literal">META-INF</code> et est packag&eacute; dans un fichier JAR avec l'extension <code class="literal">.sar</code> (service archive). Vous devez &eacute;galement packager Hibernate, les librairies tierces requises, vos classes persistantes compil&eacute;es
                     et vos fichiers de mapping dans la m&ecirc;me archive. Vos beans entreprise (souvent des EJBs session) peuvent rester dans leur
                     propre fichier JAR mais vous pouvez inclure ce fichier JAR dans le jar principal du service pour avoir une seule unit&eacute; d&eacute;ployable
                     &agrave; chaud. Vous pouvez consulter la documentation de JBoss AS pour plus d'information sur les services JMX et le d&eacute;ploiement
                     des EJBs. 
                  </p>
               </div>
            </div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="persistent-classes"></a>Chapitre&nbsp;4.&nbsp;Classes persistantes
                     </h2>
                  </div>
               </div>
            </div>
            <p>Les classes persistantes sont les classes d'une application qui impl&eacute;mentent les entit&eacute;s d'un probl&egrave;me m&eacute;tier (ex. Client
               et Commande dans une application de commerce &eacute;lectronique). Toutes les instances d'une classe persistante ne sont pas forc&eacute;ment
               dans l'&eacute;tat persistant - au lieu de cela, une instance peut &ecirc;tre &eacute;ph&eacute;m&egrave;re (NdT : transient) ou d&eacute;tach&eacute;e. 
            </p>
            <p>Hibernate fonctionne de mani&egrave;re optimale lorsque ces classes suivent quelques r&egrave;gles simples, aussi connues comme le mod&egrave;le
               de programmation Plain Old Java Object (POJO). Cependant, aucune de ces r&egrave;gles ne sont des besoins absolus. En effet, Hibernate3
               suppose tr&egrave;s peu de choses &agrave; propos de la nature de vos objets persistants. Vous pouvez exprimer un mod&egrave;le de domaine par
               d'autres moyens : utiliser des arbres d'instances de <code class="literal">Map</code>, par exemple. 
            </p>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="persistent-classes-pojo"></a>4.1.&nbsp;Un exemple simple de POJO
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Toute bonne application Java n&eacute;cessite une classe persistante repr&eacute;sentant les f&eacute;lins. </p><pre class="programlisting">package eg;
import java.util.Set;
import java.util.Date;

public class Cat {
    private Long id; // identifier

    private Date birthdate;
    private Color color;
    private char sex;
    private float weight;
    private int litterId;

    private Cat mother;
    private Set kittens = new HashSet();

    private void setId(Long id) {
        this.id=id;
    }
    public Long getId() {
        return id;
    }

    void setBirthdate(Date date) {
        birthdate = date;
    }
    public Date getBirthdate() {
        return birthdate;
    }

    void setWeight(float weight) {
        this.weight = weight;
    }
    public float getWeight() {
        return weight;
    }

    public Color getColor() {
        return color;
    }
    void setColor(Color color) {
        this.color = color;
    }

    void setSex(char sex) {
        this.sex=sex;
    }
    public char getSex() {
        return sex;
    }

    void setLitterId(int id) {
        this.litterId = id;
    }
    public int getLitterId() {
        return litterId;
    }

    void setMother(Cat mother) {
        this.mother = mother;
    }
    public Cat getMother() {
        return mother;
    }
    void setKittens(Set kittens) {
        this.kittens = kittens;
    }
    public Set getKittens() {
        return kittens;
    }
    
    // addKitten not needed by Hibernate
    public void addKitten(Cat kitten) {
            kitten.setMother(this);
        kitten.setLitterId( kittens.size() ); 
        kittens.add(kitten);
    }
}</pre><p>Il y a quatre r&egrave;gles &agrave; suivre ici : </p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="persistent-classes-pojo-constructor"></a>4.1.1.&nbsp;Impl&eacute;menter un constructeur sans argument
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p><code class="literal">Cat</code> a un constructeur sans argument. Toutes les classes persistantes doivent avoir un constructeur par d&eacute;faut (lequel peut ne
                     pas &ecirc;tre public) pour qu'Hibernate puissent les instancier en utilisant <code class="literal">Constructor.newInstance()</code>. Nous recommandons fortement d'avoir un constructeur par d&eacute;faut avec au moins une visibilit&eacute; <span class="emphasis"><em>paquet</em></span> pour la g&eacute;n&eacute;ration du proxy &agrave; l'ex&eacute;cution dans Hibernate. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="persistent-classes-pojo-identifier"></a>4.1.2.&nbsp;Fournir une propri&eacute;t&eacute; d'indentifiant (optionnel)
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p><code class="literal">Cat</code> poss&egrave;de une propri&eacute;t&eacute; appel&eacute;e <code class="literal">id</code>. Cette propri&eacute;t&eacute; mappe la valeur de la colonne de cl&eacute; primaire de la table d'une base de donn&eacute;es.La propri&eacute;t&eacute; aurait pu s'appeler
                     compl&egrave;tement autrement, et son type aurait pu &ecirc;tre n'importe quel type primitif, n'importe quel "encapsuleur" de type primitif,
                     <code class="literal">java.lang.String</code> ou <code class="literal">java.util.Date</code>. (Si votre base de donn&eacute;es h&eacute;rit&eacute;e poss&egrave;de des cl&eacute;s composites, elles peuvent &ecirc;tre mapp&eacute;es en utilisant une classe d&eacute;finie
                     par l'utilisateur et poss&eacute;dant les propri&eacute;t&eacute;s associ&eacute;es aux types de la cl&eacute; composite - voir la section concernant les identifiants
                     composites plus tard). 
                  </p>
                  <p>La propri&eacute;t&eacute; d'identifiant est strictement optionnelle. Vous pouver l'oublier et laisser Hibernate s'occuper des identifiants
                     de l'objet en interne. Toutefois, nous ne le recommandons pas. 
                  </p>
                  <p>En fait, quelques fonctionnalit&eacute;s ne sont disponibles que pour les classes d&eacute;clarant un identifiant de propri&eacute;t&eacute; : </p>
                  <div class="itemizedlist">
                     <ul type="disc" compact>
                        <li>
                           <p>Transitive reattachment for detached objects (cascade update or cascade merge) - see <a href="#objectstate-transitive" title="10.11.&nbsp;Persistance transitive">Section&nbsp;10.11, &laquo;&nbsp;Persistance transitive&nbsp;&raquo;</a> 
                           </p>
                        </li>
                        <li>
                           <p>
                              <code class="literal">Session.saveOrUpdate()</code>
                              
                           </p>
                        </li>
                        <li>
                           <p>
                              <code class="literal">Session.merge()</code>
                              
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>Nous recommandons que vous d&eacute;clariez les propri&eacute;t&eacute;s d'identifiant de mani&egrave;re uniforme. Nous recommandons &eacute;galement que vous
                     utilisiez un type nullable (ie. non primitif). 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="persistent-classes-pojo-final"></a>4.1.3.&nbsp;Favoriser les classes non finales (optionnel)
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une fonctionnalit&eacute; clef d'Hibernate, les <span class="emphasis"><em>proxies</em></span>, n&eacute;cessitent que la classe persistente soit non finale ou qu'elle soit l'impl&eacute;mentation d'une interface qui d&eacute;clare toutes
                     les m&eacute;thodes publiques. 
                  </p>
                  <p>Vous pouvez persister, gr&acirc;ce &agrave; Hibernate, les classes <code class="literal">final</code> qui n'impl&eacute;mentent pas d'interface, mais vous ne pourrez pas utiliser les proxies pour les chargements d'associations paresseuses
                     - ce qui limitera vos possibilit&eacute;s d'ajustement des performances. 
                  </p>
                  <p>Vous devriez aussi &eacute;viter de d&eacute;clarer des m&eacute;thodes <code class="literal">public final</code> sur des classes non-finales. Si vous voulez utiliser une classe avec une m&eacute;thode <code class="literal">public final</code>, vous devez explicitement d&eacute;sactiver les proxies en param&eacute;trant <code class="literal">lazy="false"</code>. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="persistent-classes-pojo-accessors"></a>4.1.4.&nbsp;D&eacute;clarer les accesseurs et mutateurs des attributs persistants (optionnel)
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p><code class="literal">Cat</code> d&eacute;clare des mutateurs pour toutes ses champs persistants. Beaucoup d'autres solutions de mapping Objet/relationnel persistent
                     directement les variables d'instance. Nous pensons qu'il est bien mieux de fournir une indirection entre le sch&eacute;ma relationnel
                     et les structures de donn&eacute;es internes de la classe. Par d&eacute;faut, Hibernate persiste les propri&eacute;t&eacute;s suivant le style JavaBean,
                     et reconna&icirc;t les noms de m&eacute;thodes de la forme <code class="literal"> getFoo</code>, <code class="literal">isFoo</code> et <code class="literal">setFoo</code>. Nous pouvons changer pour un acc&egrave;s direct aux champs pour des propri&eacute;t&eacute;s particuli&egrave;res, si besoin est. 
                  </p>
                  <p>Les propri&eacute;t&eacute;s <span class="emphasis"><em>n'ont pas</em></span> &agrave; &ecirc;tre d&eacute;clar&eacute;es publiques - Hibernate peut persister une propri&eacute;t&eacute; avec un paire de getter/setter de visibilit&eacute; par d&eacute;fault,
                     <code class="literal">protected</code> ou <code class="literal"> private</code>. 
                  </p>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="persistent-classes-inheritance"></a>4.2.&nbsp;Impl&eacute;menter l'h&eacute;ritage
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Une sous-classe doit &eacute;galement suivre la premi&egrave;re et la seconde r&egrave;gle. Elle h&eacute;rite sa propri&eacute;t&eacute; d'identifiant de <code class="literal">Cat</code>. 
               </p><pre class="programlisting">package eg;

public class DomesticCat extends Cat {
        private String name;

        public String getName() {
                return name;
        }
        protected void setName(String name) {
                this.name=name;
        }
}</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="persistent-classes-equalshashcode"></a>4.3.&nbsp;Impl&eacute;menter <code class="literal">equals()</code> et <code class="literal">hashCode()</code></h2>
                     </div>
                  </div>
               </div>
               <p>Vous devez surcharger les m&eacute;thodes <code class="literal">equals()</code> et <code class="literal">hashCode()</code> si vous 
               </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p>avez l'intention de mettre des instances de classes persistantes dans un <code class="literal">Set</code> (la mani&egrave;re recommand&eacute;e pour repr&eacute;senter des associations pluri-valu&eacute;es) <span class="emphasis"><em>et</em></span> 
                        </p>
                     </li>
                     <li>
                        <p>avez l'intention d'utiliser le r&eacute;attachement d'instances d&eacute;tach&eacute;es </p>
                     </li>
                  </ul>
               </div>
               <p>Hibernate garantit l'&eacute;quivalence de l'identit&eacute; persistante (ligne de base de donn&eacute;es) et l'identit&eacute; Java seulement &agrave; l'int&eacute;rieur
                  de la port&eacute;e d'une session particuli&egrave;re. Donc d&egrave;s que nous m&eacute;langeons des instances venant de diff&eacute;rentes sessions, nous devons
                  impl&eacute;menter <code class="literal">equals()</code> et <code class="literal">hashCode()</code> si nous souhaitons avoir une s&eacute;mantique correcte pour les <code class="literal">Set</code>s. 
               </p>
               <p>La mani&egrave;re la plus &eacute;vidente est d'impl&eacute;menter <code class="literal">equals()</code>/<code class="literal">hashCode()</code> en comparant la valeur de l'identifiant des deux objets. Si cette valeur est identique, les deux doivent repr&eacute;senter la m&ecirc;me
                  ligne de base de donn&eacute;es, ils sont donc &eacute;gaux (si les deux sont ajout&eacute;s &agrave; un <code class="literal">Set</code>, nous n'aurons qu'un seul &eacute;l&eacute;ment dans le <code class="literal">Set</code>). Malheureusement, nous ne pouvons pas utiliser cette approche avec des identifiants g&eacute;n&eacute;r&eacute;s ! Hibernate n'assignera de valeur
                  d'identifiant qu'aux objets qui sont persistants, une instance nouvellement cr&eacute;&eacute;e n'aura donc pas de valeur d'identifiant
                  ! De plus, si une instance est non sauvegard&eacute;e et actuellement dans un <code class="literal">Set</code>, le sauvegarder assignera une valeur d'identifiant &agrave; l'objet. Si <code class="literal">equals()</code> et <code class="literal">hashCode()</code> sont bas&eacute;es sur la valeur de l'identifiant, le code de hachage devrait changer, rompant le contrat du <code class="literal">Set</code>. Regardez sur le site web d'Hibernate pour une discussion compl&egrave;te de ce probl&egrave;me. Notez que ceci n'est pas un probl&egrave;me d'Hibernate,
                  mais la s&eacute;mantique normale de Java pour l'identit&eacute; d'un objet et l'&eacute;galit&eacute;. 
               </p>
               <p>Nous recommandons donc d'impl&eacute;menter <code class="literal">equals()</code> et <code class="literal">hashCode()</code> en utilisant <span class="emphasis"><em> l'&eacute;galit&eacute; par cl&eacute; m&eacute;tier</em></span>.L'&eacute;galit&eacute; par cl&eacute; m&eacute;tier signifie que la m&eacute;thode <code class="literal">equals()</code> compare uniquement les propri&eacute;t&eacute;s qui forment une cl&eacute; m&eacute;tier, une cl&eacute; qui identifierait notre instance dans le monde r&eacute;el
                  (une cl&eacute; candidate <span class="emphasis"><em>naturelle</em></span>) : 
               </p><pre class="programlisting">public class Cat {

    ...
    public boolean equals(Object other) {
        if (this == other) return true;
        if ( !(other instanceof Cat) ) return false;

        final Cat cat = (Cat) other;

        if ( !cat.getLitterId().equals( getLitterId() ) ) return false;
        if ( !cat.getMother().equals( getMother() ) ) return false;

        return true;
    }

    public int hashCode() {
        int result;
        result = getMother().hashCode();
        result = 29 * result + getLitterId();
        return result;
    }

}</pre><p>Notez qu'une clef m&eacute;tier ne doit pas &ecirc;tre solide comme une clef primaire de base de donn&eacute;es (voir <a href="#transactions-basics-identity" title="11.1.3.&nbsp;L'identit&eacute; des objets">Section&nbsp;11.1.3, &laquo;&nbsp;L'identit&eacute; des objets&nbsp;&raquo;</a>). Les propri&eacute;t&eacute;s immuables ou uniques sont g&eacute;n&eacute;ralement de bonnes candidates pour une clef m&eacute;tier. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="persistent-classes-dynamicmodels"></a>4.4.&nbsp;Mod&egrave;les dynamiques
                        </h2>
                     </div>
                  </div>
               </div>
               <p>
                  <span class="emphasis"><em>Notez que la fonctionnalit&eacute;s suivantes sont actuellement consid&eacute;r&eacute;es comme exp&eacute;rimentales et peuvent changer dans un futur
                        proche.</em></span>
                  
               </p>
               <p>Les entit&eacute;s persistantes ne doivent pas n&eacute;cessairement &ecirc;tre repr&eacute;sent&eacute;es comme des classes POJO ou des objets JavaBean &agrave; l'ex&eacute;cution.
                  Hibernate supporte aussi les mod&egrave;les dynamiques (en utilisant des <code class="literal">Map</code>s de <code class="literal">Map</code>s &agrave; l'ex&eacute;cution) et la repr&eacute;sentation des entit&eacute;s comme des arbres DOM4J. Avec cette approche, vous n'&eacute;crivez pas de classes
                  persistantes, seulement des fichiers de mapping. 
               </p>
               <p>Par d&eacute;faut, Hibernate fonctionne en mode POJO normal. Vous pouvez param&eacute;trer un mode de repr&eacute;sentation d'entit&eacute; par d&eacute;faut
                  pour une <code class="literal">SessionFactory</code> particuli&egrave;re en utilisant l'option de configuration <code class="literal">default_entity_mode</code> (voir <a href="#configuration-optional-properties" title="Tableau&nbsp;3.3.&nbsp;Propri&eacute;t&eacute;s de configuration d'Hibernate">Tableau&nbsp;3.3, &laquo;&nbsp;Propri&eacute;t&eacute;s de configuration d'Hibernate&nbsp;&raquo;</a>). 
               </p>
               <p>Les exemples suivants d&eacute;montrent la repr&eacute;sentation utilisant des <code class="literal">Map</code>s. D'abord, dans le fichier de mapping, un <code class="literal">entity-name</code> doit &ecirc;tre d&eacute;clar&eacute; au lieu (ou en plus) d'un nom de classe : 
               </p><pre class="programlisting">&lt;hibernate-mapping&gt;

    &lt;class entity-name="Customer"&gt;

        &lt;id name="id"
            type="long"
            column="ID"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;

        &lt;property name="name"
            column="NAME"
            type="string"/&gt;

        &lt;property name="address"
            column="ADDRESS"
            type="string"/&gt;

        &lt;many-to-one name="organization"
            column="ORGANIZATION_ID"
            class="Organization"/&gt;

        &lt;bag name="orders"
            inverse="true"
            lazy="false"
            cascade="all"&gt;
            &lt;key column="CUSTOMER_ID"/&gt;
            &lt;one-to-many class="Order"/&gt;
        &lt;/bag&gt;

    &lt;/class&gt;
    
&lt;/hibernate-mapping&gt;</pre><p>Notez que m&ecirc;me si des associations sont d&eacute;clar&eacute;es en utilisant des noms de classe cible, le type de cible d'une association
                  peut aussi &ecirc;tre une entit&eacute; dynamique au lieu d'un POJO. 
               </p>
               <p>Apr&egrave;s avoir configur&eacute; le mode d'entit&eacute; par d&eacute;faut &agrave; <code class="literal">dynamic-map</code> pour la <code class="literal">SessionFactory</code>, nous pouvons lors de l'ex&eacute;cution fonctionner avec des <code class="literal">Map</code>s de <code class="literal">Map</code>s : 
               </p><pre class="programlisting">Session s = openSession();
Transaction tx = s.beginTransaction();
Session s = openSession();

// Create a customer
Map david = new HashMap();
david.put("name", "David");

// Create an organization
Map foobar = new HashMap();
foobar.put("name", "Foobar Inc.");

// Link both
david.put("organization", foobar);

// Save both
s.save("Customer", david);
s.save("Organization", foobar);

tx.commit();
s.close();</pre><p>Les avantages d'un mapping dynamique sont un gain de temps pour le prototypage sans la n&eacute;cessit&eacute; d'impl&eacute;menter les classes
                  d'entit&eacute;. Pourtant, vous perdez la v&eacute;rification du typage au moment de la compilation et aurez plus d'exceptions &agrave; g&eacute;rer lors
                  de l'ex&eacute;cution. Gr&acirc;ce au mapping d'Hibernate, le sch&eacute;ma de la base de donn&eacute;es peut facilement &ecirc;tre normalis&eacute; et solidifi&eacute;,
                  permettant de rajouter une impl&eacute;mentation propre du mod&egrave;le de domaine plus tard. 
               </p>
               <p>Les modes de repr&eacute;sentation d'une entit&eacute; peut aussi &ecirc;tre configur&eacute; par <code class="literal">Session</code> : 
               </p><pre class="programlisting">Session dynamicSession = pojoSession.getSession(EntityMode.MAP);

// Create a customer
Map david = new HashMap();
david.put("name", "David");
dynamicSession.save("Customer", david);
...
dynamicSession.flush();
dynamicSession.close()
...
// Continue on pojoSession
</pre><p>Veuillez noter que l'appel &agrave; <code class="literal">getSession()</code> en utilisant un <code class="literal">EntityMode</code> se fait sur l'API <code class="literal">Session</code>, pas <code class="literal">SessionFactory</code>. De cette mani&egrave;re, la nouvelle <code class="literal">Session</code> partage les connexions JDBC, transactions et autres informations de contexte sous-jacentes. Cela signifie que vous n'avez
                  pas &agrave; appeler <code class="literal">flush()</code> et <code class="literal">close()</code> sur la <code class="literal">Session</code> secondaire, et laissez aussi la gestion de la transaction et de la connexion &agrave; l'unit&eacute; de travail primaire. 
               </p>
               <p>Plus d'informations &agrave; propos de la repr&eacute;sentation XML peuvent &ecirc;tre trouv&eacute;es dans <a href="#xml" title="Chapitre&nbsp;18.&nbsp;Mapping XML">Chapitre&nbsp;18, <i xmlns:xlink="http://www.w3.org/1999/xlink">Mapping XML</i></a>. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="persistent-classes-tuplizers"></a>4.5.&nbsp;Tuplizers
                        </h2>
                     </div>
                  </div>
               </div>
               <p><code class="literal">org.hibernate.tuple.Tuplizer</code>, et ses sous-interfaces, sont responsables de la gestion d'une repr&eacute;sentation particuli&egrave;re d'un morceau de donn&eacute;es, en fonction
                  du <code class="literal">org.hibernate.EntityMode</code> de r&eacute;pr&eacute;sentation. Si un morceau donn&eacute; de donn&eacute;es est pens&eacute; comme une structure de donn&eacute;es, alors un tuplizer est la chose
                  qui sait comment cr&eacute;er une telle structure de donn&eacute;es, comment extraire des valeurs et injecter des valeurs dans une telle
                  structure de donn&eacute;es. Par exemple, pour le mode d'entit&eacute; POJO, le tuplizer correspondant sait comment cr&eacute;er le POJO &agrave; travers
                  son constructeur et comment acc&eacute;der aux propri&eacute;t&eacute;s du POJO utilisant les accesseurs de la propri&eacute;t&eacute; d&eacute;finie. Il y a deux types
                  de Tuplizers haut niveau, repr&eacute;sent&eacute; par les interfaces <code class="literal">org.hibernate.tuple.EntityTuplizer</code> et <code class="literal">org.hibernate.tuple.ComponentTuplizer</code>. Les <code class="literal">EntityTuplizer</code>s sont responsables de la gestion des contrats mentionn&eacute;s ci-dessus pour les entit&eacute;s, alors que les <code class="literal">ComponentTuplizer</code>s s'occupent des composants. 
               </p>
               <p>Les utilisateurs peuvent aussi brancher leurs propres tuplizers. Peut-&ecirc;tre vous est-il n&eacute;cessaire qu'une impl&eacute;mentation de
                  <code class="literal">java.util.Map</code> autre que <code class="literal">java.util.HashMap</code> soit utilis&eacute;e dans le mode d'entit&eacute; dynamic-map ; ou peut-&ecirc;tre avez-vous besoin de d&eacute;finir une stat&eacute;gie de g&eacute;n&eacute;ration de
                  proxy diff&eacute;rente de celle utilis&eacute;e par d&eacute;faut. Les deux devraient &ecirc;tre effectu&eacute;es en d&eacute;finissant une impl&eacute;mentation de tuplizer
                  utilisateur. Les d&eacute;finitions de tuplizers sont attach&eacute;es au mapping de l'entit&eacute; ou du composant qu'ils sont cens&eacute;s g&eacute;rer.
                  Retour &agrave; l'exemple de notre entit&eacute; utilisateur : 
               </p><pre class="programlisting">&lt;hibernate-mapping&gt;
    &lt;class entity-name="Customer"&gt;
        &lt;!--
            Override the dynamic-map entity-mode
            tuplizer for the customer entity
        --&gt;
        &lt;tuplizer entity-mode="dynamic-map"
                class="CustomMapTuplizerImpl"/&gt;

        &lt;id name="id" type="long" column="ID"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;

        &lt;!-- other properties --&gt;
        ...
    &lt;/class&gt;
&lt;/hibernate-mapping&gt;


public class CustomMapTuplizerImpl
        extends org.hibernate.tuple.entity.DynamicMapEntityTuplizer {
    // override the buildInstantiator() method to plug in our custom map...
    protected final Instantiator buildInstantiator(
            org.hibernate.mapping.PersistentClass mappingInfo) {
        return new CustomMapInstantiator( mappingInfo );
    }

    private static final class CustomMapInstantiator
            extends org.hibernate.tuple.DynamicMapInstantitor {
        // override the generateMap() method to return our custom map...
            protected final Map generateMap() {
                    return new CustomMap();
            }
    }
}</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="persistent-classes-extensions"></a>4.6.&nbsp;Extentsions
                        </h2>
                     </div>
                  </div>
               </div>
               <p>TODO: Document user-extension framework in the property and proxy packages </p>
            </div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="mapping"></a>Chapitre&nbsp;5.&nbsp;Mapping O/R basique
                     </h2>
                  </div>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="mapping-declaration"></a>5.1.&nbsp;D&eacute;claration de Mapping
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Les mappings Objet/relationnel sont g&eacute;n&eacute;ralement d&eacute;finis dans un document XML. Le document de mapping est con&ccedil;u pour &ecirc;tre
                  lisible et &eacute;ditable &agrave; la main. Le langage de mapping est Java-centrique, c'est &agrave; dire que les mappings sont construits &agrave; partir
                  des d&eacute;clarations des classes persistantes et non des d&eacute;clarations des tables. 
               </p>
               <p>Remarquez que m&ecirc;me si beaucoup d'utilisateurs de Hibernate pr&eacute;f&egrave;rent &eacute;crire les fichiers de mappings &agrave; la main, plusieurs
                  outils existent pour g&eacute;n&eacute;rer ce document, notamment XDoclet, Middlegen et AndroMDA. 
               </p>
               <p>D&eacute;marrons avec un exemple de mapping : </p><a name="mapping-declaration-ex1"></a><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE hibernate-mapping PUBLIC
      "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
          "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"&gt;

&lt;hibernate-mapping package="eg"&gt;

        &lt;class name="Cat"
            table="cats"
            discriminator-value="C"&gt;

                &lt;id name="id"&gt;
                        &lt;generator class="native"/&gt;
                &lt;/id&gt;

                &lt;discriminator column="subclass"
                     type="character"/&gt;

                &lt;property name="weight"/&gt;

                &lt;property name="birthdate"
                    type="date"
                    not-null="true"
                    update="false"/&gt;

                &lt;property name="color"
                    type="eg.types.ColorUserType"
                    not-null="true"
                    update="false"/&gt;

                &lt;property name="sex"
                    not-null="true"
                    update="false"/&gt;

                &lt;property name="litterId"
                    column="litterId"
                    update="false"/&gt;

                &lt;many-to-one name="mother"
                    column="mother_id"
                    update="false"/&gt;

                &lt;set name="kittens"
                    inverse="true"
                    order-by="litter_id"&gt;
                        &lt;key column="mother_id"/&gt;
                        &lt;one-to-many class="Cat"/&gt;
                &lt;/set&gt;

                &lt;subclass name="DomesticCat"
                    discriminator-value="D"&gt;

                        &lt;property name="name"
                            type="string"/&gt;

                &lt;/subclass&gt;

        &lt;/class&gt;

        &lt;class name="Dog"&gt;
                &lt;!-- mapping for Dog could go here --&gt;
        &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre><p>Etudions le contenu du document de mapping. Nous d&eacute;crirons uniquement les &eacute;l&eacute;ments et attributs du document utilis&eacute;s par Hibernate
                  &agrave; l'ex&eacute;cution. Le document de mapping contient aussi des attributs et &eacute;l&eacute;ments optionnels qui agissent sur le sch&eacute;ma de base
                  de donn&eacute;es export&eacute; par l'outil de g&eacute;n&eacute;ration de sch&eacute;ma. (Par exemple l'attribut <code class="literal">not-null</code>.) 
               </p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-doctype"></a>5.1.1.&nbsp;Doctype
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Tous les mappings XML devraient utiliser le doctype indiqu&eacute;. Ce fichier est pr&eacute;sent &agrave; l'URL ci-dessus, dans le r&eacute;pertoire
                     <code class="literal">hibernate-x.x.x/src/org/hibernate</code> ou dans <code class="literal">hibernate3.jar</code>. Hibernate va toujours chercher la DTD dans son classpath en premier lieu. Si vous constatez des recherches de la DTD sur
                     Internet, v&eacute;rifiez votre d&eacute;claration de DTD par rapport au contenu de votre classpath. 
                  </p>
                  <div class="sect3" lang="fr-FR">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="mapping-declaration-entity-resolution"></a>5.1.1.1.&nbsp;EntityResolver
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>As mentioned previously, Hibernate will first attempt to resolve DTDs in its classpath. The manner in which it does this is
                        by registering a custom <code class="literal">org.xml.sax.EntityResolver</code> implementation with the SAXReader it uses to read in the xml files. This custom <code class="literal">EntityResolver</code> recognizes two different systemId namespaces. 
                     </p>
                     <div class="itemizedlist">
                        <ul type="disc">
                           <li>
                              <p>a <code class="literal">hibernate namespace</code> is recognized whenever the resolver encounteres a systemId starting with <code class="literal">http://hibernate.sourceforge.net/</code>; the resolver attempts to resolve these entities via the classlaoder which loaded the Hibernate classes. 
                              </p>
                           </li>
                           <li>
                              <p>a <code class="literal">user namespace</code> is recognized whenever the resolver encounteres a systemId using a <code class="literal">classpath://</code> URL protocol; the resolver will attempt to resolve these entities via (1) the current thread context classloader and (2)
                                 the classloader which loaded the Hibernate classes. 
                              </p>
                           </li>
                        </ul>
                     </div>
                     <p>An example of utilizing user namespacing: </p><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd" [
    &lt;!ENTITY types SYSTEM "classpath://your/domain/types.xml"&gt;
]&gt;

&lt;hibernate-mapping package="your.domain"&gt;
    &lt;class name="MyEntity"&gt;
        &lt;id name="id" type="my-custom-id-type"&gt;
            ...
        &lt;/id&gt;
    &lt;class&gt;
    &amp;types;
&lt;/hibernate-mapping&gt;</pre><p>Where <code class="literal">types.xml</code> is a resource in the <code class="literal">your.domain</code> package and contains a custom <a href="#mapping-types-custom" title="5.2.3.&nbsp;Types de valeur d&eacute;finis par l'utilisateur">typedef</a>. 
                     </p>
                  </div>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-mapping"></a>5.1.2.&nbsp;hibernate-mapping
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Cet &eacute;l&eacute;ment a plusieurs attributs optionnels. Les attributs <code class="literal">schema</code> et <code class="literal">catalog</code> indiquent que les tables r&eacute;f&eacute;renc&eacute;es par ce mapping appartiennent au sch&eacute;ma nomm&eacute; et/ou au catalogue. S'ils sont sp&eacute;cifi&eacute;s,
                     les noms de tables seront qualifi&eacute;s par les noms de sch&eacute;ma et catalogue. L'attribut <code class="literal">default-cascade</code> indique quel type de cascade sera utlis&eacute; par d&eacute;faut pour les propri&eacute;t&eacute;s et collections qui ne pr&eacute;cisent pas l'attribut <code class="literal">cascade</code>. L'attribut <code class="literal">auto-import</code> nous permet d'utiliser par d&eacute;faut des noms de classes non qualifi&eacute;s dans le langage de requ&ecirc;te. 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;hibernate-mapping
         schema="schemaName"                          <span class="co">(1)</span>
         catalog="catalogName"                        <span class="co">(2)</span>
         default-cascade="cascade_style"              <span class="co">(3)</span>
         default-access="field|property|ClassName"    <span class="co">(4)</span>
         default-lazy="true|false"                    <span class="co">(5)</span>
         auto-import="true|false"                     <span class="co">(6)</span>
         package="package.name"                       <span class="co">(7)</span>
 /&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">schema</code> (optionnel) : Le nom d'un sch&eacute;ma de base de donn&eacute;es. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">catalog</code> (optionnel) : Le nom d'un catalogue de base de donn&eacute;es. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">default-cascade</code> (optionnel - par d&eacute;faut vaut : <code class="literal">none</code>) : Un type de cascade par d&eacute;faut. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">default-access</code> (optionnel - par d&eacute;faut vaut : <code class="literal">property</code>) : Comment hibernate acc&egrave;dera aux propri&eacute;t&eacute;s. On peut aussi red&eacute;finir sa propre impl&eacute;mentation de <code class="literal">PropertyAccessor</code>. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">default-lazy</code> (optionnel - par d&eacute;faut vaut : <code class="literal">true</code>) : Valeur par d&eacute;faut pour un attribut <code class="literal">lazy</code> non sp&eacute;cifi&eacute; : celui des mappings de classes et de collection. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(6)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">auto-import</code> (optionnel - par d&eacute;faut vaut : <code class="literal">true</code>) : Sp&eacute;cifie si l'on peut utiliser des noms de classes non qualifi&eacute;s (des classes de ce mapping) dans le langage de requ&ecirc;te.
                                    
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(7)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">package</code> (optionnel) : Pr&eacute;fixe de package par d&eacute;faut pour les noms de classe non qualifi&eacute;s du document de mapping. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Si deux classes poss&egrave;dent le m&ecirc;me nom de classe (non qualifi&eacute;), vous devez indiquer <code class="literal">auto-import="false"</code>. Hibernate lancera une exception si vous essayez d'assigner &agrave; deux classes le m&ecirc;me nom import&eacute;. 
                  </p>
                  <p>Notez que l'&eacute;l&eacute;ment <code class="literal">hibernate-mapping</code> vous permet d'imbriquer plusieurs mappings de <code class="literal">&lt;class&gt;</code> persistantes, comme dans l'exemple ci-dessus. Cependant la bonne pratique (ce qui est attendu par certains outils) est de
                     mapper une seule classe (ou une seule hi&eacute;rarchie de classes) par fichier de mapping et de nommer ce fichier d'apr&egrave;s le nom
                     de la superclasse, par exemple <code class="literal">Cat.hbm.xml</code>, <code class="literal">Dog.hbm.xml</code>, ou en cas d'h&eacute;ritage, <code class="literal">Animal.hbm.xml</code>. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-class"></a>5.1.3.&nbsp;class
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>D&eacute;clarez une classe persistante avec l'&eacute;l&eacute;ment <code class="literal">class</code> : 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;class
        name="ClassName"                              <span class="co">(1)</span>
        table="tableName"                             <span class="co">(2)</span>
        discriminator-value="discriminator_value"     <span class="co">(3)</span>
        mutable="true|false"                          <span class="co">(4)</span>
        schema="owner"                                <span class="co">(5)</span>
        catalog="catalog"                             <span class="co">(6)</span>
        proxy="ProxyInterface"                        <span class="co">(7)</span>
        dynamic-update="true|false"                   <span class="co">(8)</span>
        dynamic-insert="true|false"                   <span class="co">(9)</span>
        select-before-update="true|false"             <span class="co">(10)</span>
        polymorphism="implicit|explicit"              <span class="co">(11)</span>
        where="arbitrary sql where condition"         <span class="co">(12)</span>
        persister="PersisterClass"                    <span class="co">(13)</span>
        batch-size="N"                                <span class="co">(14)</span>
        optimistic-lock="none|version|dirty|all"      <span class="co">(15)</span>
        lazy="true|false"                             <span class="co">(16)</span>
        entity-name="EntityName"                      <span class="co">(17)</span>
        check="arbitrary sql check condition"         <span class="co">(18)</span>
        rowid="rowid"                                 <span class="co">(19)</span>
        subselect="SQL expression"                    <span class="co">(20)</span>
        abstract="true|false"                         <span class="co">(21)</span>
        node="element-name"
/&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">name</code> (optionnel) : Le nom Java complet de la classe (ou interface) persistante. Si cet attribut est absent, il est suppos&eacute; que
                                    ce mapping ne se rapporte pas &agrave; une entit&eacute; POJO. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">table</code> (optionnel - par d&eacute;faut le nom (non-qualifi&eacute;) de la classe) : Le nom de sa table en base de donn&eacute;es. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">discriminator-value</code> (optionnel - par d&eacute;faut le nom de la classe) : Une valeur permettant de distinguer les sous-classes dans le cas de l'utilisation
                                    du polymorphisme. Les valeurs <code class="literal">null</code> et <code class="literal">not null</code> sont autoris&eacute;es. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">mutable</code> (optionnel, vaut <code class="literal">true</code> par d&eacute;faut) : Sp&eacute;cifie que des instances de la classe sont (ou non) immuables. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">schema</code> (optional): Override the schema name specified by the root <code class="literal">&lt;hibernate-mapping&gt;</code> element. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(6)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">catalog</code> (optional): Override the catalog name specified by the root <code class="literal">&lt;hibernate-mapping&gt;</code> element. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(7)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">proxy</code> (optionnel) : Sp&eacute;cifie une interface &agrave; utiliser pour l'initialisation diff&eacute;r&eacute;e (lazy loading) des proxies. Vous pouvez indiquer
                                    le nom de la classe elle-m&ecirc;me. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(8)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">dynamic-update</code> (optionnel, par d&eacute;faut &agrave; <code class="literal">false</code>) : Sp&eacute;cifie que les <code class="literal">UPDATE</code> SQL doivent &ecirc;tre g&eacute;n&eacute;r&eacute;s &agrave; l'ex&eacute;cution et contenir uniquement les colonnes dont les valeurs ont &eacute;t&eacute; modifi&eacute;es. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(9)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">dynamic-insert</code> (optionnel, par d&eacute;faut &agrave; <code class="literal">false</code>): Sp&eacute;cifie que les <code class="literal">INSERT</code> SQL doivent &ecirc;tre g&eacute;n&eacute;r&eacute;s &agrave; l'ex&eacute;cution et ne contenir que les colonnes dont les valeurs sont non nulles. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(10)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">select-before-update</code> (optionnel, par d&eacute;faut &agrave; <code class="literal">false</code>): Sp&eacute;cifie que Hibernate ne doit <span class="emphasis"><em>jamais</em></span> ex&eacute;cuter un <code class="literal">UPDATE</code> SQL sans &ecirc;tre certain qu'un objet a &eacute;t&eacute; r&eacute;ellement modifi&eacute;. Dans certains cas, (en r&eacute;alit&eacute;, seulement quand un objet transient
                                    a &eacute;t&eacute; associ&eacute; &agrave; une nouvelle session par <code class="literal">update()</code>), cela signifie que Hibernate ex&eacute;cutera un <code class="literal">SELECT</code> SQL pour s'assurer qu'un <code class="literal">UPDATE</code> SQL est v&eacute;ritablement n&eacute;cessaire. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(11)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">polymorphism</code> (optionnel, vaut <code class="literal">implicit</code> par d&eacute;faut) : D&eacute;termine si, pour cette classe, une requ&ecirc;te polymorphique implicite ou explicite est utilis&eacute;e. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(12)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">where</code> (optionnel) sp&eacute;cifie une clause SQL <code class="literal">WHERE</code> &agrave; utiliser lorsque l'on r&eacute;cup&egrave;re des objets de cette classe. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(13)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">persister</code> (optionnel) : Sp&eacute;cifie un <code class="literal">ClassPersister</code> particulier. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(14)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">batch-size</code> (optionnel, par d&eacute;faut = <code class="literal">1</code>) : sp&eacute;cifie une taille de batch pour remplir les instances de cette classe par identifiant en une seule requ&ecirc;te. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(15)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">optimistic-lock</code> (optionnel, par d&eacute;faut = <code class="literal">version</code>) : D&eacute;termine la strat&eacute;gie de verrou optimiste. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(16)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">lazy</code> (optionnel) : D&eacute;clarer <code class="literal">lazy="true"</code> est un raccourci pour sp&eacute;cifier le nom de la classe comme &eacute;tant l'interface <code class="literal">proxy</code>. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(17)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">entity-name</code> (optionnel) : Hibernate3 permet &agrave; une classe d'&ecirc;tre mapp&eacute;e plusieurs fois (potentiellement &agrave; plusieurs tables), et permet
                                    aux mappings d'entit&eacute; d'&ecirc;tre repr&eacute;sent&eacute;s par des Maps ou du XML au niveau Java. Dans ces cas, vous devez indiquer un nom explicite
                                    arbitraire pour les entit&eacute;s. Voir <a href="#persistent-classes-dynamicmodels" title="4.4.&nbsp;Mod&egrave;les dynamiques">Section&nbsp;4.4, &laquo;&nbsp;Mod&egrave;les dynamiques&nbsp;&raquo;</a> et <a href="#xml" title="Chapitre&nbsp;18.&nbsp;Mapping XML">Chapitre&nbsp;18, <i xmlns:xlink="http://www.w3.org/1999/xlink">Mapping XML</i></a> pour plus d'informations. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(18)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">check</code> (optionnel) : expression SQL utilis&eacute;e pour g&eacute;n&eacute;rer une contrainte de v&eacute;rification multi-lignes pour la g&eacute;n&eacute;ration automatique
                                    de sch&eacute;ma. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(19)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">rowid</code> (optionnel) : Hibernate peut utiliser des ROWID sur les bases de donn&eacute;es qui utilisent ce m&eacute;canisme. Par exemple avec Oracle,
                                    Hibernate peut utiliser la colonne additionnelle <code class="literal">rowid</code> pour des mises &agrave; jour rapides si cette option vaut <code class="literal">rowid</code>. Un ROWID repr&eacute;sente la localisation physique d'un tuple enregistr&eacute;. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(20)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">subselect</code> (optionnel) : Permet de mapper une entit&eacute; immuable en lecture-seule sur un sous-select de base de donn&eacute;es. Utile pour avoir
                                    une vue au lieu d'une table en base, mais &agrave; &eacute;viter. Voir plus bas pour plus d'information. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(21)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">abstract</code> (optionnel) : Utilis&eacute; pour marquer des superclasses abstraites dans des hi&eacute;rarchies de <code class="literal">&lt;union-subclass&gt;</code>. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Il est tout &agrave; fait possible d'utiliser une interface comme nom de classe persistante. Vous devez alors d&eacute;clarer les classes
                     impl&eacute;mentant cette interface en utilisant l'&eacute;l&eacute;ment <code class="literal">&lt;subclass&gt;</code>. Vous pouvez faire persister toute classe interne <span class="emphasis"><em>static</em></span>. Vous devez alors sp&eacute;cifier le nom de la classe par la notation habituelle des classes internes c'est &agrave; dire <code class="literal">eg.Foo$Bar</code>. 
                  </p>
                  <p>Les classes immuables, <code class="literal">mutable="false"</code>, ne peuvent pas &ecirc;tre modifi&eacute;es ou supprim&eacute;es par l'application. Cela permet &agrave; Hibernate de faire quelques optimisations mineures
                     sur les performances. 
                  </p>
                  <p>L'attribut optionnnel <code class="literal">proxy</code> permet les intialisations diff&eacute;r&eacute;es des instances persistantes de la classe. Hibernate retournera initialement des proxies
                     CGLIB qui impl&eacute;mentent l'interface nomm&eacute;e. Le v&eacute;ritable objet persistant ne sera charg&eacute; que lorsque une m&eacute;thode du proxy sera
                     appel&eacute;e. Voir plus bas le paragraphe abordant les proxies et le chargement diff&eacute;r&eacute; (lazy initialization). 
                  </p>
                  <p>Le polymorphisme <span class="emphasis"><em>implicite</em></span> signifie que les instances de la classe seront retourn&eacute;es par une requ&ecirc;te qui utilise les noms de la classe ou de chacune
                     de ses superclasses ou encore des interfaces impl&eacute;ment&eacute;es par cette classe ou ses superclasses. Les instances des classes
                     filles seront retourn&eacute;es par une requ&ecirc;te qui utilise le nom de la classe elle m&ecirc;me. Le polymorphisme <span class="emphasis"><em>explicite</em></span> signifie que les instances de la classe ne seront retourn&eacute;es que par une requ&ecirc;te qui utilise explicitement son nom et que
                     seules les instances des classes filles d&eacute;clar&eacute;es dans les &eacute;l&eacute;ments <code class="literal">&lt;subclass&gt;</code> ou <code class="literal">&lt;joined-subclass&gt;</code> seront retourn&eacute;es. Dans la majorit&eacute;s des cas la valeur par d&eacute;faut, <code class="literal">polymorphism="implicit"</code>, est appropri&eacute;e. Le polymorphisme explicite est utile lorsque deux classes diff&eacute;rentes sont mapp&eacute;es &agrave; la m&ecirc;me table (ceci
                     permet d'&eacute;crire une classe "l&eacute;g&egrave;re" qui ne contient qu'une partie des colonnes de la table - voir la partie design pattern
                     du site communautaire). 
                  </p>
                  <p>L'attribut <code class="literal">persister</code> vous permet de customiser la strat&eacute;gie utilis&eacute;e pour la classe. Vous pouvez, par exemple, sp&eacute;cifier votre propre sous-classe
                     de <code class="literal">org.hibernate.persister.EntityPersister</code> ou vous pourriez aussi cr&eacute;er une nouvelle impl&eacute;mentation de l'interface <code class="literal">org.hibernate.persister.ClassPersister</code> qui proposerait une persistance via, par exemple, des appels de proc&eacute;dures stock&eacute;es, de la s&eacute;rialisation vers des fichiers
                     plats ou un annuaire LDAP. Voir <code class="literal">org.hibernate.test.CustomPersister</code> pour un exemple simple (d'une "persistance" vers une <code class="literal">Hashtable</code>). 
                  </p>
                  <p>Notez que les param&egrave;tres <code class="literal">dynamic-update</code> et <code class="literal">dynamic-insert</code> ne sont pas h&eacute;rit&eacute;s par les sous-classes et peuvent donc &ecirc;tre sp&eacute;cifi&eacute;s pour les &eacute;l&eacute;ments <code class="literal">&lt;subclass&gt;</code> ou <code class="literal">&lt;joined-subclass&gt;</code> Ces param&egrave;tres peuvent am&eacute;liorer les performances dans certains cas, mais peuvent aussi les amoindrir. A utiliser en connaissance
                     de causes. 
                  </p>
                  <p>L'utilisation de <code class="literal">select-before-update</code> va g&eacute;n&eacute;ralement faire baisser les performances. Ce param&egrave;tre est pratique pour pr&eacute;venir l'appel inutile d'un trigger sur
                     modification quand on r&eacute;attache un graphe d'instances &agrave; une <code class="literal">Session</code>. 
                  </p>
                  <p>Si vous utilisez le <code class="literal">dynamic-update</code>, les diff&eacute;rentes strat&eacute;gies de verrouillage optimiste (optimistic locking) sont les suivantes: 
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p><code class="literal">version</code> v&eacute;rifie les colonnes version/timestamp 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">all</code> v&eacute;rifie toutes les colonnes 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">dirty</code> v&eacute;rifie les colonnes modifi&eacute;es, permettant des updates concurrents 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">none</code> pas de verrouillage optimiste 
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>Nous encourageons <span class="emphasis"><em>tr&egrave;s</em></span> fortement l'utilisation de colonnes de version/timestamp pour le verrouillage optimiste avec Hibernate. C'est la meilleure
                     strat&eacute;gie en regard des performances et la seule qui g&egrave;re correctement les modifications sur les objets d&eacute;tach&eacute;s (c'est &agrave;
                     dire lorsqu'on utilise <code class="literal">Session.merge()</code>). 
                  </p>
                  <p>Il n'y a pas de diff&eacute;rence entre table et vue pour le mapping Hibernate, tant que c'est transparent au niveau base de donn&eacute;es
                     (remarquez que certaines BDD ne supportent pas les vues correctement, notamment pour les updates). Vous rencontrerez peut-&ecirc;tre
                     des cas o&ugrave; vous souhaitez utiliser une vue mais ne pouvez pas en cr&eacute;er sur votre BDD (par exemple &agrave; cause de sch&eacute;mas anciens
                     et fig&eacute;s). Dans ces cas, vous pouvez mapper une entit&eacute; immuable en lecture seule sur un sous-select SQL donn&eacute;: 
                  </p><pre class="programlisting">&lt;class name="Summary"&gt;
    &lt;subselect&gt;
        select item.name, max(bid.amount), count(*)
        from item
        join bid on bid.item_id = item.id
        group by item.name
    &lt;/subselect&gt;
    &lt;synchronize table="item"/&gt;
    &lt;synchronize table="bid"/&gt;
    &lt;id name="name"/&gt;
    ...
&lt;/class&gt;</pre><p>D&eacute;clarez les tables &agrave; synchroniser avec cette entit&eacute; pour assurer que le flush automatique se produise correctement, et pour
                     que les requ&ecirc;tes sur l'entit&eacute; d&eacute;riv&eacute;e ne renvoient pas des donn&eacute;es p&eacute;rim&eacute;es. Le lit&eacute;ral <code class="literal">&lt;subselect&gt;</code> est disponible comme attribut ou comme &eacute;l&eacute;ment de mapping. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-id"></a>5.1.4.&nbsp;id
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Les classes mapp&eacute;es <span class="emphasis"><em>doivent</em></span> d&eacute;clarer la clef primaire de la table en base de donn&eacute;es. La plupart des classes auront aussi une propri&eacute;t&eacute; de type javabean
                     pr&eacute;sentant l'identifiant unique d'une instance. L'&eacute;l&eacute;ment <code class="literal">&lt;id&gt;</code> sert &agrave; d&eacute;finir le mapping entre cette propri&eacute;t&eacute; et la clef primaire en base. 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;id
        name="propertyName"                                          <span class="co">(1)</span>
        type="typename"                                              <span class="co">(2)</span>
        column="column_name"                                         <span class="co">(3)</span>
        unsaved-value="null|any|none|undefined|id_value"             <span class="co">(4)</span>
        access="field|property|ClassName"&gt;                           <span class="co">(5)</span>
        node="element-name|@attribute-name|element/@attribute|."

        &lt;generator class="generatorClass"/&gt;
&lt;/id&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">name</code> (optionnel) : Nom de la propri&eacute;t&eacute; qui sert d'identifiant. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">type</code> (optionnel) : Nom indiquant le type Hibernate. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">column</code> (optionnel - le nom de la propri&eacute;t&eacute; est pris par d&eacute;faut) : Nom de la clef primaire. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">unsaved-value</code> (optionnel - par d&eacute;faut une valeur "bien choisie") : Une valeur de la propri&eacute;t&eacute; d'identifiant qui indique que l'instance
                                    est nouvellement instanci&eacute;e (non sauvegard&eacute;e), et qui la distingue des instances <code class="literal">transient</code>s qui ont &eacute;t&eacute; sauvegard&eacute;es ou charg&eacute;es dans une session pr&eacute;c&eacute;dente. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">access</code> (optional - defaults to <code class="literal">property</code>): The strategy Hibernate should use for accessing the property value. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Si l'attribut <code class="literal">name</code> est absent, Hibernate consid&egrave;re que la classe ne poss&egrave;de pas de propri&eacute;t&eacute; identifiant. 
                  </p>
                  <p>L'attribut <code class="literal">unsaved-value</code> est important ! Si l'identifiant de votre classe n'a pas une valeur par d&eacute;faut compatible avec le comportement standard de
                     Java (z&eacute;ro ou null), vous devez alors pr&eacute;ciser la valeur par d&eacute;faut. 
                  </p>
                  <p>La d&eacute;claration alternative <code class="literal">&lt;composite-id&gt;</code> permet l'accc&egrave;s aux donn&eacute;es d'anciens syst&egrave;mes qui utilisent des clefs compos&eacute;es. Son utilisation est fortement d&eacute;conseill&eacute;e
                     pour d'autres cas. 
                  </p>
                  <div class="sect3" lang="fr-FR">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="mapping-declaration-id-generator"></a>5.1.4.1.&nbsp;Generator
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>L'&eacute;l&eacute;ment fils <code class="literal">&lt;generator&gt;</code> nomme une classe Java utilis&eacute;e pour g&eacute;n&eacute;rer les identifiants uniques pour les instances des classes persistantes. Si des
                        param&egrave;tres sont requis pour configurer ou initialiser l'instance du g&eacute;n&eacute;rateur, ils sont pass&eacute;s en utilisant l'&eacute;l&eacute;ment <code class="literal">&lt;param&gt;</code>. 
                     </p><pre class="programlisting">&lt;id name="id" type="long" column="cat_id"&gt;
        &lt;generator class="org.hibernate.id.TableHiLoGenerator"&gt;
                &lt;param name="table"&gt;uid_table&lt;/param&gt;
                &lt;param name="column"&gt;next_hi_value_column&lt;/param&gt;
        &lt;/generator&gt;
&lt;/id&gt;</pre><p>All generators implement the interface <code class="literal">org.hibernate.id.IdentifierGenerator</code>. This is a very simple interface; some applications may choose to provide their own specialized implementations. However,
                        Hibernate provides a range of built-in implementations. There are shortcut names for the built-in generators: 
                     </p>
                     <div class="variablelist">
                        <dl>
                           <dt><span class="term"><code class="literal">increment</code></span></dt>
                           <dd>
                              <p>G&eacute;n&egrave;re des identifiants de type <code class="literal">long</code>, <code class="literal">short</code> ou <code class="literal">int</code> qui ne sont uniques que si aucun autre processus n'ins&egrave;re de donn&eacute;es dans la m&ecirc;me table. <span class="emphasis"><em>Ne pas utiliser en environnement clusteris&eacute;.</em></span> 
                              </p>
                           </dd>
                           <dt><span class="term"><code class="literal">identity</code></span></dt>
                           <dd>
                              <p>Utilisation de la colonne identity de DB2, MySQL, MS SQL Server, Sybase et HypersonicSQL. L'identifiant renvoy&eacute; est de type
                                 <code class="literal">long</code>, <code class="literal">short</code> ou <code class="literal">int</code>. 
                              </p>
                           </dd>
                           <dt><span class="term"><code class="literal">sequence</code></span></dt>
                           <dd>
                              <p>Utilisation des s&eacute;quences dans DB2, PostgreSQL, Oracle, SAP DB, McKoi ou d'un g&eacute;n&eacute;rateur dans Interbase. L'identifiant renvoy&eacute;
                                 est de type <code class="literal">long</code>, <code class="literal">short</code> ou <code class="literal">int</code> 
                              </p>
                           </dd>
                           <dt><span class="term"><code class="literal">hilo</code></span></dt>
                           <dd>
                              <p><a name="mapping-declaration-id-hilodescription"></a>Utilise un algorithme hi/lo pour g&eacute;n&eacute;rer de fa&ccedil;on efficace des identifiants de type <code class="literal">long</code>, <code class="literal">short</code> ou <code class="literal">int</code>, en prenant comme source de valeur "hi" une table et une colonne (par d&eacute;faut <code class="literal">hibernate_unique_key</code> et <code class="literal">next_hi</code> respectivement). L'algorithme hi/lo g&eacute;n&egrave;re des identifiants uniques pour une base de donn&eacute;es particuli&egrave;re seulement. 
                              </p>
                           </dd>
                           <dt><span class="term"><code class="literal">seqhilo</code></span></dt>
                           <dd>
                              <p>Utilise un algorithme hi/lo pour g&eacute;n&eacute;rer efficacement des identifiants de type <code class="literal">long</code>, <code class="literal">short</code> ou <code class="literal">int</code>, &eacute;tant donn&eacute; un nom de s&eacute;quence en base. 
                              </p>
                           </dd>
                           <dt><span class="term"><code class="literal">uuid</code></span></dt>
                           <dd>
                              <p>Utilise un algorithme de type UUID 128 bits pour g&eacute;n&eacute;rer des identifiants de type string, unique au sein d'un r&eacute;seau (l'adresse
                                 IP est utilis&eacute;e). Le UUID en cod&eacute; en une cha&icirc;ne de nombre h&eacute;xad&eacute;cimaux de longueur 32. 
                              </p>
                           </dd>
                           <dt><span class="term"><code class="literal">guid</code></span></dt>
                           <dd>
                              <p>Utilise une cha&icirc;ne GUID g&eacute;n&eacute;r&eacute;e par la base pour MS SQL Server et MySQL. </p>
                           </dd>
                           <dt><span class="term"><code class="literal">native</code></span></dt>
                           <dd>
                              <p>Choisit <code class="literal">identity</code>, <code class="literal">sequence</code> ou <code class="literal">hilo</code> selon les possibilit&eacute;s offertes par la base de donn&eacute;es sous-jacente. 
                              </p>
                           </dd>
                           <dt><span class="term"><code class="literal">assigned</code></span></dt>
                           <dd>
                              <p>Laisse l'application affecter un identifiant &agrave; l'objet avant que la m&eacute;tode <code class="literal">save()</code> soit appel&eacute;e. Il s'agit de la strat&eacute;gie par d&eacute;faut si aucun <code class="literal">&lt;generator&gt;</code> n'est sp&eacute;cifi&eacute;. 
                              </p>
                           </dd>
                           <dt><span class="term"><code class="literal">select</code></span></dt>
                           <dd>
                              <p>R&eacute;cup&egrave;re une clef primaire assign&eacute;e par un trigger en s&eacute;lectionnant la ligne par une clef unique quelconque. </p>
                           </dd>
                           <dt><span class="term"><code class="literal">foreign</code></span></dt>
                           <dd>
                              <p>Utilise l'identifiant d'un objet associ&eacute;. Habituellement utilis&eacute; en conjonction avec une association <code class="literal">&lt;one-to-one&gt;</code> sur la clef primaire. 
                              </p>
                           </dd>
                           <dt><span class="term"><code class="literal">sequence-identity</code></span></dt>
                           <dd>
                              <p>a specialized sequence generation strategy which utilizes a database sequence for the actual value generation, but combines
                                 this with JDBC3 getGeneratedKeys to actually return the generated identifier value as part of the insert statement execution.
                                 This strategy is only known to be supported on Oracle 10g drivers targetted for JDK 1.4. Note comments on these insert statements
                                 are disabled due to a bug in the Oracle drivers. 
                              </p>
                           </dd>
                        </dl>
                     </div>
                     <p>
                        
                        
                     </p>
                  </div>
                  <div class="sect3" lang="fr-FR">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="mapping-declaration-id-hilo"></a>5.1.4.2.&nbsp;algorithme Hi/lo
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>Les g&eacute;n&eacute;rateurs <code class="literal">hilo</code> et <code class="literal">seqhilo</code> proposent deux impl&eacute;mentations alternatives de l'algorithme hi/lo, une approche largement utilis&eacute;e pour g&eacute;n&eacute;rer des identifiants.
                        La premi&egrave;re impl&eacute;mentation n&eacute;cessite une table "sp&eacute;ciale" en base pour h&eacute;berger la prochaine valeur "hi" disponible. La seconde
                        utilise une s&eacute;quence de type Oracle (quand la base sous-jacente le propose). 
                     </p><pre class="programlisting">&lt;id name="id" type="long" column="cat_id"&gt;
        &lt;generator class="hilo"&gt;
                &lt;param name="table"&gt;hi_value&lt;/param&gt;
                &lt;param name="column"&gt;next_value&lt;/param&gt;
                &lt;param name="max_lo"&gt;100&lt;/param&gt;
        &lt;/generator&gt;
&lt;/id&gt;</pre><pre class="programlisting">&lt;id name="id" type="long" column="cat_id"&gt;
        &lt;generator class="seqhilo"&gt;
                &lt;param name="sequence"&gt;hi_value&lt;/param&gt;
                &lt;param name="max_lo"&gt;100&lt;/param&gt;
        &lt;/generator&gt;
&lt;/id&gt;</pre><p>Malheureusement, vous ne pouvez pas utilisez <code class="literal">hilo</code> quand vous apportez votre propre <code class="literal">Connection</code> &agrave; Hibernate. Quand Hibernate utilise une datasource du serveur d'application pour obtenir des connexions inscrites avec JTA,
                        vous devez correctement configurer <code class="literal">hibernate.transaction.manager_lookup_class</code>. 
                     </p>
                  </div>
                  <div class="sect3" lang="fr-FR">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="mapping-declaration-id-uuid"></a>5.1.4.3.&nbsp;UUID algorithm
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>Le contenu du UUID est : adresse IP, date de d&eacute;marrage de la JVM (pr&eacute;cis au quart de seconde), l'heure syst&egrave;me et un compteur
                        (unique au sein de la JVM). Il n'est pas possible d'obtenir l'adresse MAC ou une adresse m&eacute;moire &agrave; partir de Java, c'est donc
                        le mieux que l'on puisse faire sans utiliser JNI. 
                     </p>
                  </div>
                  <div class="sect3" lang="fr-FR">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="mapping-declaration-id-sequences"></a>5.1.4.4.&nbsp;Colonnes identifiantes et s&eacute;quences
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>Pour les bases qui impl&eacute;mentent les colonnes "identit&eacute;" (DB2, MySQL, Sybase, MS SQL), vous pouvez utiliser la g&eacute;n&eacute;ration de
                        clef par <code class="literal">identity</code>. Pour les bases qui impl&eacute;mentent les s&eacute;quences (DB2, Oracle, PostgreSQL, Interbase, McKoi, SAP DB) vous pouvez utiliser la
                        g&eacute;n&eacute;ration de clef par <code class="literal">sequence</code>. Ces deux m&eacute;thodes n&eacute;cessitent deux requ&ecirc;tes SQL pour ins&eacute;rer un objet. 
                     </p><pre class="programlisting">&lt;id name="id" type="long" column="person_id"&gt;
        &lt;generator class="sequence"&gt;
                &lt;param name="sequence"&gt;person_id_sequence&lt;/param&gt;
        &lt;/generator&gt;
&lt;/id&gt;</pre><pre class="programlisting">&lt;id name="id" type="long" column="person_id" unsaved-value="0"&gt;
        &lt;generator class="identity"/&gt;
&lt;/id&gt;</pre><p>Pour le d&eacute;veloppement multi-plateformes, la strat&eacute;gie <code class="literal">native</code> choisira entre les m&eacute;thodes <code class="literal">identity</code>, <code class="literal">sequence</code> et <code class="literal">hilo</code>, selon les possibilit&eacute;s offertes par la base sous-jacente. 
                     </p>
                  </div>
                  <div class="sect3" lang="fr-FR">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="mapping-declaration-id-assigned"></a>5.1.4.5.&nbsp;Identifiants assign&eacute;s
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>Si vous souhaitez que l'application assigne des identifiants (par opposition &agrave; la g&eacute;n&eacute;ration par Hibernate), vous pouvez utiliser
                        le g&eacute;n&eacute;rateur <code class="literal">assigned</code>. Ce g&eacute;n&eacute;rateur sp&eacute;cial utilisera une valeur d'identifiant d&eacute;j&agrave; utilis&eacute; par la propri&eacute;t&eacute; identifiant l'objet. Ce g&eacute;n&eacute;rateur
                        est utilis&eacute; quand la clef primaire est une clef naturelle plut&ocirc;t qu'une clef secondaire. C'est le comportement par d&eacute;faut
                        si vous ne pr&eacute;cisez pas d'&eacute;l&eacute;ment <code class="literal">&lt;generator&gt;</code>. 
                     </p>
                     <p>Choisir le g&eacute;n&eacute;rateur <code class="literal">assigned</code> fait utiliser <code class="literal">unsaved-value="undefined"</code> par Hibernate, le for&ccedil;ant &agrave; interroger la base pour d&eacute;terminer si l'instance est transiente ou d&eacute;tach&eacute;e, &agrave; moins d'utiliser
                        une propri&eacute;t&eacute; version ou timestamp, ou alors de d&eacute;finir <code class="literal">Interceptor.isUnsaved()</code>. 
                     </p>
                  </div>
                  <div class="sect3" lang="fr-FR">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="mapping-declaration-id-select"></a>5.1.4.6.&nbsp;Clefs primaires assign&eacute;es par trigger
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>Pour les sch&eacute;mas de base h&eacute;rit&eacute;s d'anciens syst&egrave;mes uniquement (Hibernate ne g&eacute;n&egrave;re pas de DDL avec des triggers) </p><pre class="programlisting">&lt;id name="id" type="long" column="person_id"&gt;
        &lt;generator class="select"&gt;
                &lt;param name="key"&gt;socialSecurityNumber&lt;/param&gt;
        &lt;/generator&gt;
&lt;/id&gt;</pre><p>Dans l'exemple ci-dessus, <code class="literal">socialSecurityNumber</code> a une valeur unique d&eacute;finie par la classe en tant que clef naturelle et <code class="literal">person_id</code> est une clef secondaire dont la valeur est g&eacute;n&eacute;r&eacute;e par trigger. 
                     </p>
                  </div>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-id-enhanced"></a>5.1.5.&nbsp;Enhanced identifier generators
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Starting with release 3.2.3, there are 2 new generators which represent a re-thinking of 2 different aspects of identifier
                     generation. The first aspect is database portability; the second is optimization (not having to query the database for every
                     request for a new identifier value). These two new generators are intended to take the place of some of the named generators
                     described above (starting in 3.3.x); however, they are included in the current releases and can be referenced by FQN. 
                  </p>
                  <p>The first of these new generators is <code class="literal">org.hibernate.id.enhanced.SequenceStyleGenerator</code> which is intended firstly as a replacement for the <code class="literal">sequence</code> generator and secondly as a better portability generator than <code class="literal">native</code> (because <code class="literal">native</code> (generally) chooses between <code class="literal">identity</code> and <code class="literal">sequence</code> which have largely different semantics which can cause subtle isssues in applications eyeing portability). <code class="literal">org.hibernate.id.enhanced.SequenceStyleGenerator</code> however achieves portability in a different manner. It chooses between using a table or a sequence in the database to store
                     its incrementing values depending on the capabilities of the dialect being used. The difference between this and <code class="literal">native</code> is that table-based and sequence-based storage have the same exact semantic (in fact sequences are exactly what Hibernate
                     tries to emmulate with its table-based generators). This generator has a number of configuration parameters: 
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc" compact>
                        <li>
                           <p><code class="literal">sequence_name</code> (optional, defaults to <code class="literal">hibernate_sequence</code>): The name of the sequence (or table) to be used. 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">initial_value</code> (optional, defaults to <code class="literal">1</code>): The initial value to be retrieved from the sequence/table. In sequence creation terms, this is analogous to the clause
                              typical named "STARTS WITH". 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">increment_size</code> (optional, defaults to <code class="literal">1</code>): The value by which subsequent calls to the sequence/table should differ. In sequence creation terms, this is analogous
                              to the clause typical named "INCREMENT BY". 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">force_table_use</code> (optional, defaults to <code class="literal">false</code>): Should we force the use of a table as the backing structure even though the dialect might support sequence? 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">value_column</code> (optional, defaults to <code class="literal">next_val</code>): Only relevant for table structures! The name of the column on the table which is used to hold the value. 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">optimizer</code> (optional, defaults to <code class="literal">none</code>): See <a href="#mapping-declaration-id-enhanced-optimizers" title="5.1.6.&nbsp;Identifier generator optimization">Section&nbsp;5.1.6, &laquo;&nbsp;Identifier generator optimization&nbsp;&raquo;</a> 
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>
                     
                  </p>
                  <p>The second of these new generators is <code class="literal">org.hibernate.id.enhanced.TableGenerator</code> which is intended firstly as a replacement for the <code class="literal">table</code> generator (although it actually functions much more like <code class="literal">org.hibernate.id.MultipleHiLoPerTableGenerator</code>) and secondly as a re-implementation of <code class="literal">org.hibernate.id.MultipleHiLoPerTableGenerator</code> utilizing the notion of pluggable optimiziers. Essentially this generator defines a table capable of holding a number of
                     different increment values simultaneously by using multiple distinctly keyed rows. This generator has a number of configuration
                     parameters: 
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc" compact>
                        <li>
                           <p><code class="literal">table_name</code> (optional, defaults to <code class="literal">hibernate_sequences</code>): The name of the table to be used. 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">value_column_name</code> (optional, defaults to <code class="literal">next_val</code>): The name of the column on the table which is used to hold the value. 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">segment_column_name</code> (optional, defaults to <code class="literal">sequence_name</code>): The name of the column on the table which is used to hold the "segement key". This is the value which distinctly identifies
                              which increment value to use. 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">segment_value</code> (optional, defaults to <code class="literal">default</code>): The "segment key" value for the segment from which we want to pull increment values for this generator. 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">segment_value_length</code> (optional, defaults to <code class="literal">255</code>): Used for schema generation; the column size to create this segment key column. 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">initial_value</code> (optional, defaults to <code class="literal">1</code>): The initial value to be retrieved from the table. 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">increment_size</code> (optional, defaults to <code class="literal">1</code>): The value by which subsequent calls to the table should differ. 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">optimizer</code> (optional, defaults to <code class="literal"></code>): See <a href="#mapping-declaration-id-enhanced-optimizers" title="5.1.6.&nbsp;Identifier generator optimization">Section&nbsp;5.1.6, &laquo;&nbsp;Identifier generator optimization&nbsp;&raquo;</a> 
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>
                     
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-id-enhanced-optimizers"></a>5.1.6.&nbsp;Identifier generator optimization
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>For identifier generators which store values in the database, it is inefficient for them to hit the database on each and every
                     call to generate a new identifier value. Instead, you'd ideally want to group a bunch of them in memory and only hit the database
                     when you have exhausted your in-memory value group. This is the role of the pluggable optimizers. Currently only the two enhanced
                     generators (<a href="#mapping-declaration-id-enhanced" title="5.1.5.&nbsp;Enhanced identifier generators">Section&nbsp;5.1.5, &laquo;&nbsp;Enhanced identifier generators&nbsp;&raquo;</a> support this notion. 
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc" compact>
                        <li>
                           <p><code class="literal">none</code> (generally this is the default if no optimizer was specified): This says to not perform any optimizations, and hit the database
                              each and every request. 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">hilo</code>: applies a hi/lo algorithm around the database retrieved values. The values from the database for this optimizer are expected
                              to be sequential. The values retrieved from the database structure for this optimizer indicates the "group number"; the <code class="literal">increment_size</code> is multiplied by that value in memory to define a group "hi value". 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">pooled</code>: like was discussed for <code class="literal">hilo</code>, this optimizers attempts to minimize the number of hits to the database. Here, however, we simply store the starting value
                              for the "next group" into the database structure rather than a sequential value in combination with an in-memory grouping
                              algorithm. <code class="literal">increment_size</code> here refers to the values coming from the database. 
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>
                     
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-compositeid"></a>5.1.7.&nbsp;composite-id
                           </h3>
                        </div>
                     </div>
                  </div><pre class="programlisting">&lt;composite-id
        name="propertyName"
        class="ClassName"
        mapped="true|false"
        access="field|property|ClassName"&gt;
        node="element-name|."

        &lt;key-property name="propertyName" type="typename" column="column_name"/&gt;
        &lt;key-many-to-one name="propertyName class="ClassName" column="column_name"/&gt;
        ......
&lt;/composite-id&gt;</pre><p>Pour une table avec clef compos&eacute;e, vous pouvez mapper plusieurs attributs de la classe comme propri&eacute;t&eacute;s identifiantes. L'&eacute;lement
                     <code class="literal">&lt;composite-id&gt;</code> accepte les mappings de propri&eacute;t&eacute;s <code class="literal">&lt;key-property&gt;</code> et les mappings <code class="literal">&lt;key-many-to-one&gt;</code> comme fils. 
                  </p><pre class="programlisting">&lt;composite-id&gt;
        &lt;key-property name="medicareNumber"/&gt;
        &lt;key-property name="dependent"/&gt;
&lt;/composite-id&gt;</pre><p>Vos classes persistantes <span class="emphasis"><em>doivent</em></span> surcharger les m&eacute;thodes <code class="literal">equals()</code> et <code class="literal">hashCode()</code> pour impl&eacute;menter l'&eacute;galit&eacute; d'identifiant compos&eacute;. Elles doivent aussi implenter l'interface <code class="literal">Serializable</code>. 
                  </p>
                  <p>Malheureusement cette approche sur les identifiants compos&eacute;s signifie qu'un objet persistant est son propre identifiant. Il
                     n'y a pas d'autre moyen pratique de manipuler l'objet que par l'objet lui-m&ecirc;me. Vous devez instancier une instance de la classe
                     persistante elle-m&ecirc;me et peupler ses attributs identifiants avant de pouvoir appeler la m&eacute;thode <code class="literal">load()</code> pour charger son &eacute;tat persistant associ&eacute; &agrave; une clef compos&eacute;e. Nous appelons cette approche "identifiant compos&eacute; <span class="emphasis"><em>embarqu&eacute;</em></span>" et ne la recommandons pas pour des applications complexes. 
                  </p>
                  <p>Une seconde approche, appel&eacute;e identifiant compos&eacute; <span class="emphasis"><em>mapp&eacute;</em></span>, consiste &agrave; encapsuler les propri&eacute;t&eacute;s identifiantes (celles contenues dans <code class="literal">&lt;composite-id&gt;</code>) dans une classe particuli&egrave;re. 
                  </p><pre class="programlisting">&lt;composite-id class="MedicareId" mapped="true"&gt;
        &lt;key-property name="medicareNumber"/&gt;
        &lt;key-property name="dependent"/&gt;
&lt;/composite-id&gt;</pre><p>Dans cet exemple, la classe d'identifiant compos&eacute;e,<code class="literal">MedicareId</code> et la classe mapp&eacute;e elle-m&ecirc;me, poss&egrave;dent les propri&eacute;t&eacute;s <code class="literal">medicareNumber</code> et <code class="literal">dependent</code>. La classe identifiante doit red&eacute;finir <code class="literal">equals()</code> et <code class="literal">hashCode()</code> et impl&eacute;menter <code class="literal">Serializable</code>. Le d&eacute;savantage de cette approche est la duplication du code. 
                  </p>
                  <p>Les attributs suivants servent &agrave; configurer un identifiant compos&eacute; mapp&eacute; : </p>
                  <div class="itemizedlist">
                     <ul type="disc" compact>
                        <li>
                           <p><code class="literal">mapped</code> (optionnel, d&eacute;faut &agrave; <code class="literal">false</code>) : indique qu'un identifiant compos&eacute; mapp&eacute; est utilis&eacute;, et que les propri&eacute;t&eacute;s contenues font r&eacute;f&eacute;rence aux deux classes (celle
                              mapp&eacute;e et la classe identifiante). 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">class</code> (optionnel, mais requis pour un identifiant compos&eacute; mapp&eacute;) : La classe composant utilis&eacute;e comme identifiant compos&eacute;. 
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>Nous d&eacute;crirons une troisi&egrave;me approche beaucoup plus efficace ou l'identifiant compos&eacute; est impl&eacute;ment&eacute; comme une classe composant
                     dans <a href="#components-compositeid" title="8.4.&nbsp;Utiliser un composant comme identifiant">Section&nbsp;8.4, &laquo;&nbsp;Utiliser un composant comme identifiant&nbsp;&raquo;</a>. Les attributs d&eacute;crits ci dessous, ne s'appliquent que pour cette derni&egrave;re approche : 
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc" compact>
                        <li>
                           <p><code class="literal">name</code> (optionnel, requis pour cette approche) : une propri&eacute;t&eacute; de type composant qui contient l'identifiant compos&eacute; (voir chapitre
                              9). 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">access</code> (optional - defaults to <code class="literal">property</code>): The strategy Hibernate should use for accessing the property value. 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">class</code> (optionnel - d&eacute;faut au type de la propri&eacute;t&eacute; d&eacute;termin&eacute; par r&eacute;flexion) : La classe composant utilis&eacute;e comme identifiant (voir
                              prochaine section). 
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>Cette derni&egrave;re approche est celle que nous recommandons pour toutes vos applications. </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-discriminator"></a>5.1.8.&nbsp;discriminator
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>L'&eacute;l&eacute;ment <code class="literal">&lt;discriminator&gt;</code> est n&eacute;cessaire pour la persistance polymorphique qui utilise la strat&eacute;gie de mapping de table par hi&eacute;rarchie de classe. La
                     colonne discriminante contient une valeur marqueur qui permet &agrave; la couche de persistance de savoir quelle sous-classe instancier
                     pour une ligne particuli&egrave;re de table en base. Un nombre restreint de types peuvent &ecirc;tre utilis&eacute;s : <code class="literal">string</code>, <code class="literal">character</code>, <code class="literal">integer</code>, <code class="literal">byte</code>, <code class="literal">short</code>, <code class="literal">boolean</code>, <code class="literal">yes_no</code>, <code class="literal">true_false</code>. 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;discriminator
        column="discriminator_column"                      <span class="co">(1)</span>
        type="discriminator_type"                          <span class="co">(2)</span>
        force="true|false"                                 <span class="co">(3)</span>
        insert="true|false"                                <span class="co">(4)</span>
        formula="arbitrary sql expression"                 <span class="co">(5)</span>
/&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">column</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">class</code>) le nom de la colonne discriminante. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">type</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">string</code>) un nom indiquant le type Hibernate. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">force</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">false</code>) "oblige" Hibernate &agrave; sp&eacute;cifier une valeur discriminante autoris&eacute;e m&ecirc;me quand on r&eacute;cup&egrave;re toutes les instances de la classe
                                    de base. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">insert</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">true</code>) &agrave; passer &agrave; <code class="literal">false</code> si la colonne discriminante fait aussi partie d'un identifiant compos&eacute; mapp&eacute; (Indique &agrave; Hibernate de ne pas inclure la colonne
                                    dans les <code class="literal">INSERT</code> SQL). 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">formula</code> (optionnel) une expression SQL arbitraire qui est ex&eacute;cut&eacute;e quand un type doit &ecirc;tre &eacute;valu&eacute;. Permet la discrimination bas&eacute;e
                                    sur le contenu. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Les v&eacute;ritables valeurs de la colonne discriminante sont sp&eacute;cifi&eacute;es par l'attribut <code class="literal">discriminator-value</code> des &eacute;l&eacute;ments <code class="literal">&lt;class&gt;</code> et <code class="literal">&lt;subclass&gt;</code>. 
                  </p>
                  <p>L'attribut <code class="literal">force</code> n'est utile que si la table contient des lignes avec des valeurs "extra" discriminantes qui ne sont pas mapp&eacute;es &agrave; une classe
                     persistante. Ce ne sera g&eacute;n&eacute;ralement pas le cas. 
                  </p>
                  <p>En utilisant l'attribut <code class="literal">formula</code> vous pouvez d&eacute;clarer une expression SQL arbitraire qui sera utilis&eacute;e pour &eacute;valuer le type d'une ligne : 
                  </p><pre class="programlisting">&lt;discriminator
    formula="case when CLASS_TYPE in ('a', 'b', 'c') then 0 else 1 end"
    type="integer"/&gt;</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-version"></a>5.1.9.&nbsp;version (optionnel)
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>L'&eacute;l&eacute;ment <code class="literal">&lt;version&gt;</code> est optionnel et indique que la table contient des donn&eacute;es versionn&eacute;es. C'est particuli&egrave;rement utile si vous avez l'intention
                     d'utiliser des <span class="emphasis"><em>transactions longues</em></span> (voir plus-bas). 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;version
        column="version_column"                                      <span class="co">(1)</span>
        name="propertyName"                                          <span class="co">(2)</span>
        type="typename"                                              <span class="co">(3)</span>
        access="field|property|ClassName"                            <span class="co">(4)</span>
        unsaved-value="null|negative|undefined"                      <span class="co">(5)</span>
        generated="never|always"                                     <span class="co">(6)</span>
        insert="true|false"                                          <span class="co">(7)</span>
        node="element-name|@attribute-name|element/@attribute|."
/&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">column</code> (optionnel - par d&eacute;faut &eacute;gal au nom de la propri&eacute;t&eacute;) : Le nom de la colonne contenant le num&eacute;ro de version. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">name</code> : Le nom d'un attribut de la classe persistante. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">type</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">integer</code>) : Le type du num&eacute;ro de version. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">access</code> (optional - defaults to <code class="literal">property</code>): The strategy Hibernate should use for accessing the property value. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">unsaved-value</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">undefined</code>) : Une valeur de la propri&eacute;t&eacute; d'identifiant qui indique que l'instance est nouvellement instanci&eacute;e (non sauvegard&eacute;e), et
                                    qui la distingue des instances d&eacute;tach&eacute;es qui ont &eacute;t&eacute; sauvegard&eacute;es ou charg&eacute;es dans une session pr&eacute;c&eacute;dente (<code class="literal">undefined</code> indique que la valeur de l'atribut identifiant devrait &ecirc;tre utilis&eacute;). 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(6)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">generated</code> (optional - d&eacute;faut &agrave; <code class="literal">never</code>) : Indique que la valeur de la propri&eacute;t&eacute; version est g&eacute;n&eacute;r&eacute;e par la base de donn&eacute;es cf. <a href="#mapping-generated" title="5.6.&nbsp;Propri&eacute;t&eacute;s g&eacute;n&eacute;r&eacute;es">Section&nbsp;5.6, &laquo;&nbsp;Propri&eacute;t&eacute;s g&eacute;n&eacute;r&eacute;es&nbsp;&raquo;</a>. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(7)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">insert</code> (optionnel - d&eacute;faut &agrave; <code class="literal">true</code>) : Indique si la colonne de version doit &ecirc;tre incluse dans les ordres insert. Peut &ecirc;tre &agrave; <code class="literal">false</code> si et seulement si la colonne de la base de donn&eacute;es est d&eacute;finie avec une valeur par d&eacute;faut &agrave; <code class="literal">0</code>. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Les num&eacute;ros de version doivent avoir les types Hibernate <code class="literal">long</code>, <code class="literal">integer</code>, <code class="literal">short</code>, <code class="literal">timestamp</code> ou <code class="literal">calendar</code>. 
                  </p>
                  <p>Une propri&eacute;t&eacute; de version ou un timestamp ne doit jamais &ecirc;tre null pour une instance d&eacute;tach&eacute;e, ainsi Hibernate pourra d&eacute;tecter
                     toute instance ayant une version ou un timestamp null comme transient, quelles que soient les strat&eacute;gies <code class="literal">unsaved-value</code> sp&eacute;cifi&eacute;es. <span class="emphasis"><em>D&eacute;clarer un num&eacute;ro de version ou un timestamp "nullable" est un moyen pratique d'&eacute;viter tout probl&egrave;me avec les r&eacute;attachements
                           transitifs dans Hibernate, particuli&egrave;rement utile pour ceux qui utilisent des identifiants assign&eacute;s ou des clefs compos&eacute;es
                           !</em></span> 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-timestamp"></a>5.1.10.&nbsp;timestamp (optionnel)
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>L'&eacute;l&eacute;ment optionnel <code class="literal">&lt;timestamp&gt;</code> indique que la table contient des donn&eacute;es horodat&eacute;es (timestamp). Cela sert d'alternative &agrave; l'utilisation de num&eacute;ros de version.
                     Les timestamps (ou horodatage) sont par nature une impl&eacute;mentation moins fiable pour l'optimistic locking. Cependant, l'application
                     peut parfois utiliser l'horodatage &agrave; d'autres fins. 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;timestamp
        column="timestamp_column"                                    <span class="co">(1)</span>
        name="propertyName"                                          <span class="co">(2)</span>
        access="field|property|ClassName"                            <span class="co">(3)</span>
        unsaved-value="null|undefined"                               <span class="co">(4)</span>
        source="vm|db"                                               <span class="co">(5)</span>
        generated="never|always"                                     <span class="co">(6)</span>
        node="element-name|@attribute-name|element/@attribute|."
/&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">column</code> (optionnel - par d&eacute;faut &agrave; le nom de la propri&eacute;t&eacute;) : Le nom d'une colonne contenant le timestamp. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">name</code> : Le nom d'une propri&eacute;t&eacute; au sens JavaBean de type <code class="literal">Date</code> ou <code class="literal">Timestamp</code> de la classe persistante. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">access</code> (optional - defaults to <code class="literal">property</code>): The strategy Hibernate should use for accessing the property value. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">unsaved-value</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">null</code>) : Propri&eacute;t&eacute; dont la valeur est un num&eacute;ro de version qui indique que l'instance est nouvellement instanci&eacute;e (non sauvegard&eacute;e),
                                    et qui la distingue des instances d&eacute;tach&eacute;es qui ont &eacute;t&eacute; sauvegard&eacute;es ou charg&eacute;es dans une session pr&eacute;c&eacute;dente (<code class="literal">undefined</code> indique que la valeur de l'attribut identifiant devrait &ecirc;tre utilis&eacute;e). 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">source</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">vm</code>) : D'o&ugrave; Hibernate doit-il r&eacute;cup&eacute;rer la valeur du timestamp? Depuis la base de donn&eacute;es ou depuis la JVM d'ex&eacute;cution? Les valeurs
                                    de timestamp de la base de donn&eacute;es provoquent une surcharge puisque Hibernate doit interroger la base pour d&eacute;terminer la prochaine
                                    valeur mais cela est plus s&ucirc;r lorsque vous fonctionnez dans un cluster. Remarquez aussi que certains des dialectes ne supportent
                                    pas cette fonction, et que d'autres l'impl&eacute;mentent mal, provoquant des erreurs de pr&eacute;cision (Oracle 8 par exemple). 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(6)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">generated</code> (optional - d&eacute;faut &agrave; <code class="literal">never</code>) : Indique que la valeur de ce timestamp est g&eacute;n&eacute;r&eacute;e par la base de donn&eacute;es cf. <a href="#mapping-generated" title="5.6.&nbsp;Propri&eacute;t&eacute;s g&eacute;n&eacute;r&eacute;es">Section&nbsp;5.6, &laquo;&nbsp;Propri&eacute;t&eacute;s g&eacute;n&eacute;r&eacute;es&nbsp;&raquo;</a>. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Notez que <code class="literal">&lt;timestamp&gt;</code> est &eacute;quivalent &agrave; <code class="literal">&lt;version type="timestamp"&gt;</code>. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-property"></a>5.1.11.&nbsp;property
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>L'&eacute;l&eacute;ment <code class="literal">&lt;property&gt;</code> d&eacute;clare une propri&eacute;t&eacute; de la classe au sens JavaBean. 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;property
        name="propertyName"                                          <span class="co">(1)</span>
        column="column_name"                                         <span class="co">(2)</span>
        type="typename"                                              <span class="co">(3)</span>
        update="true|false"                                          <span class="co">(4)</span>
        insert="true|false"                                          <span class="co">(4)</span>
        formula="arbitrary SQL expression"                           <span class="co">(5)</span>
        access="field|property|ClassName"                            <span class="co">(6)</span>
        lazy="true|false"                                            <span class="co">(7)</span>
        unique="true|false"                                          <span class="co">(8)</span>
        not-null="true|false"                                        <span class="co">(9)</span>
        optimistic-lock="true|false"                                 <span class="co">(10)</span>
        generated="never|insert|always"                              <span class="co">(11)</span>
        node="element-name|@attribute-name|element/@attribute|."
        index="index_name"
        unique_key="unique_key_id"
        length="L"
        precision="P"
        scale="S"
/&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">name</code> : nom de la propri&eacute;t&eacute;, avec une lettre initiale en minuscule. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">column</code> (optionnel - par d&eacute;faut au nom de la propri&eacute;t&eacute;) : le nom de la colonne mapp&eacute;e. Cela peut aussi &ecirc;tre indiqu&eacute; dans le(s) sous-&eacute;l&eacute;ment(s)
                                    <code class="literal">&lt;column&gt;</code>. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">type</code> (optionnel) : nom indiquant le type Hibernate. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">update, insert</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">true</code>) : indique que les colonnes mapp&eacute;es devraient &ecirc;tre incluses dans des <code class="literal">UPDATE</code> SQL et/ou des <code class="literal">INSERT</code>. Mettre les deux &agrave; <code class="literal">false</code> emp&ecirc;che la propagation en base de donn&eacute;es (utile si vous savez qu'un trigger affectera la valeur &agrave; la colonne). 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">formula</code> (optionnel) : une expression SQL qui d&eacute;finit la valeur pour une propri&eacute;t&eacute; <span class="emphasis"><em>calcul&eacute;e</em></span>. Les propri&eacute;t&eacute;s calcul&eacute;es ne poss&egrave;de pas leur propre mapping. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(6)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">access</code> (optional - defaults to <code class="literal">property</code>): The strategy Hibernate should use for accessing the property value. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(7)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">lazy</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">false</code>): Indique que cette propri&eacute;t&eacute; devrait &ecirc;tre charg&eacute;e en diff&eacute;r&eacute; (lazy loading) quand on acc&egrave;de &agrave; la variable d'instance pour
                                    la premi&egrave;re fois. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(8)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">unique</code> (optionnel): G&eacute;n&egrave;re le DDL d'une contrainte d'unicit&eacute; pour les colonnes. Permet aussi d'en faire la cible d'un <code class="literal">property-ref</code>. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(9)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">not-null</code> (optionnel): G&eacute;n&egrave;re le DDL d'une contrainte de non nullit&eacute; pour les colonnes. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(10)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">optimistic-lock</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">true</code>): Indique que les mises &agrave; jour de cette propri&eacute;t&eacute; peuvent ou non n&eacute;cessiter l'acquisition d'un verrou optimiste. En d'autres
                                    termes, cela d&eacute;termine s'il est n&eacute;cessaire d'incr&eacute;menter un num&eacute;ro de version quand cette propri&eacute;t&eacute; est marqu&eacute;e obsol&egrave;te (dirty).
                                    
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(11)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">generated</code> (optional - d&eacute;faut &agrave;<code class="literal">never</code>): Indique que la valeur de ce timestamp est g&eacute;n&eacute;r&eacute;e par la base de donn&eacute;es cf. <a href="#mapping-generated" title="5.6.&nbsp;Propri&eacute;t&eacute;s g&eacute;n&eacute;r&eacute;es">Section&nbsp;5.6, &laquo;&nbsp;Propri&eacute;t&eacute;s g&eacute;n&eacute;r&eacute;es&nbsp;&raquo;</a>. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p><span class="emphasis"><em>typename</em></span> peut &ecirc;tre: 
                  </p>
                  <div class="orderedlist">
                     <ol type="1" compact>
                        <li>
                           <p>Nom d'un type basique Hibernate (ex: <code class="literal">integer, string, character, date, timestamp, float, binary, serializable, object, blob</code>). 
                           </p>
                        </li>
                        <li>
                           <p>Nom d'une classe Java avec un type basique par d&eacute;faut (ex: <code class="literal">int, float, char, java.lang.String, java.util.Date, java.lang.Integer, java.sql.Clob</code>). 
                           </p>
                        </li>
                        <li>
                           <p>Nom d'une classe Java s&eacute;rialisable. </p>
                        </li>
                        <li>
                           <p>Nom d'une classe ayant un type sp&eacute;cifique (ex: <code class="literal">com.illflow.type.MyCustomType</code>). 
                           </p>
                        </li>
                     </ol>
                  </div>
                  <p>Si vous n'indiquez pas un type, Hibernate utlisera la r&eacute;flexion sur le nom de la propri&eacute;t&eacute; pour tenter de trouver le type
                     Hibernate correct. Hibernate essayera d'interpr&ecirc;ter le nom de la classe retourn&eacute;e par le getter de la propri&eacute;t&eacute; en utilisant
                     les r&eacute;gles 2, 3, 4 dans cet ordre. Cependant, ce n'est pas toujours suffisant. Dans certains cas vous aurez encore besoin
                     de l'attribut <code class="literal">type</code> (Par exemple, pour distinguer <code class="literal">Hibernate.DATE</code> et <code class="literal">Hibernate.TIMESTAMP</code>, ou pour pr&eacute;ciser un type sp&eacute;cifique). 
                  </p>
                  <p>L'attribut <code class="literal">access</code> permet de contr&ocirc;ler comment Hibernate acc&egrave;dera &agrave; la propri&eacute;t&eacute; &agrave; l'ex&eacute;cution. Par d&eacute;faut, Hibernate utilisera les m&eacute;thodes
                     set/get. Si vous indiquez <code class="literal">access="field"</code>, Hibernate ignorera les getter/setter et acc&egrave;dera &agrave; la propri&eacute;t&eacute; directement en utilisant la r&eacute;flexion. Vous pouvez sp&eacute;cifier
                     votre propre strat&eacute;gie d'acc&egrave;s aux propri&eacute;t&eacute; en donnant une classe qui impl&eacute;mente l'interface <code class="literal">org.hibernate.property.PropertyAccessor</code>. 
                  </p>
                  <p>Une fonctionnalit&eacute; particuli&egrave;rement int&eacute;ressante est les propri&eacute;t&eacute;s d&eacute;riv&eacute;es. Ces propri&eacute;t&eacute;s sont par d&eacute;finition en lecture
                     seule, la valeur de la propri&eacute;t&eacute; est calcul&eacute;e au chargement. Le calcul est d&eacute;clar&eacute; comme une expression SQL, qui se traduit
                     par une sous-requ&ecirc;te <code class="literal">SELECT</code> dans la requ&ecirc;te SQL qui charge une instance : 
                  </p><pre class="programlisting">
&lt;property name="totalPrice"
    formula="( SELECT SUM (li.quantity*p.price) FROM LineItem li, Product p
                WHERE li.productId = p.productId
                AND li.customerId = customerId
                AND li.orderNumber = orderNumber )"/&gt;</pre><p>Remarquez que vous pouvez r&eacute;f&eacute;rencer la propre table des entit&eacute;s en ne d&eacute;clarant pas un alias sur une colonne particuli&egrave;re
                     (<code class="literal">customerId</code> dans l'exemple donn&eacute;). Notez aussi que vous pouvez utiliser le sous-&eacute;l&eacute;ment de mapping <code class="literal">&lt;formula&gt;</code> plut&ocirc;t que d'utiliser l'attribut si vous le souhaitez. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-manytoone"></a>5.1.12.&nbsp;many-to-one
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une association ordinaire vers une autre classe persistante est d&eacute;clar&eacute;e en utilisant un &eacute;l&eacute;ment <code class="literal">many-to-one</code>. Le mod&egrave;le relationnel est une association de type many-to-one : une clef &eacute;trang&egrave;re dans une table r&eacute;f&eacute;rence la ou les clef(s)
                     primaire(s) dans la table cible. 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;many-to-one
        name="propertyName"                                          <span class="co">(1)</span>
        column="column_name"                                         <span class="co">(2)</span>
        class="ClassName"                                            <span class="co">(3)</span>
        cascade="cascade_style"                                      <span class="co">(4)</span>
        fetch="join|select"                                          <span class="co">(5)</span>
        update="true|false"                                          <span class="co">(6)</span>
        insert="true|false"                                          <span class="co">(6)</span>
        property-ref="propertyNameFromAssociatedClass"               <span class="co">(7)</span>
        access="field|property|ClassName"                            <span class="co">(8)</span>
        unique="true|false"                                          <span class="co">(9)</span>
        not-null="true|false"                                        <span class="co">(10)</span>
        optimistic-lock="true|false"                                 <span class="co">(11)</span>
        lazy="proxy|no-proxy|false"                                  <span class="co">(12)</span>
        not-found="ignore|exception"                                 <span class="co">(13)</span>
        entity-name="EntityName"                                     <span class="co">(14)</span>
        formula="arbitrary SQL expression"                           <span class="co">(15)</span>
        node="element-name|@attribute-name|element/@attribute|."
        embed-xml="true|false"
        index="index_name"
        unique_key="unique_key_id"
        foreign-key="foreign_key_name"
/&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">name</code>: The name of the property. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">column</code> (optional): The name of the foreign key column. This may also be specified by nested <code class="literal">&lt;column&gt;</code> element(s). 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">class</code> (optional - defaults to the property type determined by reflection): The name of the associated class. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">cascade</code> (optionnel) : Indique quelles op&eacute;rations doivent &ecirc;tre propag&eacute;es de l'objet p&egrave;re vers les objets associ&eacute;s. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">fetch</code> (optional - defaults to <code class="literal">select</code>): Chooses between outer-join fetching or sequential select fetching. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(6)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">update, insert</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">true</code>) : indique que les colonnes mapp&eacute;es devraient &ecirc;tre incluses dans des <code class="literal">UPDATE</code> SQL et/ou des <code class="literal">INSERT</code>. Mettre les deux &agrave; <code class="literal">false</code> emp&ecirc;che la propagation en base de donn&eacute;es (utile si vous savez qu'un trigger affectera la valeur &agrave; la colonne). 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(7)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">property-ref</code> : (optionnel) Le nom d'une propri&eacute;t&eacute; de la classe associ&eacute;e qui est li&eacute;e &agrave; cette clef &eacute;trang&egrave;re. Si ce n'est pas sp&eacute;cifi&eacute;,
                                    la clef primaire de la classe associ&eacute;e est utilis&eacute;e. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(8)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">access</code> (optional - defaults to <code class="literal">property</code>): The strategy Hibernate should use for accessing the property value. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(9)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">unique</code> (optionnel) : G&eacute;n&egrave;re le DDL d'une contrainte d'unicit&eacute; pour la clef &eacute;trang&egrave;re. Permet aussi d'en faire la cible d'un <code class="literal">property-ref</code>. Cela permet de cr&eacute;er une v&eacute;ritable association one-to-one. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(10)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">not-null</code> (optionnel) : G&eacute;n&egrave;re le DDL pour une contrainte de non nullit&eacute; pour la clef &eacute;trang&egrave;re. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(11)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">optimistic-lock</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">true</code>) : Indique que les mises &agrave; jour de cette propri&eacute;t&eacute; requi&egrave;rent ou non l'acquisition d'un verrou optimiste. En d'autres termes,
                                    d&eacute;termine si un incr&eacute;ment de version doit avoir lieu quand la propri&eacute;t&eacute; est marqu&eacute;e obsol&egrave;te (dirty). 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(12)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">lazy</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">false</code>) : Indique que cette propri&eacute;t&eacute; doit &ecirc;tre charg&eacute;e en diff&eacute;r&eacute; (lazy loading) au premier acc&egrave;s &agrave; la variable d'instance (n&eacute;cessite
                                    une instrumentation du bytecode lors de la phase de construction). Remarquez que cela n'influence pas le comportement du proxy
                                    Hibernate - comme l'attribut <code class="literal">lazy</code> sur des classes ou des mappings de collections, mais utilise l'interception pour le chargement diff&eacute;r&eacute;. <code class="literal">lazy="false"</code> indique que l'association sera toujours charg&eacute;e. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(13)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">not-found</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">exception</code>) : Indique comment les clefs &eacute;trang&egrave;res qui r&eacute;f&eacute;rencent des lignes manquantes doivent &ecirc;tre manipul&eacute;es : <code class="literal">ignore</code> traitera une ligne manquante comme une association nulle. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(14)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">entity-name</code> (optional): The entity name of the associated class. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(15)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">formula</code> (optionnel) : une expression SQL qui d&eacute;finit la valeur pour une cl&eacute; &eacute;trang&egrave;re calcul&eacute;e. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Donner une valeur significative &agrave; l'attribut <code class="literal">cascade</code> autre que <code class="literal">none</code> propagera certaines op&eacute;rations &agrave; l'objet associ&eacute;. Les valeurs significatives sont les noms des op&eacute;rations Hibernate basiques,
                     <code class="literal">persist, merge, delete, save-update, evict, replicate, lock, refresh</code>, ainsi que les valeurs sp&eacute;ciales <code class="literal">delete-orphan</code> et <code class="literal">all</code> et des combinaisons de noms d'op&eacute;rations s&eacute;par&eacute;es par des virgules, comme par exemple <code class="literal">cascade="persist,merge,evict"</code> ou <code class="literal">cascade="all,delete-orphan"</code>. Voir <a href="#objectstate-transitive" title="10.11.&nbsp;Persistance transitive">Section&nbsp;10.11, &laquo;&nbsp;Persistance transitive&nbsp;&raquo;</a> pour une explication compl&egrave;te. Notez que les assocations many-to-one et one-to-one ne supportent pas orphan delete. 
                  </p>
                  <p>Une d&eacute;claration <code class="literal">many-to-one</code> typique est aussi simple que : 
                  </p><pre class="programlisting">&lt;many-to-one name="product" class="Product" column="PRODUCT_ID"/&gt;</pre><p>L'attribut <code class="literal">property-ref</code> devrait &ecirc;tre utilis&eacute; pour mapper seulement des donn&eacute;es provenant d'un ancien syst&egrave;me o&ugrave; les clefs &eacute;trang&egrave;res font r&eacute;f&eacute;rence
                     &agrave; une clef unique de la table associ&eacute;e et qui n'est pas la clef primaire. C'est un cas de mauvaise conception relationnelle.
                     Par exemple, supposez que la classe <code class="literal">Product</code> a un num&eacute;ro de s&eacute;rie unique qui n'est pas la clef primaire. (L'attribut <code class="literal">unique</code> contr&ocirc;le la g&eacute;n&eacute;ration DDL par Hibernate avec l'outil SchemaExport.) 
                  </p><pre class="programlisting">&lt;property name="serialNumber" unique="true" type="string" column="SERIAL_NUMBER"/&gt;</pre><p>Ainsi le mapping pour <code class="literal">OrderItem</code> peut utiliser : 
                  </p><pre class="programlisting">&lt;many-to-one name="product" property-ref="serialNumber" column="PRODUCT_SERIAL_NUMBER"/&gt;</pre><p>bien que ce ne soit certainement pas encourag&eacute;. </p>
                  <p>Si la clef unique r&eacute;f&eacute;renc&eacute;e comprend des propri&eacute;t&eacute;s multiples de l'entit&eacute; associ&eacute;e, vous devez mapper ces propri&eacute;t&eacute;s &agrave; l'int&eacute;rieur
                     d'un &eacute;l&eacute;ment <code class="literal">&lt;properties&gt;</code>. 
                  </p>
                  <p>one-to-one </p><pre class="programlisting">&lt;many-to-one name="owner" property-ref="identity.ssn" column="OWNER_SSN"/&gt;</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-onetoone"></a>5.1.13.&nbsp;Une association one-to-one vers une autre classe persistante est d&eacute;clar&eacute;e avec l'&eacute;l&eacute;ment <code class="literal">one-to-one</code>.
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p><code class="literal">name</code> : Le nom de la propri&eacute;t&eacute;. 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;one-to-one
        name="propertyName"                                          <span class="co">(1)</span>
        class="ClassName"                                            <span class="co">(2)</span>
        cascade="cascade_style"                                      <span class="co">(3)</span>
        constrained="true|false"                                     <span class="co">(4)</span>
        fetch="join|select"                                          <span class="co">(5)</span>
        property-ref="propertyNameFromAssociatedClass"               <span class="co">(6)</span>
        access="field|property|ClassName"                            <span class="co">(7)</span>
        formula="any SQL expression"                                 <span class="co">(8)</span>
        lazy="proxy|no-proxy|false"                                  <span class="co">(9)</span>
        entity-name="EntityName"                                     <span class="co">(10)</span>
        node="element-name|@attribute-name|element/@attribute|."
        embed-xml="true|false"
        foreign-key="foreign_key_name"
/&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">name</code>: The name of the property. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">class</code> (optional - defaults to the property type determined by reflection): The name of the associated class. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">constrained</code> (optionnel) : Indique qu'une contrainte de clef &eacute;trang&egrave;re sur la clef primaire de la table mapp&eacute;e r&eacute;f&eacute;rence la table de la
                                    classe associ&eacute;e. Cette option affecte l'ordre dans lequel chaque <code class="literal">save()</code> et chaque <code class="literal">delete()</code> sont cascad&eacute;s et d&eacute;termine si l'association peut utiliser un proxy (aussi utilis&eacute; par l'outil d'export de sch&eacute;ma). 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">fetch</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">select</code>) : Choisit entre r&eacute;cup&eacute;ration par jointure externe ou select s&eacute;quentiel. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">fetch</code> (optional - defaults to <code class="literal">select</code>): Chooses between outer-join fetching or sequential select fetching. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(6)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">access</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">property</code>) : La strat&eacute;gie &agrave; utiliser par Hibernate pour acc&eacute;der &agrave; la valeur de la propri&eacute;t&eacute;. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(7)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">access</code> (optional - defaults to <code class="literal">property</code>): The strategy Hibernate should use for accessing the property value. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(8)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">lazy</code> (optionnel - par d&eacute;faut <code class="literal">proxy</code>) : Par d&eacute;faut, les associations simples sont soumise &agrave; proxy. <code class="literal">lazy="no-proxy"</code> sp&eacute;cifie que la propri&eacute;t&eacute; doit &ecirc;tre charg&eacute;e &agrave; la demande au premier acc&egrave;s &agrave; l'instance. (n&eacute;cessite l'intrumentation du bytecode
                                    &agrave; la construction). <code class="literal">lazy="false"</code> indique que l'association sera toujours charg&eacute;e agressivement. <span class="emphasis"><em>Notez que si <code class="literal">constrained="false"</code>, l'utilisation de proxy est impossible et Hibernate chargera automatiquement l'association !</em></span> 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(9)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">entity-name</code> (optional) : The entity name of the associated class. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(10)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">entity-name</code> (optional): The entity name of the associated class. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>associations par clef primaire </p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p>association par clef &eacute;trang&egrave;re unique </p>
                        </li>
                        <li>
                           <p>Les associations par clef primaire ne n&eacute;cessitent pas une colonne suppl&eacute;mentaire en table ; si deux lignes sont li&eacute;s par l'association
                              alors les deux lignes de la table partagent la m&ecirc;me valeur de clef primaire. Donc si vous voulez que deux objets soient li&eacute;s
                              par une association par clef primaire, vous devez faire en sorte qu'on leur assigne la m&ecirc;me valeur d'identifiant ! 
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>Pour une association par clef primaire, ajoutez les mappings suivants &agrave; <code class="literal">Employee</code> et <code class="literal">Person</code>, respectivement. 
                  </p>
                  <p>Maintenant, vous devez faire en sorte que les clefs primaires des lignes li&eacute;es dans les tables PERSON et EMPLOYEE sont &eacute;gales.
                     On utilise une strat&eacute;gie Hibernate sp&eacute;ciale de g&eacute;n&eacute;ration d'identifiants appel&eacute;e <code class="literal">foreign</code> : 
                  </p><pre class="programlisting">&lt;one-to-one name="person" class="Person"/&gt;</pre><pre class="programlisting">&lt;one-to-one name="employee" class="Employee" constrained="true"/&gt;</pre><p>Une instance fra&icirc;chement enregistr&eacute;e de <code class="literal">Person</code> se voit alors assign&eacute;e la m&ecirc;me valeur de clef primaire que l'instance de <code class="literal">Employee</code> r&eacute;f&eacute;renc&eacute;e par la propri&eacute;t&eacute; <code class="literal">employee</code> de cette <code class="literal">Person</code>. 
                  </p><pre class="programlisting">&lt;class name="person" table="PERSON"&gt;
    &lt;id name="id" column="PERSON_ID"&gt;
        &lt;generator class="foreign"&gt;
            &lt;param name="property"&gt;employee&lt;/param&gt;
        &lt;/generator&gt;
    &lt;/id&gt;
    ...
    &lt;one-to-one name="employee"
        class="Employee"
        constrained="true"/&gt;
&lt;/class&gt;</pre><p>Alternativement, une clef &eacute;trang&egrave;re avec contrainte d'unicit&eacute; de <code class="literal">Employee</code> vers <code class="literal">Person</code> peut &ecirc;tre indiqu&eacute;e ainsi : 
                  </p>
                  <p>Et cette association peut &ecirc;tre rendue bidirectionnelle en ajoutant ceci au mapping de <code class="literal">Person</code> : 
                  </p><pre class="programlisting">&lt;many-to-one name="person" class="Person" column="PERSON_ID" unique="true"/&gt;</pre><p>natural-id </p><pre class="programlisting">&lt;one-to-one name="employee" class="Employee" property-ref="person"/&gt;</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-naturalid"></a>5.1.14.&nbsp;Bien que nous recommandions l'utilisation de cl&eacute; primaire g&eacute;n&eacute;r&eacute;e, vous devriez toujours essayer d'identifier des
                              cl&eacute; m&eacute;tier (naturelles) pour toutes vos entit&eacute;s. Une cl&eacute; naturelle est une propri&eacute;t&eacute; ou une combinaison de propri&eacute;t&eacute;s uniques
                              et non nulles. Si elle est aussi immuable, c'est encore mieux. Mappez les propri&eacute;t&eacute;s de la cl&eacute; naturelle dans l'&eacute;l&eacute;ment <code class="literal">&lt;natural-id&gt;</code>. Hibernate g&eacute;n&eacute;rera la cl&eacute; unique n&eacute;cessaire et les contraintes de non-nullit&eacute;, et votre mapping s'auto-documentera.
                           </h3>
                        </div>
                     </div>
                  </div><pre class="programlisting">&lt;natural-id mutable="true|false"/&gt;
        &lt;property ... /&gt;
        &lt;many-to-one ... /&gt;
        ......
&lt;/natural-id&gt;</pre><p>Nous vous recommandons fortement d'impl&eacute;menter <code class="literal">equals()</code> et <code class="literal">hashCode()</code> pour comparer les cl&eacute;s naturelles de l'entit&eacute;. 
                  </p>
                  <p>Ce mapping n'est pas destin&eacute; &agrave; &ecirc;tre utilis&eacute; avec des entit&eacute;s qui ont des cl&eacute;s naturelles. </p>
                  <p><code class="literal">mutable</code> (optionel, par d&eacute;faut &agrave; <code class="literal">false</code>) : Par d&eacute;faut, les identifiants naturels sont suppos&eacute;s &ecirc;tre immuable (constants). 
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc" compact>
                        <li>
                           <p>component, dynamic-component </p>
                        </li>
                     </ul>
                  </div>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-component"></a>5.1.15.&nbsp;L'&eacute;l&eacute;ment <code class="literal">&lt;component&gt;</code> mappe les propri&eacute;t&eacute;s d'un objet fils aux colonnes d'une classe parente. Les composants peuvent en retour d&eacute;clarer leurs propres
                              propri&eacute;t&eacute;s, composants ou collections. Voir "Components" plus bas.
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p><code class="literal">name</code> : Nom de la propri&eacute;t&eacute; 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;component
        name="propertyName"                 <span class="co">(1)</span>
        class="className"                   <span class="co">(2)</span>
        insert="true|false"                 <span class="co">(3)</span>
        update="true|false"                 <span class="co">(4)</span>
        access="field|property|ClassName"   <span class="co">(5)</span>
        lazy="true|false"                   <span class="co">(6)</span>
        optimistic-lock="true|false"        <span class="co">(7)</span>
        unique="true|false"                 <span class="co">(8)</span>
        node="element-name|."
&gt;

        &lt;property ...../&gt;
        &lt;many-to-one .... /&gt;
        ........
&lt;/component&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">name</code>: The name of the property. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">insert</code> : Est ce que les colonnes mapp&eacute;es apparaissent dans les <code class="literal">INSERT</code>s ? 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">insert</code>: Do the mapped columns appear in SQL <code class="literal">INSERT</code>s? 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">update</code>: Do the mapped columns appear in SQL <code class="literal">UPDATE</code>s? 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">access</code> (optional - defaults to <code class="literal">property</code>): The strategy Hibernate should use for accessing the property value. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(6)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">optimistic-lock</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">true</code>) : Indique que les mises &agrave; jour sur ce composant n&eacute;cessitent ou non l'acquisition d'un verrou optimiste. En d'autres termes,
                                    cela d&eacute;termine si une incr&eacute;mentation de version doit avoir lieu quand la propri&eacute;t&eacute; est marqu&eacute;e obsol&egrave;te (dirty). 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(7)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">unique</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">false</code>) : Indique qu'une contrainte d'unicit&eacute; existe sur toutes les colonnes mapp&eacute;es de ce composant. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(8)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">unique</code> (optional - defaults to <code class="literal">false</code>): Specifies that a unique constraint exists upon all mapped columns of the component. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>L'&eacute;l&eacute;ment <code class="literal">&lt;component&gt;</code> permet de d&eacute;clarer sous-&eacute;l&eacute;ment <code class="literal">&lt;parent&gt;</code> qui associe une propri&eacute;t&eacute; de la classe composant comme une r&eacute;f&eacute;rence arri&egrave;re vers l'entit&eacute; contenante. 
                  </p>
                  <p>L'&eacute;l&eacute;ment <code class="literal">&lt;dynamic-component&gt;</code> permet &agrave; une <code class="literal">Map</code> d'&ecirc;tre mapp&eacute;e comme un composant, quand les noms de la propri&eacute;t&eacute; font r&eacute;f&eacute;rence aux clefs de cette Map, voir <a href="#components-dynamic" title="8.5.&nbsp;Composant Dynamique">Section&nbsp;8.5, &laquo;&nbsp;Composant Dynamique&nbsp;&raquo;</a>. 
                  </p>
                  <p>properties </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-properties"></a>5.1.16.&nbsp;L'&eacute;l&eacute;ment <code class="literal">&lt;properties&gt;</code> permet la d&eacute;finition d'un groupement logique nomm&eacute; des propri&eacute;t&eacute;s d'une classe. L'utilisation la plus importante de cette
                              construction est la possibilit&eacute; pour une combinaison de propri&eacute;t&eacute;s d'&ecirc;tre la cible d'un <code class="literal">property-ref</code>. C'est aussi un moyen pratique de d&eacute;finir une contrainte d'unicit&eacute; multi-colonnes.
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p><code class="literal">name</code> : Le nom logique d'un regroupement et <span class="emphasis"><em>non</em></span> le v&eacute;ritable nom d'une propri&eacute;t&eacute;. 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;properties
        name="logicalName"                  <span class="co">(1)</span>
        insert="true|false"                 <span class="co">(2)</span>
        update="true|false"                 <span class="co">(3)</span>
        optimistic-lock="true|false"        <span class="co">(4)</span>
        unique="true|false"                 <span class="co">(5)</span>
&gt;

        &lt;property ...../&gt;
        &lt;many-to-one .... /&gt;
        ........
&lt;/properties&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">insert</code> : Est-ce que les colonnes mapp&eacute;es apparaissent dans les <code class="literal">INSERT</code>s ? 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">insert</code>: Do the mapped columns appear in SQL <code class="literal">INSERT</code>s? 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">update</code>: Do the mapped columns appear in SQL <code class="literal">UPDATE</code>s? 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">unique</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">false</code>) : Indique qu'une contrainte d'unicit&eacute; existe sur toutes les colonnes mapp&eacute;es de ce composant. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">unique</code> (optional - defaults to <code class="literal">false</code>): Specifies that a unique constraint exists upon all mapped columns of the component. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Alors nous pourrions avoir une association sur des donn&eacute;es d'un ancien syst&egrave;me (legacy) qui font r&eacute;f&eacute;rence &agrave; cette clef unique
                     de la table <code class="literal">Person</code> au lieu de la clef primaire : 
                  </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="personNumber"/&gt;
    ...
    &lt;properties name="name"
            unique="true" update="false"&gt;
        &lt;property name="firstName"/&gt;
        &lt;property name="initial"/&gt;
        &lt;property name="lastName"/&gt;
    &lt;/properties&gt;
&lt;/class&gt;</pre><p>Nous ne recommandons pas l'utilisation de ce genre de chose en dehors du contexte de mapping de donn&eacute;es h&eacute;rit&eacute;es d'anciens
                     syst&egrave;mes. 
                  </p><pre class="programlisting">&lt;many-to-one name="person"
         class="Person" property-ref="name"&gt;
    &lt;column name="firstName"/&gt;
    &lt;column name="initial"/&gt;
    &lt;column name="lastName"/&gt;
&lt;/many-to-one&gt;</pre><p>subclass </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-subclass"></a>5.1.17.&nbsp;Pour finir, la persistance polymorphique n&eacute;cessite la d&eacute;claration de chaque sous-classe de la classe persistante de
                              base. pour la strat&eacute;gie de mapping de type table-per-class-hierarchy, on utilise la d&eacute;claration <code class="literal">&lt;subclass&gt;</code>.
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p><code class="literal">name</code> : Le nom complet de la sous-classe. 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;subclass
        name="ClassName"                              <span class="co">(1)</span>
        discriminator-value="discriminator_value"     <span class="co">(2)</span>
        proxy="ProxyInterface"                        <span class="co">(3)</span>
        lazy="true|false"                             <span class="co">(4)</span>
        dynamic-update="true|false"
        dynamic-insert="true|false"
        entity-name="EntityName"
        node="element-name"
        extends="SuperclassName"&gt;

        &lt;property .... /&gt;
        .....
&lt;/subclass&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">name</code>: The fully qualified class name of the subclass. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">proxy</code> (optionnel) : Indique une classe ou interface &agrave; utiliser pour les chargements &agrave; la demande des proxies (lazy). 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">proxy</code> (optional): Specifies a class or interface to use for lazy initializing proxies. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">lazy</code> (optional, defaults to <code class="literal">true</code>): Setting <code class="literal">lazy="false"</code> disables the use of lazy fetching. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Pour plus d'infos sur le mapping d'h&eacute;ritage, voir <a href="#inheritance" title="Chapitre&nbsp;9.&nbsp;Mapping d'h&eacute;ritage de classe">Chapitre&nbsp;9, <i xmlns:xlink="http://www.w3.org/1999/xlink">Mapping d'h&eacute;ritage de classe</i></a>. 
                  </p>
                  <p>Pour des informations sur les mappings d'h&eacute;ritage, voir <a href="#inheritance" title="Chapitre&nbsp;9.&nbsp;Mapping d'h&eacute;ritage de classe">Chapitre&nbsp;9, <i xmlns:xlink="http://www.w3.org/1999/xlink">Mapping d'h&eacute;ritage de classe</i></a>. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-joinedsubclass"></a>5.1.18.&nbsp;joined-subclass
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une autre fa&ccedil;on possible de faire est la suivante, chaque sous-classe peut &ecirc;tre mapp&eacute;e vers sa propre table (strat&eacute;gie de
                     mapping de type table-per-subclass). L'&eacute;tat h&eacute;rit&eacute; est r&eacute;cup&eacute;r&eacute; en joignant la table de la super-classe. L'&eacute;l&eacute;ment <code class="literal">&lt;joined-subclass&gt;</code> est utilis&eacute;. 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;joined-subclass
        name="ClassName"                    <span class="co">(1)</span>
        table="tablename"                   <span class="co">(2)</span>
        proxy="ProxyInterface"              <span class="co">(3)</span>
        lazy="true|false"                   <span class="co">(4)</span>
        dynamic-update="true|false"
        dynamic-insert="true|false"
        schema="schema"
        catalog="catalog"
        extends="SuperclassName"
        persister="ClassName"
        subselect="SQL expression"
        entity-name="EntityName"
        node="element-name"&gt;

        &lt;key .... &gt;

        &lt;property .... /&gt;
        .....
&lt;/joined-subclass&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">name</code>: The fully qualified class name of the subclass. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">table</code>: The name of the subclass table. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">proxy</code> (optional): Specifies a class or interface to use for lazy initializing proxies. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">lazy</code> (optional, defaults to <code class="literal">true</code>): Setting <code class="literal">lazy="false"</code> disables the use of lazy fetching. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Aucune colonne discriminante n'est n&eacute;cessaire pour cette strat&eacute;gie de mapping. Cependant, chaque sous-classe doit d&eacute;clarer
                     une colonne de table contenant l'objet identifiant qui utilise l'&eacute;l&eacute;ment <code class="literal">&lt;key&gt;</code>. Le mapping au d&eacute;but de ce chapitre serait r&eacute;-&eacute;crit ainsi : 
                  </p><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"&gt;

&lt;hibernate-mapping package="eg"&gt;

        &lt;class name="Cat" table="CATS"&gt;
                &lt;id name="id" column="uid" type="long"&gt;
                        &lt;generator class="hilo"/&gt;
                &lt;/id&gt;
                &lt;property name="birthdate" type="date"/&gt;
                &lt;property name="color" not-null="true"/&gt;
                &lt;property name="sex" not-null="true"/&gt;
                &lt;property name="weight"/&gt;
                &lt;many-to-one name="mate"/&gt;
                &lt;set name="kittens"&gt;
                        &lt;key column="MOTHER"/&gt;
                        &lt;one-to-many class="Cat"/&gt;
                &lt;/set&gt;
                &lt;joined-subclass name="DomesticCat" table="DOMESTIC_CATS"&gt;
                    &lt;key column="CAT"/&gt;
                    &lt;property name="name" type="string"/&gt;
                &lt;/joined-subclass&gt;
        &lt;/class&gt;

        &lt;class name="eg.Dog"&gt;
                &lt;!-- mapping for Dog could go here --&gt;
        &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre><p>Pour des informations sur les mappings d'h&eacute;ritage, voir <a href="#inheritance" title="Chapitre&nbsp;9.&nbsp;Mapping d'h&eacute;ritage de classe">Chapitre&nbsp;9, <i xmlns:xlink="http://www.w3.org/1999/xlink">Mapping d'h&eacute;ritage de classe</i></a>. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-unionsubclass"></a>5.1.19.&nbsp;union-subclass
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une troisi&egrave;me option est de seulement mapper vers des tables les classes concr&egrave;tes d'une hi&eacute;rarchie d'h&eacute;ritage, (strat&eacute;gie
                     de type table-per-concrete-class) o&ugrave; chaque table d&eacute;finit tous les &eacute;tats persistants de la classe, y compris les &eacute;tats h&eacute;rit&eacute;s.
                     Dans Hibernate il n'est absolument pas n&eacute;cessaire de mapper explicitement de telles hi&eacute;rarchies d'h&eacute;ritage. Vous pouvez simplement
                     mapper chaque classe avec une d&eacute;claration <code class="literal">&lt;class&gt;</code> diff&eacute;rente. Cependant, si vous souhaitez utiliser des associations polymorphiques (c&agrave;d une association vers la superclasse
                     de la hi&eacute;rarchie), vous devez utiliser le mapping <code class="literal">&lt;union-subclass&gt;</code>. 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;union-subclass
        name="ClassName"                    <span class="co">(1)</span>
        table="tablename"                   <span class="co">(2)</span>
        proxy="ProxyInterface"              <span class="co">(3)</span>
        lazy="true|false"                   <span class="co">(4)</span>
        dynamic-update="true|false"
        dynamic-insert="true|false"
        schema="schema"
        catalog="catalog"
        extends="SuperclassName"
        abstract="true|false"
        persister="ClassName"
        subselect="SQL expression"
        entity-name="EntityName"
        node="element-name"&gt;

        &lt;property .... /&gt;
        .....
&lt;/union-subclass&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">name</code>: The fully qualified class name of the subclass. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">table</code>: The name of the subclass table. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">proxy</code> (optional): Specifies a class or interface to use for lazy initializing proxies. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">lazy</code> (optional, defaults to <code class="literal">true</code>): Setting <code class="literal">lazy="false"</code> disables the use of lazy fetching. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Aucune colonne discriminante ou colonne clef n'est requise pour cette strat&eacute;gie de mapping. </p>
                  <p>Pour des informations sur les mappings d'h&eacute;ritage, voir <a href="#inheritance" title="Chapitre&nbsp;9.&nbsp;Mapping d'h&eacute;ritage de classe">Chapitre&nbsp;9, <i xmlns:xlink="http://www.w3.org/1999/xlink">Mapping d'h&eacute;ritage de classe</i></a>. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-join"></a>5.1.20.&nbsp;join
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>En utilisant l'&eacute;l&eacute;ment <code class="literal">&lt;join&gt;</code>, il est possible de mapper des propri&eacute;t&eacute;s d'une classe sur plusieurs tables. 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;join
        table="tablename"                        <span class="co">(1)</span>
        schema="owner"                           <span class="co">(2)</span>
        catalog="catalog"                        <span class="co">(3)</span>
        fetch="join|select"                      <span class="co">(4)</span>
        inverse="true|false"                     <span class="co">(5)</span>
        optional="true|false"&gt;                   <span class="co">(6)</span>

        &lt;key ... /&gt;

        &lt;property ... /&gt;
        ...
&lt;/join&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">table</code> : Le nom de la table jointe. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">schema</code> (optional): Override the schema name specified by the root <code class="literal">&lt;hibernate-mapping&gt;</code> element. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">catalog</code> (optional): Override the catalog name specified by the root <code class="literal">&lt;hibernate-mapping&gt;</code> element. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">fetch</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">join</code>) : Si positionn&eacute; &agrave; <code class="literal">join</code>, Hibernate utilisera une jointure interne pour charger une <code class="literal">jointure</code> d&eacute;finie par une classe ou ses super-classes et une jointure externe pour une <code class="literal">&lt;jointure&gt;</code> d&eacute;finie par une sous-classe. Si positionn&eacute; &agrave; <code class="literal">select</code> alors Hibernate utilisera un select s&eacute;quentiel pour une <code class="literal">&lt;jointure&gt;</code> d&eacute;finie sur une sous-classe, qui ne sera d&eacute;livr&eacute;e que si une ligne se repr&eacute;sente une instance de la sous-classe. Les jointures
                                    internes seront quand m&ecirc;me utilis&eacute;es pour charger une <code class="literal">&lt;jointure&gt;</code> d&eacute;finie par une classe et ses super-classes. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">inverse</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">false</code>) : Si positionn&eacute; &agrave; true, Hibernate n'essaiera pas d'ins&eacute;rer ou de mettre &agrave; jour les propri&eacute;t&eacute;s d&eacute;finies par cette jointure.
                                    
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(6)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">optionnel</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">false</code>) : Si positionn&eacute; &agrave; true, Hibernate ins&egrave;rera une ligne seulement si les propri&eacute;t&eacute;s d&eacute;finies par cette jointure sont non-nulles
                                    et utilisera toujours une jointure externe pour charger les propri&eacute;t&eacute;s. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Par exemple, les informations d'adresse pour une personne peuvent &ecirc;tre mapp&eacute;es vers une table s&eacute;par&eacute;e (tout en pr&eacute;servant
                     des s&eacute;mantiques de type valeur pour toutes ses propri&eacute;t&eacute;s) : 
                  </p><pre class="programlisting">&lt;class name="Person"
    table="PERSON"&gt;

    &lt;id name="id" column="PERSON_ID"&gt;...&lt;/id&gt;

    &lt;join table="ADDRESS"&gt;
        &lt;key column="ADDRESS_ID"/&gt;
        &lt;property name="address"/&gt;
        &lt;property name="zip"/&gt;
        &lt;property name="country"/&gt;
    &lt;/join&gt;
    ...</pre><p>Cette fonctionnalit&eacute; est souvent seulement utile pour les mod&egrave;les de donn&eacute;es h&eacute;rit&eacute;s d'anciens syst&egrave;mes (legacy), nous recommandons
                     d'utiliser moins de tables que de classes et un mod&egrave;le de domaine &agrave; granularit&eacute; fine. Cependant, c'est utile pour passer d'une
                     strat&eacute;gie de mapping d'h&eacute;ritage &agrave; une autre dans une hi&eacute;rarchie simple ainsi qu'il est expliqu&eacute; plus tard. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-key"></a>5.1.21.&nbsp;key
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Nous avons rencontr&eacute; l'&eacute;l&eacute;ment <code class="literal">&lt;key&gt;</code> &agrave; plusieurs reprises maintenant. Il appara&icirc;t partout que l'&eacute;l&eacute;ment de mapping parent d&eacute;finit une jointure sur une nouvele
                     table, et d&eacute;finit la clef &eacute;trang&egrave;re dans la table jointe, ce qui r&eacute;f&eacute;rence la clef primaire de la table d'origine. 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;key
        column="columnname"                      <span class="co">(1)</span>
        on-delete="noaction|cascade"             <span class="co">(2)</span>
        property-ref="propertyName"              <span class="co">(3)</span>
        not-null="true|false"                    <span class="co">(4)</span>
        update="true|false"                      <span class="co">(5)</span>
        unique="true|false"                      <span class="co">(6)</span>
/&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">column</code> (optional): The name of the foreign key column. This may also be specified by nested <code class="literal">&lt;column&gt;</code> element(s). 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">on-delete</code> (optionnel, par d&eacute;faut &agrave; <code class="literal">noaction</code>) : Indique si la contrainte de clef &eacute;trang&egrave;re poss&egrave;de la possibilit&eacute; au niveau base de donn&eacute;es de suppression en cascade.
                                    
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">property-ref</code> (optionnel) : Indique que la clef &eacute;trang&egrave;re fait r&eacute;f&eacute;rence &agrave; des colonnes qui ne sont pas la clef primaire de la table d'origine
                                    (Pour les donn&eacute;es de syst&egrave;mes legacy). 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">not-null</code> (optionnel) : Indique que les colonnes des clefs &eacute;trang&egrave;res ne peuvent pas &ecirc;tre nulles (c'est implicite si la clef &eacute;trang&egrave;re
                                    fait partie de la clef primaire). 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">update</code> (optionnel) : Indique que la clef &eacute;trang&egrave;re ne devrait jamais &ecirc;tre mise &agrave; jour (implicite si celle-ci fait partie de la clef
                                    primaire). 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(6)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">unique</code> (optionnel) : Indique que la clef &eacute;trang&egrave;re doit poss&eacute;der une contrainte d'unicit&eacute; (implicite si la clef &eacute;trang&egrave;re est aussi
                                    la clef primaire). 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Nous recommandons pour les syst&egrave;mes o&ugrave; les suppressions doivent &ecirc;tre performantes de d&eacute;finir toutes les clefs <code class="literal">on-delete="cascade"</code>, ainsi Hibernate utilisera une contrainte <code class="literal">ON CASCADE DELETE</code> au niveau base de donn&eacute;es, plut&ocirc;t que de nombreux <code class="literal">DELETE</code> individuels. Attention, cette fonctionnalit&eacute; court-circuite la strat&eacute;gie habituelle de verrou optimiste pour les donn&eacute;es
                     versionn&eacute;es. 
                  </p>
                  <p>Les attributs <code class="literal">not-null</code> et <code class="literal">update</code> sont utiles pour mapper une association one-to-many unidirectionnelle. Si vous mappez un one-to-many unidirectionnel vers
                     une clef &eacute;trang&egrave;re non nulle, vous <span class="emphasis"><em>devez</em></span> d&eacute;clarer la colonne de la clef en utilisant <code class="literal">&lt;key not-null="true"&gt;</code>. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-column"></a>5.1.22.&nbsp;&eacute;l&eacute;ments column et formula
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Tout &eacute;l&eacute;ment de mapping qui accepte un attribut <code class="literal">column</code> acceptera alternativement un sous-&eacute;l&eacute;ment <code class="literal">&lt;column&gt;</code>. De fa&ccedil;on identique, <code class="literal">&lt;formula&gt;</code> est une alternative &agrave; l'attribut <code class="literal">formula</code>. 
                  </p><pre class="programlisting">&lt;column
        name="column_name"
        length="N"
        precision="N"
        scale="N"
        not-null="true|false"
        unique="true|false"
        unique-key="multicolumn_unique_key_name"
        index="index_name"
        sql-type="sql_type_name"
        check="SQL expression"
        default="SQL expression"/&gt;</pre><pre class="programlisting">&lt;formula&gt;SQL expression&lt;/formula&gt;</pre><p>Les attributs <code class="literal">column</code> et <code class="literal">formula</code> peuvent m&ecirc;me &ecirc;tre combin&eacute;s au sein d'une m&ecirc;me propri&eacute;t&eacute; ou mapping d'association pour exprimer, par exemple, des conditions
                     de jointure exotiques. 
                  </p><pre class="programlisting">&lt;many-to-one name="homeAddress" class="Address"
        insert="false" update="false"&gt;
    &lt;column name="person_id" not-null="true" length="10"/&gt;
    &lt;formula&gt;'MAILING'&lt;/formula&gt;
&lt;/many-to-one&gt;</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-declaration-import"></a>5.1.23.&nbsp;import
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Supposez que votre application poss&egrave;de deux classes persistantes du m&ecirc;me nom, et vous ne voulez pas pr&eacute;ciser le nom Java complet
                     (packages inclus) dans les queries Hibernate. Les classes peuvent alors &ecirc;tre "import&eacute;es" explicitement plut&ocirc;t que de compter
                     sur <code class="literal">auto-import="true"</code>.Vous pouvez m&ecirc;me importer des classes et interfaces qui ne sont pas mapp&eacute;es explicitement. 
                  </p><pre class="programlisting">&lt;import class="java.lang.Object" rename="Universe"/&gt;</pre><div class="programlistingco"><pre class="programlisting">&lt;import
        class="ClassName"              <span class="co">(1)</span>
        rename="ShortName"             <span class="co">(2)</span>
/&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">class</code> : Nom Java complet de la classe. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">rename</code> (optionnel - par d&eacute;faut vaut le nom de la classe Java (sans package)) : Nom pouvant &ecirc;tre utilis&eacute; dans le langage de requ&ecirc;te.
                                    
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-types-anymapping"></a>5.1.24.&nbsp;any
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Il existe encore un type de mapping de propri&eacute;t&eacute;. L'&eacute;l&eacute;ment de mapping <code class="literal">&lt;any&gt;</code> d&eacute;finit une association polymorphique vers des classes de tables multiples. Ce type de mapping requiert toujours plus d'une
                     colonne. La premi&egrave;re colonne contient le type de l'entit&eacute; associ&eacute;e. Les colonnes restantes contiennent l'identifiant. il est
                     impossible de sp&eacute;cifier une contrainte de clef &eacute;trang&egrave;re pour ce type d'association, donc ce n'est certainement pas consid&eacute;r&eacute;
                     comme le moyen habituel de mapper des associations (polymorphiques). Vous devriez utiliser cela uniquement dans des cas particuliers
                     (par exemple des logs d'audit, des donn&eacute;es de session utilisateur, etc...). 
                  </p>
                  <p>L'attribut <code class="literal">meta-type</code> permet &agrave; l'application de sp&eacute;cifier un type personnalis&eacute; qui mappe des valeurs de colonnes de le base de donn&eacute;es sur des
                     classes persistantes qui ont un attribut identifiant du type sp&eacute;cifi&eacute; par <code class="literal">id-type</code>. Vous devez sp&eacute;cifier le mapping &agrave; partir de valeurs du m&eacute;ta-type sur les noms des classes. 
                  </p><pre class="programlisting">&lt;any name="being" id-type="long" meta-type="string"&gt;
    &lt;meta-value value="TBL_ANIMAL" class="Animal"/&gt;
    &lt;meta-value value="TBL_HUMAN" class="Human"/&gt;
    &lt;meta-value value="TBL_ALIEN" class="Alien"/&gt;
    &lt;column name="table_name"/&gt;
    &lt;column name="id"/&gt;
&lt;/any&gt;</pre><div class="programlistingco"><pre class="programlisting">&lt;any
        name="propertyName"                      <span class="co">(1)</span>
        id-type="idtypename"                     <span class="co">(2)</span>
        meta-type="metatypename"                 <span class="co">(3)</span>
        cascade="cascade_style"                  <span class="co">(4)</span>
        access="field|property|ClassName"        <span class="co">(5)</span>
        optimistic-lock="true|false"             <span class="co">(6)</span>
&gt;
        &lt;meta-value ... /&gt;
        &lt;meta-value ... /&gt;
        .....
        &lt;column .... /&gt;
        &lt;column .... /&gt;
        .....
&lt;/any&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">name</code> : le nom de la propri&eacute;t&eacute;. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">id-type</code> : le type identifiant. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">meta-type</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">string</code>) : Tout type permis pour un mapping par discriminateur. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">cascade</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">none</code>) : le style de cascade. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">access</code> (optional - defaults to <code class="literal">property</code>): The strategy Hibernate should use for accessing the property value. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(6)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">optimistic-lock</code> (optionnel - par d&eacute;faut &agrave; <code class="literal">true</code>) : Indique que les mises &agrave; jour sur cette propri&eacute;t&eacute; n&eacute;cessitent ou non l'acquisition d'un verrou optimiste. En d'autres termes,
                                    d&eacute;finit si un incr&eacute;ment de version doit avoir lieu quand cette propri&eacute;t&eacute; est marqu&eacute;e dirty. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="mapping-types"></a>5.2.&nbsp;Hibernate Types
                        </h2>
                     </div>
                  </div>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-types-entitiesvalues"></a>5.2.1.&nbsp;Entit&eacute;s et valeurs
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Pour comprendre le comportement des diff&eacute;rents objets Java par rapport au service de persistance, nous avons besoin de les
                     classer en deux groupes : 
                  </p>
                  <p>Une <span class="emphasis"><em>entit&eacute;</em></span> existe ind&eacute;pendamment de tout autre objet poss&eacute;dant une r&eacute;f&eacute;rence vers l'entit&eacute;. Comparez cela avec le mod&egrave;le Java habituel
                     o&ugrave; un objet est supprim&eacute; par le garbage collector d&egrave;s qu'il n'est plus r&eacute;f&eacute;renc&eacute;. Les entit&eacute;s doivent &ecirc;tre explicitement enregistr&eacute;es
                     et supprim&eacute;es (sauf dans les cas o&ugrave; sauvegardes et suppressions sont <span class="emphasis"><em>cascad&eacute;es</em></span> d'une entit&eacute; m&egrave;re vers ses enfants). C'est diff&eacute;rent du mod&egrave;le ODMG de persistance par atteignabilit&eacute; - et correspond mieux
                     &agrave; la fa&ccedil;on dont les objets sont habituellement utilis&eacute;s dans des grands syst&egrave;mes. Les entit&eacute;s permettent les r&eacute;f&eacute;rences circulaires
                     et partag&eacute;es. Elles peuvent aussi &ecirc;tre versionn&eacute;es. 
                  </p>
                  <p>L'&eacute;tat persistant d'une entit&eacute; consiste en des r&eacute;f&eacute;rences vers d'autres entit&eacute;s et instances de types <span class="emphasis"><em>valeurs</em></span>. Ces valeurs sont des types primitifs, des collections (et non le contenu d'une collection), des composants de certains objets
                     immuables. Contrairement aux entit&eacute;s, les valeurs (et en particulier les collections et composants) <span class="emphasis"><em>sont</em></span> persist&eacute;s par atteignabiliit&eacute;. Comme les valeurs (et types primitifs) sont persist&eacute;s et supprim&eacute;s avec l'entit&eacute; qui les contient,
                     ils ne peuvent pas poss&eacute;der leurs propres versions. Les valeurs n'ont pas d'identit&eacute; ind&eacute;pendantes, ainsi elles ne peuvent
                     pas &ecirc;tre partag&eacute;es par deux entit&eacute;s ou collections. 
                  </p>
                  <p>Jusqu'&agrave; pr&eacute;sent nous avons utilis&eacute; le terme "classe persistante" pour parler d'entit&eacute;s. Nous allons continuer &agrave; faire ainsi.
                     Cependant, au sens strict, toutes les classes d&eacute;finies par un utilisateur poss&eacute;dant un &eacute;tat persistant ne sont pas des entit&eacute;s.
                     Un <span class="emphasis"><em>composant</em></span> est une classe d&eacute;finie par un utilisateur avec les caract&eacute;ristiques d'une valeur. Une propri&eacute;t&eacute; Java de type <code class="literal">java.lang.String</code> a aussi les caract&eacute;ristiques d'une valeur. Given this definition, we can say that all types (classes) provided by the JDK
                     have value type semantics in Java, while user-defined types may be mapped with entity or value type semantics. This decision
                     is up to the application developer. A good hint for an entity class in a domain model are shared references to a single instance
                     of that class, while composition or aggregation usually translates to a value type. 
                  </p>
                  <p>Nous nous pencherons sur ces deux concepts tout au long de la documentation. </p>
                  <p>Le d&eacute;fi est de mapper les type Javas (et la d&eacute;finition des d&eacute;veloppeurs des entit&eacute;s et valeurs types) sur les types du SQL
                     ou des bases de donn&eacute;es. Le pont entre les deux syst&egrave;mes est propos&eacute; par Hibernate : pour les entit&eacute;s nous utilisons <code class="literal">&lt;class&gt;</code>, <code class="literal">&lt;subclass&gt;</code> et ainsi de suite. Pour les types valeurs nous utilisons <code class="literal">&lt;property&gt;</code>, <code class="literal">&lt;component&gt;</code>, etc., habituellement avec un attribut <code class="literal">type</code>. La valeur de cet attribut est le nom d'un <span class="emphasis"><em>type de mapping</em></span> Hibernate. Hibernate propose de base de nombreux mappings (pour les types de valeurs standards du JDK). Vous pouvez &eacute;crire
                     vos propres types de mappings et impl&eacute;menter aussi vos propres strat&eacute;gies de conversion, nous le verrons plus tard. 
                  </p>
                  <p>Tous les types propos&eacute;s de base par Hibernate &agrave; part les collections autorisent la valeur null. </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-types-basictypes"></a>5.2.2.&nbsp;Basic value types
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>The built-in <span class="emphasis"><em>basic mapping types</em></span> may be roughly categorized into 
                  </p>
                  <div class="variablelist">
                     <dl>
                        <dt><span class="term"><code class="literal">integer, long, short, float, double, character, byte, boolean, yes_no, true_false</code></span></dt>
                        <dd>
                           <p>Les mappings de type des primitives Java ou leurs classes wrappers (ex: Integer pour int) vers les types SQL (propri&eacute;taires)
                              appropri&eacute;s. <code class="literal">boolean, yes_no</code>et <code class="literal">true_false</code> sont tous des alternatives pour les types Java <code class="literal">boolean</code> ou <code class="literal">java.lang.Boolean</code>. 
                           </p>
                        </dd>
                        <dt><span class="term"><code class="literal">string</code></span></dt>
                        <dd>
                           <p>Mapping de type de <code class="literal">java.lang.String</code> vers <code class="literal">VARCHAR</code> (ou le <code class="literal">VARCHAR2</code> Oracle). 
                           </p>
                        </dd>
                        <dt><span class="term"><code class="literal">date, time, timestamp</code></span></dt>
                        <dd>
                           <p>Mappings de type pour <code class="literal">java.util.Date</code> et ses sous-classes vers les types SQL <code class="literal">DATE</code>, <code class="literal">TIME</code> et <code class="literal">TIMESTAMP</code> (ou &eacute;quivalent). 
                           </p>
                        </dd>
                        <dt><span class="term"><code class="literal">calendar, calendar_date</code></span></dt>
                        <dd>
                           <p>Mappings de type pour <code class="literal">java.util.Calendar</code> vers les types SQL <code class="literal">TIMESTAMP</code> et <code class="literal">DATE</code> (ou &eacute;quivalent). 
                           </p>
                        </dd>
                        <dt><span class="term"><code class="literal">big_decimal, big_integer</code></span></dt>
                        <dd>
                           <p>Mappings de type pour <code class="literal">java.math.BigDecimal</code> et <code class="literal">java.math.BigInteger</code> vers <code class="literal">NUMERIC</code> (ou le <code class="literal">NUMBER</code> Oracle). 
                           </p>
                        </dd>
                        <dt><span class="term"><code class="literal">locale, timezone, currency</code></span></dt>
                        <dd>
                           <p>Mappings de type pour <code class="literal">java.util.Locale</code>, <code class="literal">java.util.TimeZone</code> et <code class="literal">java.util.Currency</code> vers <code class="literal">VARCHAR</code> (ou le <code class="literal">VARCHAR2</code> Oracle). Les instances de <code class="literal">Locale</code> et <code class="literal">Currency</code> sont mapp&eacute;es sur leurs codes ISO. Les instances de <code class="literal">TimeZone</code> sont mapp&eacute;es sur leur <code class="literal">ID</code>. 
                           </p>
                        </dd>
                        <dt><span class="term"><code class="literal">class</code></span></dt>
                        <dd>
                           <p>Un type de mapping pour <code class="literal">java.lang.Class</code> vers <code class="literal">VARCHAR</code> (ou le <code class="literal">VARCHAR2</code> Oracle). Un objet <code class="literal">Class</code> est mapp&eacute; sur son nom Java complet. 
                           </p>
                        </dd>
                        <dt><span class="term"><code class="literal">binary</code></span></dt>
                        <dd>
                           <p>Mappe les tableaux de bytes vers le type binaire SQL appropri&eacute;. </p>
                        </dd>
                        <dt><span class="term"><code class="literal">text</code></span></dt>
                        <dd>
                           <p>Mappe les longues cha&icirc;nes de caract&egrave;res Java vers les types SQL <code class="literal">CLOB</code> ou <code class="literal">TEXT</code>. 
                           </p>
                        </dd>
                        <dt><span class="term"><code class="literal">serializable</code></span></dt>
                        <dd>
                           <p>Mappe les types Java s&eacute;rialisables vers le type SQL binaire appropri&eacute;. Vous pouvez aussi indiquer le type Hibernate <code class="literal">serializable</code> avec le nom d'une classe Java s&eacute;rialisable ou une interface qui ne soit pas par d&eacute;faut un type de base. 
                           </p>
                        </dd>
                        <dt><span class="term"><code class="literal">clob, blob</code></span></dt>
                        <dd>
                           <p>Mappings de type pour les classes JDBC <code class="literal">java.sql.Clob</code> and <code class="literal">java.sql.Blob</code>. Ces types peuvent ne pas convenir pour certaines applications car un objet blob ou clob peut ne pas &ecirc;tre r&eacute;utilisable en
                              dehors d'une transaction (de plus l'impl&eacute;mentation par les pilotes est moyennement bonne). 
                           </p>
                        </dd>
                        <dt><span class="term">
                              <code class="literal">imm_date, imm_time, imm_timestamp, imm_calendar, imm_calendar_date, imm_serializable, imm_binary</code>
                              </span></dt>
                        <dd>
                           <p>Mappings de type pour ceux qui sont habituellement modifiable, pour lesquels Hibernate effectue certains optimisations convenant
                              seulement aux types Java immuables, et l'application les traite comme immuable. Par exemple, vous ne devriez pas appeler <code class="literal">Date.setTime()</code> sur une instance mapp&eacute;e sur un <code class="literal">imm_timestamp</code>. Pour changer la valeur de la propri&eacute;t&eacute;, et faire que cette modification soit persist&eacute;e, l'application doit assigner un nouvel
                              (non identique) objet &agrave; la propri&eacute;t&eacute;. 
                           </p>
                        </dd>
                     </dl>
                  </div>
                  <p>
                     
                     
                  </p>
                  <p>Les identifiants uniques des entit&eacute;s et collections peuvent &ecirc;tre de n'importe quel type de base except&eacute; <code class="literal">binary</code>, <code class="literal">blob</code> et <code class="literal">clob</code> (les identifiants composites sont aussi permis, voir plus bas). 
                  </p>
                  <p>Les types de base des valeurs ont des <code class="literal">Type</code> constants correspondants d&eacute;finis dans <code class="literal">org.hibernate.Hibernate</code>. Par exemple, <code class="literal">Hibernate.STRING</code> repr&eacute;sent&eacute; le type <code class="literal">string</code>. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-types-custom"></a>5.2.3.&nbsp;Types de valeur d&eacute;finis par l'utilisateur
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Il est assez facile pour les d&eacute;veloppeurs de cr&eacute;er leurs propres types de valeurs. Par exemple, vous pourriez vouloir persister
                     des propri&eacute;t&eacute;s du type <code class="literal">java.lang.BigInteger</code> dans des colonnnes <code class="literal">VARCHAR</code>. Hibernate ne procure pas par d&eacute;faut un type pour cela. Mais les types que vous pouvez cr&eacute;er ne se limitent pas &agrave; mapper
                     des propri&eacute;t&eacute;s (ou &eacute;l&eacute;ment collection) &agrave; une simple colonne d'une table. Donc, par exemple, vous pourriez avoir une propri&eacute;t&eacute;
                     Java <code class="literal">getName()</code>/<code class="literal">setName()</code> de type <code class="literal">java.lang.String</code> persist&eacute;e dans les colonnes <code class="literal">FIRST_NAME</code>, <code class="literal">INITIAL</code>, <code class="literal">SURNAME</code>. 
                  </p>
                  <p>Pour impl&eacute;menter votre propre type, vous pouvez soit impl&eacute;menter <code class="literal">org.hibernate.UserType</code> soit <code class="literal">org.hibernate.CompositeUserType</code> et d&eacute;clarer des propri&eacute;t&eacute;s utilisant des noms de classes complets du type. Regardez <code class="literal">org.hibernate.test.DoubleStringType</code> pour voir ce qu'il est possible de faire. 
                  </p><pre class="programlisting">&lt;property name="twoStrings" type="org.hibernate.test.DoubleStringType"&gt;
    &lt;column name="first_string"/&gt;
    &lt;column name="second_string"/&gt;
&lt;/property&gt;</pre><p>Remarquez l'utilisation des tags <code class="literal">&lt;column&gt;</code> pour mapper une propri&eacute;t&eacute; sur des colonnes multiples. 
                  </p>
                  <p>Les interfaces <code class="literal">CompositeUserType</code>, <code class="literal">EnhancedUserType</code>, <code class="literal">UserCollectionType</code>, et <code class="literal">UserVersionType</code> permettent des utilisations plus sp&eacute;cialis&eacute;es. 
                  </p>
                  <p>Vous pouvez m&ecirc;me donner des param&egrave;tres en indiquant <code class="literal">UserType</code> dans le fichier de mapping ; Pour cela, votre <code class="literal">UserType</code> doit impl&eacute;menter l'interface <code class="literal">org.hibernate.usertype.ParameterizedType</code>. Pour sp&eacute;cifier des param&egrave;tres dans votre type propre, vous pouvez utiliser l'&eacute;l&eacute;ment <code class="literal">&lt;type&gt;</code> dans vos fichiers de mapping. 
                  </p><pre class="programlisting">&lt;property name="priority"&gt;
    &lt;type name="com.mycompany.usertypes.DefaultValueIntegerType"&gt;
        &lt;param name="default"&gt;0&lt;/param&gt;
    &lt;/type&gt;
&lt;/property&gt;</pre><p>Le <code class="literal">UserType</code> permet maintenant de r&eacute;cup&eacute;rer la valeur pour le param&egrave;tre nomm&eacute; <code class="literal">default</code> &agrave; partir de l'objet <code class="literal">Properties</code> qui lui est pass&eacute;. 
                  </p>
                  <p>Si vous utilisez fr&eacute;quemment un <code class="literal">UserType</code>, cela peut &ecirc;tre utile de lui d&eacute;finir un nom plus court. Vous pouvez faire cela en utilisant l'&eacute;l&eacute;ment <code class="literal">&lt;typedef&gt;</code>. Les typedefs permettent d'assigner un nom &agrave; votre type propre et peuvent aussi contenir une liste de valeurs de param&egrave;tres
                     par d&eacute;faut si ce type est param&eacute;tr&eacute;. 
                  </p><pre class="programlisting">&lt;typedef class="com.mycompany.usertypes.DefaultValueIntegerType" name="default_zero"&gt;
    &lt;param name="default"&gt;0&lt;/param&gt;
&lt;/typedef&gt;</pre><pre class="programlisting">&lt;property name="priority" type="default_zero"/&gt;</pre><p>Il est aussi possible de red&eacute;finir les param&egrave;tres par d&eacute;faut du typedef au cas par cas en utilisant des param&egrave;tres type sur
                     le mapping de la propri&eacute;t&eacute;. 
                  </p>
                  <p>Bien que le fait que Hibernate propose de base une riche vari&eacute;t&eacute; de types, et qu'il supporte les composants signifie que vous
                     aurez tr&egrave;s rarement <span class="emphasis"><em>besoin</em></span> d'utiliser un nouveau type propre, il est n&eacute;anmoins de bonne pratique d'utiliser des types propres pour les classes (non
                     entit&eacute;s) qui apparaissent fr&eacute;quemment dans votre application. Par exemple une classe <code class="literal">MonetaryAmount</code> est un bon candidat pour un <code class="literal">CompositeUserType</code> m&ecirc;me s'il pourrait facilement &ecirc;tre mapp&eacute; comme un composant. Une motivation pour cela est l'abstraction. Avec un type propre
                     vos documents de mapping sont &agrave; l'abri des changements futurs dans votre fa&ccedil;on de repr&eacute;senter des valeurs mon&eacute;taires. 
                  </p>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="mapping-entityname"></a>5.3.&nbsp;Mapper une classe plus d'une fois
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Il est possible de proposer plus d'un mapping par classe persistante. Dans ce cas, vous devez sp&eacute;cifier un <span class="emphasis"><em>nom d'entit&eacute;</em></span> pour lever l'ambiguit&eacute; entre les instances des entit&eacute;s mapp&eacute;es (par d&eacute;faut, le nom de l'entit&eacute; est celui de la classe). Hibernate
                  vous permet de sp&eacute;cifier le nom de l'entit&eacute; lorsque vous utilisez des objets persistants, lorsque vous &eacute;crivez des requ&ecirc;tes
                  ou quand vous mappez des associations vers les entit&eacute;s nomm&eacute;es. 
               </p><pre class="programlisting">&lt;class name="Contract" table="Contracts"
        entity-name="CurrentContract"&gt;
    ...
    &lt;set name="history" inverse="true"
            order-by="effectiveEndDate desc"&gt;
        &lt;key column="currentContractId"/&gt;
        &lt;one-to-many entity-name="HistoricalContract"/&gt;
    &lt;/set&gt;
&lt;/class&gt;

&lt;class name="Contract" table="ContractHistory"
        entity-name="HistoricalContract"&gt;
    ...
    &lt;many-to-one name="currentContract"
            column="currentContractId"
            entity-name="CurrentContract"/&gt;
&lt;/class&gt;</pre><p>Remarquez comment les associations sont d&eacute;sormais sp&eacute;cifi&eacute;es en utilisant <code class="literal">entity-name</code> au lieu de <code class="literal">class</code>. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="mapping-quotedidentifiers"></a>5.4.&nbsp;SQL quoted identifiers
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Vous pouvez forcer Hibernate &agrave; mettre un identifiant entre quotes dans le SQL g&eacute;n&eacute;r&eacute; en mettant le nom de la table ou de la
                  colonne entre backticks dans le document de mapping. Hibernate utilisera les bons styles de quotes pour le <code class="literal">Dialect</code> SQL (habituellement des doubles quotes, mais des parenth&egrave;ses pour SQL server et des backticks pour MySQL). 
               </p><pre class="programlisting">&lt;class name="LineItem" table="`Line Item`"&gt;
    &lt;id name="id" column="`Item Id`"/&gt;&lt;generator class="assigned"/&gt;&lt;/id&gt;
    &lt;property name="itemNumber" column="`Item #`"/&gt;
    ...
&lt;/class&gt;</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="mapping-alternatives"></a>5.5.&nbsp;alternatives Metadata
                        </h2>
                     </div>
                  </div>
               </div>
               <p>XML ne convient pas &agrave; tout le monde, il y a donc des moyens alternatifs pour d&eacute;finir des metatda de mappings O/R dans Hibernate.
                  
               </p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-xdoclet"></a>5.5.1.&nbsp;utilisation de XDoclet
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>De nombreux utilisateurs de Hibernate pr&eacute;f&egrave;rent embarquer les informations de mappings directement au sein du code source
                     en utilisant les tags XDoclet <code class="literal">@hibernate.tags</code>. Nous ne couvrons pas cette approche dans ce document cependant, puisque c'est consid&eacute;r&eacute; comme faisant partie de XDoclet.
                     Cependant, nous pr&eacute;sentons l'exemple suivant de la classe <code class="literal">Cat</code> avec des mappings XDoclet. 
                  </p><pre class="programlisting">package eg;
import java.util.Set;
import java.util.Date;

/**
 * @hibernate.class
 *  table="CATS"
 */
public class Cat {
    private Long id; // identifier
    private Date birthdate;
    private Cat mother;
    private Set kittens
    private Color color;
    private char sex;
    private float weight;

    /*
     * @hibernate.id
     *  generator-class="native"
     *  column="CAT_ID"
     */
    public Long getId() {
        return id;
    }
    private void setId(Long id) {
        this.id=id;
    }

    /**
     * @hibernate.many-to-one
     *  column="PARENT_ID"
     */
    public Cat getMother() {
        return mother;
    }
    void setMother(Cat mother) {
        this.mother = mother;
    }

    /**
     * @hibernate.property
     *  column="BIRTH_DATE"
     */
    public Date getBirthdate() {
        return birthdate;
    }
    void setBirthdate(Date date) {
        birthdate = date;
    }
    /**
     * @hibernate.property
     *  column="WEIGHT"
     */
    public float getWeight() {
        return weight;
    }
    void setWeight(float weight) {
        this.weight = weight;
    }

    /**
     * @hibernate.property
     *  column="COLOR"
     *  not-null="true"
     */
    public Color getColor() {
        return color;
    }
    void setColor(Color color) {
        this.color = color;
    }
    /**
     * @hibernate.set
     *  inverse="true"
     *  order-by="BIRTH_DATE"
     * @hibernate.collection-key
     *  column="PARENT_ID"
     * @hibernate.collection-one-to-many
     */
    public Set getKittens() {
        return kittens;
    }
    void setKittens(Set kittens) {
        this.kittens = kittens;
    }
    // addKitten not needed by Hibernate
    public void addKitten(Cat kitten) {
        kittens.add(kitten);
    }

    /**
     * @hibernate.property
     *  column="SEX"
     *  not-null="true"
     *  update="false"
     */
    public char getSex() {
        return sex;
    }
    void setSex(char sex) {
        this.sex=sex;
    }
}</pre><p>Voyez le site web de Hibernate pour plus d'exemples sur XDoclet et Hibernate. </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="mapping-annotations"></a>5.5.2.&nbsp;Utilisation des annotations JDK 5.0
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Le JDK 5.0 introduit des annotations proches de celles de XDoclet au niveau java, qui sont type-safe et v&eacute;rifi&eacute;es &agrave; la compilation.
                     Ce m&eacute;canisme est plus puissant que XDoclet et mieux support&eacute; par les outils et IDE. IntelliJ IDEA, par exemple, supporte l'auto-compl&eacute;tion
                     et le surlignement syntaxique des annotations JDK 5.0. La nouvelle r&eacute;vision des sp&eacute;cifications des EJB (JSR-220) utilise les
                     annotations JDK 5.0 comme m&eacute;canisme primaire pour les meta-donn&eacute;es des beans entit&eacute;s. Hibernate3 impl&eacute;mente l'<code class="literal">EntityManager</code> de la JSR-220 (API de persistance), le support du mapping de meta-donn&eacute;es est disponible via le package <span class="emphasis"><em>Hibernate Annotations</em></span>, en tant que module s&eacute;par&eacute; &agrave; t&eacute;l&eacute;charger. EJB3 (JSR-220) et les m&eacute;tadata Hibernate3 sont support&eacute;s. 
                  </p>
                  <p>Ceci est un exemple d'une classe POJO annot&eacute;e comme un EJB entit&eacute; : </p><pre class="programlisting">@Entity(access = AccessType.FIELD)
public class Customer implements Serializable {

    @Id;
    Long id;

    String firstName;
    String lastName;
    Date birthday;

    @Transient
    Integer age;

    @Embedded
    private Address homeAddress;

    @OneToMany(cascade=CascadeType.ALL)
    @JoinColumn(name="CUSTOMER_ID")
    Set&lt;Order&gt; orders;

    // Getter/setter and business methods
}</pre><p>Notez que le support des annotations JDK 5.0 (et de la JSR-220) est encore en cours et n'est pas termin&eacute;. R&eacute;f&eacute;rez vous au
                     module Hibernate Annotation pour plus de d&eacute;tails. 
                  </p>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="mapping-generated"></a>5.6.&nbsp;Propri&eacute;t&eacute;s g&eacute;n&eacute;r&eacute;es
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Les propri&eacute;t&eacute;s g&eacute;n&eacute;r&eacute;es sont des propri&eacute;t&eacute;s dont les valeurs sont g&eacute;n&eacute;r&eacute;es par la base de donn&eacute;es. Typiquement, les applications
                  Hibernate avaient besoin d'invoquer <code class="literal">refresh</code> sur les instances qui contenaient des propri&eacute;t&eacute;s pour lesquelles la base de donn&eacute;es g&eacute;n&eacute;rait des valeurs. Marquer les propri&eacute;t&eacute;s
                  comme g&eacute;n&eacute;r&eacute;es permet &agrave; l'application de d&eacute;l&eacute;guer cette responsabilit&eacute; &agrave; Hibernate. Principalement, &agrave; chaque fois qu'Hibernate
                  r&eacute;alise une insertion ou une mise &agrave; jour en base de donn&eacute;es pour une entit&eacute; marqu&eacute;e comme telle, cela provoque imm&eacute;diatement
                  un select pour r&eacute;cup&eacute;rer les valeurs g&eacute;n&eacute;r&eacute;es. 
               </p>
               <p>Les propri&eacute;t&eacute;s marqu&eacute;es comme g&eacute;n&eacute;r&eacute;es doivent de plus ne pas &ecirc;tre ins&eacute;rables et modifiables Seuls <a href="#mapping-declaration-version" title="5.1.9.&nbsp;version (optionnel)">Section&nbsp;5.1.9, &laquo;&nbsp;version (optionnel)&nbsp;&raquo;</a>, <a href="#mapping-declaration-timestamp" title="5.1.10.&nbsp;timestamp (optionnel)">Section&nbsp;5.1.10, &laquo;&nbsp;timestamp (optionnel)&nbsp;&raquo;</a>, et <a href="#mapping-declaration-property" title="5.1.11.&nbsp;property">Section&nbsp;5.1.11, &laquo;&nbsp;property&nbsp;&raquo;</a> peuvent &ecirc;tre marqu&eacute;s comme g&eacute;n&eacute;r&eacute;es. 
               </p>
               <p><code class="literal">never</code> (par d&eacute;faut) - indique la valeur de la propri&eacute;t&eacute; n'est pas g&eacute;n&eacute;r&eacute;e dans la base de donn&eacute;es. 
               </p>
               <p><code class="literal">insert</code> - indique que la valeur de la propri&eacute;t&eacute; donn&eacute;e est g&eacute;n&eacute;r&eacute;e &agrave; l'insertion mais pas lors des futures mises &agrave; jour de l'enregistrement.
                  Les colonnes de type "date de cr&eacute;ation" sont le cas d'utilisation typique de cette option. Notez que m&ecirc;me les propri&eacute;t&eacute;s <a href="#mapping-declaration-version" title="5.1.9.&nbsp;version (optionnel)">Section&nbsp;5.1.9, &laquo;&nbsp;version (optionnel)&nbsp;&raquo;</a> et <a href="#mapping-declaration-timestamp" title="5.1.10.&nbsp;timestamp (optionnel)">Section&nbsp;5.1.10, &laquo;&nbsp;timestamp (optionnel)&nbsp;&raquo;</a> peuvent &ecirc;tre d&eacute;clar&eacute;es comme g&eacute;n&eacute;r&eacute;es, cette option n'est pas disponible &agrave; cet endroit... 
               </p>
               <p><code class="literal">always</code> - indique que la valeur de la propri&eacute;t&eacute; est g&eacute;n&eacute;r&eacute;e &agrave; l'insert comme aux updates. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="mapping-database-object"></a>5.7.&nbsp;Objets auxiliaires de la base de donn&eacute;es
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Permettent les ordres CREATE et DROP d'objets arbitraire de la base de donn&eacute;&eacute;es, en conjonction avec les outils Hibernate
                  d'&eacute;volutions de sch&eacute;ma, pour permettre de d&eacute;finir compl&egrave;tement un sch&eacute;ma utilisateur au sein des fichiers de mapping Hibernate.
                  Bien que con&ccedil;u sp&eacute;cifiquement pour cr&eacute;er et supprimer des objets tels que des triggers et des proc&eacute;dures stock&eacute;es, ou toute
                  commande pouvant &ecirc;tre ex&eacute;cut&eacute;e via une m&eacute;thode de <code class="literal">java.sql.Statement.execute()</code> (ALTERs, INSERTS, etc). Il y a principalement deux modes pour d&eacute;finir les objets auxiliaires de base de donn&eacute;es... 
               </p>
               <p>Le premier mode est de lister explicitement les commandes CREATE et DROP dans le fichier de mapping: </p><pre class="programlisting">&lt;hibernate-mapping&gt;
    ...
    &lt;database-object&gt;
        &lt;create&gt;CREATE TRIGGER my_trigger ...&lt;/create&gt;
        &lt;drop&gt;DROP TRIGGER my_trigger&lt;/drop&gt;
    &lt;/database-object&gt;
&lt;/hibernate-mapping&gt;</pre><p>Le second mode est de fournir une classe particuli&egrave;re qui connait comment construire les commandes CREATE et DROP. Cette classe
                  particuli&egrave;re doit impl&eacute;menter l'interface <code class="literal">org.hibernate.mapping.AuxiliaryDatabaseObject</code>. 
               </p><pre class="programlisting">&lt;hibernate-mapping&gt;
    ...
    &lt;database-object&gt;
        &lt;definition class="MyTriggerDefinition"/&gt;
    &lt;/database-object&gt;
&lt;/hibernate-mapping&gt;</pre><p>Additionnellement, ces objets de base de donn&eacute;es peuvent &ecirc;tre optionnellement trait&eacute;s selon l'utilisation de dialectes particuliers..
                  
               </p><pre class="programlisting">&lt;hibernate-mapping&gt;
    ...
    &lt;database-object&gt;
        &lt;definition class="MyTriggerDefinition"/&gt;
        &lt;dialect-scope name="org.hibernate.dialect.Oracle9Dialect"/&gt;
        &lt;dialect-scope name="org.hibernate.dialect.OracleDialect"/&gt;
    &lt;/database-object&gt;
&lt;/hibernate-mapping&gt;</pre></div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="collections"></a>Chapitre&nbsp;6.&nbsp;Mapping des collections
                     </h2>
                  </div>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="collections-persistent"></a>6.1.&nbsp;Collections persistantes
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Hibernate requiert que les champs contenant des collections persistantes soient d&eacute;clar&eacute;s comme des types d'interface, par
                  exemple : 
               </p><pre class="programlisting">public class Product {
    private String serialNumber;
    private Set parts = new HashSet();
    
    public Set getParts() { return parts; }
    void setParts(Set parts) { this.parts = parts; }
    public String getSerialNumber() { return serialNumber; }
    void setSerialNumber(String sn) { serialNumber = sn; }
}</pre><p>L'interface r&eacute;elle devrait &ecirc;tre <code class="literal">java.util.Set</code>, <code class="literal">java.util.Collection</code>, <code class="literal">java.util.List</code>, <code class="literal">java.util.Map</code>, <code class="literal">java.util.SortedSet</code>, <code class="literal">java.util.SortedMap</code> ou ... n'importe quoi d'autre ! (O&ugrave; "n'importe quoi d'autre" signifie que vous devrez &eacute;crire une impl&eacute;mentation de <code class="literal">org.hibernate.usertype.UserCollectionType</code>.) 
               </p>
               <p>Notez comment nous avons initialis&eacute; les variables d'instance avec une instance de <code class="literal">HashSet</code>. C'est le meilleur moyen pour initialiser les collections d'instances nouvellement cr&eacute;&eacute;es (non persistantes). Quand nous
                  fabriquons l'instance persistante - en appelant <code class="literal">persist()</code>, par exemple - Hibernate remplacera r&eacute;ellement le <code class="literal">HashSet</code> avec une instance d'une impl&eacute;mentation propre &agrave; Hibernate de <code class="literal">Set</code>. Prenez garde aux erreurs : 
               </p><pre class="programlisting">Cat cat = new DomesticCat();
Cat kitten = new DomesticCat();
....
Set kittens = new HashSet();
kittens.add(kitten);
cat.setKittens(kittens);
session.persist(cat);
kittens = cat.getKittens(); // Okay, kittens collection is a Set
(HashSet) cat.getKittens(); // Error!</pre><p>Les collections persistantes inject&eacute;es par Hibernate se comportent de la m&ecirc;me mani&egrave;re que <code class="literal">HashMap</code>, <code class="literal">HashSet</code>, <code class="literal">TreeMap</code>, <code class="literal">TreeSet</code> ou <code class="literal">ArrayList</code>, selon le type de l'interface. 
               </p>
               <p>Les instances des collections ont le comportement habituel des types des valeurs. Elles sont automatiquement persist&eacute;es quand
                  elles sont r&eacute;f&eacute;renc&eacute;es par un objet persistant et automatiquement effac&eacute;es quand elles sont d&eacute;r&eacute;f&eacute;renc&eacute;es. Si une collection
                  est pass&eacute;e d'un objet persistant &agrave; un autre, ses &eacute;l&eacute;ments pourraient &ecirc;tre d&eacute;plac&eacute;s d'une table &agrave; une autre. Deux entit&eacute;s ne
                  peuvent pas partager une r&eacute;f&eacute;rence vers une m&ecirc;me instance d'une collection. D&ucirc; au mod&egrave;le relationnel sous-jacent, les propri&eacute;t&eacute;s
                  contenant des collections ne supportent pas la s&eacute;mantique de la valeur null ; Hibernate ne distingue pas une r&eacute;f&eacute;rence vers
                  une collection nulle d'une collection vide. 
               </p>
               <p>Vous ne devriez pas vous pr&eacute;occuper trop de &ccedil;a. Utilisez les collections persistantes de la m&ecirc;me mani&egrave;re que vous utilisez
                  des collections Java ordinaires. Assurez-vous de comprendre la s&eacute;mantique des associations bidirectionnelles (trait&eacute;e plus
                  loin). 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="collections-mapping"></a>6.2.&nbsp;Mapper une collection
                        </h2>
                     </div>
                  </div>
               </div>
               <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
                  <h3 class="title">Astuce</h3>
                  <p>Il y a pas mal de vari&eacute;t&eacute;s de mappings qui peuvent &ecirc;tre g&eacute;n&eacute;r&eacute;s pour les collections, couvrant beaucoup des mod&egrave;les relationnels
                     communs. Nous vous sugg&eacute;rons d'exp&eacute;rimenter avec l'outil de g&eacute;n&eacute;ration de sch&eacute;ma pour avoir une id&eacute;e de comment traduire les
                     diff&eacute;rentes d&eacute;clarations de mapping vers des table de la base de donn&eacute;es. 
                  </p>
               </div>
               <p>L'&eacute;l&eacute;ment de mapping d'Hibernate utilis&eacute; pour mapper une collection d&eacute;pend du type de l'interface. Par exemple, un &eacute;l&eacute;ment
                  <code class="literal">&lt;set&gt;</code> est utilis&eacute; pour mapper des propri&eacute;t&eacute;s de type <code class="literal">Set</code>. 
               </p><pre class="programlisting">&lt;class name="Product"&gt;
    &lt;id name="serialNumber" column="productSerialNumber"/&gt;
    &lt;set name="parts"&gt;
        &lt;key column="productSerialNumber" not-null="true"/&gt;
        &lt;one-to-many class="Part"/&gt;
    &lt;/set&gt;
&lt;/class&gt;</pre><p>&Agrave; part <code class="literal">&lt;set&gt;</code>, il y aussi les &eacute;l&eacute;ments de mapping <code class="literal">&lt;list&gt;</code>, <code class="literal">&lt;map&gt;</code>, <code class="literal">&lt;bag&gt;</code>, <code class="literal">&lt;array&gt;</code> et <code class="literal">&lt;primitive-array&gt;</code>. L'&eacute;l&eacute;ment <code class="literal">&lt;map&gt;</code> est repr&eacute;sentatif : 
               </p>
               <div class="programlistingco"><pre class="programlisting">&lt;map
    name="propertyName"                                         <span class="co">(1)</span>
    table="table_name"                                          <span class="co">(2)</span>
    schema="schema_name"                                        <span class="co">(3)</span>
    lazy="true|extra|false"                                     <span class="co">(4)</span>
    inverse="true|false"                                        <span class="co">(5)</span>
    cascade="all|none|save-update|delete|all-delete-orphan|delet<span class="co">(6)</span>e-orphan"
    sort="unsorted|natural|comparatorClass"                     <span class="co">(7)</span>
    order-by="column_name asc|desc"                             <span class="co">(8)</span>
    where="arbitrary sql where condition"                       <span class="co">(9)</span>
    fetch="join|select|subselect"                               <span class="co">(10)</span>
    batch-size="N"                                              <span class="co">(11)</span>
    access="field|property|ClassName"                           <span class="co">(12)</span>
    optimistic-lock="true|false"                                <span class="co">(13)</span>
    mutable="true|false"                                        <span class="co">(14)</span>
    node="element-name|."
    embed-xml="true|false"
&gt;

    &lt;key .... /&gt;
    &lt;map-key .... /&gt;
    &lt;element .... /&gt;
&lt;/map&gt;</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                           </td>
                           <td valign="top" align="left">
                              <p><code class="literal">name</code> : le nom de la propri&eacute;t&eacute; contenant la collection 
                              </p>
                           </td>
                        </tr>
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                           </td>
                           <td valign="top" align="left">
                              <p><code class="literal">table</code> (optionnel - par d&eacute;faut = nom de la propri&eacute;t&eacute;) : le nom de la table de la collection (non utilis&eacute; pour les associations one-to-many)
                                 
                              </p>
                           </td>
                        </tr>
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                           </td>
                           <td valign="top" align="left">
                              <p><code class="literal">schema</code> (optionnel) : le nom du sch&eacute;ma pour surcharger le sch&eacute;ma d&eacute;clar&eacute; dans l'&eacute;l&eacute;ment racine 
                              </p>
                           </td>
                        </tr>
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                           </td>
                           <td valign="top" align="left">
                              <p><code class="literal">lazy</code> (optionnel - par d&eacute;faut = <code class="literal">true</code>) : peut &ecirc;tre utilis&eacute; pour d&eacute;sactiver l'initialisation tardive et sp&eacute;cifier que l'association est toujours rapport&eacute;e, ou pour
                                 activer la r&eacute;cup&eacute;ration extra-paresseuse (NdT : extra-lazy) o&ugrave; la plupart des op&eacute;rations n'initialisent pas la collection
                                 (appropri&eacute; pour de tr&egrave;s grosses collections) 
                              </p>
                           </td>
                        </tr>
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                           </td>
                           <td valign="top" align="left">
                              <p><code class="literal">inverse</code> (optionnel - par d&eacute;faut = <code class="literal">false</code>) : d&eacute;finit cette collection comme l'extr&ecirc;mit&eacute; "inverse" de l'association bidirectionnelle 
                              </p>
                           </td>
                        </tr>
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(6)</fo:inline>
                           </td>
                           <td valign="top" align="left">
                              <p><code class="literal">cascade</code> (optionnel - par d&eacute;faut = <code class="literal">none</code>) : active les op&eacute;rations de cascade vers les entit&eacute;s filles 
                              </p>
                           </td>
                        </tr>
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(7)</fo:inline>
                           </td>
                           <td valign="top" align="left">
                              <p><code class="literal">sort</code> (optionnel) : sp&eacute;cifie une collection tri&eacute;e via un ordre de tri <code class="literal">naturel</code>, ou via une classe comparateur donn&eacute;e (impl&eacute;mentant Comparator) 
                              </p>
                           </td>
                        </tr>
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(8)</fo:inline>
                           </td>
                           <td valign="top" align="left">
                              <p><code class="literal">order-by</code> (optionnel, seulement &agrave; partir du JDK1.4) : sp&eacute;cifie une colonne de table (ou des colonnes) qui d&eacute;finit l'ordre d'it&eacute;ration
                                 de <code class="literal">Map</code>, <code class="literal">Set</code> ou Bag, avec en option <code class="literal">asc</code> ou <code class="literal">desc</code> 
                              </p>
                           </td>
                        </tr>
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(9)</fo:inline>
                           </td>
                           <td valign="top" align="left">
                              <p><code class="literal">where</code> (optionnel) : sp&eacute;cifie une condition SQL arbitraire <code class="literal">WHERE</code> &agrave; utiliser au chargement ou &agrave; la suppression d'une collection (utile si la collection ne doit contenir qu'un sous ensemble
                                 des donn&eacute;es disponibles) 
                              </p>
                           </td>
                        </tr>
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(10)</fo:inline>
                           </td>
                           <td valign="top" align="left">
                              <p><code class="literal">fetch</code> (optionnel, par d&eacute;faut = <code class="literal">select</code>) : &agrave; choisir entre r&eacute;cup&eacute;ration par jointures externes, r&eacute;cup&eacute;ration par selects s&eacute;quentiels, et r&eacute;cup&eacute;ration par sous-selects
                                 s&eacute;quentiels 
                              </p>
                           </td>
                        </tr>
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(11)</fo:inline>
                           </td>
                           <td valign="top" align="left">
                              <p><code class="literal">batch-size</code> (optionnel, par d&eacute;faut = <code class="literal">1</code>) : une taille de batch (batch size) utilis&eacute;e pour charger plusieurs instances de cette collection en initialisation tardive
                                 
                              </p>
                           </td>
                        </tr>
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(12)</fo:inline>
                           </td>
                           <td valign="top" align="left">
                              <p><code class="literal">access</code> (optionnel - par d&eacute;faut = <code class="literal">property</code>) : La strat&eacute;gie qu'Hibernate doit utiliser pour acc&eacute;der &agrave; la valeur de la propri&eacute;t&eacute; 
                              </p>
                           </td>
                        </tr>
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(13)</fo:inline>
                           </td>
                           <td valign="top" align="left">
                              <p><code class="literal">optimistic-lock</code> (optionnel - par d&eacute;faut = <code class="literal">true</code>) : sp&eacute;cifie que changer l'&eacute;tat de la collection entra&icirc;ne l'incr&eacute;mentation de la version appartenant &agrave; l'entit&eacute; (Pour une
                                 association un vers plusieurs, il est souvent raisonnable de d&eacute;sactiver ce param&egrave;tre) 
                              </p>
                           </td>
                        </tr>
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(14)</fo:inline>
                           </td>
                           <td valign="top" align="left">
                              <p><code class="literal">mutable</code> (optionnel - par d&eacute;faut = <code class="literal">true</code>) : une valeur &agrave; <code class="literal">false</code> sp&eacute;cifie que les &eacute;l&eacute;ments de la collection ne changent jamais (une optimisation mineure dans certains cas) 
                              </p>
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="collections-foreignkeys"></a>6.2.1.&nbsp;Les clefs &eacute;trang&egrave;res d'une collection
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Les instances d'une collection sont distingu&eacute;es dans la base par la clef &eacute;trang&egrave;re de l'entit&eacute; qui poss&egrave;de la collection.
                     Cette clef &eacute;trang&egrave;re est r&eacute;f&eacute;renc&eacute;e comme la(es) <span class="emphasis"><em>colonne(s) de la clef de la collection</em></span> de la table de la collection. La colonne de la clef de la collection est mapp&eacute;e par l'&eacute;l&eacute;ment <code class="literal">&lt;key&gt;</code>. 
                  </p>
                  <p>Il peut y avoir une contrainte de nullit&eacute; sur la colonne de la clef &eacute;trang&egrave;re. Pour les associations unidirectionnelles un
                     vers plusieurs, la colonne de la clef &eacute;trang&egrave;re peut &ecirc;tre nulle par d&eacute;faut, donc vous pourriez avoir besoin de sp&eacute;cifier <code class="literal">not-null="true"</code>. 
                  </p><pre class="programlisting">&lt;key column="productSerialNumber" not-null="true"/&gt;</pre><p>La contraite de la clef &eacute;trang&egrave;re peut utiliser <code class="literal">ON DELETE CASCADE</code>. 
                  </p><pre class="programlisting">&lt;key column="productSerialNumber" on-delete="cascade"/&gt;</pre><p>Voir le chapitre pr&eacute;c&eacute;dent pour une d&eacute;finition compl&egrave;te de l'&eacute;l&eacute;ment <code class="literal">&lt;key&gt;</code>. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="collections-elements"></a>6.2.2.&nbsp;Les &eacute;l&eacute;ments d'une collection
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Les collections peuvent contenir la plupart des autres types Hibernate, dont tous les types basiques, les types utilisateur,
                     les composants, et bien s&ucirc;r, les r&eacute;f&eacute;rences vers d'autres entit&eacute;s. C'est une distinction importante : un objet dans une collection
                     pourrait &ecirc;tre g&eacute;r&eacute; avec une s&eacute;mantique de "valeur" (sa dur&eacute;e de vie d&eacute;pend compl&egrave;tement du propri&eacute;taire de la collection)
                     ou il pourrait avoir une r&eacute;f&eacute;rence vers une autre entit&eacute;, avec sa propre dur&eacute;e de vie. Dans le dernier cas, seul le "lien"
                     entre les 2 objets est consid&eacute;r&eacute; &ecirc;tre l'&eacute;tat retenu par la collection. 
                  </p>
                  <p>Le type contenu est r&eacute;f&eacute;renc&eacute; comme le <span class="emphasis"><em>type de l'&eacute;l&eacute;ment de la collection</em></span>. Les &eacute;l&eacute;ments de la collections sont mapp&eacute;s par <code class="literal">&lt;element&gt;</code> ou <code class="literal">&lt;composite-element&gt;</code>, ou dans le cas des r&eacute;f&eacute;rences d'entit&eacute;, avec <code class="literal">&lt;one-to-many&gt;</code> ou <code class="literal">&lt;many-to-many&gt;</code>. Les deux premiers mappent des &eacute;l&eacute;ments avec un s&eacute;mantique de valeur, les deux suivants sont utilis&eacute;s pour mapper des associations
                     d'entit&eacute;. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="collections-indexed"></a>6.2.3.&nbsp;Collections index&eacute;es
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Tous les mappings de collection, except&eacute;s ceux avec les s&eacute;mantiques d'ensemble (NdT : set) et de sac (NdT : bag), ont besoin
                     d'une <span class="emphasis"><em>colonne d'index</em></span> dans la table de la collection - une colonne qui mappe un index de tableau, ou un index de <code class="literal">List</code>, ou une clef de <code class="literal">Map</code>. L'index d'une <code class="literal">Map</code> peut &ecirc;tre n'importe quel type basique, mapp&eacute; avec <code class="literal">&lt;map-key&gt;</code>, &ccedil;a peut &ecirc;tre une r&eacute;f&eacute;rence d'entit&eacute; mapp&eacute;e avec <code class="literal">&lt;map-key-many-to-many&gt;</code>, ou &ccedil;a peut &ecirc;tre un type compos&eacute;, mapp&eacute; avec <code class="literal">&lt;composite-map-key&gt;</code>. L'index d'un tableau ou d'une liste est toujours de type <code class="literal">integer</code> et est mapp&eacute; en utilisant l'&eacute;l&eacute;ment <code class="literal">&lt;list-index&gt;</code>. Les colonnes mapp&eacute;es contiennent des entiers s&eacute;quentiels (num&eacute;rot&eacute;s &agrave; partir de z&eacute;ro par d&eacute;faut). 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;list-index 
        column="column_name"                <span class="co">(1)</span>
        base="0|1|..."/&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">column_name</code> (required): The name of the column holding the collection index values. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">base</code> (optional, defaults to <code class="literal">0</code>): The value of the index column that corresponds to the first element of the list or array. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <div class="programlistingco"><pre class="programlisting">&lt;map-key 
        column="column_name"                <span class="co">(1)</span>
        formula="any SQL expression"        <span class="co">(2)</span>
        type="type_name"                    <span class="co">(3)</span>
        node="@attribute-name"
        length="N"/&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">column</code> (optional): The name of the column holding the collection index values. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">formula</code> (optional): A SQL formula used to evaluate the key of the map. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">type</code> (reguired): The type of the map keys. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <div class="programlistingco"><pre class="programlisting">&lt;map-key-many-to-many
        column="column_name"                <span class="co">(1)</span>
        formula="any SQL expression"        <span class="co">(2)</span><span class="co">(3)</span>
        class="ClassName"
/&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">column</code> (optional): The name of the foreign key column for the collection index values. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">formula</code> (optional): A SQL formula used to evaluate the foreign key of the map key. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">class</code> (required): The entity class used as the map key. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Si votre table n'a pas de colonne d'index, et que vous souhaitez tout de m&ecirc;me utiliser <code class="literal">List</code> comme type de propri&eacute;t&eacute;, vous devriez mapper la propri&eacute;t&eacute; comme un <span class="emphasis"><em>&lt;bag&gt;</em></span> Hibernate. Un sac (NdT : bag) ne garde pas son ordre quand il est r&eacute;cup&eacute;r&eacute; de la base de donn&eacute;es, mais il peut &ecirc;tre optionnellement
                     tri&eacute; ou ordonn&eacute;. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="collections-ofvalues"></a>6.2.4.&nbsp;Collections de valeurs et associations plusieurs-vers-plusieurs
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>N'importe quelle collection de valeurs ou association plusieurs-vers-plusieurs requiert une <span class="emphasis"><em>table de collection</em></span> avec une(des) colonne(s) de clef &eacute;trang&egrave;re, une(des) <span class="emphasis"><em>colonne(s) d'&eacute;l&eacute;ment de la collection</em></span> ou des colonnes et possiblement une(des) colonne(s) d'index. 
                  </p>
                  <p>Pour une collection de valeurs, nous utilisons la balise <code class="literal">&lt;element&gt;</code>. 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;element
        column="column_name"                     <span class="co">(1)</span>
        formula="any SQL expression"             <span class="co">(2)</span>
        type="typename"                          <span class="co">(3)</span>
        length="L"
        precision="P"
        scale="S"
        not-null="true|false"
        unique="true|false"
        node="element-name"
/&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">column</code> (optional): The name of the column holding the collection element values. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">formula</code> (optional): An SQL formula used to evaluate the element. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">type</code> (required): The type of the collection element. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p> A <span class="emphasis"><em>many-to-many association</em></span> is specified using the <code class="literal">&lt;many-to-many&gt;</code> element. 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;many-to-many
        column="column_name"                               <span class="co">(1)</span>
        formula="any SQL expression"                       <span class="co">(2)</span>
        class="ClassName"                                  <span class="co">(3)</span>
        fetch="select|join"                                <span class="co">(4)</span>
        unique="true|false"                                <span class="co">(5)</span>
        not-found="ignore|exception"                       <span class="co">(6)</span>
        entity-name="EntityName"                           <span class="co">(7)</span>
        property-ref="propertyNameFromAssociatedClass"     <span class="co">(8)</span>
        node="element-name"
        embed-xml="true|false"
    /&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">column</code> (optional): The name of the element foreign key column. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">formula</code> (optional): An SQL formula used to evaluate the element foreign key value. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">class</code> (required): The name of the associated class. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">fetch</code> (optional - defaults to <code class="literal">join</code>): enables outer-join or sequential select fetching for this association. This is a special case; for full eager fetching
                                    (in a single <code class="literal">SELECT</code>) of an entity and its many-to-many relationships to other entities, you would enable <code class="literal">join</code> fetching not only of the collection itself, but also with this attribute on the <code class="literal">&lt;many-to-many&gt;</code> nested element. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">unique</code> (optional): Enable the DDL generation of a unique constraint for the foreign-key column. This makes the association multiplicity
                                    effectively one to many. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(6)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">not-found</code> (optional - defaults to <code class="literal">exception</code>): Specifies how foreign keys that reference missing rows will be handled: <code class="literal">ignore</code> will treat a missing row as a null association. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(7)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">entity-name</code> (optional): The entity name of the associated class, as an alternative to <code class="literal">class</code>. 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(8)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p> <code class="literal">property-ref</code>: (optional) The name of a property of the associated class that is joined to this foreign key. If not specified, the primary
                                    key of the associated class is used. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Quelques exemples, d'abord, un ensemble de cha&icirc;nes de caract&egrave;res : </p><pre class="programlisting">&lt;set name="names" table="person_names"&gt;
    &lt;key column="person_id"/&gt;
    &lt;element column="person_name" type="string"/&gt;
&lt;/set&gt;</pre><p>Un bag contenant des entiers (avec un ordre d'it&eacute;ration d&eacute;termin&eacute; par l'attribut <code class="literal">order-by</code>) : 
                  </p><pre class="programlisting">&lt;bag name="sizes" 
        table="item_sizes" 
        order-by="size asc"&gt;
    &lt;key column="item_id"/&gt;
    &lt;element column="size" type="integer"/&gt;
&lt;/bag&gt;</pre><p>Un tableau d'entit&eacute;s - dans ce cas, une association plusieurs-vers-plusieurs : </p><pre class="programlisting">&lt;array name="addresses" 
        table="PersonAddress" 
        cascade="persist"&gt;
    &lt;key column="personId"/&gt;
    &lt;list-index column="sortOrder"/&gt;
    &lt;many-to-many column="addressId" class="Address"/&gt;
&lt;/array&gt;</pre><p>Une map de cha&icirc;nes de caract&egrave;res vers des dates : </p><pre class="programlisting">&lt;map name="holidays" 
        table="holidays" 
        schema="dbo" 
        order-by="hol_name asc"&gt;
    &lt;key column="id"/&gt;
    &lt;map-key column="hol_name" type="string"/&gt;
    &lt;element column="hol_date" type="date"/&gt;
&lt;/map&gt;</pre><p>Une liste de composants (discute dans le prochain chapitre) : </p><pre class="programlisting">&lt;list name="carComponents" 
        table="CarComponents"&gt;
    &lt;key column="carId"/&gt;
    &lt;list-index column="sortOrder"/&gt;
    &lt;composite-element class="CarComponent"&gt;
        &lt;property name="price"/&gt;
        &lt;property name="type"/&gt;
        &lt;property name="serialNumber" column="serialNum"/&gt;
    &lt;/composite-element&gt;
&lt;/list&gt;</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="collections-onetomany"></a>6.2.5.&nbsp;Association un-vers-plusieurs
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une <span class="emphasis"><em>association un vers plusieurs</em></span> lie les tables de deux classes par une clef &eacute;trang&egrave;re, sans l'intervention d'une table de collection. Ce mapping perd certaines
                     s&eacute;mantiques des collections Java normales : 
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc" compact>
                        <li>
                           <p>Une instance de la classe de l'entit&eacute; contenue ne peut pas appartenir &agrave; plus d'une instance de la collection </p>
                        </li>
                        <li>
                           <p>Une instance de la classe de l'entit&eacute; contenue ne peut pas appara&icirc;tre plus plus d'une valeur d'index de la collection </p>
                        </li>
                     </ul>
                  </div>
                  <p>Une association de <code class="literal">Product</code> vers <code class="literal">Part</code> requiert l'existence d'une clef &eacute;trang&egrave;re et possiblement une colonne d'index pour la table <code class="literal">Part</code>. Une balise <code class="literal">&lt;one-to-many&gt;</code> indique que c'est une association un vers plusieurs. 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;one-to-many 
        class="ClassName"                                  <span class="co">(1)</span>
        not-found="ignore|exception"                       <span class="co">(2)</span>
        entity-name="EntityName"                           <span class="co">(3)</span>
        node="element-name"
        embed-xml="true|false"
    /&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">class</code> (requis) : le nom de la classe associ&eacute;e 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">not-found</code> (optionnel - par d&eacute;faut <code class="literal">exception</code>) : sp&eacute;cifie comment les identifiants cach&eacute;s qui r&eacute;f&eacute;rencent des lignes manquantes seront g&eacute;r&eacute;s : <code class="literal">ignore</code> traitera une ligne manquante comme une association nulle 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">entity-name</code> (optional): The entity name of the associated class, as an alternative to <code class="literal">class</code>. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Notez que l'&eacute;l&eacute;ment <code class="literal">&lt;one-to-many&gt;</code> n'a pas besoin de d&eacute;clarer de colonnes. Il n'est pas non plus n&eacute;cessaire de sp&eacute;cifier le nom de la table nulle part. 
                  </p>
                  <p><span class="emphasis"><em>Note tr&egrave;s importante :</em></span> si la colonne de la clef d'une association <code class="literal">&lt;one-to-many&gt;</code> est d&eacute;clar&eacute;e <code class="literal">NOT NULL</code>, vous devez d&eacute;clarer le mapping de <code class="literal">&lt;key&gt;</code> avec <code class="literal">not-null="true"</code> ou <span class="emphasis"><em>utiliser une association bidirectionnelle</em></span> avec le mapping de la collection marqu&eacute; <code class="literal">inverse="true"</code>. Voir la discussion sur les associations bidirectionnelles plus tard dans ce chapitre. 
                  </p>
                  <p>Cet exemple montre une map d'entit&eacute;s <code class="literal">Part</code> par nom (o&ugrave; <code class="literal">partName</code> est une propri&eacute;t&eacute; persistante de <code class="literal">Part</code>). Notez l'utilisation d'un index bas&eacute; sur une formule. 
                  </p><pre class="programlisting">&lt;map name="parts"
        cascade="all"&gt;
    &lt;key column="productId" not-null="true"/&gt;
    &lt;map-key formula="partName"/&gt;
    &lt;one-to-many class="Part"/&gt;
&lt;/map&gt;</pre></div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="collections-advancedmappings"></a>6.3.&nbsp;Mappings de collection avanc&eacute;s
                        </h2>
                     </div>
                  </div>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="collections-sorted"></a>6.3.1.&nbsp;Collections tri&eacute;es
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Hibernate supporte des collections impl&eacute;mentant <code class="literal">java.util.SortedMap</code> et <code class="literal">java.util.SortedSet</code>. Vous devez sp&eacute;cifier un comparateur dans le fichier de mapping : 
                  </p><pre class="programlisting">&lt;set name="aliases" 
            table="person_aliases" 
            sort="natural"&gt;
    &lt;key column="person"/&gt;
    &lt;element column="name" type="string"/&gt;
&lt;/set&gt;

&lt;map name="holidays" sort="my.custom.HolidayComparator"&gt;
    &lt;key column="year_id"/&gt;
    &lt;map-key column="hol_name" type="string"/&gt;
    &lt;element column="hol_date" type="date"/&gt;
&lt;/map&gt;</pre><p>Les valeurs permises pour l'attribut <code class="literal">sort</code> sont <code class="literal">unsorted</code>, <code class="literal">natural</code> et le nom d'une classe impl&eacute;mentant <code class="literal">java.util.Comparator</code>. 
                  </p>
                  <p>Les collections tri&eacute;es se comportent r&eacute;ellement comme <code class="literal">java.util.TreeSet</code> ou <code class="literal">java.util.TreeMap</code>. 
                  </p>
                  <p>Si vous voulez que la base de donn&eacute;es elle-m&ecirc;me ordonne les &eacute;l&eacute;ments de la collection, utilisez l'attribut <code class="literal">order-by</code> des mappings <code class="literal">set</code>, <code class="literal">bag</code> ou <code class="literal">map</code>. Cette solution est seulement disponible &agrave; partir du JDK 1.4 (c'est impl&eacute;ment&eacute; en utilisant <code class="literal">LinkedHashSet</code> ou <code class="literal">LinkedHashMap</code>). Ceci ex&eacute;cute le tri dans la requ&ecirc;te SQL, pas en m&eacute;moire. 
                  </p><pre class="programlisting">&lt;set name="aliases" table="person_aliases" order-by="lower(name) asc"&gt;
    &lt;key column="person"/&gt;
    &lt;element column="name" type="string"/&gt;
&lt;/set&gt;

&lt;map name="holidays" order-by="hol_date, hol_name"&gt;
    &lt;key column="year_id"/&gt;
    &lt;map-key column="hol_name" type="string"/&gt;
    &lt;element column="hol_date type="date"/&gt;
&lt;/map&gt;</pre><p>Notez que la valeur de l'attribut <code class="literal">order-by</code> est un ordre SQL, pas un ordre HQL ! 
                  </p>
                  <p>Les associations peuvent m&ecirc;me &ecirc;tre tri&eacute;es sur des crit&egrave;res arbitraires &agrave; l'ex&eacute;cution en utilisant un <code class="literal">filter()</code> de collection. 
                  </p><pre class="programlisting">sortedUsers = s.createFilter( group.getUsers(), "order by this.name" ).list();</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="collections-bidirectional"></a>6.3.2.&nbsp;Associations bidirectionnelles
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>A <span class="emphasis"><em>bidirectional association</em></span> allows navigation from both "ends" of the association. Two kinds of bidirectional association are supported: 
                  </p>
                  <div class="variablelist">
                     <dl>
                        <dt><span class="term">un-vers-plusieurs (NdT : one-to-many)</span></dt>
                        <dd>
                           <p>ensemble ou sac &agrave; une extr&eacute;mit&eacute;, une seule valeur &agrave; l'autre </p>
                        </dd>
                        <dt><span class="term">plusieurs-vers-plusieurs (NdT : many-to-many)</span></dt>
                        <dd>
                           <p>ensemble ou sac aux deux extr&eacute;mit&eacute;s </p>
                        </dd>
                     </dl>
                  </div>
                  <p>
                     
                     
                  </p>
                  <p>Vous pouvez sp&eacute;cifier une association plusieurs-vers-plusieurs bidirectionnelle simplement en mappant deux associations plusieurs-vers-plusieurs
                     vers la m&ecirc;me table de base de donn&eacute;es et en d&eacute;clarant une extr&eacute;mit&eacute; comme <span class="emphasis"><em>inverse</em></span> (celle de votre choix, mais &ccedil;a ne peut pas &ecirc;tre une collection index&eacute;e). 
                  </p>
                  <p>Voici un exemple d'association bidirectionnelle plusieurs-vers-plusieurs ; chaque cat&eacute;gorie peut avoir plusieurs objets et
                     chaque objet peut &ecirc;tre dans plusieurs cat&eacute;gories : 
                  </p><pre class="programlisting">&lt;class name="Category"&gt;
    &lt;id name="id" column="CATEGORY_ID"/&gt;
    ...
    &lt;bag name="items" table="CATEGORY_ITEM"&gt;
        &lt;key column="CATEGORY_ID"/&gt;
        &lt;many-to-many class="Item" column="ITEM_ID"/&gt;
    &lt;/bag&gt;
&lt;/class&gt;

&lt;class name="Item"&gt;
    &lt;id name="id" column="ITEM_ID"/&gt;
    ...

    &lt;!-- inverse end --&gt;
    &lt;bag name="categories" table="CATEGORY_ITEM" inverse="true"&gt;
        &lt;key column="ITEM_ID"/&gt;
        &lt;many-to-many class="Category" column="CATEGORY_ID"/&gt;
    &lt;/bag&gt;
&lt;/class&gt;</pre><p>Les changements faits uniquement sur l'extr&eacute;mint&eacute; inverse de l'association <span class="emphasis"><em>ne sont pas</em></span> persist&eacute;s. Ceci signifie qu'Hibernate a deux repr&eacute;sentations en m&eacute;moire pour chaque association bidirectionnelles, un lien
                     de A vers B et un autre de B vers A. C'est plus facile &agrave; comprendre si vous pensez au mod&egrave;le objet de Java et comment nous
                     cr&eacute;ons une relation plusieurs-vers-plusieurs en Java : 
                  </p><pre class="programlisting">
category.getItems().add(item);          // The category now "knows" about the relationship
item.getCategories().add(category);     // The item now "knows" about the relationship

session.persist(item);                   // The relationship won't be saved!
session.persist(category);               // The relationship will be saved</pre><p>La partie non-inverse est utilis&eacute;e pour sauvegarder la repr&eacute;sentation en m&eacute;moire dans la base de donn&eacute;es. </p>
                  <p>Vous pouvez d&eacute;finir une association un-vers-plusieurs bidirectionnelle en mappant une association un-vers-plusieurs vers la(es)
                     m&ecirc;me(s) colonne(s) de table qu'une association plusieurs-vers-un et en d&eacute;clarant l'extr&eacute;mit&eacute; pluri-valu&eacute;e <code class="literal">inverse="true"</code>. 
                  </p><pre class="programlisting">&lt;class name="Parent"&gt;
    &lt;id name="id" column="parent_id"/&gt;
    ....
    &lt;set name="children" inverse="true"&gt;
        &lt;key column="parent_id"/&gt;
        &lt;one-to-many class="Child"/&gt;
    &lt;/set&gt;
&lt;/class&gt;

&lt;class name="Child"&gt;
    &lt;id name="id" column="child_id"/&gt;
    ....
    &lt;many-to-one name="parent" 
        class="Parent" 
        column="parent_id"
        not-null="true"/&gt;
&lt;/class&gt;</pre><p>Mapper une extr&eacute;mit&eacute; d'une association avec <code class="literal">inverse="true"</code> n'affecte pas l'op&eacute;ration de cascades, ce sont des concepts orthogonaux ! 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="collections-indexedbidirectional"></a>6.3.3.&nbsp;Associations bidirectionnelles avec des collections index&eacute;es
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une association bidirectionnelle o&ugrave; une extr&eacute;mit&eacute; est repr&eacute;sent&eacute;e comme une <code class="literal">&lt;list&gt;</code> ou une <code class="literal">&lt;map&gt;</code> requiert une consid&eacute;ration sp&eacute;ciale. Si il y a une propri&eacute;t&eacute; de la classe enfant qui mappe la colonne de l'index, pas de
                     probl&egrave;me, nous pouvons continuer &agrave; utiliser <code class="literal">inverse="true"</code> sur le mapping de la collection : 
                  </p><pre class="programlisting">&lt;class name="Parent"&gt;
    &lt;id name="id" column="parent_id"/&gt;
    ....
    &lt;map name="children" inverse="true"&gt;
        &lt;key column="parent_id"/&gt;
        &lt;map-key column="name" 
            type="string"/&gt;
        &lt;one-to-many class="Child"/&gt;
    &lt;/map&gt;
&lt;/class&gt;

&lt;class name="Child"&gt;
    &lt;id name="id" column="child_id"/&gt;
    ....
    &lt;property name="name" 
        not-null="true"/&gt;
    &lt;many-to-one name="parent" 
        class="Parent" 
        column="parent_id"
        not-null="true"/&gt;
&lt;/class&gt;</pre><p>Mais, si il n'y a pas de telle prorpri&eacute;t&eacute; sur la classe enfant, nous ne pouvons pas penser &agrave; l'association comme vraiment
                     bidirectionnelle (il y a des informations disponibles &agrave; une extr&eacute;mit&eacute; de l'association qui ne sont pas disponibles &agrave; l'autre
                     extr&eacute;mit&eacute;). Dans ce cas, nous ne pouvons pas mapper la collection <code class="literal">inverse="true"</code>. &Agrave; la place, nous pourrions utiliser le mapping suivant : 
                  </p><pre class="programlisting">&lt;class name="Parent"&gt;
    &lt;id name="id" column="parent_id"/&gt;
    ....
    &lt;map name="children"&gt;
        &lt;key column="parent_id"
            not-null="true"/&gt;
        &lt;map-key column="name" 
            type="string"/&gt;
        &lt;one-to-many class="Child"/&gt;
    &lt;/map&gt;
&lt;/class&gt;

&lt;class name="Child"&gt;
    &lt;id name="id" column="child_id"/&gt;
    ....
    &lt;many-to-one name="parent" 
        class="Parent" 
        column="parent_id"
        insert="false"
        update="false"
        not-null="true"/&gt;
&lt;/class&gt;</pre><p>Notez que dans ce mapping, l'extr&eacute;mit&eacute; de l'association contenant la collection est responsable des mises &agrave; jour de la clef
                     &eacute;trang&egrave;re. &Agrave; faire : cela entra&icirc;ne-t-il r&eacute;ellement des expressions updates inutiles ? 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="collections-ternary"></a>6.3.4.&nbsp;Associations ternaires
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Il y a trois approches possibles pour mapper une association ternaire. L'une est d'utiliser une <code class="literal">Map</code> avec une association en tant qu'index : 
                  </p><pre class="programlisting">&lt;map name="contracts"&gt;
    &lt;key column="employer_id" not-null="true"/&gt;
    &lt;map-key-many-to-many column="employee_id" class="Employee"/&gt;
    &lt;one-to-many class="Contract"/&gt;
&lt;/map&gt;</pre><pre class="programlisting">&lt;map name="connections"&gt;
    &lt;key column="incoming_node_id"/&gt;
    &lt;map-key-many-to-many column="outgoing_node_id" class="Node"/&gt;
    &lt;many-to-many column="connection_id" class="Connection"/&gt;
&lt;/map&gt;</pre><p>Une seconde approche est simplement de remodeler l'association comme une classe d'entit&eacute;. C'est l'approche la plus commune.
                     
                  </p>
                  <p>Une alternative finale est d'utiliser des &eacute;l&eacute;ments composites, dont nous discuterons plus tard. </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="collections-idbag"></a>6.3.5.&nbsp;<code class="literal">Utiliser un <code class="literal">&lt;idbag&gt;</code></code></h3>
                        </div>
                     </div>
                  </div>
                  <p>Si vous embrassez pleinement notre vue que les clefs compos&eacute;es sont une mauvaise chose et que des entit&eacute;s devraient avoir
                     des identifiants artificiels (des clefs subrog&eacute;es), alors vous pourriez trouver un peu curieux que les associations plusieurs-vers-plusieurs
                     et les collections de valeurs que nous avons montr&eacute; jusqu'ici mappent toutes des tables avec des clefs compos&eacute;es ! Maintenant,
                     ce point est assez discutable ; une table d'association pure ne semble pas beaucoup b&eacute;n&eacute;ficier d'une clef subrog&eacute;e (bien qu'une
                     collection de valeur compos&eacute;es le <span class="emphasis"><em>pourrait</em></span>). N&eacute;anmoins, Hibernate fournit une foncionnalit&eacute; qui vous permet de mapper des associations plusieurs-vers-plusieurs et des
                     collections de valeurs vers une table avec une clef subrog&eacute;e. 
                  </p>
                  <p>L'&eacute;l&eacute;ment <code class="literal">&lt;idbag&gt;</code> vous laisse mapper une <code class="literal">List</code> (ou une <code class="literal">Collection</code>) avec une s&eacute;mantique de sac. 
                  </p><pre class="programlisting">&lt;idbag name="lovers" table="LOVERS"&gt;
    &lt;collection-id column="ID" type="long"&gt;
        &lt;generator class="sequence"/&gt;
    &lt;/collection-id&gt;
    &lt;key column="PERSON1"/&gt;
    &lt;many-to-many column="PERSON2" class="Person" fetch="join"/&gt;
&lt;/idbag&gt;</pre><p>Comme vous pouvez voir, un <code class="literal">&lt;idbag&gt;</code> a un g&eacute;n&eacute;r&eacute;teur d'id artificiel, comme une classe d'entit&eacute; ! Une clef subrog&eacute;e diff&eacute;rente est assign&eacute;e &agrave; chaque ligne de
                     la collection. Cependant, Hibernate ne fournit pas de m&eacute;canisme pour d&eacute;couvrir la valeur d'une clef subrog&eacute;e d'une ligne particuli&egrave;re.
                     
                  </p>
                  <p>Notez que les performances de la mise &agrave; jour d'un <code class="literal">&lt;idbag&gt;</code> sont <span class="emphasis"><em>bien</em></span> meilleures qu'un <code class="literal">&lt;bag&gt;</code> ordinaire ! Hibernate peut localiser des lignes individuelles efficacement et les mettre &agrave; jour ou les effacer individuellement,
                     comme une liste, une map ou un ensemble. 
                  </p>
                  <p>Dans l'impl&eacute;mentation actuelle, la strat&eacute;gie de la g&eacute;n&eacute;ration de l'identifiant <code class="literal">native</code> n'est pas support&eacute;e pour les identifiants de collection <code class="literal">&lt;idbag&gt;</code>. 
                  </p>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="collections-example"></a>6.4.&nbsp;Exemples de collections
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Les sections pr&eacute;c&eacute;dentes sont assez confuses. Donc prenons un exemple. Cette classe : </p><pre class="programlisting">package eg;
import java.util.Set;

public class Parent {
    private long id;
    private Set children;

    public long getId() { return id; }
    private void setId(long id) { this.id=id; }

    private Set getChildren() { return children; }
    private void setChildren(Set children) { this.children=children; }

    ....
    ....
}</pre><p>a une collection d'instances de <code class="literal">Child</code>. Si chaque enfant a au plus un parent, le mapping le plus naturel est une association un-vers-plusieurs : 
               </p><pre class="programlisting">&lt;hibernate-mapping&gt;

    &lt;class name="Parent"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;
        &lt;set name="children"&gt;
            &lt;key column="parent_id"/&gt;
            &lt;one-to-many class="Child"/&gt;
        &lt;/set&gt;
    &lt;/class&gt;

    &lt;class name="Child"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;
        &lt;property name="name"/&gt;
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre><p>Ceci mappe les d&eacute;finitions de tables suivantes : </p><pre class="programlisting">create table parent ( id bigint not null primary key )
create table child ( id bigint not null primary key, name varchar(255), parent_id bigint )
alter table child add constraint childfk0 (parent_id) references parent</pre><p>Si le parent est <span class="emphasis"><em>requis</em></span>, utilisez une association un-vers-plusieurs unidirectionnelle : 
               </p><pre class="programlisting">&lt;hibernate-mapping&gt;

    &lt;class name="Parent"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;
        &lt;set name="children" inverse="true"&gt;
            &lt;key column="parent_id"/&gt;
            &lt;one-to-many class="Child"/&gt;
        &lt;/set&gt;
    &lt;/class&gt;

    &lt;class name="Child"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;
        &lt;property name="name"/&gt;
        &lt;many-to-one name="parent" class="Parent" column="parent_id" not-null="true"/&gt;
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre><p>Notez la contrainte <code class="literal">NOT NULL</code> : 
               </p><pre class="programlisting">create table parent ( id bigint not null primary key )
create table child ( id bigint not null
                     primary key,
                     name varchar(255),
                     parent_id bigint not null )
alter table child add constraint childfk0 (parent_id) references parent</pre><p>Alternativement, si vous insistez absolument pour que cette association soit unidirectionnelle, vous pouvez d&eacute;clarer la contrainte
                  <code class="literal">NOT NULL</code> sur le mapping <code class="literal">&lt;key&gt;</code> : 
               </p><pre class="programlisting">&lt;hibernate-mapping&gt;

    &lt;class name="Parent"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;
        &lt;set name="children"&gt;
            &lt;key column="parent_id" not-null="true"/&gt;
            &lt;one-to-many class="Child"/&gt;
        &lt;/set&gt;
    &lt;/class&gt;

    &lt;class name="Child"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;
        &lt;property name="name"/&gt;
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre><p>D'un autre c&ocirc;t&eacute;, si un enfant pouvait avoir plusieurs parent, une association plusieurs-vers-plusieurs est plus appropri&eacute;e
                  : 
               </p><pre class="programlisting">&lt;hibernate-mapping&gt;

    &lt;class name="Parent"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;
        &lt;set name="children" table="childset"&gt;
            &lt;key column="parent_id"/&gt;
            &lt;many-to-many class="Child" column="child_id"/&gt;
        &lt;/set&gt;
    &lt;/class&gt;

    &lt;class name="Child"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;
        &lt;property name="name"/&gt;
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre><p>D&eacute;finitions des tables : </p><pre class="programlisting">create table parent ( id bigint not null primary key )
create table child ( id bigint not null primary key, name varchar(255) )
create table childset ( parent_id bigint not null,
                        child_id bigint not null,
                        primary key ( parent_id, child_id ) )
alter table childset add constraint childsetfk0 (parent_id) references parent
alter table childset add constraint childsetfk1 (child_id) references child</pre><p>Pour plus d'exemples et une revue compl&egrave;te du mapping de la relation parent/enfant, voir see <a href="#example-parentchild" title="Chapitre&nbsp;21.&nbsp;Exemple : P&egrave;re/Fils">Chapitre&nbsp;21, <i xmlns:xlink="http://www.w3.org/1999/xlink">Exemple : P&egrave;re/Fils</i></a>. 
               </p>
               <p>Des mappings d'association plus exotiques sont possibles, nous cataloguerons toutes les possibilit&eacute;s dans le prochain chapitre.
                  
               </p>
            </div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="associations"></a>Chapitre&nbsp;7.&nbsp;Mapper les associations
                     </h2>
                  </div>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="assoc-intro"></a>7.1.&nbsp;Introduction
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Correctement mapper les associations est souvent la t&acirc;che la plus difficile. Dans cette section nous traiterons les cas classiques
                  les uns apr&egrave;s les autres. Nous commencerons d'abbord par les mappings unidirectionnels, puis nous aborderons la question des
                  mappings bidirectionnels. Nous illustrerons tous nos exemples avec les classes <code class="literal">Person</code> et <code class="literal">Address</code>. 
               </p>
               <p>Nous utiliserons deux crit&egrave;res pour classer les associations : le premier sera de savoir si l'association est b&acirc;ti sur une
                  table suppl&eacute;mentaire d'association et le deuxieme sera bas&eacute; sur la multiplicit&eacute; de cette association. 
               </p>
               <p>Autoriser une cl&eacute; &eacute;trang&egrave;re nulle est consid&eacute;r&eacute; comme un mauvais choix dans la construction d'un mod&egrave;le de donn&eacute;es. Nous supposerons
                  donc que dans tous les exemples qui vont suivre on aura interdit la valeur nulle pour les cl&eacute;s &eacute;trang&egrave;res. Attention, ceci
                  ne veut pas dire que Hibernate ne supporte pas les cl&eacute;s &eacute;trang&egrave;res pouvant prendre des valeurs nulles, les exemples qui suivent
                  continueront de fonctionner si vous d&eacute;cidiez ne plus imposer la contrainte de non-nullit&eacute; sur les cl&eacute;s &eacute;trang&egrave;res. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="assoc-unidirectional"></a>7.2.&nbsp;Association unidirectionnelle
                        </h2>
                     </div>
                  </div>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="assoc-unidirectional-m21"></a>7.2.1.&nbsp;plusieurs &agrave; un
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une <span class="emphasis"><em>association plusieurs-&agrave;-un (many-to-one) unidirectionnelle </em></span> est le type que l'on rencontre le plus souvent dans les associations unidirectionnelles. 
                  </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="id" column="personId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;many-to-one name="address" 
        column="addressId"
        not-null="true"/&gt;
&lt;/class&gt;

&lt;class name="Address"&gt;
    &lt;id name="id" column="addressId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
&lt;/class&gt;</pre><pre class="programlisting">
create table Person ( personId bigint not null primary key, addressId bigint not null )
create table Address ( addressId bigint not null primary key )
        </pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="assoc-unidirectional-121"></a>7.2.2.&nbsp;one to one
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>une <span class="emphasis"><em>association un-&agrave;-un (one-to-one) sur une cl&eacute; &eacute;trang&egrave;re</em></span> est presque identique. La seule diff&eacute;rence est sur la contrainte d'unicit&eacute; que l'on impose &agrave; cette colonne. 
                  </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="id" column="personId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;many-to-one name="address" 
        column="addressId" 
        unique="true"
        not-null="true"/&gt;
&lt;/class&gt;

&lt;class name="Address"&gt;
    &lt;id name="id" column="addressId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
&lt;/class&gt;</pre><pre class="programlisting">
create table Person ( personId bigint not null primary key, addressId bigint not null unique )
create table Address ( addressId bigint not null primary key )
        </pre><p>Une <span class="emphasis"><em>association un-&agrave;-un (one-to-one) unidirectionnelle sur une cl&eacute; primaire</em></span> utilise un g&eacute;n&eacute;rateur d'identifiant particulier. (Remarquez que nous avons invers&eacute; le sens de cette association dans cet
                     exemple.) 
                  </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="id" column="personId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
&lt;/class&gt;

&lt;class name="Address"&gt;
    &lt;id name="id" column="personId"&gt;
        &lt;generator class="foreign"&gt;
            &lt;param name="property"&gt;person&lt;/param&gt;
        &lt;/generator&gt;
    &lt;/id&gt;
    &lt;one-to-one name="person" constrained="true"/&gt;
&lt;/class&gt;</pre><pre class="programlisting">
create table Person ( personId bigint not null primary key )
create table Address ( personId bigint not null primary key )
        </pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="assoc-unidirectional-12m"></a>7.2.3.&nbsp;un &agrave; plusieurs
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une <span class="emphasis"><em>association un-&agrave;-plusieurs (one-to-many) unidirectionnelle sur une cl&eacute; &eacute;trang&egrave;re</em></span> est vraiment inhabituelle, et n'est pas vraiment recommand&eacute;e. 
                  </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="id" column="personId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;set name="addresses"&gt;
        &lt;key column="personId" 
            not-null="true"/&gt;
        &lt;one-to-many class="Address"/&gt;
    &lt;/set&gt;
&lt;/class&gt;

&lt;class name="Address"&gt;
    &lt;id name="id" column="addressId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
&lt;/class&gt;</pre><pre class="programlisting">
create table Person ( personId bigint not null primary key )
create table Address ( addressId bigint not null primary key, personId bigint not null )
        </pre><p>Nous pensons qu'il est pr&eacute;f&eacute;rable d'utiliser une table de jointure pour ce type d'association. </p>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="assoc-unidirectional-join"></a>7.3.&nbsp;Associations unidirectionnelles avec tables de jointure
                        </h2>
                     </div>
                  </div>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="assoc-unidirectional-join-12m"></a>7.3.1.&nbsp;un &agrave; plusieurs
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une <span class="emphasis"><em>association unidirectionnelle un-&agrave;-plusieurs (one-to-many) avec une table de jointure</em></span> est un bien meilleur choix. Remarquez qu'en sp&eacute;cifiant <code class="literal">unique="true"</code>, on a chang&eacute; la multiplicit&eacute; plusieurs-&agrave;-plusieurs (many-to-many) pour un-&agrave;-plusieurs (one-to-many). 
                  </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="id" column="personId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;set name="addresses" table="PersonAddress"&gt;
        &lt;key column="personId"/&gt;
        &lt;many-to-many column="addressId"
            unique="true"
            class="Address"/&gt;
    &lt;/set&gt;
&lt;/class&gt;

&lt;class name="Address"&gt;
    &lt;id name="id" column="addressId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
&lt;/class&gt;</pre><pre class="programlisting">
create table Person ( personId bigint not null primary key )
create table PersonAddress ( personId not null, addressId bigint not null primary key )
create table Address ( addressId bigint not null primary key )
        </pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="assoc-unidirectional-join-m21"></a>7.3.2.&nbsp;plusieurs &agrave; un
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une <span class="emphasis"><em>assiociation plusieurs-&agrave;-un (many-to-one) unidirectionnelle sur une table de jointure</em></span> est tr&egrave;s fr&eacute;quente quand l'association est optionnelle. 
                  </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="id" column="personId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;join table="PersonAddress" 
        optional="true"&gt;
        &lt;key column="personId" unique="true"/&gt;
        &lt;many-to-one name="address"
            column="addressId" 
            not-null="true"/&gt;
    &lt;/join&gt;
&lt;/class&gt;

&lt;class name="Address"&gt;
    &lt;id name="id" column="addressId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
&lt;/class&gt;</pre><pre class="programlisting">
create table Person ( personId bigint not null primary key )
create table PersonAddress ( personId bigint not null primary key, addressId bigint not null )
create table Address ( addressId bigint not null primary key )
        </pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="assoc-unidirectional-join-121"></a>7.3.3.&nbsp;one to one
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une <span class="emphasis"><em>association unidirectionnelle un-&agrave;-un (one-to-one) sur une table de jointure</em></span> est extr&egrave;mement rare mais envisageable. 
                  </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="id" column="personId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;join table="PersonAddress" 
        optional="true"&gt;
        &lt;key column="personId" 
            unique="true"/&gt;
        &lt;many-to-one name="address"
            column="addressId" 
            not-null="true"
            unique="true"/&gt;
    &lt;/join&gt;
&lt;/class&gt;

&lt;class name="Address"&gt;
    &lt;id name="id" column="addressId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
&lt;/class&gt;</pre><pre class="programlisting">
create table Person ( personId bigint not null primary key )
create table PersonAddress ( personId bigint not null primary key, addressId bigint not null unique )
create table Address ( addressId bigint not null primary key )
        </pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="assoc-unidirectional-join-m2m"></a>7.3.4.&nbsp;plusieurs &agrave; plusieurs
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Finallement, nous avons <span class="emphasis"><em>l'association unidirectionnelle plusieurs-&agrave;-plusieurs (many-to-many)</em></span>. 
                  </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="id" column="personId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;set name="addresses" table="PersonAddress"&gt;
        &lt;key column="personId"/&gt;
        &lt;many-to-many column="addressId"
            class="Address"/&gt;
    &lt;/set&gt;
&lt;/class&gt;

&lt;class name="Address"&gt;
    &lt;id name="id" column="addressId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
&lt;/class&gt;</pre><pre class="programlisting">
create table Person ( personId bigint not null primary key )
create table PersonAddress ( personId bigint not null, addressId bigint not null, primary key (personId, addressId) )
create table Address ( addressId bigint not null primary key )
        </pre></div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="assoc-bidirectional"></a>7.4.&nbsp;Associations bidirectionnelles
                        </h2>
                     </div>
                  </div>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="assoc-bidirectional-m21"></a>7.4.1.&nbsp;un &agrave; plusieurs / plusieurs &agrave; un
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une <span class="emphasis"><em>association bidirectionnelle plusieurs &agrave; un (many-to-one)</em></span> est le type d'association que l'on rencontre le plus souvent. (c'est la fa&ccedil;on standard de cr&eacute;er des relations parents/enfants.)
                     
                  </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="id" column="personId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;many-to-one name="address" 
        column="addressId"
        not-null="true"/&gt;
&lt;/class&gt;

&lt;class name="Address"&gt;
    &lt;id name="id" column="addressId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;set name="people" inverse="true"&gt;
        &lt;key column="addressId"/&gt;
        &lt;one-to-many class="Person"/&gt;
    &lt;/set&gt;
&lt;/class&gt;</pre><pre class="programlisting">
create table Person ( personId bigint not null primary key, addressId bigint not null )
create table Address ( addressId bigint not null primary key )
        </pre><p>Si vous utilisez une <code class="literal">List</code> (ou toute autre collection index&eacute;e) vous devez param&eacute;trer la colonne <code class="literal">key</code> de la cl&eacute; &eacute;trang&egrave;re &agrave; <code class="literal">not null</code>, et laisser Hibernate g&eacute;rer l'association depuis l'extr&eacute;mit&eacute; collection pour maintenir l'index de chaque &eacute;l&eacute;ment (rendant
                     l'autre extr&eacute;mit&eacute; virtuellement inverse en param&eacute;trant <code class="literal">update="false"</code> et <code class="literal">insert="false"</code>): 
                  </p><pre class="programlisting">&lt;class name="Person"&gt;
   &lt;id name="id"/&gt;
   ...
   &lt;many-to-one name="address"
      column="addressId"
      not-null="true"
      insert="false"
      update="false"/&gt;
&lt;/class&gt;

&lt;class name="Address"&gt;
   &lt;id name="id"/&gt;
   ...
   &lt;list name="people"&gt;
      &lt;key column="addressId" not-null="true"/&gt;
      &lt;list-index column="peopleIdx"/&gt;
      &lt;one-to-many class="Person"/&gt;
   &lt;/list&gt;
&lt;/class&gt;</pre><p>It is important that you define <code class="literal">not-null="true"</code> on the <code class="literal">&lt;key&gt;</code> element of the collection mapping if the underlying foreign key column is <code class="literal">NOT NULL</code>. Don't only declare <code class="literal">not-null="true"</code> on a possible nested <code class="literal">&lt;column&gt;</code> element, but on the <code class="literal">&lt;key&gt;</code> element. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="assoc-bidirectional-121"></a>7.4.2.&nbsp;one to one
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une <span class="emphasis"><em>association bidirectionnelle un &agrave; un (one-to-one) sur une cl&eacute; &eacute;trang&egrave;re</em></span> est aussi tr&egrave;s fr&eacute;quente. 
                  </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="id" column="personId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;many-to-one name="address" 
        column="addressId" 
        unique="true"
        not-null="true"/&gt;
&lt;/class&gt;

&lt;class name="Address"&gt;
    &lt;id name="id" column="addressId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
   &lt;one-to-one name="person" 
        property-ref="address"/&gt;
&lt;/class&gt;</pre><pre class="programlisting">
create table Person ( personId bigint not null primary key, addressId bigint not null unique )
create table Address ( addressId bigint not null primary key )
        </pre><p>Une <span class="emphasis"><em>association bidirectionnelle un-&agrave;-un (one-to-one) sur une cl&eacute; primaire</em></span> utilise un g&eacute;n&eacute;rateur particulier d'id. 
                  </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="id" column="personId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;one-to-one name="address"/&gt;
&lt;/class&gt;

&lt;class name="Address"&gt;
    &lt;id name="id" column="personId"&gt;
        &lt;generator class="foreign"&gt;
            &lt;param name="property"&gt;person&lt;/param&gt;
        &lt;/generator&gt;
    &lt;/id&gt;
    &lt;one-to-one name="person" 
        constrained="true"/&gt;
&lt;/class&gt;</pre><pre class="programlisting">
create table Person ( personId bigint not null primary key )
create table Address ( personId bigint not null primary key )
        </pre></div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="assoc-bidirectional-join"></a>7.5.&nbsp;Associations bidirectionnelles avec table de jointure
                        </h2>
                     </div>
                  </div>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="assoc-bidirectional-join-12m"></a>7.5.1.&nbsp;un &agrave; plusieurs / plusieurs &agrave; un
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une <span class="emphasis"><em>association bidirectionnelle un-&agrave;-plusieurs (one-to-many) sur une table de jointure </em></span>. Remarquez que <code class="literal">inverse="true"</code> peut s'appliquer sur les deux extr&eacute;mit&eacute;s de l' association, sur la collection, ou sur la jointure. 
                  </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="id" column="personId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;set name="addresses" 
        table="PersonAddress"&gt;
        &lt;key column="personId"/&gt;
        &lt;many-to-many column="addressId"
            unique="true"
            class="Address"/&gt;
    &lt;/set&gt;
&lt;/class&gt;

&lt;class name="Address"&gt;
    &lt;id name="id" column="addressId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;join table="PersonAddress" 
        inverse="true" 
        optional="true"&gt;
        &lt;key column="addressId"/&gt;
        &lt;many-to-one name="person"
            column="personId"
            not-null="true"/&gt;
    &lt;/join&gt;
&lt;/class&gt;</pre><pre class="programlisting">
create table Person ( personId bigint not null primary key )
create table PersonAddress ( personId bigint not null, addressId bigint not null primary key )
create table Address ( addressId bigint not null primary key )
        </pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="assoc-bidirectional-join-121"></a>7.5.2.&nbsp;one to one
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une <span class="emphasis"><em>association bidirectionnelle un-&agrave;-un (one-to-one) sur une table de jointure</em></span> est extr&egrave;mement rare mais envisageable. 
                  </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="id" column="personId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;join table="PersonAddress" 
        optional="true"&gt;
        &lt;key column="personId" 
            unique="true"/&gt;
        &lt;many-to-one name="address"
            column="addressId" 
            not-null="true"
            unique="true"/&gt;
    &lt;/join&gt;
&lt;/class&gt;

&lt;class name="Address"&gt;
    &lt;id name="id" column="addressId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;join table="PersonAddress" 
        optional="true"
        inverse="true"&gt;
        &lt;key column="addressId" 
            unique="true"/&gt;
        &lt;many-to-one name="person"
            column="personId" 
            not-null="true"
            unique="true"/&gt;
    &lt;/join&gt;
&lt;/class&gt;</pre><pre class="programlisting">
create table Person ( personId bigint not null primary key )
create table PersonAddress ( personId bigint not null primary key, addressId bigint not null unique )
create table Address ( addressId bigint not null primary key )
        </pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="assoc-bidirectional-join-m2m"></a>7.5.3.&nbsp;plusieurs &agrave; plusieurs
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Finallement nous avons <span class="emphasis"><em>l'association bidirectionnelle plusieurs &agrave; plusieurs</em></span>. 
                  </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="id" column="personId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;set name="addresses" table="PersonAddress"&gt;
        &lt;key column="personId"/&gt;
        &lt;many-to-many column="addressId"
            class="Address"/&gt;
    &lt;/set&gt;
&lt;/class&gt;

&lt;class name="Address"&gt;
    &lt;id name="id" column="addressId"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;set name="people" inverse="true" table="PersonAddress"&gt;
        &lt;key column="addressId"/&gt;
        &lt;many-to-many column="personId"
            class="Person"/&gt;
    &lt;/set&gt;
&lt;/class&gt;</pre><pre class="programlisting">
create table Person ( personId bigint not null primary key )
create table PersonAddress ( personId bigint not null, addressId bigint not null, primary key (personId, addressId) )
create table Address ( addressId bigint not null primary key )
        </pre></div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="assoc-complex"></a>7.6.&nbsp;Des mappings plus complexes
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Des associations encore plus complexes sont <span class="emphasis"><em>extr&ecirc;mement</em></span> rares. Hibernate permet de g&eacute;rer des situations plus complexes en utilisant des parties SQL dans les fichiers de mapping.
                  Par exemple, si une table avec l'historiques des informations d'un compte d&eacute;finit les colonnes <code class="literal">accountNumber</code>, <code class="literal">effectiveEndDate</code> et <code class="literal">effectiveStartDate</code>, mapp&eacute;es de telle sorte: 
               </p><pre class="programlisting">&lt;properties name="currentAccountKey"&gt;
    &lt;property name="accountNumber" type="string" not-null="true"/&gt;
    &lt;property name="currentAccount" type="boolean"&gt;
        &lt;formula&gt;case when effectiveEndDate is null then 1 else 0 end&lt;/formula&gt;
    &lt;/property&gt;
&lt;/properties&gt;
&lt;property name="effectiveEndDate" type="date"/&gt;
&lt;property name="effectiveStateDate" type="date" not-null="true"/&gt;</pre><p>alors nous pouvons mapper une association &agrave; l'instance <span class="emphasis"><em>courante</em></span> (celle avec une <code class="literal">effectiveEndDate</code>) nulle en utilisant: 
               </p><pre class="programlisting">&lt;many-to-one name="currentAccountInfo" 
        property-ref="currentAccountKey"
        class="AccountInfo"&gt;
    &lt;column name="accountNumber"/&gt;
    &lt;formula&gt;'1'&lt;/formula&gt;
&lt;/many-to-one&gt;</pre><p>Dans un exemple plus complexe, imaginez qu'une association entre <code class="literal">Employee</code> et <code class="literal">Organization</code> est g&eacute;r&eacute;e dans une table <code class="literal">Employment</code> pleines de donn&eacute;es historiques. Dans ce cas, une association vers l'employeur <span class="emphasis"><em>le plus r&eacute;cent</em></span> (celui avec la <code class="literal">startDate</code> la plus r&eacute;cente) pourrait &ecirc;tre mapp&eacute;e comme cela: 
               </p><pre class="programlisting">&lt;join&gt;
    &lt;key column="employeeId"/&gt;
    &lt;subselect&gt;
        select employeeId, orgId 
        from Employments 
        group by orgId 
        having startDate = max(startDate)
    &lt;/subselect&gt;
    &lt;many-to-one name="mostRecentEmployer" 
            class="Organization" 
            column="orgId"/&gt;
&lt;/join&gt;</pre><p>Vous pouvez &ecirc;tre cr&eacute;atif grace &agrave; ces possibilit&eacute;s, mais il est g&eacute;n&eacute;ralement plus pratique d'utiliser des requ&ecirc;tes HQL ou criteria
                  dans ce genre de situation. 
               </p>
            </div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="components"></a>Chapitre&nbsp;8.&nbsp;Mapping de composants
                     </h2>
                  </div>
               </div>
            </div>
            <p>La notion de <span class="emphasis"><em>composants</em></span> est r&eacute;utilis&eacute; dans diff&eacute;rents contextes, avec diff&eacute;rents objectifs, &agrave; travers Hibernate. 
            </p>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="components-dependentobjects"></a>8.1.&nbsp;Objects d&eacute;pendants
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Le composant est un objet inclu dans un autre qui est sauvegard&eacute; comme une valeur, et non pas comme une entit&eacute;. Le composant
                  fait r&eacute;f&eacute;rence &agrave; la notion (au sens objet) de composition (et non pas de composant au sens d'architecture de composants).
                  Par exemple on pourrait mod&eacute;lis&eacute; l'objet personne de cette fa&ccedil;on: 
               </p><pre class="programlisting">public class Person {
    private java.util.Date birthday;
    private Name name;
    private String key;
    public String getKey() {
        return key;
    }
    private void setKey(String key) {
        this.key=key;
    }
    public java.util.Date getBirthday() {
        return birthday;
    }
    public void setBirthday(java.util.Date birthday) {
        this.birthday = birthday;
    }
    public Name getName() {
        return name;
    }
    public void setName(Name name) {
        this.name = name;
    }
    ......
    ......
}</pre><pre class="programlisting">public class Name {
    char initial;
    String first;
    String last;
    public String getFirst() {
        return first;
    }
    void setFirst(String first) {
        this.first = first;
    }
    public String getLast() {
        return last;
    }
    void setLast(String last) {
        this.last = last;
    }
    public char getInitial() {
        return initial;
    }
    void setInitial(char initial) {
        this.initial = initial;
    }
}</pre><p>Maintenant <code class="literal">Name</code> peut-&ecirc;tre sauvegard&eacute; comme un composant de <code class="literal">Person</code>. Remarquer que <code class="literal">Name</code> d&eacute;finit des methodes d'acc&egrave;s et de modification pour ses propri&eacute;t&eacute;s persistantes, mais il n'a pas besoin des interfaces ou
                  des propri&eacute;t&eacute;s d'identification ( par exemple getId() ) qui sont propres aux entit&eacute;s. 
               </p>
               <p>Nous serions alors amen&eacute; &agrave; mapper ce composant de cette fa&ccedil;on: </p><pre class="programlisting">&lt;class name="eg.Person" table="person"&gt;
    &lt;id name="Key" column="pid" type="string"&gt;
        &lt;generator class="uuid"/&gt;
    &lt;/id&gt;
    &lt;property name="birthday" type="date"/&gt;
    &lt;component name="Name" class="eg.Name"&gt; &lt;!-- class attribute optional --&gt;
        &lt;property name="initial"/&gt;
        &lt;property name="first"/&gt;
        &lt;property name="last"/&gt;
    &lt;/component&gt;
&lt;/class&gt;</pre><p>La table person aurai les colonnes <code class="literal">pid</code>, <code class="literal">birthday</code>, <code class="literal">initial</code>, <code class="literal">first</code> and <code class="literal">last</code>. 
               </p>
               <p>Comme tous les types valeurs, les composants ne supportent pas les r&eacute;f&eacute;rences partag&eacute;s. En d'autres mots, deux instances de
                  person peuvent avoir un m&ecirc;me nom, mais ces noms sont ind&eacute;pendants, ils peuvent &ecirc;tre identiques si on les compare par valeur
                  mais ils repr&eacute;sentent deux objets distincts en m&eacute;moire. La notion de nullit&eacute; pour un composant est <span class="emphasis"><em>ad hoc</em></span>. Quand il recharge l'objet qui contient le composant, Hibernate supposera que si tous les champs du composants sont nuls
                  alors le composant sera positionn&eacute; &agrave; la valeur null. Ce choix programmatif devrait &ecirc;tre satisfaisant dans la plupart des cas.
                  
               </p>
               <p>Les propri&eacute;t&eacute;s d'un composant peuvent &ecirc;tre de tous les types qu'Hibernate supporte habituellement (collections, many-to-one
                  associations, autres composants, etc). Les composants inclus ne doivent <span class="emphasis"><em>pas</em></span> &ecirc;tre vus comme quelque chose d'exotique. Hibernate a &eacute;t&eacute; con&ccedil;u pour supporter un mod&egrave;le objet tr&egrave;s granulaire. 
               </p>
               <p>Le <code class="literal">&lt;component&gt;</code> peut inclure dans la liste de ses propri&eacute;t&eacute;s une r&eacute;f&eacute;rence au <code class="literal">&lt;parent&gt;</code> conteneur. 
               </p><pre class="programlisting">&lt;class name="eg.Person" table="person"&gt;
    &lt;id name="Key" column="pid" type="string"&gt;
        &lt;generator class="uuid"/&gt;
    &lt;/id&gt;
    &lt;property name="birthday" type="date"/&gt;
    &lt;component name="Name" class="eg.Name" unique="true"&gt;
        &lt;parent name="namedPerson"/&gt; &lt;!-- reference back to the Person --&gt;
        &lt;property name="initial"/&gt;
        &lt;property name="first"/&gt;
        &lt;property name="last"/&gt;
    &lt;/component&gt;
&lt;/class&gt;</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="components-incollections"></a>8.2.&nbsp;Collection d'objets d&eacute;pendants
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Les collections d'objets d&eacute;pendants sont support&eacute;s (exemple: un tableau de type <code class="literal">Name</code>). D&eacute;clarer la collection de composants en rempla&ccedil;ant le tag <code class="literal">&lt;element&gt;</code> par le tag <code class="literal">&lt;composite-element&gt;</code>. 
               </p><pre class="programlisting">&lt;set name="someNames" table="some_names" lazy="true"&gt;
    &lt;key column="id"/&gt;
    &lt;composite-element class="eg.Name"&gt; &lt;!-- class attribute required --&gt;
        &lt;property name="initial"/&gt;
        &lt;property name="first"/&gt;
        &lt;property name="last"/&gt;
    &lt;/composite-element&gt;
&lt;/set&gt;</pre><p>Remarque: Si vous d&eacute;finissez un <code class="literal">Set</code> d'&eacute;l&eacute;ment composite, il est tr&egrave;s important d'impl&eacute;menter la m&eacute;thode <code class="literal">equals()</code> et <code class="literal">hashCode()</code> correctement. 
               </p>
               <p>Les &eacute;lements composite peuvent aussi contenir des composants mais pas des collections. Si votre &eacute;l&eacute;ment composite contient
                  aussi des composants, utilisez l'&eacute;l&eacute;ment <code class="literal">&lt;nested-composite-element&gt;</code> . Une collections de composants qui ccontiennent eux-m&ecirc;mes des composants est un cas tr&egrave;s exotique. A ce stade demandez-vous
                  si une association un-&agrave;-plusieurs ne serait pas plus appropri&eacute;. Essayez de re remodeler votre &eacute;l&eacute;ment composite comme une
                  entit&eacute; ( Dans ce cas m&ecirc;me si le mod&egrave;le Java est le m&ecirc;me la logique de persitence et de relation sont tout de m&ecirc;me diff&eacute;rentes)
                  
               </p>
               <p>Remarque, le mapping d'&eacute;l&eacute;ments composites ne supporte pas la nullit&eacute; des propri&eacute;t&eacute;s lorsqu'on utilise un <code class="literal">&lt;set&gt;</code>. Hibernate lorsqu'il supprime un objet utilise chaque colonne pour identifier un objet (on ne peut pas utiliser des cl&eacute;s
                  primaires distinctes dans une table d'&eacute;l&eacute;ments composites), ce qui n'est pas possible avec des valeurs nulles. Vous devez
                  donc choisir d'interdire la nullit&eacute; des propri&eacute;t&eacute;s d'un &eacute;l&eacute;ment composite ou choisir un autre type de collection comme : <code class="literal">&lt;list&gt;</code>, <code class="literal">&lt;map&gt;</code>, <code class="literal">&lt;bag&gt;</code> ou <code class="literal">&lt;idbag&gt;</code>. 
               </p>
               <p>Un cas particulier d'&eacute;l&eacute;ment composite est un &eacute;l&eacute;ment composite qui inclut un &eacute;l&eacute;ment <code class="literal">&lt;many-to-one&gt;</code>. Un mapping comme celui-ci vous permet d'associer les colonnes d'une table d'association plusieurs &agrave; plusieurs (many-to-many)
                  &agrave; la classse de l'&eacute;l&eacute;ment composite. L'exemple suivant est une association plusieurs &agrave; plusieurs de <code class="literal">Order</code> &agrave; <code class="literal">Item</code> &agrave; <code class="literal">purchaseDate</code>, <code class="literal">price</code> et <code class="literal">quantity</code> sont des propri&eacute;t&eacute;s de l'association. 
               </p><pre class="programlisting">&lt;class name="eg.Order" .... &gt;
    ....
    &lt;set name="purchasedItems" table="purchase_items" lazy="true"&gt;
        &lt;key column="order_id"&gt;
        &lt;composite-element class="eg.Purchase"&gt;
            &lt;property name="purchaseDate"/&gt;
            &lt;property name="price"/&gt;
            &lt;property name="quantity"/&gt;
            &lt;many-to-one name="item" class="eg.Item"/&gt; &lt;!-- class attribute is optional --&gt;
        &lt;/composite-element&gt;
    &lt;/set&gt;
&lt;/class&gt;</pre><p>Bien s&ucirc;r, il ne peut pas y avoir de r&eacute;f&eacute;rence &agrave; l'achat (purchase) depuis l'article (item), pour pouvoir naviguer de fa&ccedil;on
                  bidirectionnelle dans l'association. N'oubliez pas que les composants sont de type valeurs et n'autorise pas les r&eacute;f&eacute;rences
                  partag&eacute;es. 
               </p>
               <p>M&ecirc;me les associations ternaires ou quaternaires sont possibles:</p><pre class="programlisting">&lt;class name="eg.Order" .... &gt;
    ....
    &lt;set name="purchasedItems" table="purchase_items" lazy="true"&gt;
        &lt;key column="order_id"&gt;
        &lt;composite-element class="eg.OrderLine"&gt;
            &lt;many-to-one name="purchaseDetails class="eg.Purchase"/&gt;
            &lt;many-to-one name="item" class="eg.Item"/&gt;
        &lt;/composite-element&gt;
    &lt;/set&gt;
&lt;/class&gt;</pre><p>Les &eacute;l&eacute;ments composites peuvent appara&icirc;tre dans les requ&ecirc;tes en utilisant la m&ecirc;me syntaxe que associations </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="components-asmapindex"></a>8.3.&nbsp;Utiliser les composants comme index de map
                        </h2>
                     </div>
                  </div>
               </div>
               <p>l'&eacute;l&eacute;ment <code class="literal">&lt;composite-map-key&gt;</code> vous permet d'utiliser une classe de composant comme indice de <code class="literal">Map</code>. Assurez-vous d'avoir surd&eacute;fini <code class="literal">hashCode()</code> et <code class="literal">equals()</code> dans la classe du composant. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="components-compositeid"></a>8.4.&nbsp;Utiliser un composant comme identifiant
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Vous pouvez utiliser un composant comme identifiant d'une entit&eacute;. Mais pour cela la classe du composant doit respecter certaines
                  r&egrave;gles. 
               </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p>Elle doit impl&eacute;menter <code class="literal">java.io.Serializable</code>. 
                        </p>
                     </li>
                     <li>
                        <p>Elle doit red&eacute;finir <code class="literal">equals()</code> et <code class="literal">hashCode()</code>, de fa&ccedil;on coh&eacute;rente avec le fait qu'elle d&eacute;finit une cl&eacute; composite dans la base de donn&eacute;es. 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>
                  <span class="emphasis"><em>Remarque: avec hibernate3, la seconde r&egrave;gle n'est plus absolument necessaire mais fa&icirc;tes le quand m&ecirc;me.</em></span>
                  
               </p>
               <p>Vous ne pouvez pas utiliser de <code class="literal">IdentifierGenerator</code> pour g&eacute;n&eacute;rer une cl&eacute; composite, l'application devra d&eacute;finir elle m&ecirc;me ses propres identifiants. 
               </p>
               <p>Utiliser l'&eacute;l&eacute;ment <code class="literal">&lt;composite-id&gt;</code> (en incluant l'&eacute;l&eacute;ment <code class="literal">&lt;key-property&gt;</code>) &agrave; la place de l'habituel d&eacute;claration <code class="literal">&lt;id&gt;</code>. Par exemple la classe <code class="literal">OrderLine</code> qui d&eacute;pend de la cl&eacute; primaire (composite) de <code class="literal">Order</code>. 
               </p><pre class="programlisting">&lt;class name="OrderLine"&gt;
    
    &lt;composite-id name="id" class="OrderLineId"&gt;
        &lt;key-property name="lineId"/&gt;
        &lt;key-property name="orderId"/&gt;
        &lt;key-property name="customerId"/&gt;
    &lt;/composite-id&gt;
    
    &lt;property name="name"/&gt;
    
    &lt;many-to-one name="order" class="Order"
            insert="false" update="false"&gt;
        &lt;column name="orderId"/&gt;
        &lt;column name="customerId"/&gt;
    &lt;/many-to-one&gt;
    ....
    
&lt;/class&gt;</pre><p>Maintenant toutes cl&eacute;s &eacute;trang&egrave;res r&eacute;f&eacute;ren&ccedil;ant la table <code class="literal">OrderLine</code> devra aussi &ecirc;tre composite. Vous devez en tenir compte lorsque vous &eacute;crivez vos mapping d'association pour les autres classes.
                  Une association &agrave; <code class="literal">OrderLine</code> devrait &ecirc;tre mapp&eacute; de la fa&ccedil;on suivante : 
               </p><pre class="programlisting">&lt;many-to-one name="orderLine" class="OrderLine"&gt;
&lt;!-- the "class" attribute is optional, as usual --&gt;
    &lt;column name="lineId"/&gt;
    &lt;column name="orderId"/&gt;
    &lt;column name="customerId"/&gt;
&lt;/many-to-one&gt;</pre><p>(Remarque: l'&eacute;l&eacute;ment <code class="literal">&lt;column&gt;</code> est une alternative &agrave; l'attribut <code class="literal">column</code> que l'on utilise partout.) 
               </p>
               <p>Une association <code class="literal">plusieurs-&agrave;-plusieurs</code> (many-to-many) &agrave; <code class="literal">OrderLine</code> utilisera aussi une cl&eacute; &eacute;trang&egrave;re composite: 
               </p><pre class="programlisting">&lt;set name="undeliveredOrderLines"&gt;
    &lt;key column name="warehouseId"/&gt;
    &lt;many-to-many class="OrderLine"&gt;
        &lt;column name="lineId"/&gt;
        &lt;column name="orderId"/&gt;
        &lt;column name="customerId"/&gt;
    &lt;/many-to-many&gt;
&lt;/set&gt;</pre><p>La collection des <code class="literal">OrderLine</code>s dans <code class="literal">Order</code> utilisera: 
               </p><pre class="programlisting">&lt;set name="orderLines" inverse="true"&gt;
    &lt;key&gt;
        &lt;column name="orderId"/&gt;
        &lt;column name="customerId"/&gt;
    &lt;/key&gt;
    &lt;one-to-many class="OrderLine"/&gt;
&lt;/set&gt;</pre><p>(L'&eacute;l&eacute;ment <code class="literal">&lt;one-to-many&gt;</code>, comme d'habitude, ne d&eacute;clare pas de colonne.) 
               </p>
               <p>Si <code class="literal">OrderLine</code> lui-m&ecirc;me poss&egrave;de une collection, celle-ci aura aussi une cl&eacute; composite &eacute;trang&egrave;re. 
               </p><pre class="programlisting">&lt;class name="OrderLine"&gt;
    ....
    ....
    &lt;list name="deliveryAttempts"&gt;
        &lt;key&gt;   &lt;!-- a collection inherits the composite key type --&gt;
            &lt;column name="lineId"/&gt;
            &lt;column name="orderId"/&gt;
            &lt;column name="customerId"/&gt;
        &lt;/key&gt;
        &lt;list-index column="attemptId" base="1"/&gt;
        &lt;composite-element class="DeliveryAttempt"&gt;
            ...
        &lt;/composite-element&gt;
    &lt;/set&gt;
&lt;/class&gt;</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="components-dynamic"></a>8.5.&nbsp;Composant Dynamique
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Vous pouvez m&ecirc;me mapper une propri&eacute;t&eacute; de type <code class="literal">Map</code>: 
               </p><pre class="programlisting">&lt;dynamic-component name="userAttributes"&gt;
    &lt;property name="foo" column="FOO" type="string"/&gt;
    &lt;property name="bar" column="BAR" type="integer"/&gt;
    &lt;many-to-one name="baz" class="Baz" column="BAZ_ID"/&gt;
&lt;/dynamic-component&gt;</pre><p>La s&eacute;mantique de l'association &agrave; un <code class="literal">&lt;dynamic-component&gt;</code> est identique &agrave; celle que l'on utilise pour les composants. L'avantage de ce type de mapping est qu'il pemet de d&eacute;terminer
                  les v&eacute;ritables propri&eacute;t&eacute;s du bean au moment su d&eacute;ploiement en &eacute;ditant simplement le document de mapping. La manipulation du
                  document de mapping pendant l'execution de l'application est aussi possible en utilisant un parser DOM. Il ya m&ecirc;me mieux,
                  vous pouvez acc&eacute;der (et changer) le metamodel de configuration d'hibernate en utilisant l'objet <code class="literal">Configuration</code> 
               </p>
            </div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="inheritance"></a>Chapitre&nbsp;9.&nbsp;Mapping d'h&eacute;ritage de classe
                     </h2>
                  </div>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="inheritance-strategies"></a>9.1.&nbsp;Les trois strat&eacute;gies
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Hibernate supporte les trois strat&eacute;gies d'h&eacute;ritage de base : </p>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        <p>une table par hi&eacute;rarchie de classe (table per class hierarchy) </p>
                     </li>
                     <li>
                        <p>table per subclass </p>
                     </li>
                     <li>
                        <p>une table par classe concr&egrave;te (table per concrete class) </p>
                     </li>
                  </ul>
               </div>
               <p>Hibernate supporte en plus une quatri&egrave;mestrat&eacute;gie, l&eacute;g&egrave;rement diff&eacute;rente, qui supporte le polymorphisme : </p>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        <p>le polymorphisme implicite </p>
                     </li>
                  </ul>
               </div>
               <p>Il est possible d'utiliser diff&eacute;rentes strat&eacute;gies de mapping pour diff&eacute;rentes branches d'une m&ecirc;me hi&eacute;rarchie d'h&eacute;ritage, et
                  alors d'employer le polymorphisme implicite pour r&eacute;aliser le polymorphisme &agrave; travers toute la hi&eacute;rarchie. Pourtant, Hibernate
                  ne supporte pas de m&eacute;langer des mappings <code class="literal">&lt;subclass&gt;</code> et <code class="literal">&lt;joined-subclass&gt;</code> et <code class="literal">&lt;union-subclass&gt;</code> pour le m&ecirc;me &eacute;l&eacute;ment <code class="literal">&lt;class&gt;</code> racine. Il est possible de m&eacute;langer ensemble les strat&eacute;gies d'une table par hi&eacute;rarchie et d'une table par sous-classe, pour
                  le m&ecirc;me &eacute;l&eacute;ment <code class="literal">&lt;class&gt;</code>, en combinant les &eacute;l&eacute;ments <code class="literal">&lt;subclass&gt;</code> et <code class="literal">&lt;join&gt;</code> (voir dessous). 
               </p>
               <p>Il est possible de d&eacute;finir des mappings de <code class="literal">subclass</code>, <code class="literal">union-subclass</code>, et <code class="literal">joined-subclass</code> dans des documents de mapping s&eacute;par&eacute;s, directement sous <code class="literal">hibernate-mapping</code>. Ceci vous permet d'&eacute;tendre une hi&eacute;rarchie de classe juste en ajoutant un nouveau fichier de mapping. Vous devez sp&eacute;cifier
                  un attribut <code class="literal">extends</code> dans le mapping de la sous-classe, en nommant une super-classe pr&eacute;c&eacute;demment mapp&eacute;e. Note : pr&eacute;c&eacute;demment cette foncionnalit&eacute;
                  rendait l'ordre des documents de mapping important. Depuis Hibernate3, l'ordre des fichier de mapping n'importe plus lors
                  de l'utilisation du mot-clef "extends". L'ordre &agrave; l'int&eacute;rieur d'un simple fichier de mapping impose encore de d&eacute;finir les
                  classes m&egrave;res avant les classes filles. 
               </p><pre class="programlisting">
 &lt;hibernate-mapping&gt;
     &lt;subclass name="DomesticCat" extends="Cat" discriminator-value="D"&gt;
          &lt;property name="name" type="string"/&gt;
     &lt;/subclass&gt;
 &lt;/hibernate-mapping&gt;</pre><div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="inheritance-tableperclass"></a>9.1.1.&nbsp;Une table par hi&eacute;rarchie de classe
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Supposons que nous ayons une interface <code class="literal">Payment</code>, impl&eacute;ment&eacute;e par <code class="literal">CreditCardPayment</code>, <code class="literal">CashPayment</code>, <code class="literal">ChequePayment</code>. La strat&eacute;gie une table par hi&eacute;rarchie serait : 
                  </p><pre class="programlisting">&lt;class name="Payment" table="PAYMENT"&gt;
    &lt;id name="id" type="long" column="PAYMENT_ID"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;discriminator column="PAYMENT_TYPE" type="string"/&gt;
    &lt;property name="amount" column="AMOUNT"/&gt;
    ...
    &lt;subclass name="CreditCardPayment" discriminator-value="CREDIT"&gt;
        &lt;property name="creditCardType" column="CCTYPE"/&gt;
        ...
    &lt;/subclass&gt;
    &lt;subclass name="CashPayment" discriminator-value="CASH"&gt;
        ...
    &lt;/subclass&gt;
    &lt;subclass name="ChequePayment" discriminator-value="CHEQUE"&gt;
        ...
    &lt;/subclass&gt;
&lt;/class&gt;</pre><p>Une seule table est requise. Une grande limitation de cette strat&eacute;gie est que les colonnes d&eacute;clar&eacute;es par les classes filles,
                     telles que <code class="literal">CCTYPE</code>, ne peuvent avoir de contrainte <code class="literal">NOT NULL</code>. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="inheritance-tablepersubclass"></a>9.1.2.&nbsp;Une table par classe fille
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>La strat&eacute;gie une table par classe fille serait : </p><pre class="programlisting">&lt;class name="Payment" table="PAYMENT"&gt;
    &lt;id name="id" type="long" column="PAYMENT_ID"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;property name="amount" column="AMOUNT"/&gt;
    ...
    &lt;joined-subclass name="CreditCardPayment" table="CREDIT_PAYMENT"&gt;
        &lt;key column="PAYMENT_ID"/&gt;
        &lt;property name="creditCardType" column="CCTYPE"/&gt;
        ...
    &lt;/joined-subclass&gt;
    &lt;joined-subclass name="CashPayment" table="CASH_PAYMENT"&gt;
        &lt;key column="PAYMENT_ID"/&gt;
        ...
    &lt;/joined-subclass&gt;
    &lt;joined-subclass name="ChequePayment" table="CHEQUE_PAYMENT"&gt;
        &lt;key column="PAYMENT_ID"/&gt;
        ...
    &lt;/joined-subclass&gt;
&lt;/class&gt;</pre><p>Quatre tables sont requises. Les trois tables des classes filles ont une cl&eacute; primaire associ&eacute;e &agrave; la table classe m&egrave;re (le
                     mod&egrave;le relationnel est une association un-vers-un). 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="inheritance-tablepersubclass-discriminator"></a>9.1.3.&nbsp;Une table par classe fille, en utilisant un discriminant
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Notez que l'impl&eacute;mentation Hibernate de la strat&eacute;gie un table par classe fille ne n&eacute;cessite pas de colonne discriminante dans
                     la table classe m&egrave;re. D'autres impl&eacute;mentations de mappers Objet/Relationnel utilisent une autre impl&eacute;mentation de la strat&eacute;gie
                     une table par classe fille qui n&eacute;cessite une colonne de type discriminant dans la table de la classe m&egrave;re. L'approche prise
                     par Hibernate est plus difficile &agrave; impl&eacute;menter mais plus correcte d'une point de vue relationnel. Si vous aimeriez utiliser
                     une colonne discriminante avec la strat&eacute;gie d'une table par classe fille, vous pourriez combiner l'utilisation de <code class="literal">&lt;subclass&gt;</code> et <code class="literal">&lt;join&gt;</code>, comme suit : 
                  </p><pre class="programlisting">&lt;class name="Payment" table="PAYMENT"&gt;
    &lt;id name="id" type="long" column="PAYMENT_ID"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;discriminator column="PAYMENT_TYPE" type="string"/&gt;
    &lt;property name="amount" column="AMOUNT"/&gt;
    ...
    &lt;subclass name="CreditCardPayment" discriminator-value="CREDIT"&gt;
        &lt;join table="CREDIT_PAYMENT"&gt;
            &lt;key column="PAYMENT_ID"/&gt;
            &lt;property name="creditCardType" column="CCTYPE"/&gt;
            ...
        &lt;/join&gt;
    &lt;/subclass&gt;
    &lt;subclass name="CashPayment" discriminator-value="CASH"&gt;
        &lt;join table="CASH_PAYMENT"&gt;
            &lt;key column="PAYMENT_ID"/&gt;
            ...
        &lt;/join&gt;
    &lt;/subclass&gt;
    &lt;subclass name="ChequePayment" discriminator-value="CHEQUE"&gt;
        &lt;join table="CHEQUE_PAYMENT" fetch="select"&gt;
            &lt;key column="PAYMENT_ID"/&gt;
            ...
        &lt;/join&gt;
    &lt;/subclass&gt;
&lt;/class&gt;</pre><p>La d&eacute;claration optionnelle <code class="literal">fetch="select"</code> indique &agrave; Hibernate de ne pas r&eacute;cup&eacute;rer les donn&eacute;es de la classe fille <code class="literal">ChequePayment</code> par une jointure externe lors des requ&ecirc;tes sur la classe m&egrave;re. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="inheritance-mixing-tableperclass-tablepersubclass"></a>9.1.4.&nbsp;M&eacute;lange d'une table par hi&eacute;rarchie de classe avec une table par classe fille
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Vous pouvez m&ecirc;me m&eacute;langer les strat&eacute;gies d'une table par hi&eacute;rarchie de classe et d'une table par classe fille en utilisant
                     cette approche : 
                  </p><pre class="programlisting">&lt;class name="Payment" table="PAYMENT"&gt;
    &lt;id name="id" type="long" column="PAYMENT_ID"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;discriminator column="PAYMENT_TYPE" type="string"/&gt;
    &lt;property name="amount" column="AMOUNT"/&gt;
    ...
    &lt;subclass name="CreditCardPayment" discriminator-value="CREDIT"&gt;
        &lt;join table="CREDIT_PAYMENT"&gt;
            &lt;property name="creditCardType" column="CCTYPE"/&gt;
            ...
        &lt;/join&gt;
    &lt;/subclass&gt;
    &lt;subclass name="CashPayment" discriminator-value="CASH"&gt;
        ...
    &lt;/subclass&gt;
    &lt;subclass name="ChequePayment" discriminator-value="CHEQUE"&gt;
        ...
    &lt;/subclass&gt;
&lt;/class&gt;</pre><p>Pour importe laquelle de ces strat&eacute;gies, une association polymorphique vers la classe racine <code class="literal">Payment</code> est mapp&eacute;e en utilisant <code class="literal">&lt;many-to-one&gt;</code>. 
                  </p><pre class="programlisting">&lt;many-to-one name="payment" column="PAYMENT_ID" class="Payment"/&gt;</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="inheritance-tableperconcrete"></a>9.1.5.&nbsp;Une table par classe concr&egrave;te
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Il y a deux mani&egrave;res d'utiliser la strat&eacute;gie d'une table par classe concr&egrave;te. La premi&egrave;re est d'employer <code class="literal">&lt;union-subclass&gt;</code>. 
                  </p><pre class="programlisting">&lt;class name="Payment"&gt;
    &lt;id name="id" type="long" column="PAYMENT_ID"&gt;
        &lt;generator class="sequence"/&gt;
    &lt;/id&gt;
    &lt;property name="amount" column="AMOUNT"/&gt;
    ...
    &lt;union-subclass name="CreditCardPayment" table="CREDIT_PAYMENT"&gt;
        &lt;property name="creditCardType" column="CCTYPE"/&gt;
        ...
    &lt;/union-subclass&gt;
    &lt;union-subclass name="CashPayment" table="CASH_PAYMENT"&gt;
        ...
    &lt;/union-subclass&gt;
    &lt;union-subclass name="ChequePayment" table="CHEQUE_PAYMENT"&gt;
        ...
    &lt;/union-subclass&gt;
&lt;/class&gt;</pre><p>Trois tables sont n&eacute;cessaires pour les classes filles. Chaque table d&eacute;finit des colonnes pour toutes les propri&eacute;t&eacute;s de la
                     classe, incluant les propri&eacute;t&eacute;s h&eacute;rit&eacute;&eacute;s. 
                  </p>
                  <p>La limitation de cette approche est que si une propri&eacute;t&eacute; est mapp&eacute;e sur la classe m&egrave;re, le nom de la colonne doit &ecirc;tre le
                     m&ecirc;me pour toutes les classes filles. (Nous pourrions &ecirc;tre plus souple dans une future version d'Hibernate). La strat&eacute;gie du
                     g&eacute;n&eacute;rateur d'identifiant n'est pas permise dans l'h&eacute;ritage de classes filles par union, en effet la valeur (NdT : seed) de
                     la clef primaire doit &ecirc;tre partag&eacute;e par toutes les classes filles "union" d'une hi&eacute;rarchie. 
                  </p>
                  <p>Si votre classe m&egrave;re est abstraite, mappez la avec <code class="literal">abstract="true"</code>. Bien s&ucirc;r, si elle n'est pas abstraite, une table suppl&eacute;mentaire (par d&eacute;faut, <code class="literal">PAYMENT</code> dans l'exemple ci-dessus) est requise pour contenir des instances de la classe m&egrave;re. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="inheritance-tableperconcreate-polymorphism"></a>9.1.6.&nbsp;Une table par classe concr&egrave;te, en utilisant le polymorphisme implicite
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une approche alternative est l'emploi du polymorphisme implicite : </p><pre class="programlisting">&lt;class name="CreditCardPayment" table="CREDIT_PAYMENT"&gt;
    &lt;id name="id" type="long" column="CREDIT_PAYMENT_ID"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;property name="amount" column="CREDIT_AMOUNT"/&gt;
    ...
&lt;/class&gt;

&lt;class name="CashPayment" table="CASH_PAYMENT"&gt;
    &lt;id name="id" type="long" column="CASH_PAYMENT_ID"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;property name="amount" column="CASH_AMOUNT"/&gt;
    ...
&lt;/class&gt;

&lt;class name="ChequePayment" table="CHEQUE_PAYMENT"&gt;
    &lt;id name="id" type="long" column="CHEQUE_PAYMENT_ID"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;property name="amount" column="CHEQUE_AMOUNT"/&gt;
    ...
&lt;/class&gt;</pre><p>Notez que nulle part nous ne mentionnons l'interface <code class="literal">Payment</code> explicitement. Notez aussi que des propri&eacute;t&eacute;s de <code class="literal">Payment</code> sont mapp&eacute;es dans chaque classe fille. Si vous voulez &eacute;viter des duplications, consid&eacute;rez l'utilisation des entit&eacute;s XML (cf.
                     <code class="literal">[ &lt;!ENTITY allproperties SYSTEM "allproperties.xml"&gt; ]</code> dans la d&eacute;claration du <code class="literal">DOCTYPE</code> et <code class="literal">&amp;allproperties;</code> dans le mapping). 
                  </p>
                  <p>L'inconv&eacute;nient de cette approche est qu'Hibernate ne g&eacute;n&egrave;re pas d'<code class="literal">UNION</code>s SQL lors de l'ex&eacute;cution des requ&ecirc;tes polymorphiques. 
                  </p>
                  <p>Pour cette strat&eacute;gie de mapping, une association polymorphique pour <code class="literal">Payment</code> est habituellement mapp&eacute;e en utilisant <code class="literal">&lt;any&gt;</code>. 
                  </p><pre class="programlisting">&lt;any name="payment" meta-type="string" id-type="long"&gt;
    &lt;meta-value value="CREDIT" class="CreditCardPayment"/&gt;
    &lt;meta-value value="CASH" class="CashPayment"/&gt;
    &lt;meta-value value="CHEQUE" class="ChequePayment"/&gt;
    &lt;column name="PAYMENT_CLASS"/&gt;
    &lt;column name="PAYMENT_ID"/&gt;
&lt;/any&gt;</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="inheritace-mixingpolymorphism"></a>9.1.7.&nbsp;M&eacute;lange du polymorphisme implicite avec d'autres mappings d'h&eacute;ritage
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Il y a une chose suppl&eacute;mentaire &agrave; noter &agrave; propos de ce mapping. Puisque les classes filles sont chacune mapp&eacute;es avec leur
                     propre &eacute;l&eacute;ment <code class="literal">&lt;class&gt;</code> (et puisque <code class="literal">Payment</code> est juste une interface), chaque classe fille pourrait facilement faire partie d'une autre hi&eacute;rarchie d'h&eacute;ritage ! (Et vous
                     pouvez encore faire des requ&ecirc;tes polymorphiques pour l'interface <code class="literal">Payment</code>). 
                  </p><pre class="programlisting">&lt;class name="CreditCardPayment" table="CREDIT_PAYMENT"&gt;
    &lt;id name="id" type="long" column="CREDIT_PAYMENT_ID"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;discriminator column="CREDIT_CARD" type="string"/&gt;
    &lt;property name="amount" column="CREDIT_AMOUNT"/&gt;
    ...
    &lt;subclass name="MasterCardPayment" discriminator-value="MDC"/&gt;
    &lt;subclass name="VisaPayment" discriminator-value="VISA"/&gt;
&lt;/class&gt;

&lt;class name="NonelectronicTransaction" table="NONELECTRONIC_TXN"&gt;
    &lt;id name="id" type="long" column="TXN_ID"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    ...
    &lt;joined-subclass name="CashPayment" table="CASH_PAYMENT"&gt;
        &lt;key column="PAYMENT_ID"/&gt;
        &lt;property name="amount" column="CASH_AMOUNT"/&gt;
        ...
    &lt;/joined-subclass&gt;
    &lt;joined-subclass name="ChequePayment" table="CHEQUE_PAYMENT"&gt;
        &lt;key column="PAYMENT_ID"/&gt;
        &lt;property name="amount" column="CHEQUE_AMOUNT"/&gt;
        ...
    &lt;/joined-subclass&gt;
&lt;/class&gt;</pre><p>Encore une fois, nous ne mentionnons pas explicitement <code class="literal">Payment</code>. Si nous ex&eacute;cutons une requ&ecirc;te sur l'interface <code class="literal">Payment</code> - par exemple, <code class="literal">from Payment</code> - Hibernate retournera automatiquement les instances de <code class="literal">CreditCardPayment</code> (et ses classes filles puisqu'elles impl&eacute;mentent aussi <code class="literal">Payment</code>), <code class="literal">CashPayment</code> et <code class="literal">ChequePayment</code> mais pas les instances de <code class="literal">NonelectronicTransaction</code>. 
                  </p>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="inheritance-limitations"></a>9.2.&nbsp;Limitations
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Il y a certaines limitations &agrave; l'approche du "polymorphisme implicite" pour la strat&eacute;gie de mapping d'une table par classe
                  concr&egrave;te. Il y a plut&ocirc;t moins de limitations restrictives aux mappings <code class="literal">&lt;union-subclass&gt;</code>. 
               </p>
               <p>La table suivante montre les limitations des mappings d'une table par classe concr&egrave;te, et du polymorphisme implicite, dans
                  Hibernate. 
               </p>
               <div class="table"><a name="d0e9013"></a><p class="title"><b>Tableau&nbsp;9.1.&nbsp;Caract&eacute;ristiques du mapping d'h&eacute;ritage</b></p>
                  <div class="table-contents">
                     <table summary="Caract&eacute;ristiques du mapping d'h&eacute;ritage" border="1">
                        <colgroup>
                           <col align="left">
                           <col align="left">
                           <col align="left">
                           <col align="left">
                           <col align="left">
                           <col align="left">
                           <col align="left">
                           <col align="left">
                        </colgroup>
                        <thead>
                           <tr>
                              <th align="left">Strat&eacute;gie d'h&eacute;ritage</th>
                              <th align="left">many-to-one polymorphique</th>
                              <th align="left">one-to-one polymorphique</th>
                              <th align="left">one-to-many polymorphique</th>
                              <th align="left">many-to-many polymorphique</th>
                              <th align="left">Polymorphic <code class="literal">load()/get()</code></th>
                              <th align="left">Requ&ecirc;tes polymorphiques</th>
                              <th align="left">Jointures polymorphiques</th>
                              <th align="left">R&eacute;cup&eacute;ration par jointure externe</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr>
                              <td align="left">une table par hi&eacute;rarchie de classe</td>
                              <td align="left"><code class="literal">&lt;many-to-one&gt;</code></td>
                              <td align="left"><code class="literal">&lt;one-to-one&gt;</code></td>
                              <td align="left"><code class="literal">&lt;one-to-many&gt;</code></td>
                              <td align="left"><code class="literal">&lt;many-to-many&gt;</code></td>
                              <td align="left"><code class="literal">s.get(Payment.class, id)</code></td>
                              <td align="left"><code class="literal">from Payment p</code></td>
                              <td align="left"><code class="literal">from Order o join o.payment p</code></td>
                              <td align="left"><span class="emphasis"><em>support&eacute;e</em></span></td>
                           </tr>
                           <tr>
                              <td align="left">table per subclass</td>
                              <td align="left"><code class="literal">&lt;many-to-one&gt;</code></td>
                              <td align="left"><code class="literal">&lt;one-to-one&gt;</code></td>
                              <td align="left"><code class="literal">&lt;one-to-many&gt;</code></td>
                              <td align="left"><code class="literal">&lt;many-to-many&gt;</code></td>
                              <td align="left"><code class="literal">s.get(Payment.class, id)</code></td>
                              <td align="left"><code class="literal">from Payment p</code></td>
                              <td align="left"><code class="literal">from Order o join o.payment p</code></td>
                              <td align="left"><span class="emphasis"><em>support&eacute;e</em></span></td>
                           </tr>
                           <tr>
                              <td align="left">une table par classe concr&egrave;te (union-subclass)</td>
                              <td align="left"><code class="literal">&lt;many-to-one&gt;</code></td>
                              <td align="left"><code class="literal">&lt;one-to-one&gt;</code></td>
                              <td align="left"><code class="literal">&lt;one-to-many&gt;</code> (for <code class="literal">inverse="true"</code> only)
                              </td>
                              <td align="left"><code class="literal">&lt;many-to-many&gt;</code></td>
                              <td align="left"><code class="literal">s.get(Payment.class, id)</code></td>
                              <td align="left"><code class="literal">from Payment p</code></td>
                              <td align="left"><code class="literal">from Order o join o.payment p</code></td>
                              <td align="left"><span class="emphasis"><em>support&eacute;e</em></span></td>
                           </tr>
                           <tr>
                              <td align="left">une table par classe concr&egrave;te (polymorphisme implicite)</td>
                              <td align="left"><code class="literal">&lt;any&gt;</code></td>
                              <td align="left"><span class="emphasis"><em>not supported</em></span></td>
                              <td align="left"><span class="emphasis"><em>not supported</em></span></td>
                              <td align="left"><code class="literal">&lt;many-to-any&gt;</code></td>
                              <td align="left"><code class="literal">s.createCriteria(Payment.class).add( Restrictions.idEq(id) ).uniqueResult()</code></td>
                              <td align="left"><code class="literal">from Payment p</code></td>
                              <td align="left"><span class="emphasis"><em>not supported</em></span></td>
                              <td align="left"><span class="emphasis"><em>not supported</em></span></td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
               </div><br class="table-break"></div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="objectstate"></a>Chapitre&nbsp;10.&nbsp;Travailler avec des objets
                     </h2>
                  </div>
               </div>
            </div>
            <p>Hibernate est une solution de mapping objet/relationnel compl&egrave;te qui ne masque pas seulement au d&eacute;velopppeur les d&eacute;tails du
               syst&egrave;me de gestion de base de donn&eacute;es sous-jacent, mais offre aussi <span class="emphasis"><em>la gestion d'&eacute;tat</em></span> des objets. C'est, contrairement &agrave; la gestion de <code class="literal">statements</code> SQL dans les couches de persistance habituelles JDBC/SQL, une vue orient&eacute;e objet tr&egrave;s naturelle de la persistance dans les
               applications Java. 
            </p>
            <p>En d'autres mots, les d&eacute;veloppeurs d'applications Hibernate devrait toujours r&eacute;fl&eacute;chir &agrave; <span class="emphasis"><em>l'&eacute;tat</em></span> de leurs objets, et pas n&eacute;cessairement &agrave; l'ex&eacute;cution des expressions SQL. Cette part est prise en charge pas Hibernate et
               seulement importante pour les d&eacute;veloppeurs d'applications lors du r&eacute;glage de la performance de leur syst&egrave;me. 
            </p>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="objectstate-overview"></a>10.1.&nbsp;&Eacute;tats des objets Hibernate
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Hibernate d&eacute;finit et comprend les &eacute;tats suivants : </p>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        <p><span class="emphasis"><em>&Eacute;ph&eacute;m&egrave;re</em></span> (NdT : transient) - un objet est &eacute;ph&eacute;m&egrave;re s'il a juste &eacute;t&eacute; instanci&eacute; en utilisant l'op&eacute;rateur <code class="literal">new</code>. Il n'a aucune repr&eacute;sentation persistante dans la base de donn&eacute;es et aucune valeur d'identifiant n'a &eacute;t&eacute; assign&eacute;e. Les instances
                           &eacute;ph&eacute;m&egrave;res seront d&eacute;truites par le ramasse-miettes si l'application n'en conserve aucune r&eacute;f&eacute;rence. Utilisez la <code class="literal">Session</code> d'Hibernate pour rendre un objet persistant (et laisser Hibernate s'occuper des expressions SQL qui ont besoin d'&ecirc;tre ex&eacute;cut&eacute;es
                           pour cette transistion). 
                        </p>
                     </li>
                     <li>
                        <p><span class="emphasis"><em>Persistant</em></span> - une instance persistante a une repr&eacute;sentation dans la base de donn&eacute;es et une valeur d'identifiant. Elle pourrait avoir
                           juste &eacute;t&eacute; sauvegard&eacute;e ou charg&eacute;e, pourtant, elle est par d&eacute;finition dans la port&eacute;e d'une <code class="literal">Session</code>. Hibernate d&eacute;tectera n'importe quels changements effectu&eacute;s sur un objet dans l'&eacute;tat persistant et synchronisera l'&eacute;tat avec
                           la base de donn&eacute;es lors de la fin l'unit&eacute; de travail. Les d&eacute;veloppeurs n'ex&eacute;cutent pas d'expressions <code class="literal">UPDATE</code> ou <code class="literal">DELETE</code> manuelles lorsqu'un objet devrait &ecirc;tre rendu &eacute;ph&eacute;m&egrave;re. 
                        </p>
                     </li>
                     <li>
                        <p><span class="emphasis"><em>D&eacute;tach&eacute;</em></span> - une instance d&eacute;tach&eacute;e est un objet qui a &eacute;t&eacute; persistant, mais dont sa <code class="literal">Session</code> a &eacute;t&eacute; ferm&eacute;e. La r&eacute;f&eacute;rence &agrave; l'objet est encore valide, bien s&ucirc;r, et l'instance d&eacute;tach&eacute;e pourrait m&ecirc;me &ecirc;tre modifi&eacute;e dans
                           cet &eacute;tat. Une instance d&eacute;tach&eacute;e peut &ecirc;tre r&eacute;attach&eacute;e &agrave; une nouvelle <code class="literal">Session</code> plus tard dans le temps, la rendant (et toutes les modifications avec) de nouveau persistante. Cette fonctionnalit&eacute; rend
                           possible un mod&egrave;le de programmation pour de longues unit&eacute;s de travail qui requi&egrave;rent un temps de r&eacute;flexion de l'utilisateur.
                           Nous les appelons des <span class="emphasis"><em>conversations</em></span>, c'est-&agrave;-dire une unit&eacute; de travail du point de vue de l'utilisateur. 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Nous alons maintenant dicuster des &eacute;tats et des transitions d'&eacute;tat (et des m&eacute;thodes d'Hibernate qui d&eacute;clenchent une transition)
                  plus en d&eacute;tails. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="objectstate-makingpersistent"></a>10.2.&nbsp;Rendre des objets persistants
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Les instances nouvellement instanci&eacute;es d'une classe persistante sont consid&eacute;r&eacute;es <span class="emphasis"><em>&eacute;ph&eacute;m&egrave;res</em></span> par Hibernate. Nous pouvons rendre une instance &eacute;ph&eacute;m&egrave;re <span class="emphasis"><em>persistante</em></span> en l'associant avec une session : 
               </p><pre class="programlisting">DomesticCat fritz = new DomesticCat();
fritz.setColor(Color.GINGER);
fritz.setSex('M');
fritz.setName("Fritz");
Long generatedId = (Long) sess.save(fritz);</pre><p>Si <code class="literal">Cat</code> a un identifiant g&eacute;n&eacute;r&eacute;, l'identifiant est g&eacute;n&eacute;r&eacute; et assign&eacute; au <code class="literal">cat</code> lorsque <code class="literal">save()</code> est appel&eacute;e. Si <code class="literal">Cat</code> a un identifiant <code class="literal">assigned</code>, ou une clef compos&eacute;e, l'identifiant devrait &ecirc;tre assign&eacute; &agrave; l'instance de <code class="literal">cat</code> avant d'appeler <code class="literal">save()</code>. Vous pouvez aussi utiliser <code class="literal">persist()</code> &agrave; la place de<code class="literal">save()</code>, avec la s&eacute;mantique d&eacute;finie plus t&ocirc;t dans le brouillon d'EJB3. 
               </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p><code class="literal">persist()</code> makes a transient instance persistent. However, it doesn't guarantee that the identifier value will be assigned to the persistent
                           instance immediately, the assignment might happen at flush time. <code class="literal">persist()</code> also guarantees that it will not execute an <code class="literal">INSERT</code> statement if it is called outside of transaction boundaries. This is useful in long-running conversations with an extended
                           Session/persistence context. 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">save()</code> does guarantee to return an identifier. If an INSERT has to be executed to get the identifier ( e.g. "identity" generator,
                           not "sequence"), this INSERT happens immediately, no matter if you are inside or outside of a transaction. This is problematic
                           in a long-running conversation with an extended Session/persistence context. 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Alternativement, vous pouvez assigner l'identifiant en utilisant une version surcharg&eacute;e de <code class="literal">save()</code>. 
               </p><pre class="programlisting">DomesticCat pk = new DomesticCat();
pk.setColor(Color.TABBY);
pk.setSex('F');
pk.setName("PK");
pk.setKittens( new HashSet() );
pk.addKitten(fritz);
sess.save( pk, new Long(1234) );</pre><p>Si l'objet que vous rendez persistant a des objets associ&eacute;s (par exemple, la collection <code class="literal">kittens</code> dans l'exemple pr&eacute;c&eacute;dent), ces objets peuvent &ecirc;tre rendus persistants dans n'importe quel ordre que vous souhaitez &agrave; moins
                  que vous ayez une contrainte <code class="literal">NOT NULL</code> sur la colonne de la clef &eacute;trang&egrave;re. Il n'y a jamais de risque de violer une contrainte de clef &eacute;trang&egrave;re. Cependant, vous
                  pourriez violer une contrainte <code class="literal">NOT NULL</code> si vous appeliez <code class="literal">save()</code> sur les objets dans le mauvais ordre. 
               </p>
               <p>Habituellement, vous ne vous pr&eacute;occupez pas de ce d&eacute;tail, puisque vous utiliserez tr&egrave;s probablement la fonctionnalit&eacute; de <span class="emphasis"><em>persistance transitive</em></span> d'Hibernate pour sauvegarder les objets associ&eacute;s automatiquement. Alors, m&ecirc;me les violations de contrainte <code class="literal">NOT NULL</code> n'ont plus lieu - Hibernate prendra soin de tout. La persistance transitive est trait&eacute;e plus loin dans ce chapitre. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="objectstate-loading"></a>10.3.&nbsp;Chargement d'un objet
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Les m&eacute;thodes <code class="literal">load()</code> de <code class="literal">Session</code> vous donnent un moyen de r&eacute;cup&eacute;rer une instance persistante si vous connaissez d&eacute;j&agrave; son identifiant. <code class="literal">load()</code> prend un objet de classe et chargera l'&eacute;tat dans une instance nouvellement instanci&eacute;e de cette classe, dans un &eacute;tat persistant.
                  
               </p><pre class="programlisting">Cat fritz = (Cat) sess.load(Cat.class, generatedId);</pre><pre class="programlisting">// you need to wrap primitive identifiers
long id = 1234;
DomesticCat pk = (DomesticCat) sess.load( DomesticCat.class, new Long(id) );</pre><p>Alternativement, vous pouvez charger un &eacute;tat dans une instance donn&eacute;e : </p><pre class="programlisting">Cat cat = new DomesticCat();
// load pk's state into cat
sess.load( cat, new Long(pkId) );
Set kittens = cat.getKittens();</pre><p>Notez que <code class="literal">load()</code> l&egrave;vera une exception irr&eacute;cup&eacute;rable s'il n'y a pas de ligne correspondante dans la base de donn&eacute;es. Si la classe est mapp&eacute;e
                  avec un proxy, <code class="literal">load()</code> retourne juste un proxy non initialis&eacute; et n'acc&egrave;de en fait pas &agrave; la base de donn&eacute;es jusqu'&agrave; ce que vous invoquiez une m&eacute;thode
                  du proxy. Ce comportement est tr&egrave;s utile si vous souhaitez cr&eacute;er une association vers un objet sans r&eacute;ellement le charger
                  &agrave; partir de la base de donn&eacute;es. Cela permet aussi &agrave; de multiples instances d'&ecirc;tre charg&eacute;es comme un lot si <code class="literal">batch-size</code> est d&eacute;fini pour le mapping de la classe. 
               </p>
               <p>Si vous n'&ecirc;tes pas certain qu'une ligne correspondante existe, vous devriez utiliser la m&eacute;thode <code class="literal">get()</code>, laquelle acc&egrave;de &agrave; la base de donn&eacute;es imm&eacute;diatement et retourne null s'il n'y a pas de ligne correspondante. 
               </p><pre class="programlisting">Cat cat = (Cat) sess.get(Cat.class, id);
if (cat==null) {
    cat = new Cat();
    sess.save(cat, id);
}
return cat;</pre><p>Vous pouvez m&ecirc;me charger un objet en employant un <code class="literal">SELECT ... FOR UPDATE</code> SQL, en utilisant un <code class="literal">LockMode</code>. Voir la documentation de l'API pour plus d'informations. 
               </p><pre class="programlisting">Cat cat = (Cat) sess.get(Cat.class, id, LockMode.UPGRADE);</pre><p>Notez que n'importe quelles instances associ&eacute;es ou collections contenues <span class="emphasis"><em>ne sont pas</em></span> s&eacute;lectionn&eacute;es par <code class="literal">FOR UPDATE</code>, &agrave; moins que vous ne d&eacute;cidiez de sp&eacute;cifier <code class="literal">lock</code> ou <code class="literal">all</code> en tant que style de cascade pour l'association. 
               </p>
               <p>Il est possible de re-charger un objet et toutes ses collections &agrave; n'importe quel moment, en utilisant la m&eacute;thode <code class="literal">refresh()</code>. C'est utile lorsque des "triggers" de base de donn&eacute;es sont utilis&eacute;s pour initiliser certains propri&eacute;t&eacute;s de l'objet. 
               </p><pre class="programlisting">sess.save(cat);
sess.flush(); //force the SQL INSERT
sess.refresh(cat); //re-read the state (after the trigger executes)</pre><p>Une question importante appara&icirc;t g&eacute;n&eacute;ralement &agrave; ce point : combien (NdT : de donn&eacute;es) Hibernate charge-t-il de la base de
                  donn&eacute;es et combient de <code class="literal">SELECT</code>s utilisera-t-il ? Cela d&eacute;pent de la <span class="emphasis"><em>strat&eacute;gie de r&eacute;cup&eacute;ration</em></span> et cela est expliqu&eacute; dans <a href="#performance-fetching" title="19.1.&nbsp;Strat&eacute;gies de chargement">Section&nbsp;19.1, &laquo;&nbsp;Strat&eacute;gies de chargement&nbsp;&raquo;</a>. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="objectstate-querying"></a>10.4.&nbsp;Requ&ecirc;tage
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Si vous ne connaissez par les identifiants des objets que vous recherchez, vous avez besoin d'une requ&ecirc;te. Hibernate supporte
                  un langage de requ&ecirc;tes orient&eacute;es objet facile &agrave; utiliser mais puissant. Pour la cr&eacute;ation de requ&ecirc;tes par programmation, Hibernate
                  supporte une fonction de requ&ecirc;tage sophistiqu&eacute; Criteria et Example (QBC et QBE). Vous pouvez aussi exprimez votre requ&ecirc;te
                  dans le SQL natif de votre base de donn&eacute;es, avec un support optionnel d'Hibernate pour la conversion des ensembles de r&eacute;sultats
                  en objets. 
               </p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="objectstate-querying-executing"></a>10.4.1.&nbsp;Ex&eacute;cution de requ&ecirc;tes
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Les requ&ecirc;tes HQL et SQL natives sont repr&eacute;sent&eacute;es avec une instance de <code class="literal">org.hibernate.Query</code>. L'interface offre des m&eacute;thodes pour la liaison des param&egrave;tres, la gestion des ensembles de resultats, et pour l'ex&eacute;cution
                     de la requ&ecirc;te r&eacute;elle. Vous obtenez toujours une <code class="literal">Query</code> en utilisant la <code class="literal">Session</code> courante : 
                  </p><pre class="programlisting">List cats = session.createQuery(
    "from Cat as cat where cat.birthdate &lt; ?")
    .setDate(0, date)
    .list();

List mothers = session.createQuery(
    "select mother from Cat as cat join cat.mother as mother where cat.name = ?")
    .setString(0, name)
    .list();

List kittens = session.createQuery(
    "from Cat as cat where cat.mother = ?")
    .setEntity(0, pk)
    .list();

Cat mother = (Cat) session.createQuery(
    "select cat.mother from Cat as cat where cat = ?")
    .setEntity(0, izi)
    .uniqueResult();]]

Query mothersWithKittens = (Cat) session.createQuery(
    "select mother from Cat as mother left join fetch mother.kittens");
Set uniqueMothers = new HashSet(mothersWithKittens.list());</pre><p>Une requ&ecirc;te est g&eacute;n&eacute;ralement ex&eacute;cut&eacute;e en invoquant <code class="literal">list()</code>, le r&eacute;sultat de la requ&ecirc;te sera charg&eacute;e compl&egrave;tement dans une collection en m&eacute;moire. Les intances d'entit&eacute;s recup&eacute;r&eacute;es par
                     une requ&ecirc;te sont dans un &eacute;tat persistant. La m&eacute;thode <code class="literal">uniqueResult()</code> offre un raccourci si vous savez que votre requ&ecirc;te retournera seulement un seul objet. 
                  </p>
                  <div class="sect3" lang="fr-FR">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="objectstate-querying-executing-iterate"></a>10.4.1.1.&nbsp;It&eacute;ration de r&eacute;sultats
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>Occasionnellement, vous pourriez &ecirc;tre capable d'obtenir de meilleures performances en ex&eacute;cutant la requ&ecirc;te avec la m&eacute;thode
                        <code class="literal">iterate()</code>. Ce sera g&eacute;n&eacute;ralement seulement le cas si vous esp&eacute;rez que les intances r&eacute;elles d'entit&eacute; retourn&eacute;es par la requ&ecirc;te soient
                        d&eacute;j&agrave; charg&eacute;es dans la session ou le cache de second niveau. Si elles ne sont pas cach&eacute;es, <code class="literal">iterate()</code> sera plus lent que <code class="literal">list()</code> et pourrait n&eacute;cessiter plusieurs acc&egrave;s &agrave; la base de donn&eacute;es pour une simple requ&ecirc;te, g&eacute;n&eacute;ralement <span class="emphasis"><em>1</em></span> pour le select initial qui retourne seulement les identifiants, et <span class="emphasis"><em>n</em></span> selects suppl&eacute;mentaires pour initialiser les instances r&eacute;elles. 
                     </p><pre class="programlisting">// fetch ids
Iterator iter = sess.createQuery("from eg.Qux q order by q.likeliness").iterate();
while ( iter.hasNext() ) {
    Qux qux = (Qux) iter.next();  // fetch the object
    // something we couldnt express in the query
    if ( qux.calculateComplicatedAlgorithm() ) {
        // delete the current instance
        iter.remove();
        // dont need to process the rest
        break;
    }
}</pre></div>
                  <div class="sect3" lang="fr-FR">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="objectstate-querying-executing-tuples"></a>10.4.1.2.&nbsp;Requ&ecirc;tes qui retournent des tuples
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>Les requ&ecirc;tes d'Hibernate retournent parfois des tuples d'objets, auquel cas chaque tuple est retourn&eacute; comme un tableau : </p><pre class="programlisting">Iterator kittensAndMothers = sess.createQuery(
            "select kitten, mother from Cat kitten join kitten.mother mother")
            .list()
            .iterator();

while ( kittensAndMothers.hasNext() ) {
    Object[] tuple = (Object[]) kittensAndMothers.next();
    Cat kitten = (Cat) tuple[0];
    Cat mother = (Cat) tuple[1];
    ....
}</pre></div>
                  <div class="sect3" lang="fr-FR">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="objectstate-querying-executing-scalar"></a>10.4.1.3.&nbsp;R&eacute;sultats scalaires
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>Des requ&ecirc;tes peuvent sp&eacute;cifier une propri&eacute;t&eacute; d'une classe dans la clause <code class="literal">select</code>. Elles peuvent m&ecirc;me appeler des fonctions d'aggr&eacute;gat SQL. Les propri&eacute;t&eacute;s ou les aggr&eacute;gats sont consid&eacute;r&eacute;s comme des r&eacute;sultats
                        "scalaires" (et pas des entit&eacute;s dans un &eacute;tat persistant). 
                     </p><pre class="programlisting">Iterator results = sess.createQuery(
        "select cat.color, min(cat.birthdate), count(cat) from Cat cat " +
        "group by cat.color")
        .list()
        .iterator();

while ( results.hasNext() ) {
    Object[] row = (Object[]) results.next();
    Color type = (Color) row[0];
    Date oldest = (Date) row[1];
    Integer count = (Integer) row[2];
    .....
}</pre></div>
                  <div class="sect3" lang="fr-FR">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="objectstate-querying-executing-parameters"></a>10.4.1.4.&nbsp;Lier des param&egrave;tres
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>Des m&eacute;thodes de <code class="literal">Query</code> sont fournies pour lier des valeurs &agrave; des param&egrave;tres nomm&eacute;s ou &agrave; des param&egrave;tres de style JDBC <code class="literal">?</code>. <span class="emphasis"><em>Contrairement &agrave; JDBC, les num&eacute;ros des param&egrave;tres d'Hibernate commencent &agrave; z&eacute;ro.</em></span> Les param&egrave;tres nomm&eacute;s sont des identifiants de la forme <code class="literal">:nom</code> dans la cha&icirc;ne de caract&egrave;res de la requ&ecirc;te. Les avantages des param&egrave;tres nomm&eacute;s sont : 
                     </p>
                     <div class="itemizedlist">
                        <ul type="disc" compact>
                           <li>
                              <p>les param&egrave;tres nomm&eacute;s sont insensibles &agrave; l'ordre de leur place dans la cha&icirc;ne de la requ&ecirc;te </p>
                           </li>
                           <li>
                              <p>ils peuvent appara&icirc;tre plusieurs fois dans la m&ecirc;me requ&ecirc;te </p>
                           </li>
                           <li>
                              <p>ils sont auto-document&eacute;s </p>
                           </li>
                        </ul>
                     </div><pre class="programlisting">//named parameter (preferred)
Query q = sess.createQuery("from DomesticCat cat where cat.name = :name");
q.setString("name", "Fritz");
Iterator cats = q.iterate();</pre><pre class="programlisting">//positional parameter
Query q = sess.createQuery("from DomesticCat cat where cat.name = ?");
q.setString(0, "Izi");
Iterator cats = q.iterate();</pre><pre class="programlisting">//named parameter list
List names = new ArrayList();
names.add("Izi");
names.add("Fritz");
Query q = sess.createQuery("from DomesticCat cat where cat.name in (:namesList)");
q.setParameterList("namesList", names);
List cats = q.list();</pre></div>
                  <div class="sect3" lang="fr-FR">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="objectstate-querying-executing-pagination"></a>10.4.1.5.&nbsp;Pagination
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>Si vous avez besoin de sp&eacute;cifier des liens sur votre ensemble de r&eacute;sultats (le nombre maximum de lignes que vous voulez r&eacute;cup&eacute;rez
                        et/ou la premi&egrave;re ligne que vous voulez r&eacute;cup&eacute;rer) vous devriez utiliser des m&eacute;thodes de l'interface <code class="literal">Query</code> : 
                     </p><pre class="programlisting">Query q = sess.createQuery("from DomesticCat cat");
q.setFirstResult(20);
q.setMaxResults(10);
List cats = q.list();</pre><p>Hibernate sait comment traduite cette requ&ecirc;te de limite en SQL natif pour votre SGBD. </p>
                  </div>
                  <div class="sect3" lang="fr-FR">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="objectstate-querying-executing-scrolling"></a>10.4.1.6.&nbsp;It&eacute;ration "scrollable"
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>Si votre connecteur JDBC supporte les <code class="literal">ResultSet</code>s "scrollables", l'interface <code class="literal">Query</code> peut &ecirc;tre utilis&eacute;e pour obtenir un objet <code class="literal">ScrollableResults</code>, lequel permet une navigation flexible dans les r&eacute;sultats de la requ&ecirc;te. 
                     </p><pre class="programlisting">Query q = sess.createQuery("select cat.name, cat from DomesticCat cat " +
                            "order by cat.name");
ScrollableResults cats = q.scroll();
if ( cats.first() ) {

    // find the first name on each page of an alphabetical list of cats by name
    firstNamesOfPages = new ArrayList();
    do {
        String name = cats.getString(0);
        firstNamesOfPages.add(name);
    }
    while ( cats.scroll(PAGE_SIZE) );

    // Now get the first page of cats
    pageOfCats = new ArrayList();
    cats.beforeFirst();
    int i=0;
    while( ( PAGE_SIZE &gt; i++ ) &amp;&amp; cats.next() ) pageOfCats.add( cats.get(1) );

}
cats.close()</pre><p>Notez qu'une connexion ouverte (et un curseur) est requise pour cette fonctionnalit&eacute;, utilisez <code class="literal">setMaxResult()</code>/<code class="literal">setFirstResult()</code> si vous avez besoin d'une fonctionnalit&eacute; de pagination hors ligne. 
                     </p>
                  </div>
                  <div class="sect3" lang="fr-FR">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="objectstate-querying-executing-named"></a>10.4.1.7.&nbsp;Externaliser des requ&ecirc;tes nomm&eacute;es
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>Vous pouvez aussi d&eacute;finir des requ&ecirc;tes nomm&eacute;es dans le document de mapping. (Souvenez-vous d'utiliser une section <code class="literal">CDATA</code> si votre requ&ecirc;te contient des caract&egrave;res qui pourraient &ecirc;tre interpr&eacute;t&eacute;s comme des &eacute;l&eacute;ments XML.) 
                     </p><pre class="programlisting">&lt;query name="ByNameAndMaximumWeight"&gt;&lt;![CDATA[
    from eg.DomesticCat as cat
        where cat.name = ?
        and cat.weight &gt; ?
] ]&gt;&lt;/query&gt;</pre><p>La liaison de param&egrave;tres et l'ex&eacute;cution sont fait par programmation : </p><pre class="programlisting">Query q = sess.getNamedQuery("ByNameAndMaximumWeight");
q.setString(0, name);
q.setInt(1, minWeight);
List cats = q.list();</pre><p>Notez que le code r&eacute;el du programme est ind&eacute;pendant du langage de requ&ecirc;te qui est utilis&eacute;, vous pouvez aussi d&eacute;finir des requ&ecirc;tes
                        SQL nativez dans les m&eacute;ta-donn&eacute;es, ou migrer des requ&ecirc;tes existantes vers Hibernate en les pla&ccedil;ant dans les fichiers de mapping.
                        
                     </p>
                     <p>UNTRANSLATED! Also note that a query declaration inside a <code class="literal">&lt;hibernate-mapping&gt;</code> element requires a global unique name for the query, while a query declaration inside a <code class="literal">&lt;class&gt;</code> element is made unique automatically by prepending the fully qualified name of the class, for example <code class="literal">eg.Cat.ByNameAndMaximumWeight</code>. 
                     </p>
                  </div>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="objectstate-filtering"></a>10.4.2.&nbsp;Filtrer des collections
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Un <span class="emphasis"><em>filtre</em></span> de collection est un type sp&eacute;cial de requ&ecirc;te qui peut &ecirc;tre appliqu&eacute; &agrave; une collection persistante ou &agrave; un tableau. La cha&icirc;ne
                     de requ&ecirc;te peut se r&eacute;f&eacute;rer &agrave; <code class="literal">this</code>, correspondant &agrave; l'&eacute;l&eacute;ment de la collection courant. 
                  </p><pre class="programlisting">Collection blackKittens = session.createFilter(
    pk.getKittens(), 
    "where this.color = ?")
    .setParameter( Color.BLACK, Hibernate.custom(ColorUserType.class) )
    .list()
);</pre><p>La collection retourn&eacute;e est consid&eacute;r&eacute;e comme un bag, et c'est une copie de la collection donn&eacute;e. La collection originale n'est
                     pas modifi&eacute;e (c'est contraire &agrave; l'implication du nom "filtre"; mais coh&eacute;rent avec le comportement attendu). 
                  </p>
                  <p>Observez que les filtres ne n&eacute;cessitent pas une clause <code class="literal">from</code> (bien qu'ils puissent en avoir une si besoin est). Les filtres ne sont pas limit&eacute;s &agrave; retourner des &eacute;l&eacute;ments de la collection
                     eux-m&ecirc;mes. 
                  </p><pre class="programlisting">Collection blackKittenMates = session.createFilter(
    pk.getKittens(), 
    "select this.mate where this.color = eg.Color.BLACK.intValue")
    .list();</pre><p>M&ecirc;me une requ&ecirc;te de filtre vide est utile, par exemple pour charger un sous-ensemble d'&eacute;l&eacute;ments dans une &eacute;norme collection
                     : 
                  </p><pre class="programlisting">Collection tenKittens = session.createFilter(
    mother.getKittens(), "")
    .setFirstResult(0).setMaxResults(10)
    .list();</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="objecstate-querying-criteria"></a>10.4.3.&nbsp;Requ&ecirc;tes Criteria
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>HQL est extr&ecirc;mement puissant mais certains d&eacute;veloppeurs pr&eacute;f&egrave;rent construire des requ&ecirc;tes dynamiquement, en utilisant l'API
                     orient&eacute;e objet, plut&ocirc;t que construire des cha&icirc;nes de requ&ecirc;tes. Hibernate fournit une API intuitive de requ&ecirc;te <code class="literal">Criteria</code> pour ces cas : 
                  </p><pre class="programlisting">Criteria crit = session.createCriteria(Cat.class);
crit.add( Restrictions.eq( "color", eg.Color.BLACK ) );
crit.setMaxResults(10);
List cats = crit.list();</pre><p>Les APIs <code class="literal">Criteria</code> et <code class="literal">Example</code> associ&eacute; sont trait&eacute;es plus en d&eacute;tail dans <a href="#querycriteria" title="Chapitre&nbsp;15.&nbsp;Requ&ecirc;tes par crit&egrave;res">Chapitre&nbsp;15, <i xmlns:xlink="http://www.w3.org/1999/xlink">Requ&ecirc;tes par crit&egrave;res</i></a>. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="objectstate-querying-nativesql"></a>10.4.4.&nbsp;Requ&ecirc;tes en SQL natif
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Vous pouvez exprimer une requ&ecirc;te en SQL, en utilisant <code class="literal">createSQLQuery()</code> et laisser Hibernate s'occuper du mapping des r&eacute;sultats vers des objets. Notez que vous pouvez n'importe quand appeler <code class="literal">session.connection()</code> et utiliser directement la <code class="literal">Connection</code> JDBC. Si vous choisissez d'utiliser l'API Hibernate, vous devez mettre les alias SQL entre accolades : 
                  </p><pre class="programlisting">List cats = session.createSQLQuery("SELECT {cat.*} FROM CAT {cat} WHERE ROWNUM&lt;10")
    .addEntity("cat", Cat.class)
.list();</pre><pre class="programlisting">List cats = session.createSQLQuery(
    "SELECT {cat}.ID AS {cat.id}, {cat}.SEX AS {cat.sex}, " +
           "{cat}.MATE AS {cat.mate}, {cat}.SUBCLASS AS {cat.class}, ... " +
    "FROM CAT {cat} WHERE ROWNUM&lt;10")
    .addEntity("cat", Cat.class)
.list()</pre><p>Les requ&ecirc;tes SQL peuvent contenir des param&egrave;tres nomm&eacute;s et positionnels, comme des requ&ecirc;tes Hibernate. Plus d'informations
                     &agrave; propos des requ&ecirc;tes SQL natives dans Hibernate peuvent &ecirc;tre trouv&eacute;es dans <a href="#querysql" title="Chapitre&nbsp;16.&nbsp;SQL natif">Chapitre&nbsp;16, <i xmlns:xlink="http://www.w3.org/1999/xlink">SQL natif</i></a>. 
                  </p>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="objectstate-modifying"></a>10.5.&nbsp;Modifier des objets persistants
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Les <span class="emphasis"><em>instances persistantes transactionnelles</em></span> (c'est-&agrave;-dire des objets charg&eacute;s, sauvegard&eacute;s, cr&eacute;&eacute;s ou requ&ecirc;t&eacute;s par la <code class="literal">Session</code>) peuvent &ecirc;tre manipul&eacute;es par l'application et n'importe quel changement vers l'&eacute;tat persistant sera persist&eacute; lorsque la <code class="literal">Session</code> est <span class="emphasis"><em>"flush&eacute;e"</em></span> (trait&eacute; plus tard dans ce chapitre). Il n'y a pas besoin d'appeler une m&eacute;thode particuli&egrave;re (comme <code class="literal">update()</code>, qui a un but diff&eacute;rent) pour rendre vos modifications persistantes. Donc la mani&egrave;re la plus directe de mettre &agrave; jour l'&eacute;tat
                  d'un objet est de le charger avec <code class="literal">load()</code>, et puis le manipuler directement, tant que la <code class="literal">Session</code> est ouverte : 
               </p><pre class="programlisting">DomesticCat cat = (DomesticCat) sess.load( Cat.class, new Long(69) );
cat.setName("PK");
sess.flush();  // changes to cat are automatically detected and persisted</pre><p>Parfois ce mod&egrave;le de programmation est inefficace puisqu'il n&eacute;cessiterait un <code class="literal">SELECT</code> SQL (pour charger l'objet) et un <code class="literal">UPDATE</code> SQL (pour persister son &eacute;tat mis &agrave; jour) dans la m&ecirc;me session. Aussi Hibernate offre une autre approche, en utilisant des
                  instances d&eacute;tach&eacute;es. 
               </p>
               <p>
                  <span class="emphasis"><em>Note that Hibernate does not offer its own API for direct execution of <code class="literal">UPDATE</code> or <code class="literal">DELETE</code> statements. Hibernate is a <span class="emphasis"><em>state management</em></span> service, you don't have to think in <span class="emphasis"><em>statements</em></span> to use it. JDBC is a perfect API for executing SQL statements, you can get a JDBC <code class="literal">Connection</code> at any time by calling <code class="literal">session.connection()</code>. Furthermore, the notion of mass operations conflicts with object/relational mapping for online transaction processing-oriented
                        applications. Future versions of Hibernate may however provide special mass operation functions. See <a href="#batch" title="Chapitre&nbsp;13.&nbsp;Traitement par paquet">Chapitre&nbsp;13, <i xmlns:xlink="http://www.w3.org/1999/xlink">Traitement par paquet</i></a> for some possible batch operation tricks.</em></span>
                  
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="objectstate-detached"></a>10.6.&nbsp;Modifier des objets d&eacute;tach&eacute;s
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Beaucoup d'applications ont besoin de r&eacute;cup&eacute;rer un objet dans une transaction, l'envoyer &agrave; la couche interfac&eacute;e avec l'utilisateur
                  pour les manipulations, puis sauvegarder les changements dans une nouvelle transaction. Les applications qui utilisent cette
                  approche dans un environnement &agrave; haute concurrence utilisent g&eacute;n&eacute;ralement des donn&eacute;es versionn&eacute;es pour assurer l'isolation
                  pour les "longues" unit&eacute;s de travail. 
               </p>
               <p>Hibernate supporte ce mod&egrave;le en permettant pour le r&eacute;attachement d'instances d&eacute;tach&eacute;es l'utilisation des m&eacute;thodes <code class="literal">Session.update()</code> ou <code class="literal">Session.merge()</code> : 
               </p><pre class="programlisting">// in the first session
Cat cat = (Cat) firstSession.load(Cat.class, catId);
Cat potentialMate = new Cat();
firstSession.save(potentialMate);

// in a higher layer of the application
cat.setMate(potentialMate);

// later, in a new session
secondSession.update(cat);  // update cat
secondSession.update(mate); // update mate</pre><p>Si le <code class="literal">Cat</code> avec l'identifiant <code class="literal">catId</code> avait d&eacute;j&agrave; &eacute;t&eacute; charg&eacute; par <code class="literal">secondSession</code> lorsque l'application a essay&eacute; de le r&eacute;attacher, une exception aurait &eacute;t&eacute; lev&eacute;e. 
               </p>
               <p>Utilisez <code class="literal">update()</code> si vous &ecirc;tes sure que la session ne contient pas d&eacute;j&agrave; une instance persistante avec le m&ecirc;me identifiant, et <code class="literal">merge()</code> si vous voulez fusionner vos modifications n'importe quand sans consid&eacute;rer l'&eacute;tat de la session. En d'autres mots, <code class="literal">update()</code> est g&eacute;n&eacute;ralement la premi&egrave;re m&eacute;thode que vous devriez appeler dans une session fra&icirc;che, pour s'assurer que le r&eacute;attachement
                  de vos instances d&eacute;tach&eacute;es est la premi&egrave;re op&eacute;ration qui est ex&eacute;cut&eacute;e. 
               </p>
               <p>L'application devrait individuellement <code class="literal">update()</code> (NdT : mettre &agrave; jour) les instances d&eacute;tach&eacute;es accessibles depuis l'instance d&eacute;tach&eacute;e donn&eacute;e si et <span class="emphasis"><em>seulement</em></span> si elle veut que leur &eacute;tat soit aussi mis &agrave; jour. Ceci peut &ecirc;tre automatis&eacute; bien s&ucirc;r, en utilisant la <span class="emphasis"><em>persistance transitive</em></span>, voir <a href="#objectstate-transitive" title="10.11.&nbsp;Persistance transitive">Section&nbsp;10.11, &laquo;&nbsp;Persistance transitive&nbsp;&raquo;</a>. 
               </p>
               <p>La m&eacute;thode <code class="literal">lock()</code> permet aussi &agrave; une application de r&eacute;associer un objet avec une nouvelle session. Pourtant, l'instance d&eacute;tach&eacute;e doit &ecirc;tre
                  non modifi&eacute;e ! 
               </p><pre class="programlisting">//just reassociate:
sess.lock(fritz, LockMode.NONE);
//do a version check, then reassociate:
sess.lock(izi, LockMode.READ);
//do a version check, using SELECT ... FOR UPDATE, then reassociate:
sess.lock(pk, LockMode.UPGRADE);</pre><p>Notez que <code class="literal">lock()</code> peut &ecirc;tre utilis&eacute; avec diff&eacute;rents <code class="literal">LockMode</code>s, voir la documentation de l'API documentation et le chapitre sur la gestion des transactions pour plus d'informations. Le
                  r&eacute;attachement n'est pas le seul cas d'utilisation pour <code class="literal">lock()</code>. 
               </p>
               <p>D'autres mod&egrave;les pour de longues unit&eacute;s de travail sont trait&eacute;s dans <a href="#transactions-optimistic" title="11.3.&nbsp;Contr&ocirc;le de consurrence optimiste">Section&nbsp;11.3, &laquo;&nbsp;Contr&ocirc;le de consurrence optimiste&nbsp;&raquo;</a>. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="objectstate-saveorupdate"></a>10.7.&nbsp;D&eacute;tection automatique d'un &eacute;tat
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Les utilisateurs d'Hibernate ont demand&eacute; une m&eacute;thode dont l'intention g&eacute;n&eacute;rale serait soit de sauvegarder une instance &eacute;ph&eacute;m&egrave;re
                  en g&eacute;n&eacute;rant un nouvel identifiant, soit mettre &agrave; jour/r&eacute;attacher les instances d&eacute;tach&eacute;es associ&eacute;es &agrave; l'identifiant courant.
                  La m&eacute;thode <code class="literal">saveOrUpdate()</code> impl&eacute;mente cette fonctionnalit&eacute;. 
               </p><pre class="programlisting">// in the first session
Cat cat = (Cat) firstSession.load(Cat.class, catID);

// in a higher tier of the application
Cat mate = new Cat();
cat.setMate(mate);

// later, in a new session
secondSession.saveOrUpdate(cat);   // update existing state (cat has a non-null id)
secondSession.saveOrUpdate(mate);  // save the new instance (mate has a null id)</pre><p>L'usage et la s&eacute;mantique de <code class="literal">saveOrUpdate()</code> semble &ecirc;tre confuse pour les nouveaux utilisateurs. Premi&egrave;rement, aussi longtemps que vous n'essayez pas d'utiliser des instances
                  d'une session dans une autre, vous ne devriez pas avoir besoin d'utiliser <code class="literal">update()</code>, <code class="literal">saveOrUpdate()</code>, ou <code class="literal">merge()</code>. Certaines applications n'utiliseront jamais ces m&eacute;thodes. 
               </p>
               <p>G&eacute;n&eacute;ralement <code class="literal">update()</code> ou <code class="literal">saveOrUpdate()</code> sont utilis&eacute;es dans le sc&eacute;nario suivant : 
               </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p>l'application charge un objet dans la premi&egrave;re session </p>
                     </li>
                     <li>
                        <p>l'objet est pass&eacute; &agrave; la couche utilisateur </p>
                     </li>
                     <li>
                        <p>certaines modifications sont effectu&eacute;es sur l'objet </p>
                     </li>
                     <li>
                        <p>l'objet est retourn&eacute; &agrave; la couche logique m&eacute;tier </p>
                     </li>
                     <li>
                        <p>l'application persiste ces modifications en appelant <code class="literal">update()</code> dans une seconde sessin 
                        </p>
                     </li>
                  </ul>
               </div>
               <p><code class="literal">saveOrUpdate()</code> s'utilise dans le cas suivant : 
               </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p>si l'objet est d&eacute;j&agrave; persistant dans cette session, ne rien faire </p>
                     </li>
                     <li>
                        <p>si un autre objet associ&eacute; &agrave; la session a le m&ecirc;me identifiant, lever une exception </p>
                     </li>
                     <li>
                        <p>si l'objet n'a pas de propri&eacute;t&eacute; d'identifiant, appeler <code class="literal">save()</code> 
                        </p>
                     </li>
                     <li>
                        <p>si l'identifiant de l'objet a une valeur assign&eacute;e &agrave; un objet nouvellement instanci&eacute;, appeler <code class="literal">save()</code> 
                        </p>
                     </li>
                     <li>
                        <p>si l'objet est versionn&eacute; (par <code class="literal">&lt;version&gt;</code> ou <code class="literal">&lt;timestamp&gt;</code>), et la valeur de la propri&eacute;t&eacute; de version est la m&ecirc;me valeur que celle assign&eacute;e &agrave; un objet nouvellement instanci&eacute;, appeler
                           <code class="literal">save()</code> 
                        </p>
                     </li>
                     <li>
                        <p>sinon mettre &agrave; jour l'objet avec <code class="literal">update()</code> 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>et <code class="literal">merge()</code> est tr&egrave;s diff&eacute;rent : 
               </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p>s'il y a une instance persistante avec le m&ecirc;me identifiant couramment associ&eacute;e &agrave; la session, copier l'&eacute;tat de l'objet donn&eacute;
                           dans l'instance persistante 
                        </p>
                     </li>
                     <li>
                        <p>s'il n'y a pas d'instance persistante associ&eacute;e &agrave; cette session, essayer de le charger &agrave; partir de la base de donn&eacute;es, ou cr&eacute;er
                           une nouvelle instance persistante 
                        </p>
                     </li>
                     <li>
                        <p>l'instance persistante est retourn&eacute;e </p>
                     </li>
                     <li>
                        <p>l'instance donn&eacute;e ne devient pas associ&eacute;e &agrave; la session, elle reste d&eacute;tach&eacute;e </p>
                     </li>
                  </ul>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="objectstate-deleting"></a>10.8.&nbsp;Suppression d'objets persistants
                        </h2>
                     </div>
                  </div>
               </div>
               <p><code class="literal">Session.delete()</code> supprimera l'&eacute;tat d'un objet de la base de donn&eacute;es. Bien s&ucirc;r, votre application pourrait encore conserver une r&eacute;f&eacute;rence vers
                  un objet effac&eacute;. Il est mieux de penser &agrave; <code class="literal">delete()</code> comme rendant une instance persistante &eacute;ph&eacute;m&egrave;re. 
               </p><pre class="programlisting">sess.delete(cat);</pre><p>Vous pouvez effacer des objets dans l'ordre que vous voulez, sans risque de violations de contrainte de clef &eacute;trang&egrave;re. Il
                  est encore possible de violer une contrainte <code class="literal">NOT NULL</code> sur une colonne de clef &eacute;trang&egrave;re en effa&ccedil;ant des objets dans le mauvais ordre, par exemple si vous effacer le parent, mais
                  oubliez d'effacer les enfants. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="objectstate-replicating"></a>10.9.&nbsp;R&eacute;plication d'objets entre deux entrep&ocirc;ts de donn&eacute;es
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Il est occasionnellement utile de pouvoir prendre un graphe d'instances persistantes et de les rendre persistantes dans un
                  entrep&ocirc;t diff&eacute;rent, sans reg&eacute;n&eacute;rer les valeurs des identifiants. 
               </p><pre class="programlisting">//retrieve a cat from one database
Session session1 = factory1.openSession();
Transaction tx1 = session1.beginTransaction();
Cat cat = session1.get(Cat.class, catId);
tx1.commit();
session1.close();

//reconcile with a second database
Session session2 = factory2.openSession();
Transaction tx2 = session2.beginTransaction();
session2.replicate(cat, ReplicationMode.LATEST_VERSION);
tx2.commit();
session2.close();</pre><p>Le <code class="literal">ReplicationMode</code> d&eacute;termine comment <code class="literal">replicate()</code> traitera les conflits avec les lignes existantes dans la base de donn&eacute;es. 
               </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p><code class="literal">ReplicationMode.IGNORE</code> - ignore l'objet s'il y a une ligne existante dans la base de donn&eacute;es avec le m&ecirc;me identifiant 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">ReplicationMode.OVERWRITE</code> - &eacute;crase n'importe quelle ligne existante dans la base de donn&eacute;es avec le m&ecirc;me identifiant 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">ReplicationMode.EXCEPTION</code> - l&egrave;ve une exception s'il y une ligne dans la base de donn&eacute;es avec le m&ecirc;me identifiant 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">ReplicationMode.LATEST_VERSION</code> - &eacute;crase la ligne si son num&eacute;ro de version est plus petit que le num&eacute;ro de version de l'objet, ou ignore l'objet sinon 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Les cas d'utilisation de cette fonctionnalit&eacute; incluent la r&eacute;conciliation de donn&eacute;es entr&eacute;es dans diff&eacute;rentes base de donn&eacute;es,
                  l'extension des informations de configuration du syst&egrave;me durant une mise &agrave; jour du produit, retour en arri&egrave;re sur les changements
                  effectu&eacute;s durant des transactions non-ACID, et plus. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="objectstate-flushing"></a>10.10.&nbsp;Flush de la session
                        </h2>
                     </div>
                  </div>
               </div>
               <p>De temps en temps la <code class="literal">Session</code> ex&eacute;cutera les expressions SQL requises pour syncrhoniser l'&eacute;tat de la connexion JDBC avec l'&eacute;tat des objets retenus en m&eacute;moire.
                  Ce processus, <span class="emphasis"><em>flush</em></span>, arrive par d&eacute;faut aux points suivants : 
               </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p>lors de certaines ex&eacute;cutions de requ&ecirc;te </p>
                     </li>
                     <li>
                        <p>lors d'un appel &agrave; <code class="literal">org.hibernate.Transaction.commit()</code> 
                        </p>
                     </li>
                     <li>
                        <p>lors d'un appel &agrave; <code class="literal">Session.flush()</code> 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Les expressions SQL sont effectu&eacute;es dans l'ordre suivant : </p>
               <div class="orderedlist">
                  <ol type="1" compact>
                     <li>
                        <p>insertion des entit&eacute;s, dans le m&ecirc;me ordre que celui des objets correspondants sauvegard&eacute;s par l'appel &agrave; <code class="literal">Session.save()</code> 
                        </p>
                     </li>
                     <li>
                        <p>mise &agrave; jours des entit&eacute;s </p>
                     </li>
                     <li>
                        <p>suppression des collections </p>
                     </li>
                     <li>
                        <p>suppression, mise &agrave; jour et insertion des &eacute;l&eacute;ments des collections </p>
                     </li>
                     <li>
                        <p>insertion des collections </p>
                     </li>
                     <li>
                        <p>suppression des entit&eacute;s, dans le m&ecirc;me ordre que celui des objets correspondants qui ont &eacute;t&eacute; supprim&eacute;s par l'appel &agrave; <code class="literal">Session.delete()</code> 
                        </p>
                     </li>
                  </ol>
               </div>
               <p>(Une exception est que des objets utilisant la g&eacute;n&eacute;ration <code class="literal">native</code> d'identifiants sont ins&eacute;r&eacute;s lorsqu'ils sont sauvegard&eacute;s.) 
               </p>
               <p>Except&eacute; lorsque vous appelez <code class="literal">flush()</code> explicitement, il n'y absolument aucune garantie &agrave; propos de <span class="emphasis"><em>quand</em></span> la <code class="literal">Session</code> ex&eacute;cute les appels JDBC, seulement sur l'<span class="emphasis"><em>ordre</em></span> dans lequel ils sont ex&eacute;cut&eacute;s. Cependant, Hibernate garantit que <code class="literal">Query.list(..)</code> ne retournera jamais de donn&eacute;es p&eacute;rim&eacute;es, ni des donn&eacute;es fausses. 
               </p>
               <p>Il est possible de changer le comportement par d&eacute;faut, donc que le flush se produise moins fr&eacute;quemment. La classe <code class="literal">FlushMode</code> d&eacute;finit trois modes diff&eacute;rents : flush seulement lors du commit (et seulement quand l'API <code class="literal">Transaction</code> d'Hibernate est utilis&eacute;e), flush automatiquement en utilisant la proc&eacute;dure expliqu&eacute;e, ou jamais de flush &agrave; moins que <code class="literal">flush()</code> soit appel&eacute;e explicitement. Le dernier mode est utile pour l'ex&eacute;cution de longues unit&eacute;s de travail, o&ugrave; une <code class="literal">Session</code> est gard&eacute;e ouverte et d&eacute;connect&eacute;e pour un long moment (voir <a href="#transactions-optimistic-longsession" title="11.3.2.&nbsp;Les sessions longues et le versionnage automatique.">Section&nbsp;11.3.2, &laquo;&nbsp;Les sessions longues et le versionnage automatique.&nbsp;&raquo;</a>). 
               </p><pre class="programlisting">sess = sf.openSession();
Transaction tx = sess.beginTransaction();
sess.setFlushMode(FlushMode.COMMIT); // allow queries to return stale state

Cat izi = (Cat) sess.load(Cat.class, id);
izi.setName(iznizi);

// might return stale data
sess.find("from Cat as cat left outer join cat.kittens kitten");

// change to izi is not flushed!
...
tx.commit(); // flush occurs
sess.close();</pre><p>Durant le flush, une exception peut se produire (par exemple, si une op&eacute;ration de la DML viole une contrainte). Puisque les
                  exceptions de gestion impliquent une certaine compr&eacute;hension du comportement transactionnel d'Hibernate, nous le traitons dans
                  <a href="#transactions" title="Chapitre&nbsp;11.&nbsp;Transactions et acc&egrave;s concurrents">Chapitre&nbsp;11, <i xmlns:xlink="http://www.w3.org/1999/xlink">Transactions et acc&egrave;s concurrents</i></a>. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="objectstate-transitive"></a>10.11.&nbsp;Persistance transitive
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Il est assez p&eacute;nible de sauvegarder, supprimer, ou r&eacute;attacher des objets un par un, surtout si vous traitez un graphe d'objets
                  associ&eacute;s. Un cas habituel est une relation parent/enfant. Consid&eacute;rez l'exemple suivant : 
               </p>
               <p>Si les enfants de la relation parent/enfant &eacute;taient des types de valeur (par exemple, une collection d'adresses ou de cha&icirc;nes
                  de caract&egrave;res), leur cycle de vie d&eacute;pendraient du parent et aucune action ne serait requise pour "cascader" facilement les
                  changements d'&eacute;tat. Si le parent est sauvegard&eacute;, les objets enfants de type de valeur sont sauvegard&eacute;s &eacute;galement, si le parent
                  est supprim&eacute;, les enfants sont supprim&eacute;s, etc. Ceci fonctionne m&ecirc;me pour des op&eacute;rations telles que la suppression d'un enfant
                  de la collection ; Hibernate d&eacute;tectera cela et, puisque les objets de type de valeur ne peuvent pas avoir des r&eacute;f&eacute;rences partag&eacute;es,
                  supprimera l'enfant de la base de donn&eacute;es. 
               </p>
               <p>Maintenant consid&eacute;rez le m&ecirc;me sc&eacute;nario avec un parent et dont les objets enfants sont des entit&eacute;s, et non des types de valeur
                  (par exemple, des cat&eacute;gories et des objets, ou un parent et des chatons). Les entit&eacute;s ont leur propre cycle de vie, supportent
                  les r&eacute;f&eacute;rences partag&eacute;es (donc supprimer une entit&eacute; de la collection ne signifie pas qu'elle peut &ecirc;tre supprim&eacute;e), et il n'y
                  a par d&eacute;faut pas de cascade d'&eacute;tat d'une entit&eacute; vers n'importe quelle entit&eacute; associ&eacute;e. Hibernate n'impl&eacute;mente pas la <span class="emphasis"><em>persistance par accessibilit&eacute;</em></span> par d&eacute;faut. 
               </p>
               <p>Pour chaque op&eacute;ration basique de la session d'Hibernate - incluant <code class="literal">persist(), merge(), saveOrUpdate(), delete(), lock(), refresh(), evict(), replicate()</code> - il y a un style de cascade correspondant. Respectivement, les styles de cascade s'appellent <code class="literal">persist, merge, save-update, delete, lock, refresh, evict, replicate</code>. Si vous voulez qu'une op&eacute;ration soit cascad&eacute;e le long d'une association, vous devez l'indiquer dans le document de mapping.
                  Par exemple : 
               </p><pre class="programlisting">&lt;one-to-one name="person" cascade="persist"/&gt;</pre><p>Les styles de cascade peuvent &ecirc;tre combin&eacute;s : </p><pre class="programlisting">&lt;one-to-one name="person" cascade="persist,delete,lock"/&gt;</pre><p>Vous pouvez m&ecirc;me utiliser <code class="literal">cascade="all"</code> pour sp&eacute;cifier que <span class="emphasis"><em>toutes</em></span> les op&eacute;rations devraient &ecirc;tre cascad&eacute;es le long de l'association. La valeur par d&eacute;faut <code class="literal">cascade="none"</code> sp&eacute;cifie qu'aucune op&eacute;ration ne sera cascad&eacute;e. 
               </p>
               <p>Une style de cascade sp&eacute;cial, <code class="literal">delete-orphan</code>, s'applique seulement aux associations un-vers-plusieurs, et indique que l'op&eacute;ration <code class="literal">delete()</code> devrait &ecirc;tre appliqu&eacute;e &agrave; n'importe quel enfant qui est supprim&eacute; de l'association. 
               </p>
               <p>Recommandations : </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p>Cela n'a g&eacute;n&eacute;ralement aucun sens d'activer la cascade sur une association <code class="literal">&lt;many-to-one&gt;</code> ou <code class="literal">&lt;many-to-many&gt;</code>. Les cascades sont souvent utiles pour des associations <code class="literal">&lt;one-to-one&gt;</code> et <code class="literal">&lt;one-to-many&gt;</code>. 
                        </p>
                     </li>
                     <li>
                        <p>Si la dur&eacute;e de vie de l'objet enfant est li&eacute;e &agrave; la dur&eacute;e de vie de l'objet parent, faites en un <span class="emphasis"><em>objet du cycle de vie</em></span> en sp&eacute;cifiant <code class="literal">cascade="all,delete-orphan"</code>. 
                        </p>
                     </li>
                     <li>
                        <p>Sinon, vous pourriez ne pas avoir besoin de cascade du tout. Mais si vous pensez que vous travaillerez souvent avec le parent
                           et les enfants ensemble dans la m&ecirc;me transaction, et que vous voulez vous &eacute;viter quelques frappes, consid&eacute;rez l'utilisation
                           de <code class="literal">cascade="persist,merge,save-update"</code>. 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Mapper une association (soit une simple association valu&eacute;e, soit une collection) avec <code class="literal">cascade="all"</code> marque l'association comme une relation de style <span class="emphasis"><em>parent/enfant</em></span> o&ugrave; la sauvegarde/mise &agrave; jour/suppression du parent entra&icirc;ne la sauvegarde/mise &agrave; jour/suppression de l'enfant ou des enfants.
                  
               </p>
               <p>En outre, une simple r&eacute;f&eacute;rence &agrave; un enfant d'un parent persistant aura pour cons&eacute;quence la sauvegarde/mise &agrave; jour de l'enfant.
                  Cette m&eacute;taphore est cependant incompl&egrave;te. Un enfant qui devient non r&eacute;f&eacute;renc&eacute; par son parent <span class="emphasis"><em>n'est pas</em></span> automatiquement supprim&eacute;e, except&eacute; dans le cas d'une association <code class="literal">&lt;one-to-many&gt;</code> mapp&eacute;e avec <code class="literal">cascade="delete-orphan"</code>. La s&eacute;mantique pr&eacute;cise des op&eacute;rations de cascade pour une relation parent/enfant est la suivante : 
               </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p>Si un parent est pass&eacute; &agrave; <code class="literal">persist()</code>, tous les enfant sont pass&eacute;s &agrave; <code class="literal">persist()</code> 
                        </p>
                     </li>
                     <li>
                        <p>Si un parent est pass&eacute; &agrave; <code class="literal">merge()</code>, tous les enfants sont pass&eacute;s &agrave; <code class="literal">merge()</code> 
                        </p>
                     </li>
                     <li>
                        <p>Si un parent est pass&eacute; &agrave; <code class="literal">save()</code>, <code class="literal">update()</code> ou <code class="literal">saveOrUpdate()</code>, tous les enfants sont pass&eacute;s &agrave; <code class="literal">saveOrUpdate()</code> 
                        </p>
                     </li>
                     <li>
                        <p>Si un enfant d&eacute;tach&eacute; ou &eacute;ph&eacute;m&egrave;re devient r&eacute;f&eacute;renc&eacute; par un parent persistant, il est pass&eacute; &agrave; <code class="literal">saveOrUpdate()</code> 
                        </p>
                     </li>
                     <li>
                        <p>Si un parent est supprim&eacute;, tous les enfants sont pass&eacute;s &agrave; <code class="literal">delete()</code> 
                        </p>
                     </li>
                     <li>
                        <p>Si un enfant est d&eacute;r&eacute;f&eacute;renc&eacute; par un parent persistant, <span class="emphasis"><em>rien de sp&eacute;cial n'arrive</em></span> - l'application devrait explicitement supprimer l'enfant si n&eacute;cessaire - &agrave; moins que <code class="literal">cascade="delete-orphan"</code> soit param&eacute;tr&eacute;, au quel cas l'enfant "orphelin" est supprim&eacute;. 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Enfin, la cascade des op&eacute;rations peut &ecirc;tre effectu&eacute;e sur un graphe donn&eacute; lors de l'<span class="emphasis"><em>appel de l'op&eacute;ration</em></span> or lors du <span class="emphasis"><em>flush</em></span> suivant. Toutes les op&eacute;rations, lorsque cascad&eacute;es, le sont sur toutes les entit&eacute;s associ&eacute;es atteignables lorsque l'op&eacute;tation
                  est ex&eacute;cut&eacute;e. Cependant <code class="literal">save-upate</code> et <code class="literal">delete-orphan</code> sont cascad&eacute;es &agrave; toutes les entit&eacute;s associ&eacute;es atteignables lors du flush de la <code class="literal">Session</code>. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="objectstate-metadata"></a>10.12.&nbsp;Utilisation des m&eacute;ta-donn&eacute;es
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Hibernate requiert un mod&egrave;le de m&eacute;ta-niveau tr&egrave;s riche de toutes les entit&eacute;s et types valu&eacute;s. De temps en temps, ce mod&egrave;le
                  est tr&egrave;s utile &agrave; l'application elle m&ecirc;me. Par exemple, l'application pourrait utiliser les m&eacute;ta-donn&eacute;es d'Hibernate pour impl&eacute;menter
                  un algorithme de copie en profondeur "intelligent" qui comprendrait quels objets devraient copi&eacute;s (par exemple les types de
                  valeur mutables) et lesquels ne devraient pas l'&ecirc;tre (par exemple les types de valeurs immutables et, possiblement, les entit&eacute;s
                  associ&eacute;es). 
               </p>
               <p>Hibernate expose les m&eacute;ta-donn&eacute;es via les interfaces <code class="literal">ClassMetadata</code> et <code class="literal">CollectionMetadata</code> et la hi&eacute;rarchie <code class="literal">Type</code>. Les instances des interfaces de m&eacute;ta-donn&eacute;es peuvent &ecirc;tre obtenues &agrave; partir de la <code class="literal">SessionFactory</code>. 
               </p><pre class="programlisting">Cat fritz = ......;
ClassMetadata catMeta = sessionfactory.getClassMetadata(Cat.class);

Object[] propertyValues = catMeta.getPropertyValues(fritz);
String[] propertyNames = catMeta.getPropertyNames();
Type[] propertyTypes = catMeta.getPropertyTypes();

// get a Map of all properties which are not collections or associations
Map namedValues = new HashMap();
for ( int i=0; i&lt;propertyNames.length; i++ ) {
    if ( !propertyTypes[i].isEntityType() &amp;&amp; !propertyTypes[i].isCollectionType() ) {
        namedValues.put( propertyNames[i], propertyValues[i] );
    }
}</pre></div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="transactions"></a>Chapitre&nbsp;11.&nbsp;Transactions et acc&egrave;s concurrents
                     </h2>
                  </div>
               </div>
            </div>
            <p>L'un des principaux avantages du m&eacute;canisme de contr&ocirc;le des acc&egrave;s concurrents d'Hibernate est qu'il est tr&egrave;s facile &agrave; comprendre.
               Hibernate utilise directement les connexions JDBC ainsi que les ressources JTA sans y ajouter davantage de m&eacute;canisme de blocage.
               Nous vous recommandons de vous familiariser avec les sp&eacute;cifications JDBC, ANSI et d'isolement de transaction de la base de
               donn&eacute;es que vous utilisez. 
            </p>
            <p>Hibernate ne v&eacute;rouille pas vos objets en m&eacute;moire. Votre application peut suivre le comportement d&eacute;fini par le niveau d'isolation
               de vos transactions de base de donn&eacute;es. Notez que gr&acirc;ce &agrave; la <code class="literal">Session</code>, qui est aussi un cache de scope transaction, Hibernate fournit des lectures r&eacute;p&eacute;t&eacute;es pour les r&eacute;cup&eacute;ration par identifiants
               et les requ&ecirc;tes d'entit&eacute;s (pas celle de valeurs scalaires). 
            </p>
            <p>En addition au versionning pour le controle automatique de concurrence, Hibernate fournit une API (mineure) pour le verrouillage
               perssimiste des enregistrements, en g&eacute;n&eacute;rant une syntaxe <code class="literal">SELECT FOR UPDATE</code>. Le controle de concurrence optimiste et cette API seront d&eacute;taill&eacute;s plus tard dans ce chapitre. 
            </p>
            <p>Nous aborderons la gestion des acc&egrave;s concurrents en discutant de la granularit&eacute; des objets <code class="literal">Configuration</code>, <code class="literal">SessionFactory</code>, et <code class="literal">Session</code>, ainsi que de certains concepts relatifs &agrave; la base de donn&eacute;es et aux longues transactions applicatives. 
            </p>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="transactions-basics"></a>11.1.&nbsp;Gestion de session et d&eacute;limitation de transactions
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Il est important de savoir qu'un objet <code class="literal">SessionFactory</code> est un objet complexe et optimis&eacute; pour fonctionner avec les threads(thread- safe). Il est co&ucirc;teux &agrave; cr&eacute;er et est ainsi pr&eacute;vu
                  pour n'&ecirc;tre instanci&eacute; qu?une seule fois via un objet <code class="literal">Configuration</code> au d&eacute;marrage de l'application, et &ecirc;tre partag&eacute; par tous les threads d'une application. 
               </p>
               <p>Un objet <code class="literal">Session</code> est relativement simple et n'est threadsafe. Il est &eacute;galement peu co&ucirc;teux &agrave; cr&eacute;er. Il devrait n'&ecirc;tre utilis&eacute; qu'une seule
                  fois, pour un processus d'affaire ou une unit&eacute; de travail ou une conversation et ensuite &ecirc;tre rel&acirc;ch&eacute;. Un objet <code class="literal">Session</code> ne tentera pas d'obtenir de connexion ( <code class="literal">Connection</code> ) JDBC (ou de <code class="literal">Datasource</code> ) si ce n'est pas n&eacute;cessaire. 
               </p>
               <p>Afin de compl&eacute;ter ce tableau, vous devez &eacute;galement penser aux transactions de base de donn&eacute;es. Une transaction de base de
                  donn&eacute;es se doit d'&ecirc;tre la plus courte possible afin de r&eacute;duire les risques de collision sur des enregistrements verrouill&eacute;s.
                  De longues transactions &agrave; la base de donn&eacute;es nuiront &agrave; l'extensibilit&eacute; de vos applications lorsque confront&eacute;es &agrave; de hauts
                  niveaux de charge. Par cons&eacute;quent, il n'est jamais bon de maintenir une transaction ouverte pendant la dur&eacute;e de reflexion
                  de l'utilisateur, jusqu'a ce que l'unit&eacute; de travail soit achev&eacute;e. 
               </p>
               <p>Maintenant, comment d&eacute;limiter une unit&eacute; de travail? Est-ce qu'une instance de <code class="literal">Session</code> peut avoir une dur&eacute;e de vie d&eacute;passant plusieurs transactions &agrave; la base de donn&eacute;es, ou bien est-ce que celles-ci doivent &ecirc;tre
                  li&eacute;es une &agrave; une? Quand faut-il ouvrir et fermer une <code class="literal">Session</code> ? Comment d&eacute;finir la d&eacute;marcation de vos transactions &agrave; la base de donn&eacute;es? 
               </p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="transactions-basics-uow"></a>11.1.1.&nbsp;Unit&eacute; de travail
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Il est important de mentionner que d'utiliser un paradigme <span class="emphasis"><em>session-par-operation</em></span> est un anti-pattern. Autrement dit: n'ouvrez et ne fermez pas la <code class="literal">Session</code> &agrave; chacun de vos acc&egrave;s simples &agrave; la base de donn&eacute;es dans un m&ecirc;me thread! Bien s&ucirc;r, le m&ecirc;me raisonnement s'applique sur la
                     gestion des transactions &agrave; la base de donn&eacute;es. Les appels &agrave; la base de donn&eacute;es devraient &ecirc;tre faits en ordre et selon une
                     s&eacute;quence d&eacute;finie. Ils devraient &eacute;galement &ecirc;tre regroup&eacute;s en des unit&eacute;s de travail atomiques. (Notez que l?utilisation d?une
                     connexion auto-commit constitue le m&ecirc;me anti-pattern. Ce mode de fonctionnement existe pour les applications &eacute;mettant des
                     commandes SQL &agrave; partir d?une console. Hibernate d&eacute;sengage le mode auto-commit et s'attend &agrave; ce qu'un serveur d'applications
                     le fasse &eacute;galement.) Les transactions avec la base de donn&eacute;es ne sont jamais optionnelles, toute communication avec une base
                     de donn&eacute;es doit se d&eacute;rouler dans une transaction, peu importe si vous lisez ou &eacute;crivez des donn&eacute;es. Comme &eacute;voqu&eacute;, le comportement
                     auto-commit pour lire les donn&eacute;es devrait &ecirc;tre &eacute;vit&eacute;, puisque plusieurs petites transactions ne seront jamais aussi efficaces
                     qu'une seule plus grosse clairement d&eacute;finie comme unit&eacute; de travail. Ce dernier choix et en plus beaucoup plus facile a maintenir
                     et &agrave; faire &eacute;voluer. 
                  </p>
                  <p>The most common pattern in a multi-user client/server application is <span class="emphasis"><em>session-per-request</em></span>. In this model, a request from the client is sent to the server (where the Hibernate persistence layer runs), a new Hibernate
                     <code class="literal">Session</code> is opened, and all database operations are executed in this unit of work. Once the work has been completed (and the response
                     for the client has been prepared), the session is flushed and closed. You would also use a single database transaction to
                     serve the clients request, starting and committing it when you open and close the <code class="literal">Session</code>. The relationship between the two is one-to-one and this model is a perfect fit for many applications. 
                  </p>
                  <p>The challenge lies in the implementation. Hibernate provides built-in management of the "current session" to simplify this
                     pattern. All you have to do is start a transaction when a server request has to be processed, and end the transaction before
                     the response is sent to the client. You can do this in any way you like, common solutions are <code class="literal">ServletFilter</code>, AOP interceptor with a pointcut on the service methods, or a proxy/interception container. An EJB container is a standardized
                     way to implement cross-cutting aspects such as transaction demarcation on EJB session beans, declaratively with CMT. If you
                     decide to use programmatic transaction demarcation, prefer the Hibernate <code class="literal">Transaction</code> API shown later in this chapter, for ease of use and code portability. 
                  </p>
                  <p>Votre application peut acc&eacute;der la "session courante" pour ex&eacute;cuter une requ&ecirc;te en invoquant simplement <code class="literal">sessionFactory.getCurrentSession()</code> n'importe o&ugrave; et autant de fois que souhait&eacute;. Vous obtiendrez toujours une <code class="literal">Session</code> dont le scope est la transaction courante avec la base de donn&eacute;es. Ceci doit &ecirc;tre configur&eacute; soit dans les ressources local
                     ou dans l'environnement JTA, voir <a href="#architecture-current-session" title="2.5.&nbsp;Sessions Contextuelles">Section&nbsp;2.5, &laquo;&nbsp;Sessions Contextuelles&nbsp;&raquo;</a>. 
                  </p>
                  <p>Il est parfois utile d'&eacute;tendre le scope d'une <code class="literal">Session</code> et d'une transaction &agrave; la base de donn&eacute;es jusqu'&agrave; ce que "la vue soit rendue". Ceci est particuli&egrave;rement utile dans des applications
                     &agrave; base de servlet qui utilisent une phase de rendue s&eacute;par&eacute;e une fois que la r&eacute;ponse a &eacute;t&eacute; pr&eacute;par&eacute;e. Etendre la transaction
                     avec la base de donn&eacute;es jusqu'&agrave; la fin du rendering de la vue est ais&eacute; si vous impl&eacute;mentez votre propre intercepteur. Cependant,
                     ce n'est pas facile si vous vous appuyez sur les EJBs avec CMT, puisqu'une transaction sera achev&eacute;e au retour de la m&eacute;thode
                     EJB, avant le rendu de la vue. Rendez vous sur le site Hibernate et sur le forum pour des astuces et des exemples sur le pattern
                     <span class="emphasis"><em>Open Session in View</em></span> pattern.. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="transactions-basics-apptx"></a>11.1.2.&nbsp;Longue conversation
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Le paradigme <span class="emphasis"><em>session-per-request</em></span> n'est pas le seul &eacute;l&eacute;ment &agrave; utiliser dans le design de vos unit&eacute;s de travail. Plusieurs processus d'affaire requi&egrave;rent toute
                     une s&eacute;rie d'interactions avec l'utilisateur, entrelac&eacute;es d'acc&egrave;s &agrave; la base de donn&eacute;e. Dans une application Web ou une application
                     d'entreprise, il serait inacceptable que la dur&eacute;e de vie d'une transaction s'&eacute;tale sur plusieurs interactions avec l'usager.
                     Consid&eacute;rez l'exemple suivant: 
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p>Un &eacute;cran s'affiche. Les donn&eacute;es vues par l'usager ont &eacute;t&eacute; charg&eacute;es dans l'instance d'un objet <code class="literal">Session</code> , dans le cadre d'une transaction de base de donn&eacute;es. L'usager est libre de modifier ces objets. 
                           </p>
                        </li>
                        <li>
                           <p>L'usager clique "Sauvegarder" apr&egrave;s 5 minutes et souhaite persister les modifications qu'il a apport&eacute;es. Il s'attend &agrave; &ecirc;tre
                              la seule personne a avoir modifi&eacute; ces donn&eacute;es et qu'aucune modification conflictuelle ne se soit produite durant ce laps de
                              temps. 
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>Ceci s'appelle une unit&eacute; de travail. Du point de vue de l'utilisateur: une <span class="emphasis"><em>conversation</em></span> (ou <span class="emphasis"><em>transaction d'application</em></span>). Il y a plusieurs fa&ccedil;on de mettre ceci en place dans votre application. 
                  </p>
                  <p>Une premi&egrave;re impl&eacute;mentation na&iuml;ve pourrait consister &agrave; garder la <code class="literal">Session</code> et la transaction &agrave; la base de donn&eacute;es ouvertes durant le temps de travail de l'usager, &agrave; maintenir les enregistrements verrouill&eacute;s
                     dans la base de donn&eacute;es afin d'&eacute;viter des modifications concurrentes et de maintenir l'isolation et l'atomicit&eacute; de la transaction
                     de l'usager. Ceci est un anti-pattern &agrave; &eacute;viter, puisque le verrouillage des enregistrements dans la base de donn&eacute;es ne permettrait
                     pas &agrave; l'application de g&eacute;rer un grand nombre d'usagers concurrents. 
                  </p>
                  <p>Clearly, we have to use several database transactions to implement the conversation. In this case, maintaining isolation of
                     business processes becomes the partial responsibility of the application tier. A single conversation usually spans several
                     database transactions. It will be atomic if only one of these database transactions (the last one) stores the updated data,
                     all others simply read data (e.g. in a wizard-style dialog spanning several request/response cycles). This is easier to implement
                     than it might sound, especially if you use Hibernate's features: 
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p><span class="emphasis"><em>Automatic Versioning</em></span> - Hibernate can do automatic optimistic concurrency control for you, it can automatically detect if a concurrent modification
                              occurred during user think time. Usually we only check at the end of the conversation. 
                           </p>
                        </li>
                        <li>
                           <p><span class="emphasis"><em>Objets D&eacute;tach&eacute;s</em></span> - Si vous d&eacute;cidez d'utiliser le paradigme <span class="emphasis"><em>session-par-requ&ecirc;te</em></span> discut&eacute; plus haut, toutes les entit&eacute;s charg&eacute;es en m&eacute;moire deviendront des objets d&eacute;tach&eacute;s durant le temps de r&eacute;flexion de
                              l'usager. Hibernate vous permet de rattacher ces objets et de persister les modifications y ayant &eacute;t&eacute; apport&eacute;es. Ce pattern
                              est appel&eacute;: <span class="emphasis"><em>session-per- request-with-detached-objects</em></span> (litt&eacute;ralement: session- par-requ&ecirc;te-avec-objets-d&eacute;tach&eacute;s). Le versionnage automatique est utilis&eacute; afin d'isoler les modifications
                              concurrentes. 
                           </p>
                        </li>
                        <li>
                           <p><span class="emphasis"><em>Extended (or Long) Session</em></span> - The Hibernate <code class="literal">Session</code> may be disconnected from the underlying JDBC connection after the database transaction has been committed, and reconnected
                              when a new client request occurs. This pattern is known as <span class="emphasis"><em>session-per-conversation</em></span> and makes even reattachment unnecessary. Automatic versioning is used to isolate concurrent modifications and the <code class="literal">Session</code> is usually not allowed to be flushed automatically, but explicitly. 
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>Les deux patterns <span class="emphasis"><em>session-per-request-with- detached- objects</em></span> (session-par-requ&ecirc;te-avec-objets- d&eacute;tach&eacute;s) et <span class="emphasis"><em>session-per-conversation</em></span> (session-par-conversation) ont chacun leurs avantages et d&eacute;savantages qui seront expos&eacute;s dans ce m&ecirc;me chapitre, dans la section
                     au sujet du contr&ocirc;le optimiste de concurrence. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="transactions-basics-identity"></a>11.1.3.&nbsp;L'identit&eacute; des objets
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une application peut acc&eacute;der &agrave; la m&ecirc;me entit&eacute; persistante de mani&egrave;re concurrente dans deux <code class="literal">Session</code> s diff&eacute;rentes. Toutefois, une instance d'une classe persistante n'est jamais partag&eacute;e par deux instances distinctes de la
                     classe <code class="literal">Session</code> . Il existe donc deux notions de l'identit&eacute; d'un objet: 
                  </p>
                  <div class="variablelist">
                     <dl>
                        <dt><span class="term">Identit&eacute; BD</span></dt>
                        <dd>
                           <p>
                              <code class="literal">foo.getId().equals( bar.getId() )</code>
                              
                           </p>
                        </dd>
                        <dt><span class="term">Identit&eacute; JVM</span></dt>
                        <dd>
                           <p>
                              <code class="literal">foo==bar</code>
                              
                           </p>
                        </dd>
                     </dl>
                  </div>
                  <p>Then for objects attached to a <span class="emphasis"><em>particular</em></span> <code class="literal">Session</code> (i.e. in the scope of a <code class="literal">Session</code>) the two notions are equivalent, and JVM identity for database identity is guaranteed by Hibernate. However, while the application
                     might concurrently access the "same" (persistent identity) business object in two different sessions, the two instances will
                     actually be "different" (JVM identity). Conflicts are resolved using (automatic versioning) at flush/commit time, using an
                     optimistic approach. 
                  </p>
                  <p>Cette approche permet de rel&eacute;guer &agrave; Hibernate et &agrave; la base de donn&eacute;es sous-jacente le soin de g&eacute;rer les probl&egrave;mes d'acc&egrave;s
                     concurrents. Cette mani&egrave;re de faire assure &eacute;galement une meilleure extensibilit&eacute; de l'application puisque assurer l'identit&eacute;
                     JVM dans un thread ne n&eacute;cessite pas de m&eacute;canismes de verrouillage co&ucirc;teux ou d'autres dispositifs de synchronisation. Une
                     application n'aura jamais le besoin de synchroniser des objets d'affaire tant qu'elle peut garantir qu'un seul thread aura
                     acc&egrave;s &agrave; une instance de <code class="literal">Session</code> . Dans le cadre d'ex&eacute;cution d'un objet <code class="literal">Session</code> , l'application peut utiliser en toute s&eacute;curit&eacute; <code class="literal">== </code> pour comparer des objets. 
                  </p>
                  <p>Une application qui utiliserait <code class="literal">==</code> &agrave; l'ext&eacute;rieur du cadre d'ex&eacute;cution d'une <code class="literal">Session</code> pourrait obtenir des r&eacute;sultats inattendus et causer certains effets de bords. Par exemple, si vous mettez 2 objets dans le
                     m&ecirc;me <code class="literal">Set</code> , ceux-ci pourraient avoir la m&ecirc;me identit&eacute; BD (i.e. ils repr&eacute;sentent le m&ecirc;me enregistrement), mais leur identit&eacute; JVM pourrait
                     &ecirc;tre diff&eacute;rente (elle ne peut, par d&eacute;finition, pas &ecirc;tre garantie sur deux objets d&eacute;tach&eacute;s). Le d&eacute;veloppeur doit donc red&eacute;finir
                     l'impl&eacute;mentation des m&eacute;thodes <code class="literal">equals()</code> et <code class="literal">hashcode()</code> dans les classes persistantes et y adjoindre sa propre notion d'identit&eacute;. Il existe toutefois une restriction: Il ne faut
                     jamais utiliser uniquement l'identifiant de la base de donn&eacute;es dans l'impl&eacute;mentation de l'&eacute;galit&eacute;; Il faut utiliser une cl&eacute;
                     d'affaire, g&eacute;n&eacute;ralement une combinaison de plusieurs attributs uniques, si possible immuables. Les identifiants de base de
                     donn&eacute;es vont changer si un objet transitoire (transient) devient persistant. Si une instance transitoire est contenue dans
                     un <code class="literal">Set</code> , changer le hashcode brisera le contrat du <code class="literal">Set</code> . Les attributs pour les cl&eacute;s d'affaire n'ont pas &agrave; &ecirc;tre aussi stables que des cl&eacute;s primaires de bases de donn&eacute;es. Il suffit
                     simplement qu'elles soient stables tant et aussi longtemps que les objets sont dans le m&ecirc;me <code class="literal">Set</code> . Veuillez consulter le site web Hibernate pour des discussions plus pointues &agrave; ce sujet. Notez que ce concept n'est pas
                     propre &agrave; Hibernate mais bien g&eacute;n&eacute;ral &agrave; l'impl&eacute;mentation de l'identit&eacute; et de l'&eacute;galit&eacute; en Java. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="transactions-basics-issues"></a>11.1.4.&nbsp;Probl&egrave;mes communs
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Bien qu'il puisse y avoir quelques rares exceptions &agrave; cette r&egrave;gle, il est recommand&eacute; de ne jamais utiliser les anti-patterns
                     <span class="emphasis"><em>session-per- user-session</em></span> et <span class="emphasis"><em>session-per-application</em></span> . Vous trouverez ici- bas quelques probl&egrave;mes que vous risquez de rencontrer si vous en faite l?utilisation. (Ces probl&egrave;mes
                     pourraient quand m&ecirc;me survenir avec des patterns recommand&eacute;s) Assurez-vous de bien comprendre les implications de chacun des
                     patterns avant de prendre votre d&eacute;cision. 
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p>L'objet <code class="literal">Session</code> n?est pas con&ccedil;u pour &ecirc;tre utilis&eacute; par de multiples threads. En cons&eacute;quence, les objets potentiellement multi-thread comme
                              les requ&ecirc;tes HTTP, les EJB Session et Swing Worker, risquent de provoquer des conditions de course dans la <code class="literal">Session</code> si celle-ci est partag&eacute;e. Dans un environnement web classique, il serait pr&eacute;f&eacute;rable de synchroniser les acc&egrave;s &agrave; la session
                              http afin d?&eacute;viter qu?un usager ne recharge une page assez rapidement pour que deux requ&ecirc;tes s?ex&eacute;cutant dans des threads
                              concurrents n?utilisent la m&ecirc;me <code class="literal">Session</code> . 
                           </p>
                        </li>
                        <li>
                           <p>Lorsque Hibernate lance une exception, le roll back de la transaction en cours doit &ecirc;tre effectu&eacute; et la <code class="literal">Session</code> doit &ecirc;tre imm&eacute;diatement ferm&eacute;e. (Ceci sera explor&eacute; plus tard dans le chapitre.) Si la <code class="literal">Session</code> est directement associ&eacute;e &agrave; une application, il faut arr&ecirc;ter l?application. Le roll back de la transaction ne remettra pas
                              les objets dans leur &eacute;tat du d&eacute;but de la transaction. Ainsi, ceux-ci pourraient &ecirc;tre d&eacute;synchronis&eacute;s d?avec les enregistrements.
                              (G&eacute;n&eacute;ralement, cela ne cause pas de r&eacute;els probl&egrave;mes puisque la plupart des exceptions sont non traitables et requi&egrave;rent la
                              reprise du processus d?affaire ayant &eacute;chou&eacute;.) 
                           </p>
                        </li>
                        <li>
                           <p>La <code class="literal">Session</code> met en m&eacute;moire cache tous les objets persistants (les objets surveill&eacute;s et dont l'&eacute;tat est g&eacute;r&eacute; par Hibernate.) Si la <code class="literal">Session</code> est ouverte ind&eacute;finiment ou si une trop grande quantit&eacute; d'objets y est charg&eacute;e, l?utilisation de la m&eacute;moire peut potentiellement
                              cro&icirc;tre jusqu?&agrave; atteindre le maximum allouable &agrave; l?application (java.lang.OutOfMemoryError.) Une solution &agrave; ce probl&egrave;me est
                              d?appeler les m&eacute;thodes <code class="literal">Session.clear()</code> et <code class="literal">Session.evict()</code> pour g&eacute;rer la m&eacute;moire cache de la <code class="literal">Session</code> . Vous pouvez &eacute;galement utiliser des stored procedures si vous devez lancer des traitements sur de grandes quantit&eacute;s d?informations.
                              Certaines solutions sont d&eacute;crites ici : <a href="#batch" title="Chapitre&nbsp;13.&nbsp;Traitement par paquet">Chapitre&nbsp;13, <i xmlns:xlink="http://www.w3.org/1999/xlink">Traitement par paquet</i></a> . Garder une <code class="literal">Session</code> ouverte pour toute la dur&eacute;e d?une session usager augmente &eacute;galement consid&eacute;rablement le risque de travailler avec de l?information
                              p&eacute;rim&eacute;e. 
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="transactions-demarcation"></a>11.2.&nbsp;D&eacute;marcation des transactions
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Database (or system) transaction boundaries are always necessary. No communication with the database can occur outside of
                  a database transaction (this seems to confuse many developers who are used to the auto-commit mode). Always use clear transaction
                  boundaries, even for read-only operations. Depending on your isolation level and database capabilities this might not be required
                  but there is no downside if you always demarcate transactions explicitly. Certainly, a single database transaction is going
                  to perform better than many small transactions, even for reading data. 
               </p>
               <p>Une application utilisant Hibernate peut s'ex&eacute;cuter dans un environnement l&eacute;ger n?offrant pas la gestion automatique des transactions
                  (application autonome, application web simple ou applications Swing) ou dans un environnement J2EE offrant des services de
                  gestion automatique des transactions JTA. Dans un environnement simple, Hibernate a g&eacute;n&eacute;ralement la responsabilit&eacute; de la gestion
                  de son propre pool de connexions &agrave; la base de donn&eacute;es. Le d&eacute;veloppeur de l'application doit manuellement d&eacute;limiter les transactions.
                  En d'autres mots, il appartient au d&eacute;veloppeur de g&eacute;rer les appels &agrave; <code class="literal">Transaction.begin()</code> , <code class="literal">Transaction.commit()</code> et <code class="literal">Transaction.rollback()</code> . Un environnement transactionnel J2EE (serveur d'application J2EE) doit offrir la gestion des transactions au niveau du
                  container J2EE. Les bornes de transaction peuvent normalement &ecirc;tre d&eacute;finies de mani&egrave;re d&eacute;clarative dans les descripteurs de
                  d&eacute;ploiement d'EJB Session, par exemple. La gestion programmatique des transactions n'y est donc pas n&eacute;cessaire. M&ecirc;me les appels
                  &agrave; <code class="literal">Session.flush()</code> sont faits automatiquement. 
               </p>
               <p>However, it is often desirable to keep your persistence layer portable between non-managed resource-local environments, and
                  systems that can rely on JTA but use BMT instead of CMT. In both cases you'd use programmatic transaction demarcation. Hibernate
                  offers a wrapper API called <code class="literal">Transaction</code> that translates into the native transaction system of your deployment environment. This API is actually optional, but we
                  strongly encourage its use unless you are in a CMT session bean. 
               </p>
               <p>Il existe quatre &eacute;tapes disctinctes lors de la fermeture d'une <code class="literal">Session</code> 
               </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p>flush de la session </p>
                     </li>
                     <li>
                        <p>commit de la transaction </p>
                     </li>
                     <li>
                        <p>Fermeture de la session (Close) </p>
                     </li>
                     <li>
                        <p>Gestion des exceptions </p>
                     </li>
                  </ul>
               </div>
               <p>La synchronisation de bdd depuis la session (flush) a d&eacute;j&agrave; &eacute;t&eacute; expliqu&eacute;, nous nous attarderons maintenant &agrave; la d&eacute;marcation
                  des transactions et &agrave; la gestion des exceptions dans les environnements l&eacute;gers et les environnements J2EE. 
               </p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="transactions-demarcation-nonmanaged"></a>11.2.1.&nbsp;Environnement non manag&eacute;
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Si la couche de persistance Hibernate s'ex&eacute;cute dans un environnement non manag&eacute;, les connexions &agrave; la base de donn&eacute;es seront
                     g&eacute;n&eacute;ralement prises en charge par le m&eacute;canisme de pool d'Hibernate. La gestion de la session et de la transaction se fera
                     donc de la mani&egrave;re suivante: 
                  </p><pre class="programlisting">// Non-managed environment idiom
Session sess = factory.openSession();
Transaction tx = null;
try {
    tx = sess.beginTransaction();

    // do some work
    ...

    tx.commit();
}
catch (RuntimeException e) {
    if (tx != null) tx.rollback();
    throw e; // or display error message
}
finally {
    sess.close();
}</pre><p>Vous n'avez pas &agrave; invoquer <code class="literal">flush()</code> explicitement sur la <code class="literal">Session</code> - l'appel de <code class="literal">commit()</code> d&eacute;clenchera automatiquement la synchronisation (selon le <a href="#objectstate-flushing" title="10.10.&nbsp;Flush de la session">Section&nbsp;10.10, &laquo;&nbsp;Flush de la session&nbsp;&raquo;</a> de la session. Un appel &agrave; <code class="literal">close()</code> marque la fin de la session. La cons&eacute;quence directe est que la connexion &agrave; la base de donn&eacute;es sera relach&eacute;e par la session.
                     Ce code est portable est fonctionne dans les environnements non manag&eacute; ET les environnements JTA. 
                  </p>
                  <p>Une solution plus flexible est la gestion par contexte fourni par Hibernate que nous avons d&eacute;j&agrave; rencontr&eacute;: </p><pre class="programlisting">// Non-managed environment idiom with getCurrentSession()
try {
    factory.getCurrentSession().beginTransaction();

    // do some work
    ...

    factory.getCurrentSession().getTransaction().commit();
}
catch (RuntimeException e) {
    factory.getCurrentSession().getTransaction().rollback();
    throw e; // or display error message
}</pre><p>Vous ne verrez probablement jamais ces exemples de code dans les applications; les exceptions fatales (exceptions du syst&egrave;me)
                     ne devraient &ecirc;tre trait&eacute;es que dans la couche la plus "haute". En d'autres termes, le code qui ex&eacute;cute les appels &agrave; Hibernate
                     (&agrave; la couche de persistance) et le code qui g&egrave;re les <code class="literal">RuntimeException</code> (qui ne peut g&eacute;n&eacute;ralement effectuer qu'un nettoyage et une sortie) sont dans des couches diff&eacute;rentes. La gestion du contexte
                     courant par Hibernate peut simplifier notablement ce design, puisque vous devez acc&eacute;der &agrave; la gestion des exceptions de la
                     <code class="literal">SessionFactory</code>, ce qui est d&eacute;crit plus tard dans ce chapitre. 
                  </p>
                  <p>Notez que vous devriez s&eacute;lectionner <code class="literal">org.hibernate.transaction.JDBCTransactionFactory</code> (le d&eacute;faut), pour le second exemple <code class="literal">"thread"</code> comme <code class="literal">hibernate.current_session_context_class</code>. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="transactions-demarcation-jta"></a>11.2.2.&nbsp;Utilisation de JTA
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Si votre couche de persistance s'ex&eacute;cute dans un serveur d'application (par exemple, derri&egrave;re un EJB Session Bean), toutes
                     les datasource utilis&eacute;es par Hibernate feront automatiquement partie de transactions JTA globales. Hibernate propose deux
                     strat&eacute;gies pour r&eacute;ussir cette int&eacute;gration. 
                  </p>
                  <p>Si vous utilisez des transactions g&eacute;r&eacute;es par un EJB (bean managed transactions - BMT), Hibernate informera le serveur d'application
                     du d&eacute;but et de la fin des transactions si vous utilisez l'API <code class="literal">Transaction</code> . Ainsi, le code de gestion des transactions sera identique dans les deux types d'environnements. 
                  </p><pre class="programlisting">// BMT idiom
Session sess = factory.openSession();
Transaction tx = null;
try {
    tx = sess.beginTransaction();

    // do some work
    ...

    tx.commit();
}
catch (RuntimeException e) {
    if (tx != null) tx.rollback();
    throw e; // or display error message
}
finally {
    sess.close();
}</pre><p>Ou encore, avec la gestion automatique de contexte: </p><pre class="programlisting">// BMT idiom with getCurrentSession()
try {
    UserTransaction tx = (UserTransaction)new InitialContext()
                            .lookup("java:comp/UserTransaction");

    tx.begin();

    // Do some work on Session bound to transaction
    factory.getCurrentSession().load(...);
    factory.getCurrentSession().persist(...);

    tx.commit();
}
catch (RuntimeException e) {
    tx.rollback();
    throw e; // or display error message
}</pre><p>With CMT, transaction demarcation is done in session bean deployment descriptors, not programmatically, hence, the code is
                     reduced to: 
                  </p><pre class="programlisting">// CMT idiom
 Session sess = factory.getCurrentSession();

 // do some work
 ...
</pre><p>Dans un EJB CMT m&ecirc;me le rollback intervient automatiquement, puisqu'une <code class="literal">RuntimeException</code> non trait&eacute;e et soulev&eacute;e par une m&eacute;thode d'un bean session indique au conteneur d'annuler la transaction globale. <span class="emphasis"><em>Ceci veut donc dire que vous n'avez pas &agrave; utiliser l'API <code class="literal">Transaction</code> d'Hibernate dans CMT.</em></span> 
                  </p>
                  <p>Note that you should choose <code class="literal">org.hibernate.transaction.JTATransactionFactory</code> if you use JTA directly (BMT), and <code class="literal">org.hibernate.transaction.CMTTransactionFactory</code> in a CMT session bean, when you configure Hibernate's transaction factory. Remember to also set <code class="literal">hibernate.transaction.manager_lookup_class</code>. Furthermore, make sure that your <code class="literal">hibernate.current_session_context_class</code> is either unset (backwards compatibility), or set to <code class="literal">"jta"</code>. 
                  </p>
                  <p>The <code class="literal">getCurrentSession()</code> operation has one downside in a JTA environment. There is one caveat to the use of <code class="literal">after_statement</code> connection release mode, which is then used by default. Due to a silly limitation of the JTA spec, it is not possible for
                     Hibernate to automatically clean up any unclosed <code class="literal">ScrollableResults</code> or <code class="literal">Iterator</code> instances returned by <code class="literal">scroll()</code> or <code class="literal">iterate()</code>. You <span class="emphasis"><em>must</em></span> release the underlying database cursor by calling <code class="literal">ScrollableResults.close()</code> or <code class="literal">Hibernate.close(Iterator)</code> explicitly from a <code class="literal">finally</code> block. (Of course, most applications can easily avoid using <code class="literal">scroll()</code> or <code class="literal">iterate()</code> at all from the JTA or CMT code.) 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="transactions-demarcation-exceptions"></a>11.2.3.&nbsp;Gestion des exceptions
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Si une <code class="literal">Session</code> lance une exception (incluant les exceptions du type <code class="literal">SQLException</code> ou d'un sous-type), vous devez imm&eacute;diatement faire le rollback de la transaction, appeler <code class="literal">Session.close()</code> et rel&acirc;cher les r&eacute;f&eacute;rences sur l'objet <code class="literal">Session</code> . La <code class="literal">Session</code> contient des m&eacute;thodes pouvant la mettre dans un &eacute;tat inutilisable. Vous devez consid&eacute;rer qu'<span class="emphasis"><em>aucune</em></span> exception lanc&eacute;e par Hibernate n'est traitable. Assurez-vous de fermer la session en faisant l'appel &agrave; <code class="literal">close()</code> dans un bloc <code class="literal">finally</code> . 
                  </p>
                  <p>L'exception <code class="literal">HibernateException</code> , qui englobe la plupart des exceptions pouvant survenir dans la couche de persistance Hibernate, est une exception non v&eacute;rifi&eacute;e
                     (Ceci n'&eacute;tait pas le cas dans certaines versions ant&eacute;rieures de Hibernate.) Il est de notre avis que nous ne devrions pas
                     forcer un d&eacute;veloppeur &agrave; g&eacute;rer une exception qu'il ne peut de toute fa&ccedil;on pas traiter dans une couche technique. Dans la plupart
                     des applications, les exceptions non v&eacute;rifi&eacute;es et les exceptions fatales sont g&eacute;r&eacute;es en amont du processus (dans les couches
                     hautes) et un message d'erreur est alors affich&eacute; &agrave; l'usager (ou un traitement alternatif est invoqu&eacute;.) Veuillez noter qu'Hibernate
                     peut &eacute;galement lancer des exceptions non v&eacute;rifi&eacute;es d'un autre type que <code class="literal">HibernateException</code> . Celles-ci sont &eacute;galement non traitables et vous devez les traiter comme telles. 
                  </p>
                  <p>Hibernate wraps <code class="literal">SQLException</code>s thrown while interacting with the database in a <code class="literal">JDBCException</code>. In fact, Hibernate will attempt to convert the exception into a more meaningful subclass of <code class="literal">JDBCException</code>. The underlying <code class="literal">SQLException</code> is always available via <code class="literal">JDBCException.getCause()</code>. Hibernate converts the <code class="literal">SQLException</code> into an appropriate <code class="literal">JDBCException</code> subclass using the <code class="literal">SQLExceptionConverter</code> attached to the <code class="literal">SessionFactory</code>. By default, the <code class="literal">SQLExceptionConverter</code> is defined by the configured dialect; however, it is also possible to plug in a custom implementation (see the javadocs for
                     the <code class="literal">SQLExceptionConverterFactory</code> class for details). The standard <code class="literal">JDBCException</code> subtypes are: 
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc" compact>
                        <li>
                           <p><code class="literal">JDBCConnectionException</code> - Indique une erreur de communication avec la couche JDBC sous-jacente. 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">SQLGrammarException</code> - Indique un probl&egrave;me de grammaire ou de syntaxe avec la requ&ecirc;te SQL envoy&eacute;e. 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">ConstraintViolationException</code> - Indique une violation de contrainte d'int&eacute;grit&eacute;. 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">LockAcquisitionException</code> - Indique une erreur de verrouillage lors de l'&eacute;x&eacute;cution de la requ&ecirc;te. 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">GenericJDBCException</code> - Indique une erreur g&eacute;n&eacute;rique JDBC d'une autre cat&eacute;gorie. 
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="transactions-demarcation-timeout"></a>11.2.4.&nbsp;Timeout de transaction
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>One extremely important feature provided by a managed environment like EJB that is never provided for non-managed code is
                     transaction timeout. Transaction timeouts ensure that no misbehaving transaction can indefinitely tie up resources while returning
                     no response to the user. Outside a managed (JTA) environment, Hibernate cannot fully provide this functionality. However,
                     Hibernate can at least control data access operations, ensuring that database level deadlocks and queries with huge result
                     sets are limited by a defined timeout. In a managed environment, Hibernate can delegate transaction timeout to JTA. This functionality
                     is abstracted by the Hibernate <code class="literal">Transaction</code> object. 
                  </p><pre class="programlisting">
Session sess = factory.openSession();
try {
    //set transaction timeout to 3 seconds
    sess.getTransaction().setTimeout(3);
    sess.getTransaction().begin();

    // do some work
    ...

    sess.getTransaction().commit()
}
catch (RuntimeException e) {
    sess.getTransaction().rollback();
    throw e; // or display error message
}
finally {
    sess.close();
}</pre><p>Notez que <code class="literal">setTimeout()</code> ne peut pas &ecirc;tre appel&eacute; d'un EJB CMT, puisque le timeout des transaction doit &ecirc;tre sp&eacute;cifi&eacute; de mani&egrave;re d&eacute;clarative. 
                  </p>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="transactions-optimistic"></a>11.3.&nbsp;Contr&ocirc;le de consurrence optimiste
                        </h2>
                     </div>
                  </div>
               </div>
               <p>La gestion optimiste des acc&egrave;s concurrents avec versionnage est la seule approche pouvant garantir l'extensibilit&eacute; des applications
                  &agrave; haut niveau de charge. Le syst&egrave;me de versionnage utilise des num&eacute;ros de version ou l'horodatage pour d&eacute;tecter les mises
                  &agrave; jour causant des conflits avec d'autres actualisations ant&eacute;rieures. Hibernate propose trois approches pour l'&eacute;criture de
                  code applicatif utilisant la gestion optimiste d'acc&egrave;s concurrents. Le cas d'utilisation d&eacute;crit plus bas fait mention de conversation,
                  mais le versionnage peut &eacute;galement am&eacute;liorer la qualit&eacute; d'une application en pr&eacute;venant la perte de mises &agrave; jour. 
               </p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="transactions-optimistic-manual"></a>11.3.1.&nbsp;Gestion du versionnage au niveau applicatif
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Dans cet exemple d'impl&eacute;mentation utilisant peu les fonctionnalit&eacute;s d'Hibernate, chaque interaction avec la base de donn&eacute;es
                     se fait en utilisant une nouvelle <code class="literal">Session</code> et le d&eacute;veloppeur doit recharger les donn&eacute;es persistantes &agrave; partir de la BD avant de les manipuler. Cette impl&eacute;mentation
                     force l'application &agrave; v&eacute;rifier la version des objets afin de maintenir l'isolation transactionnelle. Cette approche, semblable
                     &agrave; celle retrouv&eacute;e pour les EJB, est la moins efficace de celles pr&eacute;sent&eacute;es dans ce chapitre. 
                  </p><pre class="programlisting">// foo is an instance loaded by a previous Session
session = factory.openSession();
Transaction t = session.beginTransaction();

int oldVersion = foo.getVersion();
session.load( foo, foo.getKey() ); // load the current state
if ( oldVersion != foo.getVersion() ) throw new StaleObjectStateException();
foo.setProperty("bar");

t.commit();
session.close();</pre><p>Le mapping de la propri&eacute;t&eacute; <code class="literal">version</code> est fait via <code class="literal">&lt;version&gt;</code> et Hibernate l'incr&eacute;mentera automatiquement &agrave; chaque flush() si l'entit&eacute; doit &ecirc;tre mise &agrave; jour. 
                  </p>
                  <p>Bien s&ucirc;r, si votre application ne fait pas face &agrave; beaucoup d'acc&egrave;s concurrents et ne n&eacute;cessite pas l'utilisation du versionnage,
                     cette approche peut &eacute;galement &ecirc;tre utilis&eacute;e, il n'y a qu'&agrave; ignorer le code reli&eacute; au versionnage. Dans ce cas, la strat&eacute;gie
                     du <span class="emphasis"><em>last commit wins</em></span> (litt&eacute;ralement: le dernier commit l'emporte) sera utilis&eacute;e pour les conversations (longues transactions applicatives). Gardez
                     &agrave; l'esprit que cette approche pourrait rendre perplexe les utilisateurs de l'application car ils pourraient perdre des donn&eacute;es
                     mises &agrave; jour sans qu'aucun message d'erreur ne leur soit pr&eacute;sent&eacute; et sans avoir la possibilit&eacute; de fusionner les donn&eacute;es. 
                  </p>
                  <p>Clearly, manual version checking is only feasible in very trivial circumstances and not practical for most applications. Often
                     not only single instances, but complete graphs of modified objects have to be checked. Hibernate offers automatic version
                     checking with either an extended <code class="literal">Session</code> or detached instances as the design paradigm. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="transactions-optimistic-longsession"></a>11.3.2.&nbsp;Les sessions longues et le versionnage automatique.
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Dans ce sc&eacute;nario, une seule instance de <code class="literal">Session</code> et des objets persistants est utilis&eacute;e pour toute l'application. Hibernate v&eacute;rifie la version des objets persistants avant
                     d'effectuer le flush() et lance une exception si une modification concurrente est d&eacute;tect&eacute;e. Il appartient alors au d&eacute;veloppeur
                     de g&eacute;rer l'exception. Les traitements alternatifs g&eacute;n&eacute;ralement propos&eacute;s sont alors de permettre &agrave; l'usager de faire la fusion
                     des donn&eacute;es ou de lui offrir de recommencer son travail &agrave; partie des donn&eacute;es les plus r&eacute;centes dans la BD. 
                  </p>
                  <p>Il est &agrave; noter que lorsqu'une application est en attente d'une action de la part de l?usager, La <code class="literal">Session</code> n'est pas connect&eacute;e &agrave; la couche JDBC sous-jacente. C'est la mani&egrave;re la plus efficace de g&eacute;rer les acc&egrave;s &agrave; la base de donn&eacute;es.
                     L'application ne devrait pas se pr&eacute;occuper du versionnage des objets, de la r&eacute;association des objets d&eacute;tach&eacute;s, ni du rechargement
                     de tous les objets &agrave; chaque transaction. 
                  </p><pre class="programlisting">// foo is an instance loaded earlier by the old session
Transaction t = session.beginTransaction(); // Obtain a new JDBC connection, start transaction

foo.setProperty("bar");

session.flush();    // Only for last transaction in conversation
t.commit();         // Also return JDBC connection
session.close();    // Only for last transaction in conversation</pre><p>L'objet <code class="literal">foo</code> sait quel objet <code class="literal">Session</code> l'a charg&eacute;. <code class="literal">Session.reconnect()</code> obtient une nouvelle connexion (celle-ci peut &ecirc;tre &eacute;galement fournie) et permet &agrave; la session de continuer son travail. La
                     m&eacute;thode <code class="literal">Session.disconnect()</code> d&eacute;connecte la session de la connexion JDBC et retourne celle-ci au pool de connexion (&agrave; moins que vous ne lui ayez fourni
                     vous m&ecirc;me la connexion.) Apr&egrave;s la reconnexion, afin de forcer la v&eacute;rification du versionnage de certaines entit&eacute;s que vous
                     ne cherchez pas &agrave; actualiser, vous pouvez faire un appel &agrave; <code class="literal">Session.lock()</code> en mode <code class="literal">LockMode.READ</code> pour tout objet ayant pu &ecirc;tre modifi&eacute; par une autre transaction. Il n'est pas n&eacute;cessaire de verrouiller les donn&eacute;es que vous
                     d&eacute;sirez mettre &agrave; jour. 
                  </p>
                  <p>Si des appels implicites aux m&eacute;thodes <code class="literal">disconnect()</code> et <code class="literal">reconnect()</code> sont trop co&ucirc;teux, vous pouvez les &eacute;viter en utilisant <code class="literal">hibernate.connection.release_mode</code> . 
                  </p>
                  <p>Ce pattern peut pr&eacute;senter des probl&egrave;mes si la <code class="literal">Session</code> est trop volumineuse pour &ecirc;tre stock&eacute;e entre les actions de l'usager. Plus sp&eacute;cifiquement, une session <code class="literal">HttpSession</code> se doit d'&ecirc;tre la plus petite possible. Puisque la <code class="literal">Session</code> joue obligatoirement le r&ocirc;le de m&eacute;moire cache de premier niveau et contient &agrave; ce titre tous les objets charg&eacute;s, il est pr&eacute;f&eacute;rable
                     de n'utiliser cette strat&eacute;gie que pour quelques cycles de requ&ecirc;tes car les objets risquent d'y &ecirc;tre rapidement p&eacute;rim&eacute;s. 
                  </p>
                  <p>Notez que la <code class="literal">Session</code> d&eacute;connect&eacute;e devrait &ecirc;tre conserv&eacute;e pr&egrave;s de la couche de persistance. Autrement dit, utilisez un EJB stateful pour conserver
                     la <code class="literal">Session</code> et &eacute;vitez de la s&eacute;rialiser et de la transf&eacute;rer &agrave; la couche de pr&eacute;sentation (i.e. Il est pr&eacute;f&eacute;rable de ne pas la conserver
                     dans la session <code class="literal">HttpSession</code> .) 
                  </p>
                  <p>The extended session pattern, or <span class="emphasis"><em>session-per-conversation</em></span>, is more difficult to implement with automatic current session context management. You need to supply your own implementation
                     of the <code class="literal">CurrentSessionContext</code> for this, see the Hibernate Wiki for examples. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="transactions-optimistic-detached"></a>11.3.3.&nbsp;Les objets d&eacute;tach&eacute;s et le versionnage automatique
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Chaque interaction avec le syst&egrave;me de persistance se fait via une nouvelle <code class="literal">Session</code> . Toutefois, les m&ecirc;mes instances d'objets persistants sont r&eacute;utilis&eacute;es pour chacune de ces interactions. L'application doit
                     pouvoir manipuler l'&eacute;tat des instances d&eacute;tach&eacute;es ayant &eacute;t&eacute; charg&eacute;es ant&eacute;rieurement via une autre session. Pour ce faire, ces
                     objets persistants doivent &ecirc;tre rattach&eacute;s &agrave; la <code class="literal">Session</code> courante en utilisant <code class="literal">Session.update()</code> , <code class="literal">Session.saveOrUpdate()</code> , ou <code class="literal">Session.merge()</code> . 
                  </p><pre class="programlisting">// foo is an instance loaded by a previous Session
foo.setProperty("bar");
session = factory.openSession();
Transaction t = session.beginTransaction();
session.saveOrUpdate(foo); // Use merge() if "foo" might have been loaded already
t.commit();
session.close();</pre><p>Again, Hibernate will check instance versions during flush, throwing an exception if conflicting updates occurred. </p>
                  <p>Vous pouvez &eacute;galement utiliser <code class="literal">lock()</code> au lieu de <code class="literal">update()</code> et utiliser le mode <code class="literal">LockMode.READ</code> (qui lancera une v&eacute;rification de version, en ignorant tous les niveaux de m&eacute;moire cache) si vous &ecirc;tes certain que l'objet
                     n'a pas &eacute;t&eacute; modifi&eacute;. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="transactions-optimistic-customizing"></a>11.3.4.&nbsp;Personnaliser le versionnage automatique
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Vous pouvez d&eacute;sactiver l'incr&eacute;mentation automatique du num&eacute;ro de version de certains attributs et collections en mettant la
                     valeur du param&egrave;tre de mapping <code class="literal">optimistic-lock</code> &agrave; false. Hibernate cessera ainsi d'incr&eacute;menter leur num&eacute;ro de version s'ils sont mis &agrave; jour. 
                  </p>
                  <p>Legacy database schemas are often static and can't be modified. Or, other applications might also access the same database
                     and don't know how to handle version numbers or even timestamps. In both cases, versioning can't rely on a particular column
                     in a table. To force a version check without a version or timestamp property mapping, with a comparison of the state of all
                     fields in a row, turn on <code class="literal">optimistic-lock="all"</code> in the <code class="literal">&lt;class&gt;</code> mapping. Note that this conceptually only works if Hibernate can compare the old and new state, i.e. if you use a single
                     long <code class="literal">Session</code> and not session-per-request-with-detached-objects. 
                  </p>
                  <p>Il peut &ecirc;tre souhaitable de permettre les modifications concurrentes lorsque des champs distincts sont modifi&eacute;s. En mettant
                     la propri&eacute;t&eacute; <code class="literal">optimistic-lock="dirty"</code> dans l'&eacute;l&eacute;ment <code class="literal">&lt;class&gt;</code> , Hibernate ne fera la comparaison que des champs devant &ecirc;tre actualis&eacute;s lors du flush(). 
                  </p>
                  <p>In both cases, with dedicated version/timestamp columns or with full/dirty field comparison, Hibernate uses a single <code class="literal">UPDATE</code> statement (with an appropriate <code class="literal">WHERE</code> clause) per entity to execute the version check and update the information. If you use transitive persistence to cascade
                     reattachment to associated entities, Hibernate might execute unnecessary updates. This is usually not a problem, but <span class="emphasis"><em>on update</em></span> triggers in the database might be executed even when no changes have been made to detached instances. You can customize this
                     behavior by setting <code class="literal">select-before-update="true"</code> in the <code class="literal">&lt;class&gt;</code> mapping, forcing Hibernate to <code class="literal">SELECT</code> the instance to ensure that changes did actually occur, before updating the row. 
                  </p>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="transactions-locking"></a>11.4.&nbsp;Verouillage pessimiste
                        </h2>
                     </div>
                  </div>
               </div>
               <p>It is not intended that users spend much time worrying about locking strategies. It's usually enough to specify an isolation
                  level for the JDBC connections and then simply let the database do all the work. However, advanced users may sometimes wish
                  to obtain exclusive pessimistic locks, or re-obtain locks at the start of a new transaction. 
               </p>
               <p>Hibernate utilisera toujours le m&eacute;canisme de verrouillage de la base de donn&eacute;es et ne verrouillera jamais les objets en m&eacute;moire!
                  
               </p>
               <p>La classe <code class="literal">LockMode</code> d&eacute;finit les diff&eacute;rents niveaux de verrouillage pouvant &ecirc;tre obtenus par Hibernate. Le verrouillage est obtenu par les m&eacute;canismes
                  suivants: 
               </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p><code class="literal">LockMode.WRITE</code> est obtenu automatiquement quand Hibernate actualise ou insert un enregistrement. 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">LockMode.UPGRADE</code> peut &ecirc;tre obtenu de mani&egrave;re explicite via la requ&ecirc;te en utilisant <code class="literal">SELECT ... FOR UPDATE</code> sur une base de donn&eacute;es supportant cette syntaxe. 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">LockMode.UPGRADE_NOWAIT</code> peut &ecirc;tre obtenu de mani&egrave;re explicite en utilisant <code class="literal">SELECT ... FOR UPDATE NOWAIT</code> sur Oracle. 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">LockMode.READ</code> est obtenu automatiquement quand Hibernate lit des donn&eacute;es dans un contexte d'isolation <code class="literal">Repeatable Read</code> ou <code class="literal">Serializable</code> . Peut &ecirc;tre r&eacute;obtenu explicitement via une requ&ecirc;te. 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">LockMode.NONE</code> repr&eacute;sente l'absence de verouillage. Tous les objets migrent vers ce mode a la fin d'une <code class="literal">Transaction</code> . Les objets associ&eacute;s &agrave; une session via un appel &agrave; <code class="literal">saveOrUpdate()</code> commencent &eacute;galement leur cycle de vie dans cet &eacute;tat. 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Les niveaux de verrouillage peuvent &ecirc;tre explicitement obtenus de l'une des mani&egrave;res suivantes: </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p>Un appel &agrave; <code class="literal">Session.load()</code> , en sp&eacute;cifiant un niveau verrouillage <code class="literal">LockMode</code> . 
                        </p>
                     </li>
                     <li>
                        <p>Un appel &agrave; <code class="literal">Session.lock()</code> . 
                        </p>
                     </li>
                     <li>
                        <p>Une appel &agrave; <code class="literal">Query.setLockMode()</code> . 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Si <code class="literal">Session.load()</code> est appel&eacute; avec le param&egrave;tre de niveau de verouillage <code class="literal">UPGRADE</code> ou <code class="literal">UPGRADE_NOWAIT</code> et que l'objet demand&eacute; n'est pas pr&eacute;sent dans la session, celui-ci sera charg&eacute; &agrave; l'aide d'une requ&ecirc;te <code class="literal">SELECT ... FOR UPDATE</code> . Si la m&eacute;thode <code class="literal">load()</code> est appel&eacute;e pour un objet d&eacute;j&agrave; en session avec un verrouillage moindre que celui demand&eacute;, Hibernate appellera la m&eacute;thode
                  <code class="literal">lock()</code> pour cet objet. 
               </p>
               <p><code class="literal">Session.lock()</code> effectue une v&eacute;rification de version si le niveau de verrouillage est <code class="literal">READ</code> , <code class="literal">UPGRADE</code> ou <code class="literal">UPGRADE_NOWAIT</code> . (Dans le cas des niveaux <code class="literal">UPGRADE</code> ou <code class="literal">UPGRADE_NOWAIT</code> , une requ&ecirc;te <code class="literal">SELECT ... FOR UPDATE</code> sera utilis&eacute;e.) 
               </p>
               <p>Si une base de donn&eacute;es ne supporte pas le niveau de verrouillage demand&eacute;, Hibernate utilisera un niveau alternatif convenable
                  au lieux de lancer une exception. Ceci assurera la portabilit&eacute; de votre application. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="transactions-connection-release"></a>11.5.&nbsp;Mode de lib&eacute;ration de Connection
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Le comportement original (2.x) d'Hibernate pour la gestion des connexions JDBC &eacute;tait que la <code class="literal">Session</code> obtenait une connexion d&egrave;s qu'elle en avait besoin et la lib&eacute;rait une fois la session ferm&eacute;e. Hibernate 3 a introduit les
                  modes de lib&eacute;ration de connexion pour indiquer &agrave; la session comment g&eacute;rer les transactions JDBC. Notez que la discussion suivante
                  n'est pertinente que pour des connexions fournies par un <code class="literal">ConnectionProvider</code>, celles g&eacute;r&eacute;es par l'utilisateur sont en dehors du scope de cette discussion. Les diff&eacute;rents modes sont d&eacute;finies par <code class="literal">org.hibernate.ConnectionReleaseMode</code>: 
               </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p><code class="literal">ON_CLOSE</code> - is essentially the legacy behavior described above. The Hibernate session obtains a connection when it first needs to perform
                           some JDBC access and holds unto that connection until the session is closed. 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">AFTER_TRANSACTION</code> - indique de relacher la connexion apr&egrave;s qu'une <code class="literal">org.hibernate.Transaction</code> se soit achev&eacute;e. 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">AFTER_STATEMENT</code> (aussi appel&eacute; lib&eacute;ration brutale) - indique de relacher les connexions apr&egrave;s chaque ex&eacute;cution d'un statement. Ce relachement
                           aggressif est annul&eacute; si ce statement laisse des ressources associ&eacute;es &agrave; une session donn&eacute;e ouvertes, actuellement ceci n'arrive
                           que lors de l'utilisation de <code class="literal">org.hibernate.ScrollableResults</code>. 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Le param&egrave;tre de configuration <code class="literal">hibernate.connection.release_mode</code> est utilis&eacute; pour sp&eacute;cifier quel mode de lib&eacute;ration doit &ecirc;tre utiliser. Les valeurs possibles sont: 
               </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p><code class="literal">auto</code> (valeur par d&eacute;faut) - ce choix d&eacute;l&egrave;gue le choix de lib&eacute;ration &agrave; la m&eacute;thode <code class="literal">org.hibernate.transaction.TransactionFactory.getDefaultReleaseMode()</code> Pour la JTATransactionFactory, elle retourne ConnectionReleaseMode.AFTER_STATEMENT; pour JDBCTransactionFactory, elle retourne
                           ConnectionReleaseMode.AFTER_TRANSACTION. C'est rarement une bonne id&eacute;e de changer ce comportement par d&eacute;faut puisque les erreurs
                           soulev&eacute;es par ce param&eacute;trage tend &agrave; prouver une erreur dans le code de l'utilisateur. 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">on_close</code> - indique d'utiliser ConnectionReleaseMode.ON_CLOSE. Ce param&eacute;trage existe pour garantir la compatibilit&eacute; avec les versions
                           pr&eacute;c&eacute;dentes, mais ne devrait plus &ecirc;tre utilis&eacute;. 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">after_transaction</code> - indique d'utiliser ConnectionReleaseMode.AFTER_TRANSACTION. Ne devrait pas &ecirc;tre utilis&eacute; dans les environnements JTA. Notez
                           aussi qu'avec ConnectionReleaseMode.AFTER_TRANSACTION, si une session est consid&eacute;r&eacute;e comme &eacute;tant en mode auto-commit les connexions
                           seront relach&eacute;es comme si le mode &eacute;tait AFTER_STATEMENT. 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">after_statement</code> - indique d'utiliser ConnectionReleaseMode.AFTER_STATEMENT. Additonnellement, le <code class="literal">ConnectionProvider</code> utilis&eacute; est consult&eacute; pour savoir s'il supporte ce param&eacute;trage (<code class="literal">supportsAggressiveRelease()</code>). Si ce n'est pas le cas, le mode de lib&eacute;ration est r&eacute; initialis&eacute; &agrave; ConnectionReleaseMode.AFTER_TRANSACTION. Ce param&eacute;trage
                           n'est s&ucirc;r que dans les environnements o&ugrave; il est possible d'obtenir &agrave; nouveau la m&ecirc;me connexion JDBC &agrave; chaque fois que l'on
                           fait un appel de <code class="literal">ConnectionProvider.getConnection()</code> ou dans les envrionnements auto-commit o&ugrave; il n'est pas important d'obtenir plusieurs fois la m&ecirc;me connexion. 
                        </p>
                     </li>
                  </ul>
               </div>
            </div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="events"></a>Chapitre&nbsp;12.&nbsp;Les intercepteurs et les &eacute;v&eacute;nements
                     </h2>
                  </div>
               </div>
            </div>
            <p>Il est souvent utile pour l'application de r&eacute;agir &agrave; certains &eacute;v&eacute;nements qui surviennent dans Hibernate. Cela autorise l'impl&eacute;mentation
               de certaines sortes de fonctionnalit&eacute;s g&eacute;n&eacute;riques, et d'extensions de fonctionnalit&eacute;s d'Hibernate. 
            </p>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="objectstate-interceptors"></a>12.1.&nbsp;Intercepteurs
                        </h2>
                     </div>
                  </div>
               </div>
               <p>L'interface <code class="literal">Interceptor</code> fournit des "callbacks" de la session vers l'application et permettent &agrave; l'application de consulter et/ou de manipuler des
                  propri&eacute;t&eacute;s d'un objet persistant avant qu'il soit sauvegard&eacute;, mis &agrave; jour, supprim&eacute; ou charg&eacute;. Une utilisation possible de
                  cette fonctionnalit&eacute; est de tracer l'acc&egrave;s &agrave; l'information. Par exemple, l'<code class="literal">Interceptor</code> suivant positionne <code class="literal">createTimestamp</code> quand un <code class="literal">Auditable</code> est cr&eacute;&eacute; et met &agrave; jour la propri&eacute;t&eacute; <code class="literal">lastUpdateTimestamp</code> quand un <code class="literal">Auditable</code> est mis &agrave; jour. 
               </p>
               <p>Vous pouvez soit impl&eacute;menter <code class="literal">Interceptor</code> directement ou (mieux) &eacute;tendre <code class="literal">EmptyInterceptor</code>. 
               </p><pre class="programlisting">package org.hibernate.test;

import java.io.Serializable;
import java.util.Date;
import java.util.Iterator;

import org.hibernate.EmptyInterceptor;
import org.hibernate.Transaction;
import org.hibernate.type.Type;

public class AuditInterceptor extends EmptyInterceptor {

    private int updates;
    private int creates;
    private int loads;

    public void onDelete(Object entity,
                         Serializable id,
                         Object[] state,
                         String[] propertyNames,
                         Type[] types) {
        // do nothing
    }

    public boolean onFlushDirty(Object entity,
                                Serializable id,
                                Object[] currentState,
                                Object[] previousState,
                                String[] propertyNames,
                                Type[] types) {

        if ( entity instanceof Auditable ) {
            updates++;
            for ( int i=0; i &lt; propertyNames.length; i++ ) {
                if ( "lastUpdateTimestamp".equals( propertyNames[i] ) ) {
                    currentState[i] = new Date();
                    return true;
                }
            }
        }
        return false;
    }

    public boolean onLoad(Object entity,
                          Serializable id,
                          Object[] state,
                          String[] propertyNames,
                          Type[] types) {
        if ( entity instanceof Auditable ) {
            loads++;
        }
        return false;
    }

    public boolean onSave(Object entity,
                          Serializable id,
                          Object[] state,
                          String[] propertyNames,
                          Type[] types) {

        if ( entity instanceof Auditable ) {
            creates++;
            for ( int i=0; i&lt;propertyNames.length; i++ ) {
                if ( "createTimestamp".equals( propertyNames[i] ) ) {
                    state[i] = new Date();
                    return true;
                }
            }
        }
        return false;
    }

    public void afterTransactionCompletion(Transaction tx) {
        if ( tx.wasCommitted() ) {
            System.out.println("Creations: " + creates + ", Updates: " + updates, "Loads: " + loads);
        }
        updates=0;
        creates=0;
        loads=0;
    }

}</pre><p>Interceptors come in two flavors: <code class="literal">Session</code>-scoped and <code class="literal">SessionFactory</code>-scoped. 
               </p>
               <p>A <code class="literal">Session</code>-scoped interceptor is specified when a session is opened using one of the overloaded SessionFactory.openSession() methods
                  accepting an <code class="literal">Interceptor</code>. 
               </p><pre class="programlisting">Session session = sf.openSession( new AuditInterceptor() );</pre><p>A <code class="literal">SessionFactory</code>-scoped interceptor is registered with the <code class="literal">Configuration</code> object prior to building the <code class="literal">SessionFactory</code>. In this case, the supplied interceptor will be applied to all sessions opened from that <code class="literal">SessionFactory</code>; this is true unless a session is opened explicitly specifying the interceptor to use. <code class="literal">SessionFactory</code>-scoped interceptors must be thread safe, taking care to not store session-specific state since multiple sessions will use
                  this interceptor (potentially) concurrently. 
               </p><pre class="programlisting">new Configuration().setInterceptor( new AuditInterceptor() );</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="objectstate-events"></a>12.2.&nbsp;Syst&egrave;me d'&eacute;v&eacute;nements
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Si vous devez r&eacute;agir &agrave; des &eacute;v&eacute;nements particuliers dans votre couche de persistance, vous pouvez aussi utiliser l'architecture
                  d'<span class="emphasis"><em>&eacute;v&eacute;nements</em></span> d'Hibernate3. Le syst&egrave;me d'&eacute;v&eacute;nements peut &ecirc;tre utilis&eacute; en suppl&eacute;ment ou en remplacement des interceptors. 
               </p>
               <p>Essentiellement toutes les m&eacute;thodes de l'interface <code class="literal">Session</code> sont corr&eacute;l&eacute;es &agrave; un &eacute;v&eacute;nement. Vous avez un <code class="literal">LoadEvent</code>, un <code class="literal">FlushEvent</code>, etc (consultez la DTD du fichier de configuration XML ou le paquet <code class="literal">org.hibernate.event</code> pour avoir la liste compl&egrave;te des types d'&eacute;v&eacute;nement d&eacute;finis). Quand une requ&ecirc;te est faite &agrave; partir d'une de ces m&eacute;thodes,
                  la <code class="literal">Session</code> Hibernate g&eacute;n&egrave;re un &eacute;v&eacute;nement appropri&eacute; et le passe au listener configur&eacute; pour ce type. Par d&eacute;faut, ces listeners impl&eacute;mentent
                  le m&ecirc;me traitement dans lequel ces m&eacute;thodes aboutissent toujours. Cependant, vous &ecirc;tes libre d'impl&eacute;menter une version personnalis&eacute;e
                  d'une de ces interfaces de listener (c'est-&agrave;-dire, le <code class="literal">LoadEvent</code> est trait&eacute; par l'impl&eacute;mentation de l'interface <code class="literal">LoadEventListener</code> d&eacute;clar&eacute;e), dans quel cas leur impl&eacute;mentation devrait &ecirc;tre responsable du traitement des requ&ecirc;tes <code class="literal">load()</code> faites par la <code class="literal">Session</code>. 
               </p>
               <p>Les listeners devraient effectivement &ecirc;tre consid&eacute;r&eacute;s comme des singletons ; dans le sens o&ugrave; ils sont partag&eacute;s entre des requ&ecirc;tes,
                  et donc ne devraient pas sauvegarder des &eacute;tats de variables d'instance. 
               </p>
               <p>Un listener personnalis&eacute; devrait impl&eacute;menter l'interface appropri&eacute;e pour l'&eacute;v&eacute;nement qu'il veut traiter et/ou &eacute;tendre une
                  des classes de base (ou m&ecirc;me l'&eacute;v&eacute;nement pr&ecirc;t &agrave; l'emploi utilis&eacute; par Hibernate comme ceux d&eacute;clar&eacute;s non-finaux &agrave; cette intention).
                  Les listeners personnalis&eacute;s peuvent &ecirc;tre soit inscrits par programmation &agrave; travers l'objet <code class="literal">Configuration</code>, ou sp&eacute;cifi&eacute;s la configuration XML d'Hibernate (la configuration d&eacute;clarative &agrave; travers le fichier de propri&eacute;t&eacute;s n'est pas
                  support&eacute;e). Voici un exemple de listener personnalis&eacute; pour l'&eacute;v&eacute;nement de chargement : 
               </p><pre class="programlisting">public class MyLoadListener implements LoadEventListener {
    // this is the single method defined by the LoadEventListener interface
    public void onLoad(LoadEvent event, LoadEventListener.LoadType loadType)
            throws HibernateException {
        if ( !MySecurity.isAuthorized( event.getEntityClassName(), event.getEntityId() ) ) {
            throw MySecurityException("Unauthorized access");
        }
    }
}</pre><p>Vous avez aussi besoin d'une entr&eacute;e de configuration disant &agrave; Hibernate d'utiliser ce listener en plus du listener par d&eacute;faut
                  : 
               </p><pre class="programlisting">&lt;hibernate-configuration&gt;
    &lt;session-factory&gt;
        ...
        &lt;event type="load"&gt;
            &lt;listener class="com.eg.MyLoadListener"/&gt;
            &lt;listener class="org.hibernate.event.def.DefaultLoadEventListener"/&gt;
        &lt;/event&gt;
    &lt;/session-factory&gt;
&lt;/hibernate-configuration&gt;</pre><p>Vous pouvez aussi l'inscrire par programmation : </p><pre class="programlisting">Configuration cfg = new Configuration();
LoadEventListener[] stack = { new MyLoadListener(), new DefaultLoadEventListener() };
cfg.EventListeners().setLoadEventListeners(stack);</pre><p>Les listeners inscrits d&eacute;clarativement ne peuvent pas partager d'instances. Si le m&ecirc;me nom de classe est utilis&eacute;e dans plusieurs
                  &eacute;l&eacute;ments <code class="literal">&lt;listener/&gt;</code>, chaque r&eacute;f&eacute;rence sera une instance distincte de cette classe. Si vous avez besoin de la facult&eacute; de partager des instances
                  de listener entre plusieurs types de listener, vous devez utiliser l'approche d'inscription par programmation. 
               </p>
               <p>Pourquoi impl&eacute;menter une interface et d&eacute;finir le type sp&eacute;cifique durant la configuration ? Une impl&eacute;mentation de listener
                  pourrait impl&eacute;menter plusieurs interfaces de listener d'&eacute;v&eacute;nements. Avoir en plus le type d&eacute;fini durant l'inscription rend
                  plus facile l'activation ou la d&eacute;sactivation pendant la configuration. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="objectstate-decl-security"></a>12.3.&nbsp;S&eacute;curit&eacute; d&eacute;clarative d'Hibernate
                        </h2>
                     </div>
                  </div>
               </div>
               <p>G&eacute;n&eacute;ralement, la s&eacute;curit&eacute; d&eacute;clarative dans les applications Hibernate est g&eacute;r&eacute;e dans la couche de session. Maintenant, Hibernate3
                  permet &agrave; certaines actions d'&ecirc;tre approuv&eacute;es via JACC, et autoris&eacute;es via JAAS. Cette fonctionnalit&eacute; optionnelle est construite
                  au dessus de l'architecture d'&eacute;v&eacute;nements. 
               </p>
               <p>D'abord, vous devez configurer les listeners d'&eacute;v&eacute;nements appropri&eacute;s pour permettre l'utilisation d'autorisations JAAS. </p><pre class="programlisting">&lt;listener type="pre-delete" class="org.hibernate.secure.JACCPreDeleteEventListener"/&gt;
&lt;listener type="pre-update" class="org.hibernate.secure.JACCPreUpdateEventListener"/&gt;
&lt;listener type="pre-insert" class="org.hibernate.secure.JACCPreInsertEventListener"/&gt;
&lt;listener type="pre-load" class="org.hibernate.secure.JACCPreLoadEventListener"/&gt;</pre><p>Notez que <code class="literal">&lt;listener type="..." class="..."/&gt;</code> est juste un raccourci pour <code class="literal">&lt;event type="..."&gt;&lt;listener class="..."/&gt;&lt;/event&gt;</code> quand il y a exactement un listener pour un type d'&eacute;v&eacute;nement particulier. 
               </p>
               <p>Ensuite, toujours dans <code class="literal">hibernate.cfg.xml</code>, lier les permissions aux r&ocirc;les : 
               </p><pre class="programlisting">&lt;grant role="admin" entity-name="User" actions="insert,update,read"/&gt;
&lt;grant role="su" entity-name="User" actions="*"/&gt;</pre><p>Les noms de r&ocirc;le sont les r&ocirc;les compris par votre fournisseur JAAC. </p>
            </div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="batch"></a>Chapitre&nbsp;13.&nbsp;Traitement par paquet
                     </h2>
                  </div>
               </div>
            </div>
            <p>Une approche na&Atilde;&macr;ve pour ins&Atilde;&copy;rer 100 000 lignes dans la base de donn&Atilde;&copy;es en utilisant Hibernate pourrait ressembler &Atilde;&nbsp; &Atilde;&sect;a
               : 
            </p><pre class="programlisting">Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();
for ( int i=0; i&lt;100000; i++ ) {
    Customer customer = new Customer(.....);
    session.save(customer);
}
tx.commit();
session.close();</pre><p>Ceci devrait s'&Atilde;&copy;crouler avec une <code class="literal">OutOfMemoryException</code> quelque part aux alentours de la 50 000&Atilde;&uml;me ligne. C'est parce qu'Hibernate cache toutes les instances de <code class="literal">Customer</code> nouvellement ins&Atilde;&copy;r&Atilde;&copy;es dans le cache de second niveau. 
            </p>
            <p>Dans ce chapitre nous montrerons comment &Atilde;&copy;viter ce probl&Atilde;&uml;me. D'abord, cependant, si vous faites des traitements par batch,
               il est absolument critique que vous activiez l'utilisation ds paquet JDBC (NdT : JDBC batching), si vous avez l'intention
               d'obtenir des performances raisonnables. Configurez la taille du paquet JDBC avec un nombre raisonnable (disons, 10-50) :
               
            </p><pre class="programlisting">hibernate.jdbc.batch_size 20</pre><p><a name="disablebatching"></a>Vous pourriez aussi vouloir faire cette sorte de travail dans un traitement o&Atilde;&sup1; l'interaction avec le cache de second niveau
               est compl&Atilde;&uml;tement d&Atilde;&copy;sactiv&Atilde;&copy; : 
            </p>
            <p>Insertions en paquet </p><pre class="programlisting">hibernate.cache.use_second_level_cache false</pre><p>Lorsque vous rendez des nouveaux objets persistants, vous devez r&Atilde;&copy;guli&Atilde;&uml;rement appeler <code class="literal">flush()</code> et puis <code class="literal">clear()</code> sur la session, pour contr&Atilde;&acute;ler la taille du cache de premier niveau. 
            </p>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="batch-inserts"></a>13.1.&nbsp;Paquet de mises &Atilde;&nbsp; jour
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Pour r&Atilde;&copy;cup&Atilde;&copy;rer et mettre &Atilde;&nbsp; jour des donn&Atilde;&copy;es les m&Atilde;&ordf;mes id&Atilde;&copy;es s'appliquent. En plus, vous avez besoin d'utiliser <code class="literal">scroll()</code> pour tirer partie des curseurs c&Atilde;&acute;t&Atilde;&copy; serveur pour les requ&Atilde;&ordf;tes qui retournent beaucoup de lignes de donn&Atilde;&copy;es. 
               </p><pre class="programlisting">Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();
   
for ( int i=0; i&lt;100000; i++ ) {
    Customer customer = new Customer(.....);
    session.save(customer);
    if ( i % 20 == 0 ) { //20, same as the JDBC batch size
        //flush a batch of inserts and release memory:
        session.flush();
        session.clear();
    }
}
   
tx.commit();
session.close();</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="batch-update"></a>13.2.&nbsp;L'interface StatelessSession
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Alternativement, Hibernate fournit une API orient&Atilde;&copy;e commande qui peut &Atilde;&ordf;tre utilis&Atilde;&copy;e avec des flux de donn&Atilde;&copy;es pour et en
                  provenance de la base de donn&Atilde;&copy;es sous la forme d'objets d&Atilde;&copy;tach&Atilde;&copy;s. Une <code class="literal">StatelessSession</code> n'a pas de contexte de persistance associ&Atilde;&copy; et ne fournit pas beaucoup de s&Atilde;&copy;mantique de dur&Atilde;&copy;e de vie de haut niveau. En
                  particulier, une session sans &Atilde;&copy;tat n'impl&Atilde;&copy;mente pas de cache de premier niveau et n'interagit pas non plus avec un cache
                  de seconde niveau ou un cache de requ&Atilde;&ordf;tes. Elle n'impl&Atilde;&copy;mente pas les transactions ou la v&Atilde;&copy;rification sale automatique (NdT
                  : automatic dirty checking). Les op&Atilde;&copy;rations r&Atilde;&copy;alis&Atilde;&copy;es avec une session sans &Atilde;&copy;tat ne sont jamais r&Atilde;&copy;percut&Atilde;&copy;es en cascade
                  sur les instances associ&Atilde;&copy;es. Les collections sont ignor&Atilde;&copy;es par une session sans &Atilde;&copy;tat. Les op&Atilde;&copy;rations ex&Atilde;&copy;cut&Atilde;&copy;es via une
                  session sans &Atilde;&copy;tat outrepasse le mod&Atilde;&uml;le d'&Atilde;&copy;v&Atilde;&copy;nements d'Hibernate et les intercepteurs. Les sessions sans &Atilde;&copy;tat sont vuln&Atilde;&copy;rables
                  aux effets de modification des donn&Atilde;&copy;es, ceci est d&Atilde;&raquo; au manque de cache de premier niveau. Une session sans &Atilde;&copy;tat est une
                  abstraction bas niveau, plus proche de la couche JDBC sous-jacente. 
               </p><pre class="programlisting">Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();
   
ScrollableResults customers = session.getNamedQuery("GetCustomers")
    .setCacheMode(CacheMode.IGNORE)
    .scroll(ScrollMode.FORWARD_ONLY);
int count=0;
while ( customers.next() ) {
    Customer customer = (Customer) customers.get(0);
    customer.updateStuff(...);
    if ( ++count % 20 == 0 ) {
        //flush a batch of updates and release memory:
        session.flush();
        session.clear();
    }
}
   
tx.commit();
session.close();</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="batch-statelesssession"></a>13.3.&nbsp;Notez que dans le code de l'exemple, les intances de <code class="literal">Customer</code> retourn&Atilde;&copy;es par la requ&Atilde;&ordf;te sont imm&Atilde;&copy;diatement d&Atilde;&copy;tach&Atilde;&copy;es. Elles ne sont jamais associ&Atilde;&copy;es &Atilde;&nbsp; un contexte de persistance.
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Les op&Atilde;&copy;rations <code class="literal">insert()</code>, <code class="literal">update()</code> et <code class="literal">delete()</code> d&Atilde;&copy;finies par l'interface <code class="literal">StatelessSession</code> sont consid&Atilde;&copy;r&Atilde;&copy;es comme des op&Atilde;&copy;rations d'acc&Atilde;&uml;s direct aux lignes de la base de donn&Atilde;&copy;es, ce qui r&Atilde;&copy;sulte en une ex&Atilde;&copy;cution
                  imm&Atilde;&copy;diate du SQL <code class="literal">INSERT</code>, <code class="literal">UPDATE</code> ou <code class="literal">DELETE</code> respectif. De l&Atilde;&nbsp;, elles ont des s&Atilde;&copy;mantiques tres diff&Atilde;&copy;rentes des op&Atilde;&copy;rations <code class="literal">save()</code>, <code class="literal">saveOrUpdate()</code> et <code class="literal">delete()</code> d&Atilde;&copy;finies par l'interface <code class="literal">Session</code>. 
               </p><pre class="programlisting">StatelessSession session = sessionFactory.openStatelessSession();
Transaction tx = session.beginTransaction();
   
ScrollableResults customers = session.getNamedQuery("GetCustomers")
    .scroll(ScrollMode.FORWARD_ONLY);
while ( customers.next() ) {
    Customer customer = (Customer) customers.get(0);
    customer.updateStuff(...);
    session.update(customer);
}
   
tx.commit();
session.close();</pre><p>Op&Atilde;&copy;rations de style DML </p>
               <p>Comme d&Atilde;&copy;j&Atilde;&nbsp; discut&Atilde;&copy; avant, le mapping objet/relationnel automatique et transparent est int&Atilde;&copy;ress&Atilde;&copy; par la gestion de l'&Atilde;&copy;tat
                  de l'objet. Ceci implique que l'&Atilde;&copy;tat de l'objet est disponible en m&Atilde;&copy;moire, d'o&Atilde;&sup1; manipuler (en utilisant des expressions
                  du langage de manipulation de donn&Atilde;&copy;es - <code class="literal">Data Manipulation Language</code> (DML) - SQL) les donn&Atilde;&copy;es directement dans la base n'affectera pas l'&Atilde;&copy;tat en m&Atilde;&copy;moire. Pourtant, Hibernate fournit des m&Atilde;&copy;thodes
                  pour l'ex&Atilde;&copy;cution d'expression DML de style SQL lesquelles sont r&Atilde;&copy;alis&Atilde;&copy;es &Atilde;&nbsp; travers le langage de requ&Atilde;&ordf;te d'Hibernate
                  (<a href="#queryhql" title="Chapitre&nbsp;14.&nbsp;HQL: Langage de requ&ecirc;tage d'Hibernate">Chapitre&nbsp;14, <i xmlns:xlink="http://www.w3.org/1999/xlink">HQL: Langage de requ&ecirc;tage d'Hibernate</i></a>). 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="batch-direct"></a>13.4.&nbsp;La pseudo-syntaxe pour les expressions <code class="literal">UPDATE</code> et <code class="literal">DELETE</code> est : <code class="literal">( UPDATE | DELETE ) FROM? EntityName (WHERE where_conditions)?</code>. Certains points sont &Atilde;&nbsp; noter :
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Dans la clause from, le mot-clef FROM est optionnel </p>
               <p>Il ne peut y avoir qu'une seule entit&Atilde;&copy; nomm&Atilde;&copy;e dans la clause from ; elle peut optionnellement avoir un alias. Si le nom
                  de l'entit&Atilde;&copy; a un alias, alors n'importe quelle r&Atilde;&copy;f&Atilde;&copy;rence de propri&Atilde;&copy;t&Atilde;&copy; doit &Atilde;&ordf;tre qualifi&Atilde;&copy;e en ayant un alias ; si le
                  nom de l'entit&Atilde;&copy; n'a pas d'alias, alors il est ill&Atilde;&copy;gal pour n'importe quelle r&Atilde;&copy;f&Atilde;&copy;rence de propri&Atilde;&copy;t&Atilde;&copy; d'&Atilde;&ordf;tre qualifi&Atilde;&copy;e.
                  
               </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p>Aucune jointure (implicite ou explicite) ne peut &Atilde;&ordf;tre sp&Atilde;&copy;cifi&Atilde;&copy;e dans une requ&Atilde;&ordf;te HQL. Les sous-requ&Atilde;&ordf;tes peuvent &Atilde;&ordf;tre
                           utilis&Atilde;&copy;es dans la clause where ; les sous-requ&Atilde;&ordf;tes, elles-m&Atilde;&ordf;mes, peuvent contenir des jointures. 
                        </p>
                     </li>
                     <li>
                        <p>La clause where est aussi optionnelle. </p>
                     </li>
                     <li>
                        <p>Par exemple, pour ex&Atilde;&copy;cuter un <code class="literal">UPDATE</code> HQL, utilisez la m&Atilde;&copy;thode <code class="literal">Query.executeUpdate()</code> (la m&Atilde;&copy;thode est donn&Atilde;&copy;es pour ceux qui sont familiers avec <code class="literal">PreparedStatement.executeUpdate()</code> de JDBC) : 
                        </p>
                     </li>
                     <li>
                        <p>Pour ex&Atilde;&copy;cuter un <code class="literal">DELETE</code> HQL, utilisez la m&Atilde;&ordf;me m&Atilde;&copy;thode <code class="literal">Query.executeUpdate()</code> : 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>La valeur du <code class="literal">int</code> retourn&Atilde;&copy; par la m&Atilde;&copy;thode <code class="literal">Query.executeUpdate()</code> indique le nombre d'entit&Atilde;&copy;s affect&Atilde;&copy;es par l'op&Atilde;&copy;ration. Consid&Atilde;&copy;rez que cela peut ou pas corr&Atilde;&copy;ler le nombre de lignes
                  affect&Atilde;&copy;s dans la base de donn&Atilde;&copy;es. Une op&Atilde;&copy;ration HQL pourrait entra&Atilde;&reg;ner l'ex&Atilde;&copy;cution de multiples expressions SQL r&Atilde;&copy;elles,
                  pour des classes filles mapp&Atilde;&copy;es par jointure (NdT: join-subclass), par exemple. Le nombre retourn&Atilde;&copy; indique le nombre d'entit&Atilde;&copy;s
                  r&Atilde;&copy;elles affect&Atilde;&copy;es par l'expression. Retour &Atilde;&nbsp; l'exemple de la classe fille mapp&Atilde;&copy;e par jointure, un effacement d'une des
                  classes filles peut r&Atilde;&copy;ellement entra&Atilde;&reg;ner des suppressions pas seulement dans la table qui mappe la classe fille, mais aussi
                  dans la table "racine" et potentillement dans les tables des classes filles plus bas dans la hi&Atilde;&copy;rarchie d'h&Atilde;&copy;ritage. 
               </p><pre class="programlisting">Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();

String hqlUpdate = "update Customer c set c.name = :newName where c.name = :oldName";
// or String hqlUpdate = "update Customer set name = :newName where name = :oldName";
int updatedEntities = s.createQuery( hqlUpdate )
        .setString( "newName", newName )
        .setString( "oldName", oldName )
        .executeUpdate();
tx.commit();
session.close();</pre><p>La pseudo-syntaxe pour l'expression <code class="literal">INSERT</code> est : <code class="literal">INSERT INTO EntityName properties_list select_statement</code>. Quelques points sont &Atilde;&nbsp; noter : 
               </p><pre class="programlisting">Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();
String hqlVersionedUpdate = "update versioned Customer set name = :newName where name = :oldName";
int updatedEntities = s.createQuery( hqlUpdate )
        .setString( "newName", newName )
        .setString( "oldName", oldName )
        .executeUpdate();
tx.commit();
session.close();</pre><p>Seule la forme INSERT INTO ... SELECT ... est support&Atilde;&copy;e ; pas la forme INSERT INTO ... VALUES ... . </p>
               <p>La properties_list est analogue &Atilde;&nbsp; la <code class="literal">sp&Atilde;&copy;cification de la colonne</code> The properties_list is analogous to the <code class="literal">column speficiation</code> dans l'expression SQL <code class="literal">INSERT</code>. Pour les entit&Atilde;&copy;s impliqu&Atilde;&copy;es dans un h&Atilde;&copy;ritage mapp&Atilde;&copy;, seules les propri&Atilde;&copy;t&Atilde;&copy;s directement d&Atilde;&copy;finies &Atilde;&nbsp; ce niveau de classe
                  donn&Atilde;&copy; peuvent &Atilde;&ordf;tre utilis&Atilde;&copy;es dans properties_list. Les propri&Atilde;&copy;t&Atilde;&copy;s de la classe m&Atilde;&uml;re ne sont pas permises ; et les propri&Atilde;&copy;t&Atilde;&copy;s
                  des classes filles n'ont pas de sens. En d'autres mots, les expressions <code class="literal">INSERT</code> par nature non polymorphiques. 
               </p><pre class="programlisting">Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();

String hqlDelete = "delete Customer c where c.name = :oldName";
// or String hqlDelete = "delete Customer where name = :oldName";
int deletedEntities = s.createQuery( hqlDelete )
        .setString( "oldName", oldName )
        .executeUpdate();
tx.commit();
session.close();</pre><p>select_statement peut &Atilde;&ordf;tre n'importe quelle requ&Atilde;&ordf;te de s&Atilde;&copy;lection HQl valide, avec l'avertissement que les types de retour
                  doivent correspondre aux types attendus par l'insertion. Actuellement, c'est v&Atilde;&copy;rifi&Atilde;&copy; durant la compilation de la requ&Atilde;&ordf;te
                  plut&Atilde;&acute;t que la v&Atilde;&copy;rification soit rel&Atilde;&copy;gu&Atilde;&copy;e &Atilde;&nbsp; la base de donn&Atilde;&copy;es. Notez cependant que cela pourrait poser des probl&Atilde;&uml;mes
                  entre les <code class="literal">Type</code>s d'Hibernate qui sont <span class="emphasis"><em>&Atilde;&copy;quivalents</em></span> oppos&Atilde;&copy; &Atilde;&nbsp; <span class="emphasis"><em>&Atilde;&copy;gaux</em></span>. Cela pourrait poser des probl&Atilde;&uml;mes avec des disparit&Atilde;&copy;s entre une propri&Atilde;&copy;t&Atilde;&copy; d&Atilde;&copy;finie comme un <code class="literal">org.hibernate.type.DateType</code> et une propri&Atilde;&copy;t&Atilde;&copy; d&Atilde;&copy;finie comme un <code class="literal">org.hibernate.type.TimestampType</code>, m&Atilde;&ordf;me si la base de donn&Atilde;&copy;es ne ferait pas de distinction ou ne serait pas capable de g&Atilde;&copy;rer la conversion. 
               </p>
               <p>Pour la propri&Atilde;&copy;te id, l'expression d'insertion vous donne deux options. Vous pouvez soit sp&Atilde;&copy;cifier explicitement la propri&Atilde;&copy;t&Atilde;&copy;
                  id dans properties_list (auquel cas sa valeur est extraite de l'expression de s&Atilde;&copy;lection correspondante), soit l'omettre de
                  properties_list (auquel cas une valeur g&Atilde;&copy;n&Atilde;&copy;r&Atilde;&copy;e est utilis&Atilde;&copy;e). Cette derni&Atilde;&uml;re option est seulement disponible en utilisant
                  le g&Atilde;&copy;n&Atilde;&copy;rateur d'identifiant qui op&Atilde;&uml;re dans la base de donn&Atilde;&copy;es ; tenter d'utiliser cette option avec n'importe quel type
                  de g&Atilde;&copy;n&Atilde;&copy;rateur "en m&Atilde;&copy;moire" causera une exception durant l'analyse. Notez que pour les buts de cette discussion, les g&Atilde;&copy;n&Atilde;&copy;rateurs
                  "en base" sont consid&Atilde;&copy;r&Atilde;&copy;s &Atilde;&ordf;tre <code class="literal">org.hibernate.id.SequenceGenerator</code> (et ses classes filles) et n'importe quelles impl&Atilde;&copy;mentations de <code class="literal">org.hibernate.id.PostInsertIdentifierGenerator</code>. L'exception la plus notable ici est <code class="literal">org.hibernate.id.TableHiLoGenerator</code>, qu ne peut pas &Atilde;&ordf;tre utilis&Atilde;&copy;e parce qu'il ne propose pas un moyen de d'exposer ses valeurs par un select. 
               </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p>Pour des propri&Atilde;&copy;t&Atilde;&copy;s mapp&Atilde;&copy;es comme <code class="literal">version</code> ou <code class="literal">timestamp</code>, l'expression d'insertion vous donne deux options. Vous pouvez soit sp&Atilde;&copy;cifier la propri&Atilde;&copy;t&Atilde;&copy; dans properties_list (auquel
                           cas sa valeur est extraite des expressions select correspondantes), soit l'omettre de properties_list (auquel cas la <code class="literal">valeur de graine</code> (NdT : seed value) d&Atilde;&copy;finie par le <code class="literal">org.hibernate.type.VersionType</code> est utilis&Atilde;&copy;e). 
                        </p>
                        <p>Un exemple d'ex&Atilde;&copy;cution d'une expression <code class="literal">INSERT</code> HQL : 
                        </p>
                     </li>
                     <li>
                        <p>translator-credits </p>
                     </li>
                     <li>
                        <p>For the id property, the insert statement gives you two options. You can either explicitly specify the id property in the
                           properties_list (in which case its value is taken from the corresponding select expression) or omit it from the properties_list
                           (in which case a generated value is used). This later option is only available when using id generators that operate in the
                           database; attempting to use this option with any "in memory" type generators will cause an exception during parsing. Note
                           that for the purposes of this discussion, in-database generators are considered to be <code class="literal">org.hibernate.id.SequenceGenerator</code> (and its subclasses) and any implementors of <code class="literal">org.hibernate.id.PostInsertIdentifierGenerator</code>. The most notable exception here is <code class="literal">org.hibernate.id.TableHiLoGenerator</code>, which cannot be used because it does not expose a selectable way to get its values. 
                        </p>
                     </li>
                     <li>
                        <p>For properties mapped as either <code class="literal">version</code> or <code class="literal">timestamp</code>, the insert statement gives you two options. You can either specify the property in the properties_list (in which case its
                           value is taken from the corresponding select expressions) or omit it from the properties_list (in which case the <code class="literal">seed value</code> defined by the <code class="literal">org.hibernate.type.VersionType</code> is used). 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>An example HQL <code class="literal">INSERT</code> statement execution: 
               </p><pre class="programlisting">Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();

String hqlInsert = "insert into DelinquentAccount (id, name) select c.id, c.name from Customer c where ...";
int createdEntities = s.createQuery( hqlInsert )
        .executeUpdate();
tx.commit();
session.close();</pre></div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="queryhql"></a>Chapitre&nbsp;14.&nbsp;HQL: Langage de requ&ecirc;tage d'Hibernate
                     </h2>
                  </div>
               </div>
            </div>
            <p>Hibernate fourni un langage d'interrogation extr&ecirc;mement puissant qui ressemble (et c'est voulu) au SQL. Mais ne soyez pas
               distraits par la syntaxe ; HQL est totalement orient&eacute; objet, comprenant des notions d'h&eacute;ritage, de polymorphisme et d'association.
               
            </p>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-casesensitivity"></a>14.1.&nbsp;Sensibilit&eacute; &agrave; la casse
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Les requ&ecirc;tes sont insensibles &agrave; la casse, &agrave; l'exception des noms des classes Java et des propri&eacute;t&eacute;s. Ainsi, <code class="literal">SeLeCT</code> est identique &agrave; <code class="literal">sELEct</code> et &agrave; <code class="literal">SELECT</code> mais <code class="literal">net.sf.hibernate.eg.FOO</code> n'est pas identique <code class="literal">net.sf.hibernate.eg.Foo</code> et <code class="literal">foo.barSet</code> n'est pas identique &agrave; <code class="literal">foo.BARSET</code>. 
               </p>
               <p>Ce guide utilise les mots cl&eacute;s HQL en minuscule. Certains utilisateurs trouvent les requ&ecirc;tes &eacute;crites avec les mots cl&eacute;s en
                  majuscule plus lisibles, mais nous trouvons cette convention p&eacute;nible lorsqu'elle est lue dans du code Java. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-from"></a>14.2.&nbsp;La clause from
                        </h2>
                     </div>
                  </div>
               </div>
               <p>La requ&ecirc;te Hibernate la plus simple est de la forme : </p><pre class="programlisting">from eg.Cat</pre><p>qui retourne simplement toutes les instances de la classe <code class="literal">eg.Cat</code>. Nous n'avons pas besoin d'habitude de qualifier le nom de la classe, puisque <code class="literal">auto-import</code> est la valeur par d&eacute;faut. Donc nous &eacute;crivons presque toujours : 
               </p><pre class="programlisting">from Cat</pre><p>La plupart du temps, vous devrez assigner un <span class="emphasis"><em>alias</em></span> puisque vous voudrez faire r&eacute;f&eacute;rence &agrave; <code class="literal">Cat</code> dans d'autres parties de la requ&ecirc;te. 
               </p><pre class="programlisting">from Cat as cat</pre><p>Cette requ&ecirc;te assigne l'alias <code class="literal">cat</code> &agrave; l'instance <code class="literal">Cat</code>, nous pouvons donc utiliser cet alias ailleurs dans la requ&ecirc;te. Le mot cl&eacute; <code class="literal">as</code> est optionnel ; nous aurions pu &eacute;crire : 
               </p><pre class="programlisting">from Cat cat</pre><p>Plusieurs classes peuvent appara&icirc;tre, ce qui conduira &agrave; un produit cart&eacute;sien (encore appel&eacute; jointures crois&eacute;es). </p><pre class="programlisting">from Formula, Parameter</pre><pre class="programlisting">from Formula as form, Parameter as param</pre><p>C'est une bonne pratique que de nommer les alias dans les requ&ecirc;tes en utilisant l'initiale en miniscule, ce qui a le m&eacute;rite
                  d'&ecirc;tre en phase avec les standards de nommage Java pour les variables locales (<code class="literal">domesticCat</code>). 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-joins"></a>14.3.&nbsp;Associations et jointures
                        </h2>
                     </div>
                  </div>
               </div>
               <p>On peut aussi assigner des alias &agrave; des entit&eacute;s associ&eacute;es, ou m&ecirc;me aux &eacute;l&eacute;ments d'une collection de valeurs, en utilisant un
                  <code class="literal">join</code> (jointure). 
               </p><pre class="programlisting">from Cat as cat
    inner join cat.mate as mate
    left outer join cat.kittens as kitten</pre><pre class="programlisting">from Cat as cat left join cat.mate.kittens as kittens</pre><pre class="programlisting">from Formula form full join form.parameter param</pre><p>Les types de jointures support&eacute;es sont celles de ANSI SQL </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p>
                           <code class="literal"><code class="literal">inner join</code> (jointure ferm&eacute;e)</code>
                           
                        </p>
                     </li>
                     <li>
                        <p>
                           <code class="literal"><code class="literal">left outer join</code> (jointure ouverte par la gauche)</code>
                           
                        </p>
                     </li>
                     <li>
                        <p>
                           <code class="literal"><code class="literal">right outer join</code> (jointure ouverte par la droite)</code>
                           
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">full join</code> (jointure ouverte totalement - g&eacute;n&eacute;ralement inutile) 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Les constructions des jointures <code class="literal">inner join</code>, <code class="literal">left outer join</code> et <code class="literal">right outer join</code> peuvent &ecirc;tre abbr&eacute;g&eacute;es. 
               </p><pre class="programlisting">from Cat as cat
    join cat.mate as mate
    left join cat.kittens as kitten</pre><p>Nous pouvons soumettre des conditions de jointure suppl&eacute;mentaires en utilisant le mot-clef HQL <code class="literal">with</code>. 
               </p><pre class="programlisting">from Cat as cat
    left join cat.kittens as kitten
        with kitten.bodyWeight &gt; 10.0</pre><p>Par ailleurs, une jointure "fetch&eacute;e" (rapport&eacute;e) permet d'initialiser les associations ou collections de valeurs en m&ecirc;me temps
                  que leur objet parent, le tout n'utilisant qu'un seul Select. Ceci est particuli&egrave;rement utile dans le cas des collections.
                  Ce syst&egrave;me permet de surcharger les d&eacute;clarations "lazy" et "outer-join" des fichiers de mapping pour les associations et collections.
                  Voir <a href="#performance-fetching" title="19.1.&nbsp;Strat&eacute;gies de chargement">Section&nbsp;19.1, &laquo;&nbsp;Strat&eacute;gies de chargement&nbsp;&raquo;</a> pour plus d'informations. 
               </p><pre class="programlisting">from Cat as cat
    inner join fetch cat.mate
    left join fetch cat.kittens</pre><p>Une jointure "fetch&eacute;e" (rapport&eacute;e) n'a g&eacute;n&eacute;ralement pas besoin de se voir assigner un alias puisque les objets associ&eacute;s n'ont
                  pas &agrave; &ecirc;tre utilis&eacute;s dans les autres clauses. Notez aussi que les objets associ&eacute;s ne sont pas retourn&eacute;s directement dans le
                  r&eacute;sultat de la requ&ecirc;te mais l'on peut y acc&eacute;der via l'objet parent. La seule raison pour laquelle nous pourrions avoir besoin
                  d'un alias est si nous r&eacute;cup&eacute;rions r&eacute;cursivement une collection suppl&eacute;mentaire : 
               </p><pre class="programlisting">from Cat as cat
    inner join fetch cat.mate
    left join fetch cat.kittens child
    left join fetch child.kittens</pre><p>Notez que la construction de <code class="literal">fetch</code> ne peut pas &ecirc;tre utilis&eacute;e dans les requ&ecirc;tes appel&eacute;es par <code class="literal">scroll()</code> ou <code class="literal">iterate()</code>. <code class="literal">fetch</code> ne devrait pas non plus &ecirc;tre utilis&eacute; avec <code class="literal">setMaxResults()</code> ou <code class="literal">setFirstResult()</code>. <code class="literal">fetch</code> ne peut pas non plus &ecirc;tre utilis&eacute; avec une condition <code class="literal">with</code> ad hoc. Il est possible de cr&eacute;er un produit cart&eacute;sien par jointure en r&eacute;cup&eacute;rant plus d'une collection dans une requ&ecirc;te,
                  donc faites attention dans ce cas. R&eacute;cup&eacute;rer par jointure de multiples collections donne aussi parfois des r&eacute;sultats inattendus
                  pour des mappings de bag, donc soyez prudent lorsque vous formulez vos requ&ecirc;tes dans de tels cas. Finalement, notez que <code class="literal">full join fetch</code> et <code class="literal">right join fetch</code> ne sont pas utiles en g&eacute;n&eacute;ral. 
               </p>
               <p>Si vous utilisez un chargement retard&eacute; pour les propri&eacute;t&eacute;s (avec une instrumentation par bytecode), il est possible de forcer
                  Hibernate &agrave; r&eacute;cup&eacute;rer les propri&eacute;t&eacute;s non encore charg&eacute;es imm&eacute;diatement (dans la premi&egrave;re requ&ecirc;te) en utilisant <code class="literal">fetch all properties</code>. 
               </p><pre class="programlisting">from Document fetch all properties order by name</pre><pre class="programlisting">from Document doc fetch all properties where lower(doc.name) like '%cats%'</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-joins-forms"></a>14.4.&nbsp;Formes de syntaxes pour les jointures
                        </h2>
                     </div>
                  </div>
               </div>
               <p>HQL supporte deux formes pour joindre les associations: <code class="literal">implicite</code> et <code class="literal">explicite</code>. 
               </p>
               <p>Les requ&ecirc;tes pr&eacute;sentes dans la section pr&eacute;c&eacute;dente utilisent la forme <code class="literal">explicite</code> o&ugrave; le mode cl&eacute; join est explicitement utilis&eacute; dans la clause from. C'est la forme recommand&eacute;e. 
               </p>
               <p>La forme <code class="literal">implicite</code> n'utilise pas le mot cl&eacute; join. A la place, les associations sont "d&eacute;r&eacute;f&eacute;renc&eacute;es" en utilisant le notation '.'. Ces jointures
                  peuvent apparaitre dans toutes les clauses. Les jointures <code class="literal">implicites</code> r&eacute;sultent en des inner join dans le SQL g&eacute;n&eacute;r&eacute;. 
               </p><pre class="programlisting">from Cat as cat where cat.mate.name like '%s%'</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-identifier-property"></a>14.5.&nbsp;Refering to identifier property
                        </h2>
                     </div>
                  </div>
               </div>
               <p>There are, generally speaking, 2 ways to refer to an entity's identifier property: </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p>The special property (lowercase) <code class="literal">id</code> may be used to reference the identifier property of an entity <span class="emphasis"><em>provided that entity does not define a non-identifier property named id</em></span>. 
                        </p>
                     </li>
                     <li>
                        <p>If the entity defines a named identifier property, you may use that property name. </p>
                     </li>
                  </ul>
               </div>
               <p>References to composite identifier properties follow the same naming rules. If the entity has a non-identifier property named
                  id, the composite identifier property can only be referenced by its defined named; otherwise, the special <code class="literal">id</code> property can be used to rerference the identifier property. 
               </p>
               <p>Note: this has changed significantly starting in version 3.2.2. In previous versions, <code class="literal">id</code> <span class="emphasis"><em>always</em></span> referred to the identifier property no matter what its actual name. A ramification of that decision was that non-identifier
                  properties named <code class="literal">id</code> could never be referenced in Hibernate queries. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-select"></a>14.6.&nbsp;La clause select
                        </h2>
                     </div>
                  </div>
               </div>
               <p>La clause <code class="literal">select</code> s&eacute;lectionne les objets et propri&eacute;t&eacute;s qui doivent &ecirc;tre retourn&eacute;s dans le r&eacute;sultat de la requ&ecirc;te. Soit : 
               </p><pre class="programlisting">select mate
from Cat as cat
    inner join cat.mate as mate</pre><p>La requ&ecirc;te recherchera les <code class="literal">mate</code>s li&eacute;s aux <code class="literal">Cat</code>s. Vous pouvez explimer la requ&ecirc;te d'une mani&egrave;re plus compacte : 
               </p><pre class="programlisting">select cat.mate from Cat cat</pre><p>Les requ&ecirc;tes peuvent retourner des propri&eacute;t&eacute;s de n'importe quel type, m&ecirc;me celles de type composant (component) : </p><pre class="programlisting">select cat.name from DomesticCat cat
where cat.name like 'fri%'</pre><pre class="programlisting">select cust.name.firstName from Customer as cust</pre><p>Les requ&ecirc;tes peuvent retourner plusieurs objets et/ou propri&eacute;t&eacute;s sous la forme d'un tableau du type <code class="literal">Object[]</code>, 
               </p><pre class="programlisting">select mother, offspr, mate.name
from DomesticCat as mother
    inner join mother.mate as mate
    left outer join mother.kittens as offspr</pre><p>ou sous la forme d'une <code class="literal">List</code>, 
               </p><pre class="programlisting">select new list(mother, offspr, mate.name)
from DomesticCat as mother
    inner join mother.mate as mate
    left outer join mother.kittens as offspr</pre><p>ou sous la forme d'un objet Java typ&eacute;, </p><pre class="programlisting">select new Family(mother, mate, offspr)
from DomesticCat as mother
    join mother.mate as mate
    left join mother.kittens as offspr</pre><p>&agrave; condition que la classe <code class="literal">Family</code> poss&egrave;de le constructeur appropri&eacute;. 
               </p>
               <p>Vous pouvez assigner des alias aux expressions s&eacute;lectionn&eacute;es en utilisant <code class="literal">as</code> : 
               </p><pre class="programlisting">select max(bodyWeight) as max, min(bodyWeight) as min, count(*) as n
from Cat cat</pre><p>C'est surtout utile lorsque c'est utilis&eacute; avec <code class="literal">select new map</code> : 
               </p><pre class="programlisting">select new map( max(bodyWeight) as max, min(bodyWeight) as min, count(*) as n )
from Cat cat</pre><p>Cette requ&ecirc;te retourne une <code class="literal">Map</code> &agrave; partir des alias vers les valeurs s&eacute;lectionn&eacute;es. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-aggregation"></a>14.7.&nbsp;Fonctions d'aggr&eacute;gation
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Les requ&ecirc;tes HQL peuvent aussi retourner le r&eacute;sultat de fonctions d'aggr&eacute;gation sur les propri&eacute;t&eacute;s : </p><pre class="programlisting">select avg(cat.weight), sum(cat.weight), max(cat.weight), count(cat)
from Cat cat</pre><p>Les fonctions support&eacute;es sont </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p>
                           <code class="literal">avg(...), sum(...), min(...), max(...)</code>
                           
                        </p>
                     </li>
                     <li>
                        <p>
                           <code class="literal">count(*)</code>
                           
                        </p>
                     </li>
                     <li>
                        <p>
                           <code class="literal">count(...), count(distinct ...), count(all...)</code>
                           
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Vous pouvez utiliser des op&eacute;rateurs arithm&eacute;tiques, la concat&eacute;nation, et des fonctions SQL reconnues dans la clause select
                  : 
               </p><pre class="programlisting">select cat.weight + sum(kitten.weight)
from Cat cat
    join cat.kittens kitten
group by cat.id, cat.weight</pre><pre class="programlisting">select firstName||' '||initial||' '||upper(lastName) from Person</pre><p>Les mots cl&eacute; <code class="literal">distinct</code> et <code class="literal">all</code> peuvent &ecirc;tre utilis&eacute;s et ont la m&ecirc;me signification qu'en SQL. 
               </p><pre class="programlisting">select distinct cat.name from Cat cat

select count(distinct cat.name), count(cat) from Cat cat</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-polymorphism"></a>14.8.&nbsp;Requ&ecirc;tes polymorphiques
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Une requ&ecirc;te comme: </p><pre class="programlisting">from Cat as cat</pre><p>retourne non seuleument les instances de <code class="literal">Cat</code>, mais aussi celles des sous classes comme <code class="literal">DomesticCat</code>. Les requ&ecirc;tes Hibernate peuvent nommer n'importe quelle classe ou interface Java dans la clause <code class="literal">from</code>. La requ&ecirc;te retournera les instances de toutes les classes persistantes qui &eacute;tendent cette classe ou impl&eacute;mente cette interface.
                  La requ&ecirc;te suivante retournera tous les objets persistants : 
               </p><pre class="programlisting">from java.lang.Object o</pre><p>L'interface <code class="literal">Named</code> peut &ecirc;tre impl&eacute;ment&eacute;e par plusieurs classes persistantes : 
               </p><pre class="programlisting">from Named n, Named m where n.name = m.name</pre><p>Notez que ces deux derni&egrave;res requ&ecirc;tes n&eacute;cessitent plus d'un <code class="literal">SELECT</code> SQL. Ce qui signifie que la clause <code class="literal">order by</code> ne trie pas correctement la totalit&eacute; des r&eacute;sultats (cela signifie aussi que vous ne pouvez ex&eacute;cuter ces requ&ecirc;tes en appelant
                  <code class="literal">Query.scroll()</code>). 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-where"></a>14.9.&nbsp;La clause where
                        </h2>
                     </div>
                  </div>
               </div>
               <p>La clause <code class="literal">where</code> vous permet de r&eacute;duire la liste des instances retourn&eacute;es. Si aucun alias n'existe, vous pouvez vous r&eacute;f&eacute;rer aux propri&eacute;t&eacute;s
                  par leur nom : 
               </p><pre class="programlisting">from Cat where name='Fritz'</pre><p>S'il y a un alias, utilisez un nom de propri&eacute;t&eacute; qualifi&eacute; : </p><pre class="programlisting">from Cat as cat where cat.name='Fritz'</pre><p>retourne les instances de <code class="literal">Cat</code> dont name est &eacute;gale &agrave; 'Fritz'. 
               </p><pre class="programlisting">select foo
from Foo foo, Bar bar
where foo.startDate = bar.date</pre><p>retournera les instances de <code class="literal">Foo</code> pour lesquelles il existe une instance de <code class="literal">bar</code> avec la propri&eacute;t&eacute; <code class="literal">date</code> est &eacute;gale &agrave; la propri&eacute;t&eacute; <code class="literal">startDate</code> de <code class="literal">Foo</code>. Les expressions utilisant la navigation rendent la clause <code class="literal">where</code> extr&ecirc;mement puissante. Soit : 
               </p><pre class="programlisting">from Cat cat where cat.mate.name is not null</pre><p>Cette requ&ecirc;te se traduit en SQL par une jointure interne &agrave; une table. Si vous souhaitez &eacute;crire quelque chose comme : </p><pre class="programlisting">from Foo foo
where foo.bar.baz.customer.address.city is not null</pre><p>vous finiriez avec une requ&ecirc;te qui n&eacute;cessiterait quatre jointures en SQL. </p>
               <p>L'op&eacute;rateur <code class="literal">=</code> peut &ecirc;tre utilis&eacute; pour comparer aussi bien des propri&eacute;t&eacute;s que des instances : 
               </p><pre class="programlisting">from Cat cat, Cat rival where cat.mate = rival.mate</pre><pre class="programlisting">select cat, mate
from Cat cat, Cat mate
where cat.mate = mate</pre><p>La propri&eacute;t&eacute; sp&eacute;ciale (en minuscule) <code class="literal">id</code> peut &ecirc;tre utilis&eacute;e pour faire r&eacute;f&eacute;rence &agrave; l'identifiant d'un objet (vous pouvez aussi utiliser le nom de cette propri&eacute;t&eacute;).
                  
               </p><pre class="programlisting">from Cat as cat where cat.id = 123

from Cat as cat where cat.mate.id = 69</pre><p>La seconde requ&ecirc;te est particuli&egrave;rement efficace. Aucune jointure n'est n&eacute;cessaire ! </p>
               <p>Les propri&eacute;t&eacute;s d'un identifiant compos&eacute; peuvent aussi &ecirc;tre utilis&eacute;es. Supposez que <code class="literal">Person</code> ait un identifiant compos&eacute; de <code class="literal">country</code> et <code class="literal">medicareNumber</code>. 
               </p><pre class="programlisting">from bank.Person person
where person.id.country = 'AU'
    and person.id.medicareNumber = 123456</pre><pre class="programlisting">from bank.Account account
where account.owner.id.country = 'AU'
    and account.owner.id.medicareNumber = 123456</pre><p>Une fois de plus, la seconde requ&ecirc;te ne n&eacute;cessite pas de jointure. </p>
               <p>De m&ecirc;me, la propri&eacute;t&eacute; sp&eacute;ciale <code class="literal">class</code> interroge la valeur discriminante d'une instance dans le cas d'une persistance polymorphique. Le nom d'une classe Java incorpor&eacute;e
                  dans la clause where sera traduite par sa valeur discriminante. 
               </p><pre class="programlisting">from Cat cat where cat.class = DomesticCat</pre><p>Vous pouvez aussi sp&eacute;cifier les propri&eacute;t&eacute;s des composants ou types utilisateurs compos&eacute;s (components, composite user types
                  etc). N'essayez jamais d'utiliser un expression de navigation qui se terminerait par une propri&eacute;t&eacute; de type composant (qui
                  est diff&eacute;rent d'une propri&eacute;t&eacute; d'un composant). Par exemple, si <code class="literal">store.owner</code> est une entit&eacute; avec un composant <code class="literal">address</code> 
               </p>
               <p>Un type "any" poss&egrave;de les propri&eacute;t&eacute;s sp&eacute;ciales <code class="literal">id</code> et <code class="literal">class</code>, qui nous permettent d'exprimer une jointure de la mani&egrave;re suivante (o&ugrave; <code class="literal">AuditLog.item</code> est une propri&eacute;t&eacute; mapp&eacute;e avec <code class="literal">&lt;any&gt;</code>). 
               </p><pre class="programlisting">from AuditLog log, Payment payment
where log.item.class = 'Payment' and log.item.id = payment.id</pre><p>Dans la requ&ecirc;te pr&eacute;c&eacute;dente, notez que <code class="literal">log.item.class</code> et <code class="literal">payment.class</code> feraient r&eacute;f&eacute;rence &agrave; des valeurs de colonnes de la base de donn&eacute;es compl&egrave;tement diff&eacute;rentes. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-expressions"></a>14.10.&nbsp;Expressions
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Les expressions permises dans la clause <code class="literal">where</code> incluent la plupart des choses que vous pouvez utiliser en SQL : 
               </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p>op&eacute;rateurs math&eacute;matiques <code class="literal">+, -, *, /</code> 
                        </p>
                     </li>
                     <li>
                        <p>op&eacute;rateur de comparaison binaire <code class="literal">=, &gt;=, &lt;=, &lt;&gt;, !=, like</code> 
                        </p>
                     </li>
                     <li>
                        <p>op&eacute;rateurs logiques <code class="literal">and, or, not</code> 
                        </p>
                     </li>
                     <li>
                        <p>Parenth&egrave;ses <code class="literal">( )</code>, indiquant un regroupement 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">in</code>, <code class="literal">not in</code>, <code class="literal">between</code>, <code class="literal">is null</code>, <code class="literal">is not null</code>, <code class="literal">is empty</code>, <code class="literal">is not empty</code>, <code class="literal">member of</code> and <code class="literal">not member of</code> 
                        </p>
                     </li>
                     <li>
                        <p>"Simple" case, <code class="literal">case ... when ... then ... else ... end</code>, and "searched" case, <code class="literal">case when ... then ... else ... end</code> 
                        </p>
                     </li>
                     <li>
                        <p>concatenation de cha&icirc;ne de caract&egrave;res <code class="literal">...||...</code> ou <code class="literal">concat(...,...)</code> 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">current_date()</code>, <code class="literal">current_time()</code>, <code class="literal">current_timestamp()</code> 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">second(...)</code>, <code class="literal">minute(...)</code>, <code class="literal">hour(...)</code>, <code class="literal">day(...)</code>, <code class="literal">month(...)</code>, <code class="literal">year(...)</code>, 
                        </p>
                     </li>
                     <li>
                        <p>N'importe quel fonction ou op&eacute;rateur d&eacute;fini par EJB-QL 3.0 : <code class="literal">substring(), trim(), lower(), upper(), length(), locate(), abs(), sqrt(), bit_length(), mod()</code> 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">coalesce()</code> et <code class="literal">nullif()</code> 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">str()</code> pour convertir des valeurs num&eacute;riques ou temporelles vers une cha&icirc;ne de caract&egrave;res lisible 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">cast(... as ...)</code>, o&ugrave; le second argument est le nom d'un type Hibernate, et <code class="literal">extract(... from ...)</code> si le <code class="literal">cast()</code> ANSI et <code class="literal">extract()</code> sont support&eacute;s par la base de donn&eacute;es sous-jacente 
                        </p>
                     </li>
                     <li>
                        <p>La fonction HQL <code class="literal">index()</code>, qui s'applique aux alias d'une collection index&eacute;e jointe 
                        </p>
                     </li>
                     <li>
                        <p>Les fonctions HQL qui s'appliquent expressions repr&eacute;sentant des collections : <code class="literal">size(), minelement(), maxelement(), minindex(), maxindex()</code>, ainsi que les fonctions sp&eacute;ciales <code class="literal">elements()</code> et <code class="literal">indices</code> qui peuvent &ecirc;tre quantifi&eacute;es en utilisant <code class="literal">some, all, exists, any, in</code>. 
                        </p>
                     </li>
                     <li>
                        <p>N'importe quelle fonction scalaire support&eacute;e par la base de donn&eacute;es comme <code class="literal">sign()</code>, <code class="literal">trunc()</code>, <code class="literal">rtrim()</code>, <code class="literal">sin()</code> 
                        </p>
                     </li>
                     <li>
                        <p>Les param&egrave;tres positionnels de JDBC <code class="literal">?</code> 
                        </p>
                     </li>
                     <li>
                        <p>param&egrave;tres nomm&eacute;s <code class="literal">:name</code>, <code class="literal">:start_date</code>, <code class="literal">:x1</code> 
                        </p>
                     </li>
                     <li>
                        <p>litt&eacute;ral SQL <code class="literal">'foo'</code>, <code class="literal">69</code>, <code class="literal">'1970-01-01 10:00:01.0'</code> 
                        </p>
                     </li>
                     <li>
                        <p>Constantes Java <code class="literal">public static final</code><code class="literal">eg.Color.TABBY</code> 
                        </p>
                     </li>
                  </ul>
               </div>
               <p><code class="literal">in</code> et <code class="literal">between</code> peuvent &ecirc;tre utilis&eacute;s comme suit : 
               </p><pre class="programlisting">from DomesticCat cat where cat.name between 'A' and 'B'</pre><pre class="programlisting">from DomesticCat cat where cat.name in ( 'Foo', 'Bar', 'Baz' )</pre><p>et la forme n&eacute;gative peut &ecirc;tre &eacute;crite </p><pre class="programlisting">from DomesticCat cat where cat.name not between 'A' and 'B'</pre><pre class="programlisting">from DomesticCat cat where cat.name not in ( 'Foo', 'Bar', 'Baz' )</pre><p>De m&ecirc;me, <code class="literal">is null</code> et <code class="literal">is not null</code> peuvent &ecirc;tre utilis&eacute;s pour tester les valeurs nulle. 
               </p>
               <p>Les bool&eacute;ens peuvent &ecirc;tre facilement utilis&eacute;s en d&eacute;clarant les substitutions de requ&ecirc;tes dans la configuration Hibernate :
                  
               </p><pre class="programlisting">&lt;property name="hibernate.query.substitutions"&gt;true 1, false 0&lt;/property&gt;</pre><p>Ce qui remplacera les mots cl&eacute;s <code class="literal">true</code> et <code class="literal">false</code> par <code class="literal">1</code> et <code class="literal">0</code> dans la traduction SQL du HQL suivant : 
               </p><pre class="programlisting">from Cat cat where cat.alive = true</pre><p>Vous pouvez tester la taille d'une collection par la propri&eacute;t&eacute; sp&eacute;ciale <code class="literal">size</code>, ou la fonction sp&eacute;ciale <code class="literal">size()</code>. 
               </p><pre class="programlisting">from Cat cat where cat.kittens.size &gt; 0</pre><pre class="programlisting">from Cat cat where size(cat.kittens) &gt; 0</pre><p>Pour les collections index&eacute;es, vous pouvez faire r&eacute;f&eacute;rence aux indices minimum et maximum en utilisant les fonctions <code class="literal">minindex</code> and <code class="literal">maxindex</code>. De mani&egrave;re similaire, vous pouvez faire r&eacute;f&eacute;rence aux &eacute;l&eacute;ments minimum et maximum d'une collection de type basiques en utilisant
                  les fonctions <code class="literal">minelement</code> et <code class="literal">maxelement</code>. 
               </p><pre class="programlisting">from Calendar cal where maxelement(cal.holidays) &gt; current_date</pre><pre class="programlisting">from Order order where maxindex(order.items) &gt; 100</pre><pre class="programlisting">from Order order where minelement(order.items) &gt; 10000</pre><p>Les fonctions SQL <code class="literal">any, some, all, exists, in</code> supportent que leur soient pass&eacute;es l'&eacute;l&eacute;ment, l'index d'une collection (fonctions <code class="literal">elements</code> et <code class="literal">indices</code>) ou le r&eacute;sultat d'une sous requ&ecirc;te (voir ci dessous). 
               </p><pre class="programlisting">select mother from Cat as mother, Cat as kit
where kit in elements(foo.kittens)</pre><pre class="programlisting">select p from NameList list, Person p
where p.name = some elements(list.names)</pre><pre class="programlisting">from Cat cat where exists elements(cat.kittens)</pre><pre class="programlisting">from Player p where 3 &gt; all elements(p.scores)</pre><pre class="programlisting">from Show show where 'fizard' in indices(show.acts)</pre><p>Notez que l'&eacute;criture de - <code class="literal">size</code>, <code class="literal">elements</code>, <code class="literal">indices</code>, <code class="literal">minindex</code>, <code class="literal">maxindex</code>, <code class="literal">minelement</code>, <code class="literal">maxelement</code> - peuvent seulement &ecirc;tre utilis&eacute;e dans la clause where dans Hibernate3. 
               </p>
               <p>Les &eacute;l&eacute;ments de collections index&eacute;es (arrays, lists, maps) peuvent &ecirc;tre r&eacute;f&eacute;renc&eacute;s via index (dans une clause where seulement)
                  : 
               </p><pre class="programlisting">from Order order where order.items[0].id = 1234</pre><pre class="programlisting">select person from Person person, Calendar calendar
where calendar.holidays['national day'] = person.birthDay
    and person.nationality.calendar = calendar</pre><pre class="programlisting">select item from Item item, Order order
where order.items[ order.deliveredItemIndices[0] ] = item and order.id = 11</pre><pre class="programlisting">select item from Item item, Order order
where order.items[ maxindex(order.items) ] = item and order.id = 11</pre><p>L'expression entre <code class="literal">[]</code> peut m&ecirc;me &ecirc;tre une expression arithm&eacute;tique. 
               </p><pre class="programlisting">select item from Item item, Order order
where order.items[ size(order.items) - 1 ] = item</pre><p>HQL propose aussi une fonction <code class="literal">index()</code> interne, pour les &eacute;l&eacute;ments d'une association one-to-many ou d'une collections de valeurs. 
               </p><pre class="programlisting">select item, index(item) from Order order
    join order.items item
where index(item) &lt; 5</pre><p>Les fonctions SQL scalaires support&eacute;es par la base de donn&eacute;es utilis&eacute;e peuvent &ecirc;tre utilis&eacute;es </p><pre class="programlisting">from DomesticCat cat where upper(cat.name) like 'FRI%'</pre><p>Si vous n'&ecirc;tes pas encore convaincu par tout cela, imaginez la taille et l'illisibilit&eacute; qui caract&eacute;riseraient la transformation
                  SQL de la requ&ecirc;te HQL suivante : 
               </p><pre class="programlisting">select cust
from Product prod,
    Store store
    inner join store.customers cust
where prod.name = 'widget'
    and store.location.name in ( 'Melbourne', 'Sydney' )
    and prod = all elements(cust.currentOrder.lineItems)</pre><p><span class="emphasis"><em>Un indice :</em></span> cela donnerait quelque chose comme 
               </p><pre class="programlisting">SELECT cust.name, cust.address, cust.phone, cust.id, cust.current_order
FROM customers cust,
    stores store,
    locations loc,
    store_customers sc,
    product prod
WHERE prod.name = 'widget'
    AND store.loc_id = loc.id
    AND loc.name IN ( 'Melbourne', 'Sydney' )
    AND sc.store_id = store.id
    AND sc.cust_id = cust.id
    AND prod.id = ALL(
        SELECT item.prod_id
        FROM line_items item, orders o
        WHERE item.order_id = o.id
            AND cust.current_order = o.id
    )</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-ordering"></a>14.11.&nbsp;La clause order by
                        </h2>
                     </div>
                  </div>
               </div>
               <p>La liste retoun&eacute;e par la requ&ecirc;te peut &ecirc;tre tri&eacute;e par n'importe quelle propri&eacute;t&eacute; de la classe ou du composant retourn&eacute; : </p><pre class="programlisting">from DomesticCat cat
order by cat.name asc, cat.weight desc, cat.birthdate</pre><p>Le mot optionnel <code class="literal">asc</code> ou <code class="literal">desc</code> indique respectivement si le tri doit &ecirc;tre croissant ou d&eacute;croissant. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-grouping"></a>14.12.&nbsp;La clause group by
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Si la requ&ecirc;te retourne des valeurs aggr&eacute;g&eacute;es, celles ci peuvent &ecirc;tre group&eacute;es par propri&eacute;t&eacute; ou composant : </p><pre class="programlisting">select cat.color, sum(cat.weight), count(cat)
from Cat cat
group by cat.color</pre><pre class="programlisting">select foo.id, avg(name), max(name)
from Foo foo join foo.names name
group by foo.id</pre><p>Une clause <code class="literal">having</code> est aussi permise. 
               </p><pre class="programlisting">select cat.color, sum(cat.weight), count(cat)
from Cat cat
group by cat.color
having cat.color in (eg.Color.TABBY, eg.Color.BLACK)</pre><p>Les fonctions SQL et les fonctions d'aggr&eacute;gations sont permises dans les clauses <code class="literal">having</code> et <code class="literal">order by</code>, si elles sont support&eacute;es par la base de donn&eacute;es (ce que ne fait pas MySQL par exemple). 
               </p><pre class="programlisting">select cat
from Cat cat
    join cat.kittens kitten
group by cat.id, cat.name, cat.other, cat.properties
having avg(kitten.weight) &gt; 100
order by count(kitten) asc, sum(kitten.weight) desc</pre><p>Notez que ni la clause <code class="literal">group by</code> ni la clause <code class="literal">order by</code> ne peuvent contenir d'expressions arithm&eacute;tiques. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-subqueries"></a>14.13.&nbsp;Sous-requ&ecirc;tes
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Pour les bases de donn&eacute;es le supportant, Hibernate supporte les sous requ&ecirc;tes dans les requ&ecirc;tes. Une sous requ&ecirc;te doit &ecirc;tre
                  entre parenth&egrave;ses (souvent pour un appel &agrave; une fonction d'agr&eacute;gation SQL) M&ecirc;me les sous requ&ecirc;tes corr&eacute;l&eacute;es (celles qui font
                  r&eacute;f&eacute;rence &agrave; un alias de la requ&ecirc;te principale) sont support&eacute;es. 
               </p><pre class="programlisting">from Cat as fatcat
where fatcat.weight &gt; (
    select avg(cat.weight) from DomesticCat cat
)</pre><pre class="programlisting">from DomesticCat as cat
where cat.name = some (
    select name.nickName from Name as name
)</pre><pre class="programlisting">from Cat as cat
where not exists (
    from Cat as mate where mate.mate = cat
)</pre><pre class="programlisting">from DomesticCat as cat
where cat.name not in (
    select name.nickName from Name as name
)</pre><pre class="programlisting">select cat.id, (select max(kit.weight) from cat.kitten kit)
from Cat as cat</pre><p>Notez que les sous-requ&ecirc;tes HQL peuvent arriver seulememnt dans les clauses select ou where. </p>
               <p>Note that subqueries can also utilize <code class="literal">row value constructor</code> syntax. See <a href="#queryhql-tuple" title="14.18.&nbsp;Row value constructor syntax">Section&nbsp;14.18, &laquo;&nbsp;Row value constructor syntax&nbsp;&raquo;</a> for more details. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-examples"></a>14.14.&nbsp;Exemples HQL
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Les requ&ecirc;tes Hibernate peuvent &ecirc;tre relativement puissantes et complexes. En fait, la puissance du langage de requ&ecirc;tage est
                  l'un des avantages principaux d'Hibernate. Voici quelques exemples tr&egrave;s similaires aux requ&ecirc;tes que nous avons utilis&eacute;es lors
                  d'un r&eacute;cent projet. Notez que la plupart des requ&ecirc;tes que vous &eacute;crirez seront plus simples que les exemples suivantes ! 
               </p>
               <p>La requ&ecirc;te suivante retourne l'id de commande (order), le nombre d'articles (items) et la valeur totale de la commande (order)
                  pour toutes les commandes non pay&eacute;es d'un client (customer) particulier pour un total minimum donn&eacute;, le tout tri&eacute; par la valeur
                  totale. La requ&ecirc;te SQL g&eacute;n&eacute;r&eacute;e sur les tables <code class="literal">ORDER</code>, <code class="literal">ORDER_LINE</code>, <code class="literal">PRODUCT</code>, <code class="literal">CATALOG</code> et <code class="literal">PRICE</code> est compos&eacute;e de quatre jointures interne ainsi que d'une sous-requ&ecirc;te (non corr&eacute;l&eacute;e). 
               </p><pre class="programlisting">select order.id, sum(price.amount), count(item)
from Order as order
    join order.lineItems as item
    join item.product as product,
    Catalog as catalog
    join catalog.prices as price
where order.paid = false
    and order.customer = :customer
    and price.product = product
    and catalog.effectiveDate &lt; sysdate
    and catalog.effectiveDate &gt;= all (
        select cat.effectiveDate
        from Catalog as cat
        where cat.effectiveDate &lt; sysdate
    )
group by order
having sum(price.amount) &gt; :minAmount
order by sum(price.amount) desc</pre><p>Quel monstre ! En principe, nous ne sommes pas tr&egrave;s fan des sous-requ&ecirc;tes, la requ&ecirc;te ressemblait donc plut&ocirc;t &agrave; cela : </p><pre class="programlisting">select order.id, sum(price.amount), count(item)
from Order as order
    join order.lineItems as item
    join item.product as product,
    Catalog as catalog
    join catalog.prices as price
where order.paid = false
    and order.customer = :customer
    and price.product = product
    and catalog = :currentCatalog
group by order
having sum(price.amount) &gt; :minAmount
order by sum(price.amount) desc</pre><p>La requ&ecirc;te suivante compte le nombre de paiements (payments) pour chaque status, en excluant les paiements dans le status
                  <code class="literal">AWAITING_APPROVAL</code> o&ugrave; le changement de status le plus r&eacute;cent &agrave; &eacute;t&eacute; fait par l'utilisateur courant. En SQL, cette requ&ecirc;te effectue deux jointures
                  internes et des sous requ&ecirc;tes corr&eacute;l&eacute;es sur les tables <code class="literal">PAYMENT</code>, <code class="literal">PAYMENT_STATUS</code> et <code class="literal">PAYMENT_STATUS_CHANGE</code>. 
               </p><pre class="programlisting">select count(payment), status.name
from Payment as payment
    join payment.currentStatus as status
    join payment.statusChanges as statusChange
where payment.status.name &lt;&gt; PaymentStatus.AWAITING_APPROVAL
    or (
        statusChange.timeStamp = (
            select max(change.timeStamp)
            from PaymentStatusChange change
            where change.payment = payment
        )
        and statusChange.user &lt;&gt; :currentUser
    )
group by status.name, status.sortOrder
order by status.sortOrder</pre><p>Si nous avions mapp&eacute; la collection <code class="literal">statusChanges</code> comme une liste, au lieu d'un ensemble, la requ&ecirc;te aurait &eacute;t&eacute; plus facile &agrave; &eacute;crire. 
               </p><pre class="programlisting">select count(payment), status.name
from Payment as payment
    join payment.currentStatus as status
where payment.status.name &lt;&gt; PaymentStatus.AWAITING_APPROVAL
    or payment.statusChanges[ maxIndex(payment.statusChanges) ].user &lt;&gt; :currentUser
group by status.name, status.sortOrder
order by status.sortOrder</pre><p>La requ&ecirc;te qui suit utilise la fonction de MS SQL <code class="literal">isNull()</code> pour retourner tous les comptes (accounts) et paiements (payments) impay&eacute;s pour l'organisation &agrave; laquelle l'uilisateur (user)
                  courant appartient. Elle est traduite en SQL par trois jointures internes, une jointure externe ainsi qu'une sous requ&ecirc;te
                  sur les tables <code class="literal">ACCOUNT</code>, <code class="literal">PAYMENT</code>, <code class="literal">PAYMENT_STATUS</code>, <code class="literal">ACCOUNT_TYPE</code>, <code class="literal">ORGANIZATION</code> et <code class="literal">ORG_USER</code>. 
               </p><pre class="programlisting">select account, payment
from Account as account
    left outer join account.payments as payment
where :currentUser in elements(account.holder.users)
    and PaymentStatus.UNPAID = isNull(payment.currentStatus.name, PaymentStatus.UNPAID)
order by account.type.sortOrder, account.accountNumber, payment.dueDate</pre><p>Pour d'autres base de donn&eacute;es, nous aurions d&ucirc; faire sans la sous-requ&ecirc;te (corr&eacute;l&eacute;e). </p><pre class="programlisting">select account, payment
from Account as account
    join account.holder.users as user
    left outer join account.payments as payment
where :currentUser = user
    and PaymentStatus.UNPAID = isNull(payment.currentStatus.name, PaymentStatus.UNPAID)
order by account.type.sortOrder, account.accountNumber, payment.dueDate</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-bulk"></a>14.15.&nbsp;Mise &agrave; jour et suppression
                        </h2>
                     </div>
                  </div>
               </div>
               <p>HQL supporte maintenant les expressions <code class="literal">update</code>, <code class="literal">delete</code> et <code class="literal">insert ... select ...</code>. Voir <a href="#batch-direct" title="13.4.&nbsp;La pseudo-syntaxe pour les expressions UPDATE et DELETE est : ( UPDATE | DELETE ) FROM? EntityName (WHERE where_conditions)?. Certains points sont &Atilde;&nbsp; noter :">Section&nbsp;13.4, &laquo;&nbsp;La pseudo-syntaxe pour les expressions <code class="literal">UPDATE</code> et <code class="literal">DELETE</code> est : <code class="literal">( UPDATE | DELETE ) FROM? EntityName (WHERE where_conditions)?</code>. Certains points sont &Atilde;&nbsp; noter :&nbsp;&raquo;</a> pour les d&eacute;tails. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-tipstricks"></a>14.16.&nbsp;Trucs &amp; Astuces
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Vous pouvez compter le nombre de r&eacute;sultats d'une requ&ecirc;te sans les retourner : </p><pre class="programlisting">( (Integer) session.createQuery("select count(*) from ....").iterate().next() ).intValue()</pre><p>Pour trier les r&eacute;sultats par la taille d'une collection, utilisez la requ&ecirc;te suivante : </p><pre class="programlisting">select usr.id, usr.name
from User as usr
    left join usr.messages as msg
group by usr.id, usr.name
order by count(msg)</pre><p>Si votre base de donn&eacute;es supporte les sous-requ&ecirc;tes, vous pouvez placer des conditions sur la taille de la s&eacute;lection dans
                  la clause where de votre requ&ecirc;te: 
               </p><pre class="programlisting">from User usr where size(usr.messages) &gt;= 1</pre><p>Si votre base de donn&eacute;es ne supporte pas les sous-requ&ecirc;tes, utilisez la requ&ecirc;te suivante : </p><pre class="programlisting">select usr.id, usr.name
from User usr.name
    join usr.messages msg
group by usr.id, usr.name
having count(msg) &gt;= 1</pre><p>Cette solution ne peut pas retourner un <code class="literal">User</code> avec z&eacute;ro message &agrave; cause de la jointure interne, la forme suivante peut donc &ecirc;tre utile : 
               </p><pre class="programlisting">select usr.id, usr.name
from User as usr
    left join usr.messages as msg
group by usr.id, usr.name
having count(msg) = 0</pre><p>Les propri&eacute;t&eacute;s d'un JavaBean peuvent &ecirc;tre inject&eacute;es dans les param&egrave;tres nomm&eacute;s d'un requ&ecirc;te : </p><pre class="programlisting">Query q = s.createQuery("from foo Foo as foo where foo.name=:name and foo.size=:size");
q.setProperties(fooBean); // fooBean has getName() and getSize()
List foos = q.list();</pre><p>Les collections sont paginables via l'utilisation de l'interface <code class="literal">Query</code> avec un filtre : 
               </p><pre class="programlisting">Query q = s.createFilter( collection, "" ); // the trivial filter
q.setMaxResults(PAGE_SIZE);
q.setFirstResult(PAGE_SIZE * pageNumber);
List page = q.list();</pre><p>Les &eacute;l&eacute;ments d'une collection peuvent &ecirc;tre tri&eacute;s ou group&eacute;s en utilisant un filtre de requ&ecirc;te : </p><pre class="programlisting">Collection orderedCollection = s.filter( collection, "order by this.amount" );
Collection counts = s.filter( collection, "select this.type, count(this) group by this.type" );</pre><p>Vous pouvez r&eacute;cup&eacute;rer la taille d'une collection sans l'initialiser : </p><pre class="programlisting">( (Integer) session.createQuery("select count(*) from ....").iterate().next() ).intValue();</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-components"></a>14.17.&nbsp;translator-credits
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Components might be used in just about every way that simple value types can be used in HQL queries. They can appear in the
                  <code class="literal">select</code> clause: 
               </p><pre class="programlisting">select p.name from Person p</pre><pre class="programlisting">select p.name.first from Person p</pre><p>where the Person's name property is a component. Components can also be used in the <code class="literal">where</code> clause: 
               </p><pre class="programlisting">from Person p where p.name = :name</pre><pre class="programlisting">from Person p where p.name.first = :firstName</pre><p>Components can also be used in the <code class="literal">order by</code> clause: 
               </p><pre class="programlisting">from Person p order by p.name</pre><pre class="programlisting">from Person p order by p.name.first</pre><p>Another common use of components is in <a href="#queryhql-tuple" title="14.18.&nbsp;Row value constructor syntax">row value constructors</a>. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="queryhql-tuple"></a>14.18.&nbsp;Row value constructor syntax
                        </h2>
                     </div>
                  </div>
               </div>
               <p>HQL supports the use of ANSI SQL <code class="literal">row value constructor</code> syntax (sometimes called <code class="literal">tuple</code> syntax), even though the underlying database may not support that notion. Here we are generally referring to multi-valued
                  comparisons, typically associated with components. Consider an entity Person which defines a name component: 
               </p><pre class="programlisting">from Person p where p.name.first='John' and p.name.last='Jingleheimer-Schmidt'</pre><p>That's valid syntax, although a little verbose. It be nice to make this a bit more concise and use <code class="literal">row value constructor</code> syntax: 
               </p><pre class="programlisting">from Person p where p.name=('John', 'Jingleheimer-Schmidt')</pre><p>It can also be useful to specify this in the <code class="literal">select</code> clause: 
               </p><pre class="programlisting">select p.name from Person p</pre><p>Another time using <code class="literal">row value constructor</code> syntax can be beneficial is when using subqueries needing to compare against multiple values: 
               </p><pre class="programlisting">from Cat as cat
where not ( cat.name, cat.color ) in (
    select cat.name, cat.color from DomesticCat cat
)</pre><p>One thing to consider when deciding if you want to use this syntax is that the query will be dependent upon the ordering of
                  the component sub-properties in the metadata. 
               </p>
            </div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="querycriteria"></a>Chapitre&nbsp;15.&nbsp;Requ&ecirc;tes par crit&egrave;res
                     </h2>
                  </div>
               </div>
            </div>
            <p>Hibernate offre une API d'interrogation par crit&egrave;res intuitive et extensible. </p>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="querycriteria-creating"></a>15.1.&nbsp;Cr&eacute;er une instance de <code class="literal">Criteria</code></h2>
                     </div>
                  </div>
               </div>
               <p>L'interface <code class="literal">net.sf.hibernate.Criteria</code> repr&eacute;sente une requ&ecirc;te sur une classe persistente donn&eacute;e. La <code class="literal">Session</code> fournit les instances de <code class="literal">Criteria</code>. 
               </p><pre class="programlisting">Criteria crit = sess.createCriteria(Cat.class);
crit.setMaxResults(50);
List cats = crit.list();</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="querycriteria-narrowing"></a>15.2.&nbsp;Restriction du r&eacute;sultat
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Un criterion (crit&egrave;re de recherche) est une instance de l'interface <code class="literal">org.hibernate.criterion.Criterion</code>. La classe <code class="literal">org.hibernate.criterion.Restrictions</code> d&eacute;finit des m&eacute;thodes pour obtenir des types de <code class="literal">Criterion</code> pr&eacute;-d&eacute;finis. 
               </p><pre class="programlisting">List cats = sess.createCriteria(Cat.class)
    .add( Restrictions.like("name", "Fritz%") )
    .add( Restrictions.between("weight", minWeight, maxWeight) )
    .list();</pre><p>Les restrictions peuvent &ecirc;tre goup&eacute;es de mani&egrave;re logique. </p><pre class="programlisting">List cats = sess.createCriteria(Cat.class)
    .add( Restrictions.like("name", "Fritz%") )
    .add( Restrictions.or(
        Restrictions.eq( "age", new Integer(0) ),
        Restrictions.isNull("age")
    ) )
    .list();</pre><pre class="programlisting">List cats = sess.createCriteria(Cat.class)
    .add( Restrictions.in( "name", new String[] { "Fritz", "Izi", "Pk" } ) )
    .add( Restrictions.disjunction()
        .add( Restrictions.isNull("age") )
        .add( Restrictions.eq("age", new Integer(0) ) )
        .add( Restrictions.eq("age", new Integer(1) ) )
        .add( Restrictions.eq("age", new Integer(2) ) )
    ) )
    .list();</pre><p>Il y a plusieurs types de criterion pr&eacute;-d&eacute;finis (sous classes de <code class="literal">Restriction</code>), mais l'une d'entre elle particuli&egrave;rement utile vous permet de sp&eacute;cifier directement du SQL. 
               </p><pre class="programlisting">List cats = sess.createCriteria(Cat.class)
    .add( Restrictions.sqlRestriction("lower({alias}.name) like lower(?)", "Fritz%", Hibernate.STRING) )
    .list();</pre><p>La zone <code class="literal">{alias}</code> sera remplac&eacute;e par l'alias de colonne de l'entit&eacute; que l'on souhaite int&eacute;rroger. 
               </p>
               <p>Une autre approche pour obtenir un criterion est de le r&eacute;cup&eacute;rer d'une instance de <code class="literal">Property</code>. Vous pouvez cr&eacute;er une <code class="literal">Property</code> en appelant <code class="literal">Property.forName()</code>. 
               </p><pre class="programlisting">
Property age = Property.forName("age");
List cats = sess.createCriteria(Cat.class)
    .add( Restrictions.disjunction()
        .add( age.isNull() )
        .add( age.eq( new Integer(0) ) )
        .add( age.eq( new Integer(1) ) )
        .add( age.eq( new Integer(2) ) )
    ) )
    .add( Property.forName("name").in( new String[] { "Fritz", "Izi", "Pk" } ) )
    .list();</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="querycriteria-ordering"></a>15.3.&nbsp;Trier les r&eacute;sultats
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Vous pouvez trier les r&eacute;sultats en utilisant <code class="literal">org.hibernate.criterion.Order</code>. 
               </p><pre class="programlisting">List cats = sess.createCriteria(Cat.class)
    .add( Restrictions.like("name", "F%")
    .addOrder( Order.asc("name") )
    .addOrder( Order.desc("age") )
    .setMaxResults(50)
    .list();</pre><pre class="programlisting">List cats = sess.createCriteria(Cat.class)
    .add( Property.forName("name").like("F%") )
    .addOrder( Property.forName("name").asc() )
    .addOrder( Property.forName("age").desc() )
    .setMaxResults(50)
    .list();</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="querycriteria-associations"></a>15.4.&nbsp;Associations
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Vous pouvez facilement sp&eacute;cifier des contraintes sur des entit&eacute;s li&eacute;es, par des associations en utilisant <code class="literal">createCriteria()</code>. 
               </p><pre class="programlisting">List cats = sess.createCriteria(Cat.class)
    .add( Restrictions.like("name", "F%") )
    .createCriteria("kittens")
        .add( Restrictions.like("name", "F%") )
    .list();</pre><p>Notez que la seconde <code class="literal">createCriteria()</code> retourne une nouvelle instance de <code class="literal">Criteria</code>, qui se rapporte aux &eacute;l&eacute;ments de la collection <code class="literal">kittens</code>. 
               </p>
               <p>La forme alternative suivante est utile dans certains cas. </p><pre class="programlisting">List cats = sess.createCriteria(Cat.class)
    .createAlias("kittens", "kt")
    .createAlias("mate", "mt")
    .add( Restrictions.eqProperty("kt.name", "mt.name") )
    .list();</pre><p>(<code class="literal">createAlias()</code> ne cr&eacute;e pas de nouvelle instance de <code class="literal">Criteria</code>.) 
               </p>
               <p>Notez que les collections kittens contenues dans les instances de <code class="literal">Cat</code> retourn&eacute;es par les deux pr&eacute;c&eacute;dentes requ&ecirc;tes ne sont <span class="emphasis"><em>pas</em></span> pr&eacute;-filtr&eacute;es par les crit&egrave;res ! Si vous souhaitez r&eacute;cup&eacute;rer uniquement les kittens qui correspondent &agrave; la criteria, vous
                  devez utiliser <code class="literal">ResultTransformer</code>. 
               </p><pre class="programlisting">List cats = sess.createCriteria(Cat.class)
    .createCriteria("kittens", "kt")
        .add( Restrictions.eq("name", "F%") )
    .setResultTransformer(Criteria.ALIAS_TO_ENTITY_MAP)
    .list();
Iterator iter = cats.iterator();
while ( iter.hasNext() ) {
    Map map = (Map) iter.next();
    Cat cat = (Cat) map.get(Criteria.ROOT_ALIAS);
    Cat kitten = (Cat) map.get("kt");
}</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="querycriteria-dynamicfetching"></a>15.5.&nbsp;Peuplement d'associations de mani&egrave;re dynamique
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Vous pouvez sp&eacute;ficier au moment de l'ex&eacute;cution le peuplement d'une association en utilisant <code class="literal">setFetchMode()</code> (c'est-&agrave;-dire le chargement de celle-ci). Cela permet de surcharger les valeurs "lazy" et "outer-join" du mapping. 
               </p><pre class="programlisting">List cats = sess.createCriteria(Cat.class)
    .add( Restrictions.like("name", "Fritz%") )
    .setFetchMode("mate", FetchMode.EAGER)
    .setFetchMode("kittens", FetchMode.EAGER)
    .list();</pre><p>Cette requ&ecirc;te recherchera <code class="literal">mate</code> et <code class="literal">kittens</code> via les jointures externes. Voir <a href="#performance-fetching" title="19.1.&nbsp;Strat&eacute;gies de chargement">Section&nbsp;19.1, &laquo;&nbsp;Strat&eacute;gies de chargement&nbsp;&raquo;</a> pour plus d'informations. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="querycriteria-examples"></a>15.6.&nbsp;Requ&ecirc;tes par l'exemple
                        </h2>
                     </div>
                  </div>
               </div>
               <p>La classe <code class="literal">org.hibernate.criterion.Example</code> vous permet de construire un crit&egrave;re suivant une instance d'objet donn&eacute;e. 
               </p><pre class="programlisting">Cat cat = new Cat();
cat.setSex('F');
cat.setColor(Color.BLACK);
List results = session.createCriteria(Cat.class)
    .add( Example.create(cat) )
    .list();</pre><p>Les propri&eacute;t&eacute;s de type version, identifiant et association sont ignor&eacute;es. Par d&eacute;faut, les valeurs null sont exclues. </p>
               <p>Vous pouvez ajuster la strat&eacute;gie d'utilisation de valeurs de l'<code class="literal">Exemple</code>. 
               </p><pre class="programlisting">Example example = Example.create(cat)
    .excludeZeroes()           //exclude zero valued properties
    .excludeProperty("color")  //exclude the property named "color"
    .ignoreCase()              //perform case insensitive string comparisons
    .enableLike();             //use like for string comparisons
List results = session.createCriteria(Cat.class)
    .add(example)
    .list();</pre><p>Vous pouvez utiliser les "exemples" pour des crit&egrave;res sur les objets associ&eacute;s. </p><pre class="programlisting">List results = session.createCriteria(Cat.class)
    .add( Example.create(cat) )
    .createCriteria("mate")
        .add( Example.create( cat.getMate() ) )
    .list();</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="querycriteria-projection"></a>15.7.&nbsp;Projections, agr&eacute;gation et regroupement
                        </h2>
                     </div>
                  </div>
               </div>
               <p>La classe <code class="literal">org.hibernate.criterion.Projections</code> est une fabrique d'instances de <code class="literal">Projection</code>. Nous appliquons une projection sur une requ&ecirc;te en appelant <code class="literal">setProjection()</code>. 
               </p><pre class="programlisting">List results = session.createCriteria(Cat.class)
    .setProjection( Projections.rowCount() )
    .add( Restrictions.eq("color", Color.BLACK) )
    .list();</pre><pre class="programlisting">List results = session.createCriteria(Cat.class)
    .setProjection( Projections.projectionList()
        .add( Projections.rowCount() )
        .add( Projections.avg("weight") )
        .add( Projections.max("weight") )
        .add( Projections.groupProperty("color") )
    )
    .list();</pre><p>Il n'y a pas besoin de "group by" explicite dans une requ&ecirc;te par crit&egrave;re. Certains types de projection sont d&eacute;finis pour &ecirc;tre
                  des <span class="emphasis"><em>projections de regroupement</em></span>, lesquels apparaissent aussi dans la clause <code class="literal">group by</code> SQL. 
               </p>
               <p>Un alias peut optionnellement &ecirc;tre assign&eacute; &agrave; une projection, ainsi la valeur projet&eacute;e peut &ecirc;tre r&eacute;f&eacute;renc&eacute;e dans des restrictions
                  ou des tris. Voici deux fa&ccedil;ons diff&eacute;rentes de faire &ccedil;a : 
               </p><pre class="programlisting">List results = session.createCriteria(Cat.class)
    .setProjection( Projections.alias( Projections.groupProperty("color"), "colr" ) )
    .addOrder( Order.asc("colr") )
    .list();</pre><pre class="programlisting">List results = session.createCriteria(Cat.class)
    .setProjection( Projections.groupProperty("color").as("colr") )
    .addOrder( Order.asc("colr") )
    .list();</pre><p>Les m&eacute;thodes <code class="literal">alias()</code> et <code class="literal">as()</code> enveloppe simplement une instance de projection dans une autre instance (alias&eacute;e) de <code class="literal">Projection</code>. Comme un raccourci, vous pouvez assignez un alias lorsque vous ajoutez la projection &agrave; la liste de projections : 
               </p><pre class="programlisting">List results = session.createCriteria(Cat.class)
    .setProjection( Projections.projectionList()
        .add( Projections.rowCount(), "catCountByColor" )
        .add( Projections.avg("weight"), "avgWeight" )
        .add( Projections.max("weight"), "maxWeight" )
        .add( Projections.groupProperty("color"), "color" )
    )
    .addOrder( Order.desc("catCountByColor") )
    .addOrder( Order.desc("avgWeight") )
    .list();</pre><pre class="programlisting">List results = session.createCriteria(Domestic.class, "cat")
    .createAlias("kittens", "kit")
    .setProjection( Projections.projectionList()
        .add( Projections.property("cat.name"), "catName" )
        .add( Projections.property("kit.name"), "kitName" )
    )
    .addOrder( Order.asc("catName") )
    .addOrder( Order.asc("kitName") )
    .list();</pre><p>Vous pouvez aussi utiliser <code class="literal">Property.forName()</code> pour formuler des projections : 
               </p><pre class="programlisting">List results = session.createCriteria(Cat.class)
    .setProjection( Property.forName("name") )
    .add( Property.forName("color").eq(Color.BLACK) )
    .list();</pre><pre class="programlisting">List results = session.createCriteria(Cat.class)
    .setProjection( Projections.projectionList()
        .add( Projections.rowCount().as("catCountByColor") )
        .add( Property.forName("weight").avg().as("avgWeight") )
        .add( Property.forName("weight").max().as("maxWeight") )
        .add( Property.forName("color").group().as("color" )
    )
    .addOrder( Order.desc("catCountByColor") )
    .addOrder( Order.desc("avgWeight") )
    .list();</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="querycriteria-detachedqueries"></a>15.8.&nbsp;Requ&ecirc;tes et sous-requ&ecirc;tes d&eacute;tach&eacute;es
                        </h2>
                     </div>
                  </div>
               </div>
               <p>La classe <code class="literal">DetachedCriteria</code> vous laisse cr&eacute;er une requ&ecirc;te en dehors de la port&eacute;e de la session, et puis l'ex&eacute;cuter plus tard en utilisant n'importe quelle
                  <code class="literal">Session</code> arbitraire. 
               </p><pre class="programlisting">DetachedCriteria query = DetachedCriteria.forClass(Cat.class)
    .add( Property.forName("sex").eq('F') );
    
Session session = ....;
Transaction txn = session.beginTransaction();
List results = query.getExecutableCriteria(session).setMaxResults(100).list();
txn.commit();
session.close();</pre><p>Une <code class="literal">DetachedCriteria</code> peut aussi &ecirc;tre utilis&eacute;e pour exprimer une sous-requ&ecirc;te. Des instances de criterion impliquant des sous-requ&ecirc;tes peuvent
                  &ecirc;tre obtenues via <code class="literal">Subqueries</code> ou <code class="literal">Property</code>. 
               </p><pre class="programlisting">DetachedCriteria avgWeight = DetachedCriteria.forClass(Cat.class)
    .setProjection( Property.forName("weight").avg() );
session.createCriteria(Cat.class)
    .add( Property.forName("weight").gt(avgWeight) )
    .list();</pre><pre class="programlisting">DetachedCriteria weights = DetachedCriteria.forClass(Cat.class)
    .setProjection( Property.forName("weight") );
session.createCriteria(Cat.class)
    .add( Subqueries.geAll("weight", weights) )
    .list();</pre><p>M&ecirc;me des requ&ecirc;tes corr&eacute;l&eacute;es sont possibles : </p><pre class="programlisting">DetachedCriteria avgWeightForSex = DetachedCriteria.forClass(Cat.class, "cat2")
    .setProjection( Property.forName("weight").avg() )
    .add( Property.forName("cat2.sex").eqProperty("cat.sex") );
session.createCriteria(Cat.class, "cat")
    .add( Property.forName("weight").gt(avgWeightForSex) )
    .list();</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="query-criteria-naturalid"></a>15.9.&nbsp;Requ&ecirc;tes par identifiant naturel
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Pour la plupart des requ&ecirc;tes, incluant les requ&ecirc;tes par crit&egrave;re, le cache de requ&ecirc;tes n'est pas tr&egrave;s efficace, parce que l'invalidation
                  du cache de requ&ecirc;tes arrive trop souvent. Cependant, il y a une sorte sp&eacute;ciale de requ&ecirc;te o&ugrave; nous pouvons optimiser l'algorithme
                  d'invalidation du cache : les recherches sur une clef naturelle constante. Dans certaines applications, cette sorte de requ&ecirc;te
                  se produit fr&eacute;quemment. L'API de crit&egrave;re fournit une provision sp&eacute;ciale pour ce cas d'utilisation. 
               </p>
               <p>D'abord vous devriez mapper la clef naturelle de votre entit&eacute; en utilisant <code class="literal">&lt;natural-id&gt;</code>, et activer l'utilisation du cache de second niveau. 
               </p><pre class="programlisting">&lt;class name="User"&gt;
    &lt;cache usage="read-write"/&gt;
    &lt;id name="id"&gt;
        &lt;generator class="increment"/&gt;
    &lt;/id&gt;
    &lt;natural-id&gt;
        &lt;property name="name"/&gt;
        &lt;property name="org"/&gt;
    &lt;/natural-id&gt;
    &lt;property name="password"/&gt;
&lt;/class&gt;</pre><p>Notez que cette fonctionnalit&eacute; n'est pas pr&eacute;vue pour l'utilisation avec des entit&eacute;s avec des clefs naturelles <span class="emphasis"><em>mutables</em></span>. 
               </p>
               <p>Ensuite, activez le cache de requ&ecirc;te d'Hibernate. </p>
               <p>Maintenant <code class="literal">Restrictions.naturalId()</code> nous permet de rendre l'utilisation de l'algorithme de cache plus efficace. 
               </p><pre class="programlisting">session.createCriteria(User.class)
    .add( Restrictions.naturalId()
        .set("name", "gavin")
        .set("org", "hb") 
    ).setCacheable(true)
    .uniqueResult();</pre></div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="querysql"></a>Chapitre&nbsp;16.&nbsp;SQL natif
                     </h2>
                  </div>
               </div>
            </div>
            <p>Vous pouvez aussi &eacute;crire vos requ&ecirc;tes dans le dialecte SQL natif de votre base de donn&eacute;es. Ceci est utile si vous souhaitez
               utiliser les fonctionnalit&eacute;s sp&eacute;cifiques de votre base de donn&eacute;es comme le mot cl&eacute; <code class="literal">CONNECT</code> d'Oracle. Cette fonctionnalit&eacute; offre par ailleurs un moyen de migration plus propre et doux d'une application bas&eacute;e sur SQL/JDBC
               vers une application Hibernate.
            </p>
            <p>Hibernate3 vous permet de sp&eacute;cifier du SQL &eacute;crit &agrave; la main (incluant les proc&eacute;dures stock&eacute;es) pour toutes les op&eacute;rations de
               cr&eacute;ation, mise &agrave; jour, suppression et chargement.
            </p>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="querysql-creating"></a>16.1.&nbsp;Utiliser une <code class="literal">SQLQuery</code></h2>
                     </div>
                  </div>
               </div>
               <p>L'ex&eacute;cution des requ&ecirc;tes en SQL natif est contr&ocirc;l&eacute;e par l'interface <code class="literal">SQLQuery</code>, laquelle est obtenue en appelant <code class="literal">Session.createSQLQuery()</code>. Dans des cas extr&ecirc;mement simples, nous pouvons utiliser la forme suivante :
               </p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e13156"></a>16.1.1.&nbsp;Scalar queries
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>The most basic SQL query is to get a list of scalars (values).</p><pre class="programlisting">sess.createSQLQuery("SELECT * FROM CATS").list();
sess.createSQLQuery("SELECT ID, NAME, BIRTHDATE FROM CATS").list();
</pre><p>These will both return a List of Object arrays (Object[]) with scalar values for each column in the CATS table. Hibernate
                     will use ResultSetMetadata to deduce the actual order and types of the returned scalar values.
                  </p>
                  <p>To avoid the overhead of using <code class="literal">ResultSetMetadata</code> or simply to be more explicit in what is returned one can use <code class="literal">addScalar()</code>.
                  </p><pre class="programlisting">sess.createSQLQuery("SELECT * FROM CATS")
 .addScalar("ID", Hibernate.LONG)
 .addScalar("NAME", Hibernate.STRING)
 .addScalar("BIRTHDATE", Hibernate.DATE)
</pre><p>This query specified:</p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p>the SQL query string</p>
                        </li>
                        <li>
                           <p>the columns and types to return</p>
                        </li>
                     </ul>
                  </div>
                  <p>This will still return Object arrays, but now it will not use <code class="literal">ResultSetMetadata</code> but will instead explicitly get the ID, NAME and BIRTHDATE column as respectively a Long, String and a Short from the underlying
                     resultset. This also means that only these three columns will be returned, even though the query is using <code class="literal">*</code> and could return more than the three listed columns.
                  </p>
                  <p>It is possible to leave out the type information for all or some of the scalars.</p><pre class="programlisting">sess.createSQLQuery("SELECT * FROM CATS")
 .addScalar("ID", Hibernate.LONG)
 .addScalar("NAME")
 .addScalar("BIRTHDATE")
</pre><p>This is essentially the same query as before, but now <code class="literal">ResultSetMetaData</code> is used to decide the type of NAME and BIRTHDATE where as the type of ID is explicitly specified.
                  </p>
                  <p>How the java.sql.Types returned from ResultSetMetaData is mapped to Hibernate types is controlled by the Dialect. If a specific
                     type is not mapped or does not result in the expected type it is possible to customize it via calls to <code class="literal">registerHibernateType</code> in the Dialect.
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e13206"></a>16.1.2.&nbsp;Entity queries
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>The above queries were all about returning scalar values, basically returning the "raw" values from the resultset. The following
                     shows how to get entity objects from a native sql query via <code class="literal">addEntity()</code>.
                  </p><pre class="programlisting">sess.createSQLQuery("SELECT * FROM CATS").addEntity(Cat.class);
sess.createSQLQuery("SELECT ID, NAME, BIRTHDATE FROM CATS").addEntity(Cat.class);
</pre><p>This query specified:</p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p>the SQL query string</p>
                        </li>
                        <li>
                           <p>the entity returned by the query</p>
                        </li>
                     </ul>
                  </div>
                  <p>Assuming that Cat is mapped as a class with the columns ID, NAME and BIRTHDATE the above queries will both return a List where
                     each element is a Cat entity.
                  </p>
                  <p>If the entity is mapped with a <code class="literal">many-to-one</code> to another entity it is required to also return this when performing the native query, otherwise a database specific "column
                     not found" error will occur. The additional columns will automatically be returned when using the * notation, but we prefer
                     to be explicit as in the following example for a <code class="literal">many-to-one</code> to a <code class="literal">Dog</code>:
                  </p><pre class="programlisting">sess.createSQLQuery("SELECT ID, NAME, BIRTHDATE, DOG_ID FROM CATS").addEntity(Cat.class);
</pre><p>This will allow cat.getDog() to function properly.</p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e13242"></a>16.1.3.&nbsp;Handling associations and collections
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>It is possible to eagerly join in the <code class="literal">Dog</code> to avoid the possible extra roundtrip for initializing the proxy. This is done via the <code class="literal">addJoin()</code> method, which allows you to join in an association or collection.
                  </p><pre class="programlisting">sess.createSQLQuery("SELECT c.ID, NAME, BIRTHDATE, DOG_ID, D_ID, D_NAME FROM CATS c, DOGS d WHERE c.DOG_ID = d.D_ID")
 .addEntity("cat", Cat.class)
 .addJoin("cat.dog");
</pre><p>In this example the returned <code class="literal">Cat</code>'s will have their <code class="literal">dog</code> property fully initialized without any extra roundtrip to the database. Notice that we added a alias name ("cat") to be able
                     to specify the target property path of the join. It is possible to do the same eager joining for collections, e.g. if the
                     <code class="literal">Cat</code> had a one-to-many to <code class="literal">Dog</code> instead.
                  </p><pre class="programlisting">sess.createSQLQuery("SELECT ID, NAME, BIRTHDATE, D_ID, D_NAME, CAT_ID FROM CATS c, DOGS d WHERE c.ID = d.CAT_ID")
 .addEntity("cat", Cat.class)
 .addJoin("cat.dogs");
</pre><p>At this stage we are reaching the limits of what is possible with native queries without starting to enhance the sql queries
                     to make them usable in Hibernate; the problems starts to arise when returning multiple entities of the same type or when the
                     default alias/column names are not enough. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e13273"></a>16.1.4.&nbsp;Returning multiple entities
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Until now the result set column names are assumed to be the same as the column names specified in the mapping document. This
                     can be problematic for SQL queries which join multiple tables, since the same column names may appear in more than one table.
                  </p>
                  <p>Column alias injection is needed in the following query (which most likely will fail):</p><pre class="programlisting">sess.createSQLQuery("SELECT c.*, m.*  FROM CATS c, CATS m WHERE c.MOTHER_ID = c.ID")
 .addEntity("cat", Cat.class)
 .addEntity("mother", Cat.class)
</pre><p>The intention for this query is to return two Cat instances per row, a cat and its mother. This will fail since there is a
                     conflict of names since they are mapped to the same column names and on some databases the returned column aliases will most
                     likely be on the form "c.ID", "c.NAME", etc. which are not equal to the columns specified in the mappings ("ID" and "NAME").
                  </p>
                  <p>The following form is not vulnerable to column name duplication:</p><pre class="programlisting">sess.createSQLQuery("SELECT {cat.*}, {mother.*}  FROM CATS c, CATS m WHERE c.MOTHER_ID = c.ID")
 .addEntity("cat", Cat.class)
 .addEntity("mother", Cat.class)
</pre><p>This query specified:</p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p>the SQL query string, with placeholders for Hibernate to inject column aliases</p>
                        </li>
                        <li>
                           <p>the entities returned by the query</p>
                        </li>
                     </ul>
                  </div>
                  <p>The {cat.*} and {mother.*} notation used above is a shorthand for "all properties". Alternatively, you may list the columns
                     explicitly, but even in this case we let Hibernate inject the SQL column aliases for each property. The placeholder for a
                     column alias is just the property name qualified by the table alias. In the following example, we retrieve Cats and their
                     mothers from a different table (cat_log) to the one declared in the mapping metadata. Notice that we may even use the property
                     aliases in the where clause if we like.
                  </p><pre class="programlisting">String sql = "SELECT ID as {c.id}, NAME as {c.name}, " + 
         "BIRTHDATE as {c.birthDate}, MOTHER_ID as {c.mother}, {mother.*} " +
         "FROM CAT_LOG c, CAT_LOG m WHERE {c.mother} = c.ID";

List loggedCats = sess.createSQLQuery(sql)
        .addEntity("cat", Cat.class)
        .addEntity("mother", Cat.class).list()
</pre><div class="sect3" lang="fr-FR">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="querysql-aliasreferences"></a>16.1.4.1.&nbsp;Alias and property references
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>For most cases the above alias injection is needed, but for queries relating to more complex mappings like composite properties,
                        inheritance discriminators, collections etc. there are some specific aliases to use to allow Hibernate to inject the proper
                        aliases.
                     </p>
                     <p>The following table shows the different possibilities of using the alias injection. Note: the alias names in the result are
                        examples, each alias will have a unique and probably different name when used.
                     </p>
                     <div class="table"><a name="aliasinjection-summary"></a><p class="title"><b>Tableau&nbsp;16.1.&nbsp;Alias injection names</b></p>
                        <div class="table-contents">
                           <table summary="Alias injection names" border="1">
                              <colgroup>
                                 <col>
                                 <col>
                                 <col>
                              </colgroup>
                              <thead>
                                 <tr>
                                    <th>Description</th>
                                    <th>Syntax</th>
                                    <th>Example</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr>
                                    <td>A simple property</td>
                                    <td><code class="literal">{[aliasname].[propertyname]</code></td>
                                    <td><code class="literal">A_NAME as {item.name}</code></td>
                                 </tr>
                                 <tr>
                                    <td>A composite property</td>
                                    <td><code class="literal">{[aliasname].[componentname].[propertyname]}</code></td>
                                    <td><code class="literal">CURRENCY as {item.amount.currency}, VALUE as {item.amount.value}</code></td>
                                 </tr>
                                 <tr>
                                    <td>Discriminator of an entity</td>
                                    <td><code class="literal">{[aliasname].class}</code></td>
                                    <td><code class="literal">DISC as {item.class}</code></td>
                                 </tr>
                                 <tr>
                                    <td>All properties of an entity</td>
                                    <td><code class="literal">{[aliasname].*}</code></td>
                                    <td><code class="literal">{item.*}</code></td>
                                 </tr>
                                 <tr>
                                    <td>A collection key</td>
                                    <td><code class="literal">{[aliasname].key}</code></td>
                                    <td><code class="literal">ORGID as {coll.key}</code></td>
                                 </tr>
                                 <tr>
                                    <td>The id of an collection</td>
                                    <td><code class="literal">{[aliasname].id}</code></td>
                                    <td><code class="literal">EMPID as {coll.id}</code></td>
                                 </tr>
                                 <tr>
                                    <td>The element of an collection</td>
                                    <td><code class="literal">{[aliasname].element}</code></td>
                                    <td><code class="literal">XID as {coll.element}</code></td>
                                 </tr>
                                 <tr>
                                    <td>roperty of the element in the collection</td>
                                    <td><code class="literal">{[aliasname].element.[propertyname]}</code></td>
                                    <td><code class="literal">NAME as {coll.element.name}</code></td>
                                 </tr>
                                 <tr>
                                    <td>All properties of the element in the collection</td>
                                    <td><code class="literal">{[aliasname].element.*}</code></td>
                                    <td><code class="literal">{coll.element.*}</code></td>
                                 </tr>
                                 <tr>
                                    <td>All properties of the the collection</td>
                                    <td><code class="literal">{[aliasname].*}</code></td>
                                    <td><code class="literal">{coll.*}</code></td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                     </div><br class="table-break"></div>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e13414"></a>16.1.5.&nbsp;Returning non-managed entities
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>It is possible to apply a ResultTransformer to native sql queries. Allowing it to e.g. return non-managed entities.</p><pre class="programlisting">sess.createSQLQuery("SELECT NAME, BIRTHDATE FROM CATS")
        .setResultTransformer(Transformers.aliasToBean(CatDTO.class))</pre><p>This query specified:</p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p>the SQL query string</p>
                        </li>
                        <li>
                           <p>a result transformer</p>
                        </li>
                     </ul>
                  </div>
                  <p>The above query will return a list of <code class="literal">CatDTO</code> which has been instantiated and injected the values of NAME and BIRTHNAME into its corresponding properties or fields. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e13435"></a>16.1.6.&nbsp;Handling inheritance
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Native sql queries which query for entities that is mapped as part of an inheritance must include all properties for the baseclass
                     and all it subclasses.
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e13440"></a>16.1.7.&nbsp;Parameters
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Native sql queries support positional as well as named parameters:</p><pre class="programlisting">Query query = sess.createSQLQuery("SELECT * FROM CATS WHERE NAME like ?").addEntity(Cat.class);
List pusList = query.setString(0, "Pus%").list();
     
query = sess.createSQLQuery("SELECT * FROM CATS WHERE NAME like :name").addEntity(Cat.class);
List pusList = query.setString("name", "Pus%").list();          </pre></div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="querysql-namedqueries"></a>16.2.&nbsp;Requ&ecirc;tes SQL nomm&eacute;es
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Les requ&ecirc;tes SQL nomm&eacute;es peuvent &ecirc;tre d&eacute;finies dans le document de mapping et appel&eacute;es exactement de la m&ecirc;me mani&egrave;re qu'un
                  requ&ecirc;te HQL nomm&eacute;e. Dans ce cas, nous <span class="emphasis"><em>n'avons pas besoin</em></span> d'appeler <code class="literal">addEntity()</code>.
               </p><pre class="programlisting">&lt;sql-query name="persons"&gt;
    &lt;return alias="person" class="eg.Person"/&gt;
    SELECT person.NAME AS {person.name},
           person.AGE AS {person.age},
           person.SEX AS {person.sex}
    FROM PERSON person
    WHERE person.NAME LIKE :namePattern
&lt;/sql-query&gt;</pre><pre class="programlisting">List people = sess.getNamedQuery("persons")
    .setString("namePattern", namePattern)
    .setMaxResults(50)
    .list();</pre><p>Les &eacute;l&eacute;ments <code class="literal">&lt;return-join&gt;</code> et <code class="literal">&lt;load-collection&gt;</code> sont respectivement utilis&eacute;s pour lier des associations et d&eacute;finir des requ&ecirc;tes qui initialisent des collections.
               </p><pre class="programlisting">&lt;sql-query name="personsWith"&gt;
    &lt;return alias="person" class="eg.Person"/&gt;
    &lt;return-join alias="address" property="person.mailingAddress"/&gt;
    SELECT person.NAME AS {person.name},
           person.AGE AS {person.age},
           person.SEX AS {person.sex},
           address.STREET AS {address.street},
           address.CITY AS {address.city},
           address.STATE AS {address.state},
           address.ZIP AS {address.zip}
    FROM PERSON person
    JOIN ADDRESS address
        ON person.ID = address.PERSON_ID AND address.TYPE='MAILING'
    WHERE person.NAME LIKE :namePattern
&lt;/sql-query&gt;</pre><p>Une requ&ecirc;te SQL nomm&eacute;e peut retourner une valeur scalaire. Vous devez sp&eacute;cifier l'alias de colonne et le type Hibernate utilisant
                  l'&eacute;l&eacute;ment <code class="literal">&lt;return-scalar&gt;</code> :
               </p><pre class="programlisting">&lt;sql-query name="mySqlQuery"&gt;
    &lt;return-scalar column="name" type="string"/&gt;
    &lt;return-scalar column="age" type="long"/&gt;
    SELECT p.NAME AS name,
           p.AGE AS age,
    FROM PERSON p WHERE p.NAME LIKE 'Hiber%'
&lt;/sql-query&gt;</pre><p>You can externalize the resultset mapping informations in a <code class="literal">&lt;resultset&gt;</code> element to either reuse them across several named queries or through the <code class="literal">setResultSetMapping()</code> API.
               </p><pre class="programlisting">&lt;resultset name="personAddress"&gt;
    &lt;return alias="person" class="eg.Person"/&gt;
    &lt;return-join alias="address" property="person.mailingAddress"/&gt;
&lt;/resultset&gt;

&lt;sql-query name="personsWith" resultset-ref="personAddress"&gt;
    SELECT person.NAME AS {person.name},
           person.AGE AS {person.age},
           person.SEX AS {person.sex},
           address.STREET AS {address.street},
           address.CITY AS {address.city},
           address.STATE AS {address.state},
           address.ZIP AS {address.zip}
    FROM PERSON person
    JOIN ADDRESS address
        ON person.ID = address.PERSON_ID AND address.TYPE='MAILING'
    WHERE person.NAME LIKE :namePattern
&lt;/sql-query&gt;</pre><p>You can alternatively use the resultset mapping information in your hbm files directly in java code.</p><pre class="programlisting">List cats = sess.createSQLQuery(
        "select {cat.*}, {kitten.*} from cats cat, cats kitten where kitten.mother = cat.id"
    )
    .setResultSetMapping("catAndKitten")
    .list();</pre><div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="propertyresults"></a>16.2.1.&nbsp;Utilisation de return-property pour sp&eacute;cifier explicitement les noms des colonnes/alias
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Avec <code class="literal">&lt;return-property&gt;</code> vous pouvez explicitement dire &agrave; Hibernate quels alias de colonne utiliser, plutot que d'employer la syntaxe <code class="literal">{}</code> pour laisser Hibernate injecter ses propres alias.
                  </p><pre class="programlisting">&lt;sql-query name="mySqlQuery"&gt;
    &lt;return alias="person" class="eg.Person"&gt;
        &lt;return-property name="name" column="myName"/&gt;
        &lt;return-property name="age" column="myAge"/&gt;
        &lt;return-property name="sex" column="mySex"/&gt;
    &lt;/return&gt;
    SELECT person.NAME AS myName,
           person.AGE AS myAge,
           person.SEX AS mySex,
    FROM PERSON person WHERE person.NAME LIKE :name
&lt;/sql-query&gt;
</pre><p><code class="literal">&lt;return-property&gt;</code> fonctionne aussi avec de multiple colonnes. Cela r&eacute;sout une limitation de la syntaxe <code class="literal">{}</code> qui ne peut pas permettre une bonne granularit&eacute; des propri&eacute;t&eacute;s multi-colonnes.
                  </p><pre class="programlisting">&lt;sql-query name="organizationCurrentEmployments"&gt;
    &lt;return alias="emp" class="Employment"&gt;
        &lt;return-property name="salary"&gt;
            &lt;return-column name="VALUE"/&gt;
            &lt;return-column name="CURRENCY"/&gt;
        &lt;/return-property&gt;
        &lt;return-property name="endDate" column="myEndDate"/&gt;
    &lt;/return&gt;
        SELECT EMPLOYEE AS {emp.employee}, EMPLOYER AS {emp.employer},
        STARTDATE AS {emp.startDate}, ENDDATE AS {emp.endDate},
        REGIONCODE as {emp.regionCode}, EID AS {emp.id}, VALUE, CURRENCY
        FROM EMPLOYMENT
        WHERE EMPLOYER = :id AND ENDDATE IS NULL
        ORDER BY STARTDATE ASC
&lt;/sql-query&gt;</pre><p>Notez que dans cet exemple nous avons utilis&eacute; <code class="literal">&lt;return-property&gt;</code> en combinaison avec la syntaxe <code class="literal">{}</code> pour l'injection. Cela autorise les utilisateurs &agrave; choisir comment ils veulent r&eacute;f&eacute;rencer les colonnes et les propri&eacute;t&eacute;s.
                  </p>
                  <p>Si votre mapping a un discriminant vous devez utiliser <code class="literal">&lt;return-discriminator&gt;</code> pour sp&eacute;cifier la colonne discriminante.
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="sp_query"></a>16.2.2.&nbsp;Utilisation de proc&eacute;dures stock&eacute;es pour les requ&ecirc;tes
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Hibernate 3 introduit le support des requ&ecirc;tes via proc&eacute;dures stock&eacute;es et les fonctions. La documentation suivante est valable
                     pour les deux. Les proc&eacute;dures stock&eacute;es/fonctions doivent retourner l'ensemble de r&eacute;sultats en tant que premier param&egrave;tre sortant
                     (NdT: "out-parameter") pour &ecirc;tre capable de fonctionner avec Hibernate. Un exemple d'une telle proc&eacute;dure stock&eacute;e en Oracle
                     9 et version sup&eacute;rieure :
                  </p><pre class="programlisting">CREATE OR REPLACE FUNCTION selectAllEmployments
    RETURN SYS_REFCURSOR
AS
    st_cursor SYS_REFCURSOR;
BEGIN
    OPEN st_cursor FOR
 SELECT EMPLOYEE, EMPLOYER,
 STARTDATE, ENDDATE,
 REGIONCODE, EID, VALUE, CURRENCY
 FROM EMPLOYMENT;
      RETURN  st_cursor;
 END;</pre><p>Pour utiliser cette requ&ecirc;te dans Hibernate vous avez besoin de la mapper via une requ&ecirc;te nomm&eacute;e.</p><pre class="programlisting">&lt;sql-query name="selectAllEmployees_SP" callable="true"&gt;
    &lt;return alias="emp" class="Employment"&gt;
        &lt;return-property name="employee" column="EMPLOYEE"/&gt;
        &lt;return-property name="employer" column="EMPLOYER"/&gt;
        &lt;return-property name="startDate" column="STARTDATE"/&gt;
        &lt;return-property name="endDate" column="ENDDATE"/&gt;
        &lt;return-property name="regionCode" column="REGIONCODE"/&gt;
        &lt;return-property name="id" column="EID"/&gt;
        &lt;return-property name="salary"&gt;
            &lt;return-column name="VALUE"/&gt;
            &lt;return-column name="CURRENCY"/&gt;
        &lt;/return-property&gt;
    &lt;/return&gt;
    { ? = call selectAllEmployments() }
&lt;/sql-query&gt;</pre><p>Notez que les proc&eacute;dures stock&eacute;es retournent, pour le moment, seulement des scalaires et des entit&eacute;s. <code class="literal">&lt;return-join&gt;</code> et <code class="literal">&lt;load-collection&gt;</code> ne sont pas support&eacute;s.
                  </p>
                  <div class="sect3" lang="fr-FR">
                     <div class="titlepage">
                        <div>
                           <div>
                              <h4 class="title"><a name="querysql-limits-storedprocedures"></a>16.2.2.1.&nbsp;R&egrave;gles/limitations lors de l'utilisation des proc&eacute;dures stock&eacute;es
                              </h4>
                           </div>
                        </div>
                     </div>
                     <p>Pur utiliser des proc&eacute;dures stock&eacute;es avec Hibernate, les proc&eacute;dures doivent suivre certaines r&egrave;gles. Si elles ne suivent pas
                        ces r&egrave;gles, elles ne sont pas utilisables avec Hibernate. Si vous voulez encore utiliser ces proc&eacute;dures vous devez les ex&eacute;cuter
                        via <code class="literal">session.connection()</code>. Les r&egrave;gles sont diff&eacute;rentes pour chaque base de donn&eacute;es, puisque les vendeurs de base de donn&eacute;es ont des s&eacute;mantiques/syntaxes
                        diff&eacute;rentes pour les proc&eacute;dures stock&eacute;es.
                     </p>
                     <p>Les requ&ecirc;tes de proc&eacute;dures stock&eacute;es ne peuvent pas &ecirc;tre pagin&eacute;es avec <code class="literal">setFirstResult()/setMaxResults()</code>.
                     </p>
                     <p>Recommended call form is standard SQL92: <code class="literal">{ ? = call functionName(&lt;parameters&gt;) }</code> or <code class="literal">{ ? = call procedureName(&lt;parameters&gt;}</code>. Native call syntax is not supported.
                     </p>
                     <p>Pour Oracle les r&egrave;gles suivantes s'appliquent :</p>
                     <div class="itemizedlist">
                        <ul type="disc" compact>
                           <li>
                              <p>La proc&eacute;dure doit retourner un ensemble de r&eacute;sultats. Le prmeier param&egrave;tre d'une proc&eacute;dure doit &ecirc;tre un <code class="literal">OUT</code> qui retourne un ensemble de r&eacute;sultats. Ceci est fait en retournant un <code class="literal">SYS_REFCURSOR</code> dans Oracle 9 ou 10. Dans Oracle vous avez besoin de d&eacute;finir un type <code class="literal">REF CURSOR</code>.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <p>Pour Sybase ou MS SQL server les r&egrave;gles suivantes s'appliquent :</p>
                     <div class="itemizedlist">
                        <ul type="disc" compact>
                           <li>
                              <p>La proc&eacute;dure doit retourner un ensemble de r&eacute;sultats. Notez que comme ces serveurs peuvent retourner de multiples ensembles
                                 de r&eacute;sultats et mettre &agrave; jour des compteurs, Hibernate it&eacute;rera les r&eacute;sultats et prendra le premier r&eacute;sultat qui est un ensemble
                                 de r&eacute;sultat comme valeur de retour. Tout le reste sera ignor&eacute;.
                              </p>
                           </li>
                           <li>
                              <p>Si vous pouvez activer <code class="literal">SET NOCOUNT ON</code> dans votre proc&eacute;dure, elle sera probablement plus efficace, mais ce n'est pas une obligation.
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="querysql-cud"></a>16.3.&nbsp;SQL personnalis&eacute; pour cr&eacute;er, mettre &agrave; jour et effacer
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Hibernate3 peut utiliser des expression SQL personnalis&eacute;es pour des op&eacute;rations de cr&eacute;ation, de mise &agrave; jour, et de suppression.
                  Les objets persistants les classes et les collections dans Hibernate contiennent d&eacute;j&agrave; un ensemble de cha&icirc;nes de caract&egrave;res
                  g&eacute;n&eacute;r&eacute;es lors de la configuration (insertsql, deletesql, updatesql, etc). Les tages de mapping <code class="literal">&lt;sql-insert&gt;</code>, <code class="literal">&lt;sql-delete&gt;</code>, et <code class="literal">&lt;sql-update&gt;</code> surchargent ces cha&icirc;nes de caract&egrave;res :
               </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="id"&gt;
        &lt;generator class="increment"/&gt;
    &lt;/id&gt;
    &lt;property name="name" not-null="true"/&gt;
    &lt;sql-insert&gt;INSERT INTO PERSON (NAME, ID) VALUES ( UPPER(?), ? )&lt;/sql-insert&gt;
    &lt;sql-update&gt;UPDATE PERSON SET NAME=UPPER(?) WHERE ID=?&lt;/sql-update&gt;
    &lt;sql-delete&gt;DELETE FROM PERSON WHERE ID=?&lt;/sql-delete&gt;
&lt;/class&gt;</pre><p>Le SQL est directement ex&eacute;cut&eacute; dans votre base de donn&eacute;es, donc vous &ecirc;tes libre d'utiliser le dialecte que vous souhaitez.
                  Cela r&eacute;duira bien s&ucirc;r la portabilit&eacute; de votre mapping si vous utilisez du SQL sp&eacute;cifique &agrave; votre base de donn&eacute;es.
               </p>
               <p>Les proc&eacute;dures stock&eacute;es sont support&eacute;es si l'attribut <code class="literal">callable</code> est param&eacute;tr&eacute; :
               </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="id"&gt;
        &lt;generator class="increment"/&gt;
    &lt;/id&gt;
    &lt;property name="name" not-null="true"/&gt;
    &lt;sql-insert callable="true"&gt;{call createPerson (?, ?)}&lt;/sql-insert&gt;
    &lt;sql-delete callable="true"&gt;{? = call deletePerson (?)}&lt;/sql-delete&gt;
    &lt;sql-update callable="true"&gt;{? = call updatePerson (?, ?)}&lt;/sql-update&gt;
&lt;/class&gt;</pre><p>L'ordre des param&egrave;tres positionnels est actuellement vital, car ils doivent &ecirc;tre dans la m&ecirc;me s&eacute;quence qu'Hibernate les attend.</p>
               <p>Vous pouvez voir l'ordre attendu en activant les journaux de debug pour le niveau <code class="literal">org.hibernate.persister.entity</code> level. Avec ce niveau activ&eacute;, Hibernate imprimera le SQL statique qui est utilis&eacute; pour cr&eacute;er, mettre &agrave; jour, supprimer, etc.
                  des entit&eacute;s. (Pour voir la s&eacute;quence attendue, rappelez-vous de ne pas inclure votre SQL personnalis&eacute; dans les fichiers de
                  mapping de mani&egrave;re &agrave; surcharger le SQL statique g&eacute;n&eacute;r&eacute; par Hibernate.)
               </p>
               <p>Les proc&eacute;dures stock&eacute;es sont dans la plupart des cas (lire : il vaut mieux le faire) requises pour retourner le nombre de
                  lignes ins&eacute;r&eacute;es/mises &agrave; jour/supprim&eacute;es, puisque Hibernate fait quelques v&eacute;rifications de succ&egrave;s lors de l'ex&eacute;cution de l'expression.
                  Hibernate inscrit toujours la premi&egrave;re expression comme un param&egrave;tre de sortie num&eacute;rique pour les op&eacute;rations CUD :
               </p><pre class="programlisting">CREATE OR REPLACE FUNCTION updatePerson (uid IN NUMBER, uname IN VARCHAR2)
    RETURN NUMBER IS
BEGIN

    update PERSON
    set
        NAME = uname,
    where
        ID = uid;

    return SQL%ROWCOUNT;

END updatePerson;</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="querysql-load"></a>16.4.&nbsp;SQL personnalis&eacute; pour le chargement
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Vous pouvez aussi d&eacute;clarer vos propres requ&ecirc;tes SQL (ou HQL) pour le chargement d'entit&eacute; :</p><pre class="programlisting">&lt;sql-query name="person"&gt;
    &lt;return alias="pers" class="Person" lock-mode="upgrade"/&gt;
    SELECT NAME AS {pers.name}, ID AS {pers.id}
    FROM PERSON
    WHERE ID=?
    FOR UPDATE
&lt;/sql-query&gt;</pre><p>Ceci est juste une d&eacute;claration de requ&ecirc;te nomm&eacute;e, comme vu plus t&ocirc;t. Vous pouvez r&eacute;f&eacute;rencer cette requ&ecirc;te nomm&eacute;e dans un mapping
                  de classe :
               </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="id"&gt;
        &lt;generator class="increment"/&gt;
    &lt;/id&gt;
    &lt;property name="name" not-null="true"/&gt;
    &lt;loader query-ref="person"/&gt;
&lt;/class&gt;</pre><p>Ceci fonctionne m&ecirc;me avec des proc&eacute;dures stock&eacute;es.</p>
               <p>Vous pouvez m&ecirc;me d&eacute;finir une requ&ecirc;te pour le chargement d'une collection :</p><pre class="programlisting">&lt;set name="employments" inverse="true"&gt;
    &lt;key/&gt;
    &lt;one-to-many class="Employment"/&gt;
    &lt;loader query-ref="employments"/&gt;
&lt;/set&gt;</pre><pre class="programlisting">&lt;sql-query name="employments"&gt;
    &lt;load-collection alias="emp" role="Person.employments"/&gt;
    SELECT {emp.*}
    FROM EMPLOYMENT emp
    WHERE EMPLOYER = :id
    ORDER BY STARTDATE ASC, EMPLOYEE ASC
&lt;/sql-query&gt;</pre><p>Vous pourriez m&ecirc;me d&eacute;finir un chargeur d'entit&eacute; qui charge une collection par jointure :</p><pre class="programlisting">&lt;sql-query name="person"&gt;
    &lt;return alias="pers" class="Person"/&gt;
    &lt;return-join alias="emp" property="pers.employments"/&gt;
    SELECT NAME AS {pers.*}, {emp.*}
    FROM PERSON pers
    LEFT OUTER JOIN EMPLOYMENT emp
        ON pers.ID = emp.PERSON_ID
    WHERE ID=?
&lt;/sql-query&gt;</pre></div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="filters"></a>Chapitre&nbsp;17.&nbsp;Filtrer les donn&eacute;es
                     </h2>
                  </div>
               </div>
            </div>
            <p>Hibernate3 fournit une nouvelle approche innovatrice pour g&eacute;rer des donn&eacute;es avec des r&egrave;gles de "visibilit&eacute;". Un <span class="emphasis"><em>filtre Hibernate</em></span> est un filtre global, nomm&eacute;, param&eacute;tr&eacute; qui peut &ecirc;tre activ&eacute; ou d&eacute;sactiv&eacute; pour une session Hibernate particuli&egrave;re. 
            </p>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="objectstate-filters"></a>17.1.&nbsp;Filtres Hibernate
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Hibernate3 ajoute la capacit&eacute; de pr&eacute;d&eacute;finir des crit&egrave;res de filtre et d'attacher ces filtres &agrave; une classe ou &agrave; une collection.
                  Un crit&egrave;re de filtre est la facult&eacute; de d&eacute;finir une clause de restriction tr&egrave;s similaire &agrave; l'attribut "where" existant disponible
                  sur une classe et divers &eacute;l&eacute;ments d'une collection. Mis &agrave; part que ces conditions de filtre peuvent &ecirc;tre param&eacute;tr&eacute;es. L'application
                  peut alors prendre la d&eacute;cision &agrave; l'ex&eacute;cution si des filtres donn&eacute;s devraient &ecirc;tre activ&eacute;s et quels devraient &ecirc;tre leurs param&egrave;tres.
                  Des filtres peuvent &ecirc;tre utilis&eacute;s comme des vues de base de donn&eacute;es, mais param&eacute;tr&eacute;es dans l'application. 
               </p>
               <p>Afin d'utiliser des filtres, ils doivent d'abord &ecirc;tre d&eacute;finis, puis attach&eacute;s aux &eacute;l&eacute;ments de mapping appropri&eacute;s. Pour d&eacute;finir
                  un filtre, utilisez l'&eacute;l&eacute;ment <code class="literal">&lt;filter-def/&gt;</code> dans un &eacute;l&eacute;ment <code class="literal">&lt;hibernate-mapping/&gt;</code> : 
               </p><pre class="programlisting">&lt;filter-def name="myFilter"&gt;
    &lt;filter-param name="myFilterParam" type="string"/&gt;
&lt;/filter-def&gt;</pre><p>Puis, ce filtre peut &ecirc;tre attach&eacute; &agrave; une classe : </p><pre class="programlisting">&lt;class name="myClass" ...&gt;
    ...
    &lt;filter name="myFilter" condition=":myFilterParam = MY_FILTERED_COLUMN"/&gt;
&lt;/class&gt;</pre><p>ou &agrave; une collection : </p><pre class="programlisting">&lt;set ...&gt;
    &lt;filter name="myFilter" condition=":myFilterParam = MY_FILTERED_COLUMN"/&gt;
&lt;/set&gt;</pre><p>ou m&ecirc;me aux deux (ou &agrave; plusieurs de chaque) en m&ecirc;me temps. </p>
               <p>The methods on <code class="literal">Session</code> are: <code class="literal">enableFilter(String filterName)</code>, <code class="literal">getEnabledFilter(String filterName)</code>, and <code class="literal">disableFilter(String filterName)</code>. By default, filters are <span class="emphasis"><em>not</em></span> enabled for a given session; they must be explcitly enabled through use of the <code class="literal">Session.enableFilter()</code> method, which returns an instance of the <code class="literal">Filter</code> interface. Using the simple filter defined above, this would look like: 
               </p><pre class="programlisting">session.enableFilter("myFilter").setParameter("myFilterParam", "some-value");</pre><p>Notez que des m&eacute;thodes sur l'interface org.hibernate.Filter autorisent le cha&icirc;nage de beaucoup de m&eacute;thodes communes d'Hibernate.
                  
               </p>
               <p>Un exemple complet, utilisant des donn&eacute;es temporelles avec une structure de date d'enregistrement effectif : </p><pre class="programlisting">&lt;filter-def name="effectiveDate"&gt;
    &lt;filter-param name="asOfDate" type="date"/&gt;
&lt;/filter-def&gt;

&lt;class name="Employee" ...&gt;
...
    &lt;many-to-one name="department" column="dept_id" class="Department"/&gt;
    &lt;property name="effectiveStartDate" type="date" column="eff_start_dt"/&gt;
    &lt;property name="effectiveEndDate" type="date" column="eff_end_dt"/&gt;
...
    &lt;!--
        Note that this assumes non-terminal records have an eff_end_dt set to
        a max db date for simplicity-sake
    --&gt;
    &lt;filter name="effectiveDate"
            condition=":asOfDate BETWEEN eff_start_dt and eff_end_dt"/&gt;
&lt;/class&gt;

&lt;class name="Department" ...&gt;
...
    &lt;set name="employees" lazy="true"&gt;
        &lt;key column="dept_id"/&gt;
        &lt;one-to-many class="Employee"/&gt;
        &lt;filter name="effectiveDate"
                condition=":asOfDate BETWEEN eff_start_dt and eff_end_dt"/&gt;
    &lt;/set&gt;
&lt;/class&gt;</pre><p>Puis, afin de s'assurer que vous pouvez toujours r&eacute;cup&eacute;rer les enregistrements actuellement effectifs, activez simplement
                  le filtre sur la session avant de r&eacute;cup&eacute;rer des donn&eacute;es des employ&eacute;s : 
               </p><pre class="programlisting">Session session = ...;
session.enableFilter("effectiveDate").setParameter("asOfDate", new Date());
List results = session.createQuery("from Employee as e where e.salary &gt; :targetSalary")
         .setLong("targetSalary", new Long(1000000))
         .list();
</pre><p>Dans le HQL ci-dessus, bien que nous ayons seulement mentionn&eacute; une contrainte de salaire sur les resultats, &agrave; cause du filtre
                  activ&eacute;, la requ&ecirc;te retournera seulement les employ&eacute;s actuellement actifs qui ont un salaire sup&eacute;rieur &agrave; un million de dollars.
                  
               </p>
               <p>A noter : si vous pr&eacute;voyez d'utiliser des filtres avec des jointures externes (soit &agrave; travers HQL, soit par le chargement)
                  faites attention &agrave; la direction de l'expression de condition. Il est plus s&ucirc;r de la positionner pour les jointures externes
                  &agrave; gauche ; en g&eacute;n&eacute;ral, placez le param&egrave;tre d'abord, suivi du(des) nom(s) de colonne apr&egrave;s l'op&eacute;rateur. 
               </p>
               <p>translator-credits </p><pre class="programlisting">&lt;filter-def name="myFilter" condition="abc &gt; xyz"&gt;...&lt;/filter-def&gt;
&lt;filter-def name="myOtherFilter"&gt;abc=xyz&lt;/filter-def&gt;</pre><p>This default condition will then be used whenever the filter is attached to something without specifying a condition. Note
                  that this means you can give a specific condition as part of the attachment of the filter which overrides the default condition
                  in that particular case. 
               </p>
            </div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="xml"></a>Chapitre&nbsp;18.&nbsp;Mapping XML
                     </h2>
                  </div>
               </div>
            </div>
            <p><span class="emphasis"><em>Notez que cette fonctionnalit&eacute; est exp&eacute;rimentale dans Hibernate 3.0 et est en d&eacute;veloppement extr&ecirc;mement actif. </em></span></p>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="xml-intro"></a>18.1.&nbsp;Travailler avec des donn&eacute;es XML
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Hibernate vous laisse travailler avec des donn&eacute;es XML persistantes de la m&ecirc;me mani&egrave;re que vous travaillez avec des POJOs persistants.
                  Un arbre XML peut &ecirc;tre vu comme une autre mani&egrave;re de repr&eacute;senter les donn&eacute;es relationnelles au niveau objet, &agrave; la place des
                  POJOs. 
               </p>
               <p>Hibernate supporte dom4j en tant qu'API pour la manipulation des arbres XML. Vous pouvez &eacute;crire des requ&ecirc;tes qui r&eacute;cup&egrave;rent
                  des arbres dom4j &agrave; partie de la base de donn&eacute;es, et avoir toutes les modifications que vous faites sur l'arbre automatiquement
                  synchronis&eacute;es dans la base de donn&eacute;es. Vous pouvez m&ecirc;me prendre un document XML, l'analyser en utilisant dom4j, et l'&eacute;crire
                  dans la base de donn&eacute;es via les op&eacute;rations basiques d'Hibernate : <code class="literal">persist(), saveOrUpdate(), merge(), delete(), replicate()</code> (merge() n'est pas encore support&eacute;). 
               </p>
               <p>Cette fonctionnalit&eacute; a plusieurs applications dont l'import/export de donn&eacute;es, l'externalisation d'entit&eacute;s via JMS ou SOAP
                  et les rapports XSLT. 
               </p>
               <p>Un simple mapping peut &ecirc;tre utilis&eacute; pour simultan&eacute;ment mapper les propri&eacute;t&eacute;s d'une classe et les noeuds d'un document XML
                  vers la base de donn&eacute;es, ou, si il n'y a pas de classe &agrave; mapper, il peut &ecirc;tre utilis&eacute; juste pour mapper le XML. 
               </p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="xml-intro-mapping"></a>18.1.1.&nbsp;Sp&eacute;cifier le mapping XML et le mapping d'une classe ensemble
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Voici un exemple de mapping d'un POJO et du XML simultan&eacute;ment : </p><pre class="programlisting">&lt;class name="Account" 
        table="ACCOUNTS" 
        node="account"&gt;
        
    &lt;id name="accountId" 
            column="ACCOUNT_ID" 
            node="@id"/&gt;
            
    &lt;many-to-one name="customer" 
            column="CUSTOMER_ID" 
            node="customer/@id" 
            embed-xml="false"/&gt;
            
    &lt;property name="balance" 
            column="BALANCE" 
            node="balance"/&gt;
            
    ...
    
&lt;/class&gt;</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="xml-onlyxml"></a>18.1.2.&nbsp;Sp&eacute;cifier seulement un mapping XML
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Voici un exemple dans lequel il n'y a pas de class POJO : </p><pre class="programlisting">&lt;class entity-name="Account" 
        table="ACCOUNTS" 
        node="account"&gt;
        
    &lt;id name="id" 
            column="ACCOUNT_ID" 
            node="@id" 
            type="string"/&gt;
            
    &lt;many-to-one name="customerId" 
            column="CUSTOMER_ID" 
            node="customer/@id" 
            embed-xml="false" 
            entity-name="Customer"/&gt;
            
    &lt;property name="balance" 
            column="BALANCE" 
            node="balance" 
            type="big_decimal"/&gt;
            
    ...
    
&lt;/class&gt;</pre><p>Ce mapping vous permet d'acc&eacute;der aux donn&eacute;es comme un arbre dom4j, ou comme un graphe de paire nom de propri&eacute;t&eacute;/valeur (<code class="literal">Map</code>s java). Les noms des propri&eacute;t&eacute;s sont des constructions purement logiques qui peuvent &ecirc;tre r&eacute;f&eacute;r&eacute;es des dans requ&ecirc;tes HQL.
                     
                  </p>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="xml-mapping"></a>18.2.&nbsp;M&eacute;tadonn&eacute;es du mapping XML
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Plusieurs &eacute;l&eacute;ments du mapping Hibernate acceptent l'attribut <code class="literal">node</code>. Ceci vous permet de sp&eacute;cifier le nom d'un attribut XML ou d'un &eacute;l&eacute;ment qui contient la propri&eacute;t&eacute; ou les donn&eacute;es de l'entit&eacute;.
                  Le format de l'attribut <code class="literal">node</code> doit &ecirc;tre un des suivants : 
               </p>
               <div class="itemizedlist">
                  <ul type="disc" compact>
                     <li>
                        <p><code class="literal">"element-name"</code> - mappe vers l'&eacute;l&eacute;ment XML nomm&eacute;
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">"@attribute-name"</code> - mappe vers l'attribut XML nomm&eacute;
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">"."</code> - mappe vers le parent de l'&eacute;l&eacute;ment
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">"element-name/@attribute-name"</code> - mappe vers l'&eacute;l&eacute;ment nomm&eacute; de l'attribut nomm&eacute; 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Pour des collections et de simples associations valu&eacute;es, il y a un attribut <code class="literal">embed-xml</code> suppl&eacute;mentaire. Si <code class="literal">embed-xml="true"</code>, qui est la valeur par d&eacute;faut, l'arbre XML pour l'entit&eacute; associ&eacute;e (ou la collection des types de valeurs) sera embarqu&eacute;e
                  directement dans l'arbre XML pour l'entit&eacute; qui poss&egrave;de l'association. Sinon, si <code class="literal">embed-xml="false"</code>, alors seule la valeur de l'identifiant r&eacute;f&eacute;renc&eacute; appara&icirc;tra dans le XML pour de simples associations de points, et les collections
                  n'appra&icirc;tront simplement pas. 
               </p>
               <p>Vous devriez faire attention &agrave; ne pas laisser <code class="literal">embed-xml="true"</code> pour trop d'associations, puisque XML ne traite pas bien les liens circurlaires. 
               </p><pre class="programlisting">&lt;class name="Customer" 
        table="CUSTOMER" 
        node="customer"&gt;
        
    &lt;id name="id" 
            column="CUST_ID" 
            node="@id"/&gt;
            
    &lt;map name="accounts" 
            node="." 
            embed-xml="true"&gt;
        &lt;key column="CUSTOMER_ID" 
                not-null="true"/&gt;
        &lt;map-key column="SHORT_DESC" 
                node="@short-desc" 
                type="string"/&gt;
        &lt;one-to-many entity-name="Account"
                embed-xml="false" 
                node="account"/&gt;
    &lt;/map&gt;
    
    &lt;component name="name" 
            node="name"&gt;
        &lt;property name="firstName" 
                node="first-name"/&gt;
        &lt;property name="initial" 
                node="initial"/&gt;
        &lt;property name="lastName" 
                node="last-name"/&gt;
    &lt;/component&gt;
    
    ...
    
&lt;/class&gt;</pre><p>dans ce cas, nous avons d&eacute;cid&eacute; d'embarquer la collection d'identifiants de compte, mais pas les donn&eacute;es actuelles du compte.
                  La requ&ecirc;te HQL suivante : 
               </p><pre class="programlisting">from Customer c left join fetch c.accounts where c.lastName like :lastName</pre><p>devrait retourner l'ensemble de donn&eacute;es suivant : </p><pre class="programlisting">&lt;customer id="123456789"&gt;
    &lt;account short-desc="Savings"&gt;987632567&lt;/account&gt;
    &lt;account short-desc="Credit Card"&gt;985612323&lt;/account&gt;
    &lt;name&gt;
        &lt;first-name&gt;Gavin&lt;/first-name&gt;
        &lt;initial&gt;A&lt;/initial&gt;
        &lt;last-name&gt;King&lt;/last-name&gt;
    &lt;/name&gt;
    ...
&lt;/customer&gt;</pre><p>Si vous positionnez <code class="literal">embed-xml="true"</code> sur le mapping <code class="literal">&lt;one-to-many&gt;</code>, les donn&eacute;es pourraient ressembler plus &agrave; &ccedil;a : 
               </p><pre class="programlisting">&lt;customer id="123456789"&gt;
    &lt;account id="987632567" short-desc="Savings"&gt;
        &lt;customer id="123456789"/&gt;
        &lt;balance&gt;100.29&lt;/balance&gt;
    &lt;/account&gt;
    &lt;account id="985612323" short-desc="Credit Card"&gt;
        &lt;customer id="123456789"/&gt;
        &lt;balance&gt;-2370.34&lt;/balance&gt;
    &lt;/account&gt;
    &lt;name&gt;
        &lt;first-name&gt;Gavin&lt;/first-name&gt;
        &lt;initial&gt;A&lt;/initial&gt;
        &lt;last-name&gt;King&lt;/last-name&gt;
    &lt;/name&gt;
    ...
&lt;/customer&gt;</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="xml-manipulation"></a>18.3.&nbsp;Manipuler des donn&eacute;es XML
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Relisons et mettons &agrave; jour des documents XML dans l'application. Nous faisons &ccedil;a en obtenant une session dom4j : </p><pre class="programlisting">Document doc = ....;
       
Session session = factory.openSession();
Session dom4jSession = session.getSession(EntityMode.DOM4J);
Transaction tx = session.beginTransaction();

List results = dom4jSession
    .createQuery("from Customer c left join fetch c.accounts where c.lastName like :lastName")
    .list();
for ( int i=0; i&lt;results.size(); i++ ) {
    //add the customer data to the XML document
    Element customer = (Element) results.get(i);
    doc.add(customer);
}

tx.commit();
session.close();</pre><pre class="programlisting">Session session = factory.openSession();
Session dom4jSession = session.getSession(EntityMode.DOM4J);
Transaction tx = session.beginTransaction();

Element cust = (Element) dom4jSession.get("Customer", customerId);
for ( int i=0; i&lt;results.size(); i++ ) {
    Element customer = (Element) results.get(i);
    //change the customer name in the XML and database
    Element name = customer.element("name");
    name.element("first-name").setText(firstName);
    name.element("initial").setText(initial);
    name.element("last-name").setText(lastName);
}

tx.commit();
session.close();</pre><p>Il est extr&ecirc;mement utile de combiner cette fonctionnalit&eacute; avec l'op&eacute;ration <code class="literal">replicate()</code> d'Hibernate pour impl&eacute;menter des imports/exports de donn&eacute;es XML. 
               </p>
            </div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="performance"></a>Chapitre&nbsp;19.&nbsp;Am&eacute;liorer les performances
                     </h2>
                  </div>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="performance-fetching"></a>19.1.&nbsp;Strat&eacute;gies de chargement
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Une <span class="emphasis"><em>strat&eacute;gie de chargement</em></span> est une strat&eacute;gie qu'Hibernate va utiliser pour r&eacute;cup&eacute;rer des objets associ&eacute;s si l'application &agrave; besoin de naviguer &agrave; travers
                  une association. Les strat&eacute;gies de chargement peuvent &ecirc;tre d&eacute;clar&eacute;es dans les m&eacute;ta-donn&eacute;es de l'outil de mapping objet relationnel
                  ou surcharg&eacute;es par une requ&ecirc;te de type HQL ou <code class="literal">Criteria</code> particuli&egrave;re. 
               </p>
               <p>Hibernate3 d&eacute;finit les strat&eacute;gies de chargement suivantes : </p>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        <p><span class="emphasis"><em>Chargement par jointure</em></span> - Hibernate r&eacute;cup&egrave;re l'instance associ&eacute;e ou la collection dans un m&ecirc;me <code class="literal">SELECT</code>, en utilisant un <code class="literal">OUTER JOIN</code>. 
                        </p>
                     </li>
                     <li>
                        <p><span class="emphasis"><em>Chargement par select</em></span> - Un second <code class="literal">SELECT</code> est utilis&eacute; pour r&eacute;cup&eacute;rer l'instance associ&eacute;e ou la collection. A moins que vous ne d&eacute;sactiviez explicitement le chargement
                           tardif en sp&eacute;cifiant <code class="literal">lazy="false"</code>, ce second select ne sera ex&eacute;cut&eacute; que lorsque vous acc&eacute;derez r&eacute;ellement &agrave; l'association. 
                        </p>
                     </li>
                     <li>
                        <p><span class="emphasis"><em>Chargement par sous-select</em></span> - Un second <code class="literal">SELECT</code> est utilis&eacute; pour r&eacute;cup&eacute;rer les associations pour toutes les entit&eacute;s r&eacute;cup&eacute;r&eacute;es dans une requ&ecirc;te ou un chargement pr&eacute;alable.
                           A moins que vous ne d&eacute;sactiviez explicitement le chargement tardif en sp&eacute;cifiant <code class="literal">lazy="false"</code>, ce second select ne sera ex&eacute;cut&eacute; que lorsque vous acc&eacute;derez r&eacute;ellement &agrave; l'association. 
                        </p>
                     </li>
                     <li>
                        <p><span class="emphasis"><em>Chargement par lot</em></span> - Il s'agit d'une strat&eacute;gie d'optimisation pour le chargement par select - Hibernate r&eacute;cup&egrave;re un lot d'instances ou de collections
                           en un seul <code class="literal">SELECT</code> en sp&eacute;cifiant une liste de cl&eacute; primaire ou de cl&eacute; &eacute;trang&egrave;re. 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Hibernate fait &eacute;galement la distinction entre : </p>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        <p><span class="emphasis"><em>Chargement imm&eacute;diat</em></span> - Une association, une collection ou un attribut est charg&eacute; imm&eacute;diatement lorsque l'objet auquel appartient cet &eacute;l&eacute;ment est
                           charg&eacute;. 
                        </p>
                     </li>
                     <li>
                        <p><span class="emphasis"><em>Chargement tardif d'une collection</em></span> - Une collection est charg&eacute;e lorque l'application invoque une m&eacute;thode sur cette collection (il s'agit du mode de chargement
                           par d&eacute;faut pour les collections). 
                        </p>
                     </li>
                     <li>
                        <p><span class="emphasis"><em>Chargement "super tardif" d'une collection</em></span> - les &eacute;l&eacute;ments de la collection sont r&eacute;cup&eacute;r&eacute;s individuellement depuis la base de donn&eacute;es lorsque n&eacute;cessaire. Hibernate essaie
                           de ne pas charger toute la collection en m&eacute;moire sauf si cela est absolument n&eacute;cessaire (bien adapt&eacute; aux tr&egrave;s grandes collections).
                           
                        </p>
                     </li>
                     <li>
                        <p><span class="emphasis"><em>Chargement par proxy</em></span> - une association vers un seul objet est charg&eacute;e lorsqu'une m&eacute;thode autre que le getter sur l'identifiant est appel&eacute;e sur
                           l'objet associ&eacute;. 
                        </p>
                     </li>
                     <li>
                        <p><span class="emphasis"><em>Chargement "sans proxy"</em></span> - une association vers un seul objet est charg&eacute;e lorsque l'on acc&egrave;de &agrave; cet objet. Par rapport au chargement par proxy, cette
                           approche est moins tardif (l'association est quand m&ecirc;me charg&eacute;e m&ecirc;me si on n'acc&egrave;de qu'&agrave; l'identifiant) mais plus transparente
                           car il n'y a pas de proxy visible dans l'application. Cette approche requiert une instrumentation du bytecode &agrave; la compilation
                           et est rarement n&eacute;cessaire. 
                        </p>
                     </li>
                     <li>
                        <p><span class="emphasis"><em>Chargement tardif des attributs</em></span> - Un attribut ou un objet associ&eacute; seul est charg&eacute; lorsque l'on y acc&egrave;de. Cette approche requiert une instrumentation du bytecode
                           &agrave; la compilation et est rarement n&eacute;cessaire. 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Nous avons ici deux notions orthogonales : <span class="emphasis"><em>quand</em></span> l'association est charg&eacute;e et <span class="emphasis"><em>comment</em></span> (quelle requ&ecirc;te SQL est utilis&eacute;e). Il ne faut pas confondre les deux. Le mode de chargement est utilis&eacute; pour am&eacute;liorer les
                  performances. On peut utiliser le mode tardif pour d&eacute;finir un contrat sur quelles donn&eacute;es sont toujours accessibles sur une
                  instance d&eacute;tach&eacute;e d'une classe particuli&egrave;re. 
               </p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-fetching-lazy"></a>19.1.1.&nbsp;Travailler avec des associations charg&eacute;es tardivement
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Par d&eacute;faut, Hibernate3 utilise le chargement tardif par select pour les collections et le chargement tardif par proxy pour
                     les associations vers un seul objet. Ces valeurs par d&eacute;faut sont valables pour la plupart des associations dans la plupart
                     des applications. 
                  </p>
                  <p><span class="emphasis"><em>Note :</em></span> si vous d&eacute;finissez <code class="literal">hibernate.default_batch_fetch_size</code>, Hibernate va utiliser l'optimisation du chargement par lot pour le chargement tardif (cette optimisation peut aussi &ecirc;tre
                     activ&eacute;e &agrave; un niveau de granularit&eacute; plus fin). 
                  </p>
                  <p>Cependant, le chargement tardif pose un probl&egrave;me qu'il faut connaitre. L'acc&egrave;s &agrave; une association d&eacute;finie comme "tardive",
                     hors du contexte d'une session hibernate ouverte, va conduire &agrave; une exception. Par exemple : 
                  </p><pre class="programlisting">s = sessions.openSession();
Transaction tx = s.beginTransaction();
            
User u = (User) s.createQuery("from User u where u.name=:userName")
    .setString("userName", userName).uniqueResult();
Map permissions = u.getPermissions();

tx.commit();
s.close();

Integer accessLevel = (Integer) permissions.get("accounts");  // Error!</pre><p>Etant donn&eacute; que la collection des permissions n'a pas &eacute;t&eacute; initialis&eacute;e avant que la <code class="literal">Session</code> soit ferm&eacute;e, la collection n'est pas capable de se charger. <span class="emphasis"><em>Hibernate ne supporte pas le chargement tardif pour des objets d&eacute;tach&eacute;s</em></span>. La solution &agrave; ce probl&egrave;me est de d&eacute;placer le code qui lit la collection avant le "commit" de la transaction. 
                  </p>
                  <p>Une autre alternative est d'utiliser une collection ou une association non "tardive" en sp&eacute;cifiant <code class="literal">lazy="false"</code> dans le mapping de l'association. Cependant il est pr&eacute;vu que le chargement tardif soit utilis&eacute; pour quasiment toutes les
                     collections ou associations. Si vous d&eacute;finissez trop d'associtions non "tardives" dans votre mod&egrave;le objet, Hibernate va finir
                     par devoir charger toute la base de donn&eacute;es en m&eacute;moire &agrave; chaque transaction ! 
                  </p>
                  <p>D'un autre c&ocirc;t&eacute;, on veut souvent choisir un chargement par jointure (qui est par d&eacute;faut non tardif) &agrave; la place du chargement
                     par select dans une transaction particuli&egrave;re. Nous allons maintenant voir comment adapter les strat&eacute;gies de chargement. Dans
                     Hibernate3 les m&eacute;canismes pour choisir une strat&eacute;gie de chargement sont identiques que l'on ait une association vers un objet
                     simple ou vers une collection. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-fetching-custom"></a>19.1.2.&nbsp;Personnalisation des strat&eacute;gies de chargement
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Le chargement par select (mode par d&eacute;faut) est tr&egrave;s vuln&eacute;rable au probl&egrave;me du N+1 selects, du coup vous pouvez avoir envie
                     d'activer le chargement par jointure dans les fichiers de mapping : 
                  </p><pre class="programlisting">&lt;set name="permissions" 
            fetch="join"&gt;
    &lt;key column="userId"/&gt;
    &lt;one-to-many class="Permission"/&gt;
&lt;/set</pre><pre class="programlisting">&lt;many-to-one name="mother" class="Cat" fetch="join"/&gt;</pre><p>La strat&eacute;gie de chargement d&eacute;finie &agrave; l'aide du mot <code class="literal">fetch</code> dans les fichiers de mapping affecte : 
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p>La r&eacute;cup&eacute;ration via <code class="literal">get()</code> ou <code class="literal">load()</code> 
                           </p>
                        </li>
                        <li>
                           <p>La r&eacute;cup&eacute;ration implicite lorsque l'on navigue &agrave; travers une association </p>
                        </li>
                        <li>
                           <p>Les requ&ecirc;tes de type <code class="literal">Criteria</code> 
                           </p>
                        </li>
                        <li>
                           <p>Les requ&ecirc;tes HQL si l'on utilise le chargement par <code class="literal">subselect</code> 
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>Quelle que soit la strat&eacute;gie de chargement que vous utilisez, la partie du graphe d'objets qui est d&eacute;finie comme non "tardive"
                     sera charg&eacute;e en m&eacute;moire. Cela peut mener &agrave; l'ex&eacute;cution de plusieurs selects successifs pour une seule requ&ecirc;te HQL. 
                  </p>
                  <p>On n'utilise pas souvent les documents de mapping pour adapter le chargement. Au lieu de cela, on conserve le comportement
                     par d&eacute;faut et on le surcharge pour une transaction particuli&egrave;re en utilisant <code class="literal">left join fetch</code> dans les requ&ecirc;tes HQL. Cela indique &agrave; hibernate &agrave; Hibernate de charger l'association de mani&egrave;re agressive lors du premier
                     select en utilisant une jointure externe. Dans l'API Criteria vous pouvez utiliser la m&eacute;thode <code class="literal">setFetchMode(FetchMode.JOIN)</code> 
                  </p>
                  <p>Si vous ne vous sentez pas pr&ecirc;t &agrave; modifier la strat&eacute;gie de chargement utilis&eacute; par <code class="literal">get()</code> ou <code class="literal">load()</code>, vous pouvez juste utiliser une requ&ecirc;te de type <code class="literal">Criteria</code> comme par exemple : 
                  </p><pre class="programlisting">User user = (User) session.createCriteria(User.class)
                .setFetchMode("permissions", FetchMode.JOIN)
                .add( Restrictions.idEq(userId) )
                .uniqueResult();</pre><p>(Il s'agit de l'&eacute;quivalent pour Hibernate de ce que d'autres outils de mapping appellent un "fetch plan" ou "plan de chargement")
                     
                  </p>
                  <p>Une autre mani&egrave;re compl&egrave;tement diff&eacute;rente d'&eacute;viter le probl&egrave;me des N+1 selects est d'utiliser le cache de second niveau. </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-fetching-proxies"></a>19.1.3.&nbsp;Proxys pour des associations vers un seul objet
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Le chargement tardif des collections est impl&eacute;ment&eacute; par Hibernate en utilisant ses propres impl&eacute;mentations pour des collections
                     persistantes. Si l'on veut un chargement tardif pour des associations vers un seul objet m&eacute;tier il faut utiliser un autre
                     m&eacute;canisme. L'entit&eacute; qui est point&eacute;e par l'association doit &ecirc;tre masqu&eacute;e derri&egrave;re un proxy. Hibernate impl&eacute;mente l'initialisation
                     tardive des proxys sur des objets persistents via une mise &agrave; jour &agrave; chaud du bytecode (&agrave; l'aide de l'excellente librairie
                     CGLIB). 
                  </p>
                  <p>Par d&eacute;faut, Hibernate g&eacute;n&egrave;re des proxys (au d&eacute;marrage) pour toutes les classes persistantes et les utilise pour activer le
                     chargement tardif des associations <code class="literal">many-to-one</code> et <code class="literal">one-to-one</code>. 
                  </p>
                  <p>Le fichier de mapping peut d&eacute;clarer une interface qui sera utilis&eacute;e par le proxy d'interfa&ccedil;age pour cette classe &agrave; l'aide
                     de l'attribut <code class="literal">proxy</code>. Par d&eacute;faut Hibernate utilises une sous classe de la classe persistante. <span class="emphasis"><em>Il faut que les classes pour lesquelles on ajoute un proxy impl&eacute;mentent un constructeur par d&eacute;faut de visibilit&eacute; au moins
                           package. Ce constructeur est recommand&eacute; pour toutes les classes persistantes !</em></span> 
                  </p>
                  <p>Il y a quelques pr&eacute;cautions &agrave; prendre lorsque l'on &eacute;tend cette approche &agrave; des classes polymorphiques, exemple : </p><pre class="programlisting">&lt;class name="Cat" proxy="Cat"&gt;
    ......
    &lt;subclass name="DomesticCat"&gt;
        .....
    &lt;/subclass&gt;
&lt;/class&gt;</pre><p>Tout d'abord, les instances de <code class="literal">Cat</code> ne pourront jamais &ecirc;tre "cast&eacute;es" en <code class="literal">DomesticCat</code>, m&ecirc;me si l'instance sous jacente est une instance de <code class="literal">DomesticCat</code> : 
                  </p><pre class="programlisting">Cat cat = (Cat) session.load(Cat.class, id);  // instantiate a proxy (does not hit the db)
if ( cat.isDomesticCat() ) {                  // hit the db to initialize the proxy
    DomesticCat dc = (DomesticCat) cat;       // Error!
    ....
}</pre><p>Deuxi&egrave;mement, il est possible de casser la notion d'<code class="literal">==</code> des proxy. 
                  </p><pre class="programlisting">Cat cat = (Cat) session.load(Cat.class, id);            // instantiate a Cat proxy
DomesticCat dc = 
        (DomesticCat) session.load(DomesticCat.class, id);  // acquire new DomesticCat proxy!
System.out.println(cat==dc);                            // false</pre><p>Cette situation n'est pas si mauvaise qu'il n'y parait. M&ecirc;me si nous avons deux r&eacute;f&eacute;rences &agrave; deux objets proxys diff&eacute;rents,
                     l'instance de base sera quand m&ecirc;me le m&ecirc;me objet : 
                  </p><pre class="programlisting">cat.setWeight(11.0);  // hit the db to initialize the proxy
System.out.println( dc.getWeight() );  // 11.0</pre><p>Troisi&egrave;mement, vous ne pourrez pas utiliser un proxy CGLIB pour une classe <code class="literal">final</code> ou pour une classe contenant la moindre m&eacute;thode <code class="literal">final</code>. 
                  </p>
                  <p>Enfin, si votre objet persistant obtient une ressource &agrave; l'instanciation (par example dans les initialiseurs ou dans le contructeur
                     par d&eacute;faut), alors ces ressources seront aussi obtenues par le proxy. La classe proxy est vraiment une sous classe de la classe
                     persistante. 
                  </p>
                  <p>Ces probl&egrave;mes sont tous dus aux limitations fondamentales du mod&egrave;le d'h&eacute;ritage unique de Java. Si vous souhaitez &eacute;viter ces
                     probl&egrave;mes, vos classes persistantes doivent chacune impl&eacute;menter une interface qui d&eacute;clare ses m&eacute;thodes m&eacute;tier. Vous devriez
                     alors sp&eacute;cifier ces interfaces dans le fichier de mapping : 
                  </p><pre class="programlisting">&lt;class name="CatImpl" proxy="Cat"&gt;
    ......
    &lt;subclass name="DomesticCatImpl" proxy="DomesticCat"&gt;
        .....
    &lt;/subclass&gt;
&lt;/class&gt;</pre><p>o&ugrave; <code class="literal">CatImpl</code> impl&eacute;mente l'interface <code class="literal">Cat</code> et <code class="literal">DomesticCatImpl</code> impl&eacute;mente l'interface <code class="literal">DomesticCat</code>. Ainsi, des proxys pour les instances de <code class="literal">Cat</code> et <code class="literal">DomesticCat</code> pourraient &ecirc;tre retourn&eacute;es par <code class="literal">load()</code> ou <code class="literal">iterate()</code> (Notez que <code class="literal">list()</code> ne retourne g&eacute;n&eacute;ralement pas de proxy). 
                  </p><pre class="programlisting">Cat cat = (Cat) session.load(CatImpl.class, catid);
Iterator iter = session.createQuery("from CatImpl as cat where cat.name='fritz'").iterate();
Cat fritz = (Cat) iter.next();</pre><p>Les relations sont aussi initialis&eacute;es tardivement. Ceci signifie que vous devez d&eacute;clarer chaque propri&eacute;t&eacute; comme &eacute;tant de type
                     <code class="literal">Cat</code>, et non <code class="literal">CatImpl</code>. 
                  </p>
                  <p>Certaines op&eacute;rations ne n&eacute;cessitent pas l'initialisation du proxy </p>
                  <div class="itemizedlist">
                     <ul type="disc" compact>
                        <li>
                           <p><code class="literal">equals()</code>, si la classe persistante ne surcharge pas <code class="literal">equals()</code> 
                           </p>
                        </li>
                        <li>
                           <p><code class="literal">hashCode()</code>, si la classe persistante ne surcharge pas <code class="literal">hashCode()</code> 
                           </p>
                        </li>
                        <li>
                           <p>Le getter de l'identifiant </p>
                        </li>
                     </ul>
                  </div>
                  <p>Hibernate d&eacute;tectera les classes qui surchargent <code class="literal">equals()</code> ou <code class="literal">hashCode()</code>. 
                  </p>
                  <p>Eh choisissant <code class="literal">lazy="no-proxy"</code> au lieu de <code class="literal">lazy="proxy"</code> qui est la valeur par d&eacute;faut, il est possible d'&eacute;viter les probl&egrave;mes li&eacute;s au transtypage. Il faudra alors une instrumentation
                     du bytecode &agrave; la compilation et toutes les op&eacute;rations r&eacute;sulterons imm&eacute;diatement en une initialisation du proxy. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-fetching-initialization"></a>19.1.4.&nbsp;Initialisation des collections et des proxys
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Une exception de type <code class="literal">LazyInitializationException</code> sera renvoy&eacute;e par hibernate si une collection ou un proxy non initialis&eacute; est acc&eacute;d&eacute; en dehors de la port&eacute;e de la <code class="literal">Session</code>, e.g. lorsque l'entit&eacute; &agrave; laquelle appartient la collection ou qui a une r&eacute;f&eacute;rence vers le proxy est dans l'&eacute;tat "d&eacute;tach&eacute;e".
                     
                  </p>
                  <p>Parfois, nous devons nous assurer qu'un proxy ou une collection est initialis&eacute;e avant de fermer la <code class="literal">Session</code>. Bien s&ucirc;r, nous pouvons toujours forcer l'initialisation en appelant par exemple <code class="literal">cat.getSex()</code> ou <code class="literal">cat.getKittens().size()</code>. Mais ceci n'est pas tr&egrave;s lisible pour les personnes parcourant le code et n'est pas tr&egrave;s g&eacute;n&eacute;rique. 
                  </p>
                  <p>Les m&eacute;thodes statiques <code class="literal">Hibernate.initialize()</code> et <code class="literal">Hibernate.isInitialized()</code> fournissent &agrave; l'application un moyen de travailler avec des proxys ou des collections initialis&eacute;s. <code class="literal">Hibernate.initialize(cat)</code> forcera l'initialisation d'un proxy de <code class="literal">cat</code>, si tant est que sa <code class="literal">Session</code> est ouverte. <code class="literal">Hibernate.initialize( cat.getKittens() )</code> a le m&ecirc;me effet sur la collection kittens. 
                  </p>
                  <p>Une autre option est de conserver la <code class="literal">Session</code> ouverte jusqu'&agrave; ce que toutes les collections et tous les proxys aient &eacute;t&eacute; charg&eacute;s. Dans certaines architectures applicatives,
                     particuli&egrave;rement celles ou le code d'acc&egrave;s aux donn&eacute;es via hiberante et le code qui utilise ces donn&eacute;es sont dans des couches
                     applicatives diff&eacute;rentes ou des processus physiques diff&eacute;rents, il peut devenir probl&eacute;matique de garantir que la <code class="literal">Session</code> est ouverte lorsqu'une collection est initialis&eacute;e. Il y a deux moyens de traiter ce probl&egrave;me : 
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p>Dans une application web, un filtre de servlet peut &ecirc;tre utilis&eacute; pour fermer la <code class="literal">Session</code> uniquement lorsque la requ&ecirc;te a &eacute;t&eacute; enti&egrave;rement trait&eacute;e, lorsque le rendu de la vue est fini (il s'agit du pattern <span class="emphasis"><em>Open Session in View</em></span>). Bien s&ucirc;r, cela demande plus d'attention &agrave; la bonne gestion des exceptions de l'application. Il est d'une importance vitale
                              que la <code class="literal">Session</code> soit ferm&eacute;e et la transaction termin&eacute;e avant que l'on rende la main &agrave; l'utilisateur m&ecirc;me si une exception survient durant
                              le traitement de la vue. Voir le wiki Hibernate pour des exemples sur le pattern "Open Session in View". 
                           </p>
                        </li>
                        <li>
                           <p>Dans une application avec une couche m&eacute;tier s&eacute;par&eacute;e, la couche contenant la logique m&eacute;tier doit "pr&eacute;parer" toutes les collections
                              qui seront n&eacute;cessaires &agrave; la couche web avant de retourner les donn&eacute;es. Cela signifie que la couche m&eacute;tier doit charger toutes
                              les donn&eacute;es et retourner toutes les donn&eacute;es d&eacute;j&agrave; initialis&eacute;es &agrave; la couche de pr&eacute;sentation/web pour un cas d'utilisation donn&eacute;.
                              En g&eacute;n&eacute;ral l'application appelle la m&eacute;thode <code class="literal">Hibernate.initialize()</code> pour chaque collection n&eacute;cessaire dans la couche web (cet appel doit &ecirc;tre fait avant la fermeture de la session) ou bien
                              r&eacute;cup&egrave;re les collections de mani&egrave;re agressive &agrave; l'aide d'une requ&ecirc;te HQL avec une clause <code class="literal">FETCH</code> ou &agrave; l'aide du mode <code class="literal">FetchMode.JOIN</code> pour une requ&ecirc;te de type <code class="literal">Criteria</code>. Cela est en g&eacute;n&eacute;ral plus facile si vous utilisez le pattern <span class="emphasis"><em>Command</em></span> plut&ocirc;t que <span class="emphasis"><em>Session Facade</em></span>. 
                           </p>
                        </li>
                        <li>
                           <p>Vous pouvez &eacute;galement attacher &agrave; une <code class="literal">Session</code> un objet charg&eacute; au pr&eacute;alable &agrave; l'aide des m&eacute;thodes <code class="literal">merge()</code> ou <code class="literal">lock()</code> avant d'acc&eacute;der aux collections (ou aux proxys) non initialis&eacute;s. Non, Hibernate ne fait pas, et ne doit pas faire, cela automatiquement
                              car cela pourrait introduire une s&eacute;mantique transactionnelle ad hoc. 
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>Parfois, vous ne voulez pas initialiser une grande collection mais vous avez quand m&ecirc;me besoin d'informations sur elle (comme
                     sa taille) ou un sous ensemble de ses donn&eacute;es 
                  </p>
                  <p>Vous pouvez utiliser un filtre de collection pour r&eacute;cup&eacute;rer sa taille sans l'initialiser : </p><pre class="programlisting">( (Integer) s.createFilter( collection, "select count(*)" ).list().get(0) ).intValue()</pre><p>La m&eacute;thode <code class="literal">createFilter()</code> est &eacute;galement utilis&eacute;e pour r&eacute;cup&eacute;rer de mani&egrave;re efficace des sous ensembles d'une collection sans avoir besoin de l'initialiser
                     dans son ensemble. 
                  </p><pre class="programlisting">s.createFilter( lazyCollection, "").setFirstResult(0).setMaxResults(10).list();</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-fetching-batch"></a>19.1.5.&nbsp;Utiliser le chargement par lot
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Pour am&eacute;liorer les performances, Hibernate peut utiliser le chargement par lot ce qui veut dire qu'Hibernate peut charger
                     plusieurs proxys (ou collections) non initialis&eacute;s en une seule requ&ecirc;te lorsque l'on acc&egrave;de &agrave; l'un de ces proxys. Le chargement
                     par lot est une optimisation intimement li&eacute;e &agrave; la strat&eacute;gie de chargement tardif par select. Il y a deux moyens d'activer
                     le chargement par lot : au niveau de la classe et au niveau de la collection. 
                  </p>
                  <p>Le chargement par lot pour les classes/entit&eacute;s est plus simple &agrave; comprendre. Imaginez que vous ayez la situation suivante
                     &agrave; l'ex&eacute;cution : vous avez 25 instances de <code class="literal">Cat</code> charg&eacute;es dans une <code class="literal">Session</code>, chaque <code class="literal">Cat</code> a une r&eacute;f&eacute;rence &agrave; son <code class="literal">owner</code>, une <code class="literal">Person</code>. La classe <code class="literal">Person</code> est mapp&eacute;e avec un proxy, <code class="literal">lazy="true"</code>. Si vous it&eacute;rez sur tous les cats et appelez <code class="literal">getOwner()</code> sur chacun d'eux, Hibernate ex&eacute;cutera par d&eacute;faut 25 <code class="literal">SELECT</code>, pour charger les owners (initialiser le proxy). Vous pouvez param&eacute;trer ce comportement en sp&eacute;cifiant une <code class="literal">batch-size</code> (taille du lot) dans le mapping de <code class="literal">Person</code> : 
                  </p><pre class="programlisting">&lt;class name="Person" batch-size="10"&gt;...&lt;/class&gt;</pre><p>Hibernate ex&eacute;cutera d&eacute;sormais trois requ&ecirc;tes, en chargeant respectivement 10, 10, et 5 entit&eacute;s. </p>
                  <p>You may also enable batch fetching of collections. For example, if each <code class="literal">Person</code> has a lazy collection of <code class="literal">Cat</code>s, and 10 persons are currently loaded in the <code class="literal">Session</code>, iterating through all persons will generate 10 <code class="literal">SELECT</code>s, one for every call to <code class="literal">getCats()</code>. If you enable batch fetching for the <code class="literal">cats</code> collection in the mapping of <code class="literal">Person</code>, Hibernate can pre-fetch collections: 
                  </p><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;set name="cats" batch-size="3"&gt;
        ...
    &lt;/set&gt;
&lt;/class&gt;</pre><p>Avec une taille de lot (<code class="literal">batch-size</code>) de 3, Hibernate chargera respectivement 3, 3, 3, et 1 collections en quatre <code class="literal">SELECT</code>s. Encore une fois, la valeur de l'attribut d&eacute;pend du nombre de collections non initialis&eacute;es dans une <code class="literal">Session</code> particuli&egrave;re. 
                  </p>
                  <p>Le chargement par lot de collections est particuli&egrave;rement utile si vous avez des arborescenses r&eacute;cursives d'&eacute;l&eacute;ments (typiquement,
                     le sch&eacute;ma facture de mat&eacute;riels). (Bien qu'un <span class="emphasis"><em>sous ensemble</em></span> ou un <span class="emphasis"><em>chemin mat&eacute;rialis&eacute;</em></span> est sans doute une meilleure option pour des arbres principalement en lecture.) 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-fetching-subselect"></a>19.1.6.&nbsp;Utilisation du chargement par sous select
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Si une collection ou un proxy vers un objet doit &ecirc;tre charg&eacute;, Hibernate va tous les charger en r&eacute;-ex&eacute;cutant la requ&ecirc;te orignial
                     dans un sous select. Cela fonctionne de la m&ecirc;me mani&egrave;re que le chargement par lot sans la possibilit&eacute; de fragmenter le chargement.
                     
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-fetching-lazyproperties"></a>19.1.7.&nbsp;Utiliser le chargement tardif des propri&eacute;t&eacute;s
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Hibernate3 supporte le chargement tardif de propri&eacute;t&eacute;s individuelles. La technique d'optimisation est &eacute;galement connue sous
                     le nom de <span class="emphasis"><em>fetch groups</em></span> (groupes de chargement). Il faut noter qu'il s'agit principalement d'une fonctionnalit&eacute; marketing car en pratique l'optimisation
                     de la lecture d'un enregistrement est beaucoup plus importante que l'optimisation de la lecture d'une colonne. Cependant,
                     la restriction du chargement &agrave; certaines colonnes peut &ecirc;tre pratique dans des cas extr&egrave;mes, lorsque des tables "legacy" poss&egrave;dent
                     des centaines de colonnes et que le mod&egrave;le de donn&eacute;es ne peut pas &ecirc;tre am&eacute;lior&eacute;. 
                  </p>
                  <p>Pour activer le chargement tardif d'une propri&eacute;t&eacute;, il faut mettre l'attribut <code class="literal">lazy</code> sur une propri&eacute;t&eacute; particuli&egrave;re du mapping : 
                  </p><pre class="programlisting">&lt;class name="Document"&gt;
       &lt;id name="id"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    &lt;property name="name" not-null="true" length="50"/&gt;
    &lt;property name="summary" not-null="true" length="200" lazy="true"/&gt;
    &lt;property name="text" not-null="true" length="2000" lazy="true"/&gt;
&lt;/class&gt;</pre><p>Le chargement tardif des propri&eacute;t&eacute;s requiert une instrumentation du bytecode lors de la compilation ! Si les classes persistantes
                     ne sont pas instrument&eacute;es, Hibernate ignorera de mani&egrave;re silencieuse le mode tardif et retombera dans le mode de chargement
                     imm&eacute;diat. 
                  </p>
                  <p>Pour l'instrumentation du bytecode vous pouvez utiliser la t&acirc;che Ant suivante : </p><pre class="programlisting">&lt;target name="instrument" depends="compile"&gt;
    &lt;taskdef name="instrument" classname="org.hibernate.tool.instrument.InstrumentTask"&gt;
        &lt;classpath path="${jar.path}"/&gt;
        &lt;classpath path="${classes.dir}"/&gt;
        &lt;classpath refid="lib.class.path"/&gt;
    &lt;/taskdef&gt;

    &lt;instrument verbose="true"&gt;
        &lt;fileset dir="${testclasses.dir}/org/hibernate/auction/model"&gt;
            &lt;include name="*.class"/&gt;
        &lt;/fileset&gt;
    &lt;/instrument&gt;
&lt;/target&gt;</pre><p>A different (better?) way to avoid unnecessary column reads, at least for read-only transactions is to use the projection
                     features of HQL or Criteria queries. This avoids the need for buildtime bytecode processing and is certainly a preferred solution.
                     
                  </p>
                  <p>Vous pouvez forcer le mode de chargement agressif des propri&eacute;t&eacute;s en utilisant <code class="literal">fetch all properties</code> dans les requ&ecirc;ts HQL. 
                  </p>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="performance-cache"></a>19.2.&nbsp;Le cache de second niveau
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Une <code class="literal">Session</code> Hibernate est un cache de niveau transactionnel des donn&eacute;es persistantes. Il est possible de configurer un cache de cluster
                  ou de JVM (de niveau <code class="literal">SessionFactory</code> pour &ecirc;tre exact) d&eacute;fini classe par classe et collection par collection. Vous pouvez m&ecirc;me utiliser votr choix de cache en
                  impl&eacute;mentant le pourvoyeur (provider) associ&eacute;. Faites attention, les caches ne sont jamais avertis des modifications faites
                  dans la base de donn&eacute;es par d'autres applications (ils peuvent cependant &ecirc;tre configur&eacute;s pour r&eacute;guli&egrave;rement expirer les donn&eacute;es
                  en cache). 
               </p>
               <p>Par d&eacute;faut, Hibernate utilise EHCache comme cache de niveau JVM (le support de JCS est d&eacute;sormais d&eacute;pr&eacute;ci&eacute; et sera enlev&eacute; des
                  futures versions d'Hibernate). Vous pouvez choisir une autre impl&eacute;mentation en sp&eacute;cifiant le nom de la classe qui impl&eacute;mente
                  <code class="literal">org.hibernate.cache.CacheProvider</code> en utilisant la propri&eacute;t&eacute; <code class="literal">hibernate.cache.provider_class</code>. 
               </p>
               <div class="table"><a name="cacheproviders"></a><p class="title"><b>Tableau&nbsp;19.1.&nbsp;Fournisseur de cache</b></p>
                  <div class="table-contents">
                     <table summary="Fournisseur de cache" border="1">
                        <colgroup>
                           <col align="left">
                           <col align="left">
                           <col align="left">
                           <col align="left">
                           <col align="left">
                        </colgroup>
                        <thead>
                           <tr>
                              <th align="left">Cache</th>
                              <th align="left">Classe pourvoyeuse</th>
                              <th align="left">Type</th>
                              <th align="left">Support en Cluster</th>
                              <th align="left">Cache de requ&ecirc;tes support&eacute;</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr>
                              <td align="left">Hashtable (not intended for production use)</td>
                              <td align="left"><code class="literal">org.hibernate.cache.HashtableCacheProvider</code></td>
                              <td align="left">m&eacute;moire</td>
                              <td align="left">&nbsp;</td>
                              <td align="left">yes</td>
                           </tr>
                           <tr>
                              <td align="left">EHCache</td>
                              <td align="left"><code class="literal">org.hibernate.cache.EhCacheProvider</code></td>
                              <td align="left">m&eacute;moire, disque</td>
                              <td align="left">&nbsp;</td>
                              <td align="left">yes</td>
                           </tr>
                           <tr>
                              <td align="left">OSCache</td>
                              <td align="left"><code class="literal">org.hibernate.cache.OSCacheProvider</code></td>
                              <td align="left">m&eacute;moire, disque</td>
                              <td align="left">&nbsp;</td>
                              <td align="left">yes</td>
                           </tr>
                           <tr>
                              <td align="left">SwarmCache</td>
                              <td align="left"><code class="literal">org.hibernate.cache.SwarmCacheProvider</code></td>
                              <td align="left">en cluster (multicast ip)</td>
                              <td align="left">oui (invalidation de cluster)</td>
                              <td align="left">&nbsp;</td>
                           </tr>
                           <tr>
                              <td align="left">JBoss Cache 1.x</td>
                              <td align="left"><code class="literal">org.hibernate.cache.TreeCacheProvider</code></td>
                              <td align="left">en cluster (multicast ip), transactionnel</td>
                              <td align="left">oui (replication)</td>
                              <td align="left">oui (horloge sync. n&eacute;cessaire)</td>
                           </tr>
                           <tr>
                              <td align="left">JBoss Cache 2</td>
                              <td align="left"><code class="literal">org.hibernate.cache.jbc2.JBossCacheRegionFactory</code></td>
                              <td align="left">en cluster (multicast ip), transactionnel</td>
                              <td align="left">yes (replication or invalidation)</td>
                              <td align="left">oui (horloge sync. n&eacute;cessaire)</td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
               </div><br class="table-break"><div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-cache-mapping"></a>19.2.1.&nbsp;Mapping de Cache
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>L'&eacute;l&eacute;ment <code class="literal">&lt;cache&gt;</code> d'une classe ou d'une collection &agrave; la forme suivante : 
                  </p>
                  <div class="programlistingco"><pre class="programlisting">&lt;cache 
    usage="transactional|read-write|nonstrict-read-write|read-only"  <span class="co">(1)</span>
    region="RegionName"                                              <span class="co">(2)</span>
    include="all|non-lazy"                                           <span class="co">(3)</span>
/&gt;</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">usage</code> (requis) sp&eacute;cifie la strat&eacute;gie de cache : <code class="literal">transactionel</code>, <code class="literal">lecture-&eacute;criture</code>, <code class="literal">lecture-&eacute;criture non stricte</code> ou <code class="literal">lecture seule</code> 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">region</code> (optionnel, par d&eacute;faut il s'agit du nom de la classe ou du nom de role de la collection) sp&eacute;cifie le nom de la r&eacute;gion du
                                    cache de second niveau 
                                 </p>
                              </td>
                           </tr>
                           <tr>
                              <td width="5%" valign="top" align="left">
                                 <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                              </td>
                              <td valign="top" align="left">
                                 <p><code class="literal">include</code> (optionnel, par d&eacute;faut <code class="literal">all</code>) <code class="literal">non-lazy</code> sp&eacute;cifie que les propri&eacute;t&eacute;s des entit&eacute;s mapp&eacute;es avec <code class="literal">lazy="true"</code> ne doivent pas &ecirc;tre mises en cache lorsque le chargement tardif des attributs est activ&eacute;. 
                                 </p>
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Alternatively (preferably?), you may specify <code class="literal">&lt;class-cache&gt;</code> and <code class="literal">&lt;collection-cache&gt;</code> elements in <code class="literal">hibernate.cfg.xml</code>. 
                  </p>
                  <p>L'attribut <code class="literal">usage</code> sp&eacute;cifie une <span class="emphasis"><em>strat&eacute;gie de concurrence d'acc&egrave;s au cache</em></span>. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-cache-readonly"></a>19.2.2.&nbsp;Strategie : lecture seule
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Si votre application a besoin de lire mais ne modifie jamais les instances d'une classe, un cache <code class="literal">read-only</code> peut &ecirc;tre utilis&eacute;. C'est la strat&eacute;gie la plus simple et la plus performante. Elle est m&ecirc;me parfaitement s&ucirc;re dans un cluster.
                     
                  </p><pre class="programlisting">&lt;class name="eg.Immutable" mutable="false"&gt;
    &lt;cache usage="read-only"/&gt;
    ....
&lt;/class&gt;</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-cache-readwrite"></a>19.2.3.&nbsp;Strat&eacute;gie : lecture/&eacute;criture
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Si l'application a besoin de mettre &agrave; jour des donn&eacute;es, un cache <code class="literal">read-write</code> peut &ecirc;tre appropri&eacute;. Cette strat&eacute;gie ne devrait jamais &ecirc;tre utilis&eacute;e si votre application n&eacute;cessite un niveau d'isolation
                     transactionnelle s&eacute;rialisable. Si le cache est utilis&eacute; dans un environnement JTA, vous devez sp&eacute;cifier <code class="literal">hibernate.transaction.manager_lookup_class</code>, fournissant une strat&eacute;gie pour obtenir le <code class="literal">TransactionManager</code> JTA. Dans d'autres environnements, vous devriez vous assurer que la transation est termin&eacute;e &agrave; l'appel de <code class="literal">Session.close()</code> ou <code class="literal">Session.disconnect()</code>. Si vous souhaitez utiliser cette strat&eacute;gie dans un cluster, vous devriez vous assurer que l'impl&eacute;mentation de cache utilis&eacute;e
                     supporte le v&eacute;rrouillage. Ce que ne font <span class="emphasis"><em>pas</em></span> les pourvoyeurs caches fournis. 
                  </p><pre class="programlisting">&lt;class name="eg.Cat" .... &gt;
    &lt;cache usage="read-write"/&gt;
    ....
    &lt;set name="kittens" ... &gt;
        &lt;cache usage="read-write"/&gt;
        ....
    &lt;/set&gt;
&lt;/class&gt;</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-cache-nonstrict"></a>19.2.4.&nbsp;Strat&eacute;gie : lecture/&eacute;criture non stricte
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Si l'application besoin de mettre &agrave; jour les donn&eacute;es de mani&egrave;re occasionnelle (qu'il est tr&egrave;s peu probable que deux transactions
                     essaient de mettre &agrave; jour le m&ecirc;me &eacute;l&eacute;ment simultan&eacute;ment) et qu'une isolation transactionnelle stricte n'est pas n&eacute;cessaire,
                     un cache <code class="literal">nonstrict-read-write</code> peut &ecirc;tre appropri&eacute;. Si le cache est utilis&eacute; dans un environnement JTA, vous devez sp&eacute;cifier <code class="literal">hibernate.transaction.manager_lookup_class</code>. Dans d'autres environnements, vous devriez vous assurer que la transation est termin&eacute;e &agrave; l'appel de <code class="literal">Session.close()</code> ou <code class="literal">Session.disconnect()</code> 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-cache-transactional"></a>19.2.5.&nbsp;Strat&eacute;gie : transactionelle
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>La strat&eacute;gie de cache <code class="literal">transactional</code> supporte un cache compl&egrave;tement transactionnel comme, par exemple, JBoss TreeCache. Un tel cache ne peut &ecirc;tre utilis&eacute; que
                     dans un environnement JTA et vous devez sp&eacute;cifier <code class="literal">hibernate.transaction.manager_lookup_class</code>. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-cache-compat-matrix"></a>19.2.6.&nbsp;Cache-provider/concurrency-strategy compatibility
                           </h3>
                        </div>
                     </div>
                  </div>
                  <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
                     <h3 class="title">Important</h3>
                     <p>None of the cache providers support all of the cache concurrency strategies. </p>
                  </div>
                  <p>The following table shows which providers are compatible with which concurrency strategies. </p>
                  <div class="table"><a name="d0e14674"></a><p class="title"><b>Tableau&nbsp;19.2.&nbsp;Strat&eacute;gie de concurrence du cache</b></p>
                     <div class="table-contents">
                        <table summary="Strat&eacute;gie de concurrence du cache" border="1">
                           <colgroup>
                              <col align="left">
                              <col align="left">
                              <col align="left">
                              <col align="left">
                              <col align="left">
                           </colgroup>
                           <thead>
                              <tr>
                                 <th align="left">Cache</th>
                                 <th align="left">read-only (lecture seule)</th>
                                 <th align="left">nonstrict-read-write (lecture-&eacute;criture non stricte)</th>
                                 <th align="left">read-write (lecture-&eacute;riture)</th>
                                 <th align="left">transactional (transactionnel)</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr>
                                 <td align="left">Hashtable (not intended for production use)</td>
                                 <td align="left">yes</td>
                                 <td align="left">yes</td>
                                 <td align="left">yes</td>
                                 <td align="left">&nbsp;</td>
                              </tr>
                              <tr>
                                 <td align="left">EHCache</td>
                                 <td align="left">yes</td>
                                 <td align="left">yes</td>
                                 <td align="left">yes</td>
                                 <td align="left">&nbsp;</td>
                              </tr>
                              <tr>
                                 <td align="left">OSCache</td>
                                 <td align="left">yes</td>
                                 <td align="left">yes</td>
                                 <td align="left">yes</td>
                                 <td align="left">&nbsp;</td>
                              </tr>
                              <tr>
                                 <td align="left">SwarmCache</td>
                                 <td align="left">yes</td>
                                 <td align="left">yes</td>
                                 <td align="left">&nbsp;</td>
                                 <td align="left">&nbsp;</td>
                              </tr>
                              <tr>
                                 <td align="left">JBoss Cache 1.x</td>
                                 <td align="left">yes</td>
                                 <td align="left">&nbsp;</td>
                                 <td align="left">&nbsp;</td>
                                 <td align="left">yes</td>
                              </tr>
                              <tr>
                                 <td align="left">JBoss Cache 2</td>
                                 <td align="left">yes</td>
                                 <td align="left">&nbsp;</td>
                                 <td align="left">&nbsp;</td>
                                 <td align="left">yes</td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                  </div><br class="table-break"></div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="performance-sessioncache"></a>19.3.&nbsp;G&eacute;rer les caches
                        </h2>
                     </div>
                  </div>
               </div>
               <p>A chaque fois que vous passez un objet &agrave; la m&eacute;thode <code class="literal">save()</code>, <code class="literal">update()</code> ou <code class="literal">saveOrUpdate()</code> et &agrave; chaque fois que vous r&eacute;cup&eacute;rez un objet avec <code class="literal">load()</code>, <code class="literal">get()</code>, <code class="literal">list()</code>, <code class="literal">iterate()</code> or <code class="literal">scroll()</code>, cet objet est ajout&eacute; au cache interne de la <code class="literal">Session</code>. 
               </p>
               <p>Lorsqu'il y a un appel &agrave; la m&eacute;thode <code class="literal">flush()</code>, l'&eacute;tat de cet objet va &ecirc;tre synchronis&eacute; avec la base de donn&eacute;es. Si vous ne voulez pas que cette synchronisation ait lieu
                  ou si vous traitez un grand nombre d'objets et que vous avez besoin de g&eacute;rer la m&eacute;moire de mani&egrave;re efficace, vous pouvez utiliser
                  la m&eacute;thode <code class="literal">evict()</code> pour supprimer l'objet et ses collections d&eacute;pendantes du cache de la session 
               </p><pre class="programlisting">ScrollableResult cats = sess.createQuery("from Cat as cat").scroll(); //a huge result set
while ( cats.next() ) {
    Cat cat = (Cat) cats.get(0);
    doSomethingWithACat(cat);
    sess.evict(cat);
}</pre><p>La <code class="literal">Session</code> dispose aussi de la m&eacute;thode <code class="literal">contains()</code> pour d&eacute;terminer si une instance appartient au cache de la session. 
               </p>
               <p>Pour retirer tous les objets du cache session, appelez <code class="literal">Session.clear()</code> 
               </p>
               <p>Pour le cache de second niveau, il existe des m&eacute;thodes d&eacute;finies dans <code class="literal">SessionFactory</code> pour retirer des instances du cache, la classe enti&egrave;re, une instance de collection ou le r&ocirc;le entier d'une collection. 
               </p><pre class="programlisting">sessionFactory.evict(Cat.class, catId); //evict a particular Cat
sessionFactory.evict(Cat.class);  //evict all Cats
sessionFactory.evictCollection("Cat.kittens", catId); //evict a particular collection of kittens
sessionFactory.evictCollection("Cat.kittens"); //evict all kitten collections</pre><p>Le <code class="literal">CacheMode</code> contr&ocirc;le comme une session particuli&egrave;re interragit avec le cache de second niveau 
               </p>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        <p><code class="literal">CacheMode.NORMAL</code> - lit et &eacute;crit les items dans le cache de second niveau 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">CacheMode.GET</code> - lit les items dans le cache de second niveau mais ne les &eacute;crit pas sauf dans le cache d'une mise &agrave; jour d'une donn&eacute;e 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">CacheMode.PUT</code> - &eacute;crit les items dans le cache de second niveau mais ne les lit pas dans le cache de second niveau 
                        </p>
                     </li>
                     <li>
                        <p><code class="literal">CacheMode.REFRESH</code> - &eacute;crit les items dans le cache de second niveau mais ne les lit pas dans le cache de second niveau, outrepasse l'effet de<code class="literal">hibernate.cache.use_minimal_puts</code>, en for&ccedil;ant un rafra&icirc;chissement du cache de second niveau pour chaque item lu dans la base 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Pour parcourir le contenu du cache de second niveau ou la r&eacute;gion du cache d&eacute;di&eacute;e au requ&ecirc;tes, vous pouvez utiliser l'API <code class="literal">Statistics</code> API: 
               </p><pre class="programlisting">Map cacheEntries = sessionFactory.getStatistics()
        .getSecondLevelCacheStatistics(regionName)
        .getEntries();</pre><p>Vous devez pour cela activer les statistiques et optionnellement forcer Hibernate &agrave; conserver les entr&eacute;es dans le cache sous
                  un format plus compr&eacute;hensible pour l'utilisateur : 
               </p><pre class="programlisting">hibernate.generate_statistics true
hibernate.cache.use_structured_entries true</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="performance-querycache"></a>19.4.&nbsp;Le cache de requ&ecirc;tes
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Les r&eacute;sultats d'une requ&ecirc;te peuvent aussi &ecirc;tre plac&eacute;s en cache. Ceci n'est utile que pour les requ&ecirc;tes qui sont ex&eacute;cut&eacute;es
                  avec les m&ecirc;mes param&egrave;tres. Pour utiliser le cache de requ&ecirc;tes, vous devez d'abord l'activer : 
               </p><pre class="programlisting">hibernate.cache.use_query_cache true</pre><p>Ce param&egrave;tre am&egrave;ne la cr&eacute;ation de deux nouvelles r&eacute;gions dans le cache, une qui va conserver le r&eacute;sultat des requ&ecirc;tes mises
                  en cache (<code class="literal">org.hibernate.cache.StandardQueryCache</code>) et l'autre qui va conserver l'horodatage des mises &agrave; jour les plus r&eacute;centes effectu&eacute;es sur les tables requ&ecirc;tables (<code class="literal">org.hibernate.cache.UpdateTimestampsCache</code>). Il faut noter que le cache de requ&ecirc;te ne conserve pas l'&eacute;tat des entit&eacute;s, il met en cache uniquement les valeurs de l'identifiant
                  et les valeurs de types de base (?). Le cache de requ&ecirc;te doit toujours &ecirc;tre utilis&eacute; avec le cache de second niveau pour &ecirc;tre
                  efficace. 
               </p>
               <p>La plupart des requ&ecirc;tes ne retirent pas de b&eacute;n&eacute;fice pas du cache, donc par d&eacute;faut les requ&ecirc;tes ne sont pas mises en cache.
                  Pour activer le cache, appelez <code class="literal">Query.setCacheable(true)</code>. Cet appel permet de v&eacute;rifier si les r&eacute;sultats sont en cache ou non, voire d'ajouter ces r&eacute;sultats si la requ&ecirc;te est ex&eacute;cut&eacute;e.
                  
               </p>
               <p>Si vous avez besoin de contr&ocirc;ler finement les d&eacute;lais d'expiration du cache, vous pouvez sp&eacute;cifier une r&eacute;gion de cache nomm&eacute;e
                  pour une requ&ecirc;te particuli&egrave;re en appelant <code class="literal">Query.setCacheRegion()</code>. 
               </p><pre class="programlisting">List blogs = sess.createQuery("from Blog blog where blog.blogger = :blogger")
    .setEntity("blogger", blogger)
    .setMaxResults(15)
    .setCacheable(true)
    .setCacheRegion("frontpages")
    .list();</pre><p>Si une requ&ecirc;te doit forcer le rafra&icirc;chissement de sa r&eacute;gion de cache, vous devez appeler <code class="literal">Query.setCacheMode(CacheMode.REFRESH)</code>. C'est particuli&egrave;rement utile lorsque les donn&eacute;es peuvent avoir &eacute;t&eacute; mises &agrave; jour par un processus s&eacute;par&eacute; (e.g. elles n'ont
                  pas &eacute;t&eacute; modifi&eacute;es par Hibernate). Cela permet &agrave; l'application de rafra&icirc;chir de mani&egrave;re s&eacute;lective les r&eacute;sultats d'une requ&ecirc;te
                  particuli&egrave;re. Il s'agit d'une alternative plus efficace &agrave; l'&eacute;viction d'une r&eacute;gion du cache &agrave; l'aide de la m&eacute;thode <code class="literal">SessionFactory.evictQueries()</code>. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="performance-collections"></a>19.5.&nbsp;Comprendre les performances des Collections
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Nous avons d&eacute;j&agrave; pass&eacute; du temps &agrave; discuter des collections. Dans cette section, nous allons traiter du comportement des collections
                  &agrave; l'ex&eacute;cution. 
               </p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-collections-taxonomy"></a>19.5.1.&nbsp;Classification
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Hibernate d&eacute;finit trois types de collections :</p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p>les collections de valeurs</p>
                        </li>
                        <li>
                           <p>les associations un-vers-plusieurs</p>
                        </li>
                        <li>
                           <p>les associations plusieurs-vers-plusieurs</p>
                        </li>
                     </ul>
                  </div>
                  <p>Cette classification distingue les diff&eacute;rentes relations entre les tables et les cl&eacute;s &eacute;trang&egrave;res mais ne nous apprend rien
                     de ce que nous devons savoir sur le mod&egrave;le relationnel. Pour comprendre parfaitement la structure relationnelle et les caract&eacute;ristiques
                     des performances, nous devons consid&eacute;rer la structure de la cl&eacute; primaire qui est utilis&eacute;e par Hibernate pour mettre &agrave; jour
                     ou supprimer les &eacute;l&eacute;ments des collections. Cel&agrave; nous am&egrave;ne aux classifications suivantes : 
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p>collections index&eacute;es</p>
                        </li>
                        <li>
                           <p>sets</p>
                        </li>
                        <li>
                           <p>bags</p>
                        </li>
                     </ul>
                  </div>
                  <p>Toutes les collections index&eacute;es (maps, lists, arrays) ont une cl&eacute; primaire constitu&eacute;e des colonnes cl&eacute; (<code class="literal">&lt;key&gt;</code>) et <code class="literal">&lt;index&gt;</code>. Avec ce type de cl&eacute; primaire, la mise &agrave; jour de collection est en g&eacute;n&eacute;ral tr&egrave;s performante - la cl&eacute; primaire peut &ecirc;tre index&eacute;es
                     efficacement et un &eacute;l&eacute;ment particulier peut &ecirc;tre localis&eacute; efficacement lorsqu'Hibernate essaie de le mettre &agrave; jour ou de le
                     supprimer. 
                  </p>
                  <p>Sets have a primary key consisting of <code class="literal">&lt;key&gt;</code> and element columns. This may be less efficient for some types of collection element, particularly composite elements or
                     large text or binary fields; the database may not be able to index a complex primary key as efficiently. On the other hand,
                     for one to many or many to many associations, particularly in the case of synthetic identifiers, it is likely to be just as
                     efficient. (Side-note: if you want <code class="literal">SchemaExport</code> to actually create the primary key of a <code class="literal">&lt;set&gt;</code> for you, you must declare all columns as <code class="literal">not-null="true"</code>.) 
                  </p>
                  <p>Le mapping &agrave; l'aide d'<code class="literal">&lt;idbag&gt;</code> d&eacute;finit une cl&eacute; de substitution ce qui leur permet d'&ecirc;tre tr&egrave;s efficaces lors de la mise &agrave; jour. En fait il s'agit du meilleur
                     cas de mise &agrave; jour d'une collection 
                  </p>
                  <p>Le pire cas intervient pour les Bags. Dans la mesure o&ugrave; un bag permet la duplications des &eacute;l&eacute;ments et n'a pas de colonne d'index,
                     aucune cl&eacute; primaire ne peut &ecirc;tre d&eacute;finie. Hibernate n'a aucun moyen de distinguer des enregistrements dupliqu&eacute;s. Hibernate
                     r&eacute;sout ce probl&egrave;me en supprimant compl&egrave;tement les enregistrements (via un simple <code class="literal">DELETE</code>), puis en recr&eacute;ant la collection chaque fois qu'elle change. Ce qui peut &ecirc;tre tr&egrave;s inefficace. 
                  </p>
                  <p>Notez que pour une relation un-vers-plusieurs, la "cl&eacute; primaire" peut ne pas &ecirc;tre la cl&eacute; primaire de la table en base de donn&eacute;es
                     - mais m&ecirc;me dans ce cas, la classification ci-dessus reste utile (Elle explique comment Hibernate "localise" chaque enregistrement
                     de la collection). 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-collections-mostefficientupdate"></a>19.5.2.&nbsp;Les lists, les maps, les idbags et les sets sont les collections les plus efficaces pour la mise &agrave; jour
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>La discussion pr&eacute;c&eacute;dente montre clairement que les collections index&eacute;es et (la plupart du temps) les sets, permettent de r&eacute;aliser
                     le plus efficacement les op&eacute;rations d'ajout, de suppression ou de modification d'&eacute;l&eacute;ments. 
                  </p>
                  <p>Il existe un autre avantage qu'ont les collections index&eacute;es sur les Sets dans le cadre d'une association plusieurs vers plusieurs
                     ou d'une collection de valeurs. A cause de la structure inh&eacute;rente d'un <code class="literal">Set</code>, Hibernate n'effectue jamais d'<code class="literal">UPDATE</code> quand un enregistrement est modifi&eacute;. Les modifications apport&eacute;es &agrave; un <code class="literal">Set</code> se font via un <code class="literal">INSERT</code> et <code class="literal">DELETE</code> (de chaque enregistrement). Une fois de plus, ce cas ne s'applique pas aux associations un vers plusieurs. 
                  </p>
                  <p>Apr&egrave;s s'&ecirc;tre rappel&eacute; que les tableaux ne peuvent pas &ecirc;tre charg&eacute;s tardivement, nous pouvons conclure que les lists, les maps
                     et les idbags sont les types de collections (non invers&eacute;es) les plus performants, avec les sets pas loin derri&egrave;res. Les sets
                     son le type de collection le plus courant dans les applications Hibernate. Cela est du au fait que la s&eacute;mantique des "set"
                     est la plus naturelle dans le mod&egrave;le relationnel. 
                  </p>
                  <p>Cependant, dans des mod&egrave;les objet bien con&ccedil;us avec Hibernate, on voit souvent que la plupart des collections sont en fait
                     des associations "un-vers-plusieurs" avec <code class="literal">inverse="true"</code>. Pour ces associations, les mises &agrave; jour sont g&eacute;r&eacute;es au niveau de l'association "plusieurs-vers-un" et les consid&eacute;rations
                     de performance de mise &agrave; jour des collections ne s'appliquent tout simplement pas dans ces cas l&agrave;. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-collections-mostefficentinverse"></a>19.5.3.&nbsp;Les Bags et les lists sont les plus efficaces pour les collections inverse
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Avant que vous n'oubliez les bags pour toujours, il y a un cas pr&eacute;cis o&ugrave; les bags (et les lists) sont bien plus performants
                     que les sets. Pour une collection marqu&eacute;e comme <code class="literal">inverse="true"</code> (le choix le plus courant pour un relation un vers plusieurs bidirectionnelle), nous pouvons ajouter des &eacute;l&eacute;ments &agrave; un bag
                     ou une list sans avoir besoin de l'initialiser (fetch) les &eacute;l&eacute;ments du sac! Ceci parce que <code class="literal">Collection.add()</code> ou <code class="literal">Collection.addAll()</code> doit toujours retourner vrai pour un bag ou une <code class="literal">List</code> (contrairement au <code class="literal">Set</code>). Cela peut rendre le code suivant beaucoup plus rapide. 
                  </p><pre class="programlisting">Parent p = (Parent) sess.load(Parent.class, id);
Child c = new Child();
c.setParent(p);
p.getChildren().add(c);  //no need to fetch the collection!
sess.flush();</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-collections-oneshotdelete"></a>19.5.4.&nbsp;Suppression en un coup
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Parfois, effacer les &eacute;l&eacute;ments d'une collection un par un peut &ecirc;tre extr&ecirc;mement inefficace. Hibernate n'est pas totalement
                     stupide, il sait qu'il ne faut pas le faire dans le cas d'une collection compl&egrave;tement vid&eacute;e (lorsque vous appellez <code class="literal">list.clear()</code>, par exemple). Dans ce cas, Hibernate fera un simple <code class="literal">DELETE</code> et le travail est fait ! 
                  </p>
                  <p>Supposons que nous ajoutions un &eacute;l&eacute;ment dans une collection de taille vingt et que nous enlevions ensuite deux &eacute;l&eacute;ments. Hibernate
                     effectuera un <code class="literal">INSERT</code> puis deux <code class="literal">DELETE</code> (&agrave; moins que la collection ne soit un bag). Ce qui est souhaitable. 
                  </p>
                  <p>Cependant, supposons que nous enlevions dix huit &eacute;l&eacute;ments, laissant ainsi deux &eacute;l&eacute;ments, puis que nous ajoutions trois nouveaux
                     &eacute;l&eacute;ments. Il y a deux moyens de proc&eacute;der. 
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p>effacer dix huit enregistrements un &agrave; un puis en ins&eacute;rer trois</p>
                        </li>
                        <li>
                           <p>effacer la totalit&eacute; de la collection (en un <code class="literal">DELETE</code> SQL) puis ins&eacute;rer les cinq &eacute;l&eacute;ments restant un &agrave; un
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>Hibernate n'est pas assez intelligent pour savoir que, dans ce cas, la seconde m&eacute;thode est plus rapide (Il plut&ocirc;t heureux
                     qu'Hibernate ne soit pas trop intelligent ; un tel comportement pourrait rendre l'utilisation de triggers de bases de donn&eacute;es
                     plut&ocirc;t al&eacute;atoire, etc...). 
                  </p>
                  <p>Heureusement, vous pouvez forcer ce comportement lorsque vous le souhaitez, en liberant (c'est-&agrave;-dire en d&eacute;r&eacute;f&eacute;ren&ccedil;ant) la
                     collection initiale et en retournant une collection nouvellement instanci&eacute;e avec les &eacute;l&eacute;ments restants. Ceci peut &ecirc;tre tr&egrave;s
                     pratique et tr&egrave;s puissant de temps en temps. 
                  </p>
                  <p>Bien s&ucirc;r, la suppression en un coup ne s'applique pas pour les collections qui sont mapp&eacute;es avec <code class="literal">inverse="true"</code>. 
                  </p>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="performance-monitoring"></a>19.6.&nbsp;Moniteur de performance
                        </h2>
                     </div>
                  </div>
               </div>
               <p>L'optimisation n'est pas d'un grand int&eacute;r&ecirc;t sans le suivi et l'acc&egrave;s aux donn&eacute;es de performance. Hibernate fournit toute une
                  panoplie de rapport sur ses op&eacute;rations internes. Les statistiques dans Hibernate sont fournies par <code class="literal">SessionFactory</code>. 
               </p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-monitoring-sf"></a>19.6.1.&nbsp;Suivi d'une SessionFactory
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Vous pouvez acc&eacute;der au m&eacute;triques d'une <code class="literal">SessionFactory</code> de deux mani&egrave;res. La premi&egrave;re option est d'appeler <code class="literal">sessionFactory.getStatistics()</code> et de lire ou d'afficher les <code class="literal">Statistics</code> vous m&ecirc;me. 
                  </p>
                  <p>Hibernate peut &eacute;galement utiliser JMX pour publier les m&eacute;triques si vous activez le MBean <code class="literal">StatisticsService</code>. Vous pouvez activer un seul MBean pour toutes vos <code class="literal">SessionFactory</code> ou un par factory. Voici un code qui montre un exemple de configuration minimaliste : 
                  </p><pre class="programlisting">// MBean service registration for a specific SessionFactory
Hashtable tb = new Hashtable();
tb.put("type", "statistics");
tb.put("sessionFactory", "myFinancialApp");
ObjectName on = new ObjectName("hibernate", tb); // MBean object name

StatisticsService stats = new StatisticsService(); // MBean implementation
stats.setSessionFactory(sessionFactory); // Bind the stats to a SessionFactory
server.registerMBean(stats, on); // Register the Mbean on the server</pre><pre class="programlisting">// MBean service registration for all SessionFactory's
Hashtable tb = new Hashtable();
tb.put("type", "statistics");
tb.put("sessionFactory", "all");
ObjectName on = new ObjectName("hibernate", tb); // MBean object name

StatisticsService stats = new StatisticsService(); // MBean implementation
server.registerMBean(stats, on); // Register the MBean on the server</pre><p>TODO: Cela n'a pas de sens : dans le premier cs on r&eacute;cup&egrave;re et on utilise le MBean directement. Dans le second, on doit fournir
                     le nom JNDI sous lequel est retenu la fabrique de session avant de l'utiliser. Pour cela il faut utiliser <code class="literal">hibernateStatsBean.setSessionFactoryJNDIName("my/JNDI/Name")</code> 
                  </p>
                  <p>Vous pouvez (d&eacute;s)activer le suivi pour une <code class="literal">SessionFactory</code> 
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p>au moment de la configuration en mettant <code class="literal">hibernate.generate_statistics</code> &agrave; <code class="literal">false</code> 
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p>&agrave; chaud avec <code class="literal">sf.getStatistics().setStatisticsEnabled(true)</code> ou <code class="literal">hibernateStatsBean.setStatisticsEnabled(true)</code> 
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>Statistics can be reset programmatically using the <code class="literal">clear()</code> method. A summary can be sent to a logger (info level) using the <code class="literal">logSummary()</code> method. 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="performance-monitoring-metrics"></a>19.6.2.&nbsp;M&eacute;triques
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Hibernate fournit un certain nombre de m&eacute;triques, qui vont des informations tr&egrave;s basiques aux informations tr&egrave;s sp&eacute;cialis&eacute;es
                     qui ne sont appropri&eacute;es que dans certains scenarii. Tous les compteurs accessibles sont d&eacute;crits dans l'API de l'interface
                     <code class="literal">Statistics</code> dans trois cat&eacute;gories : 
                  </p>
                  <div class="itemizedlist">
                     <ul type="disc">
                        <li>
                           <p>Les m&eacute;triques relatives &agrave; l'usage g&eacute;n&eacute;ral de la <code class="literal">Session</code> comme le nombre de sessions ouvertes, le nombre de connexions JDBC r&eacute;cup&eacute;r&eacute;es, etc... 
                           </p>
                        </li>
                        <li>
                           <p>Les m&eacute;triques relatives aux entit&eacute;s, collections, requ&ecirc;tes et caches dans leur ensemble (m&eacute;triques globales), </p>
                        </li>
                        <li>
                           <p>Les m&eacute;triques d&eacute;taill&eacute;es relatives &agrave; une entit&eacute;, une collection, une requ&ecirc;te ou une r&eacute;gion de cache particuli&egrave;re. </p>
                        </li>
                     </ul>
                  </div>
                  <p>For example, you can check the cache hit, miss, and put ratio of entities, collections and queries, and the average time a
                     query needs. Beware that the number of milliseconds is subject to approximation in Java. Hibernate is tied to the JVM precision,
                     on some platforms this might even only be accurate to 10 seconds. 
                  </p>
                  <p>Des accesseurs simples sont utilis&eacute;s pour acc&eacute;der aux m&eacute;triques globales (e.g. celles qui ne sont pas li&eacute;es &agrave; une entit&eacute;,
                     collection ou r&eacute;gion de cache particuli&egrave;re). Vous pouvez acc&eacute;der aux m&eacute;triques d'une entit&eacute;, collection, r&eacute;gion de cache particuli&egrave;re
                     &agrave; l'aide de son nom et &agrave; l'aide de sa repr&eacute;sentation HQL ou SQL pour une requ&ecirc;te. R&eacute;f&eacute;rez vous &agrave; la javadoc des APIS <code class="literal">Statistics</code>, <code class="literal">EntityStatistics</code>, <code class="literal">CollectionStatistics</code>, <code class="literal">SecondLevelCacheStatistics</code>, and <code class="literal">QueryStatistics</code> pour plus d'informations. Le code ci-dessous montre un exemple simple : 
                  </p><pre class="programlisting">Statistics stats = HibernateUtil.sessionFactory.getStatistics();

double queryCacheHitCount  = stats.getQueryCacheHitCount();
double queryCacheMissCount = stats.getQueryCacheMissCount();
double queryCacheHitRatio =
  queryCacheHitCount / (queryCacheHitCount + queryCacheMissCount);

log.info("Query Hit ratio:" + queryCacheHitRatio);

EntityStatistics entityStats =
  stats.getEntityStatistics( Cat.class.getName() );
long changes =
        entityStats.getInsertCount()
        + entityStats.getUpdateCount()
        + entityStats.getDeleteCount();
log.info(Cat.class.getName() + " changed " + changes + "times"  );</pre><p>Pour travailler sur toutes les entit&eacute;s, collections, requ&ecirc;tes et r&eacute;gions de cache, vous pouvez r&eacute;cup&eacute;rer la liste des noms
                     des entit&eacute;s, collections, requ&ecirc;tes et r&eacute;gions de cache avec les m&eacute;thodes : <code class="literal">getQueries()</code>, <code class="literal">getEntityNames()</code>, <code class="literal">getCollectionRoleNames()</code>, et <code class="literal">getSecondLevelCacheRegionNames()</code>. 
                  </p>
               </div>
            </div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="toolsetguide"></a>Chapitre&nbsp;20.&nbsp;Guide des outils
                     </h2>
                  </div>
               </div>
            </div>
            <p>Des outils en ligne de commande, des plugins Eclipse ainsu que des t&acirc;ches Ant permettent de g&eacute;rer de cycles de d&eacute;veloppement
               complet de projets utilisant Hibernate. 
            </p>
            <p>Les <span class="emphasis"><em>outils Hibernate</em></span> actuels incluent des plugins pour l'IDE Eclipse ainsi que des t&acirc;ches Ant pour l'ing&eacute;nierie inverse de bases de donn&eacute;es existantes
               : 
            </p>
            <div class="itemizedlist">
               <ul type="disc">
                  <li>
                     <p><span class="emphasis"><em>Mapping Editor :</em></span> un &eacute;diteur pour les fichiers de mapping XML Hibernate, supportant l'auto-compl&eacute;tion et la mise en valeur de la syntaxe. Il
                        supporte aussi l'auto-compl&eacute;tion automatique pour les noms de classes et les noms de propri&eacute;t&eacute;/champ, le rendant beaucoup
                        plus polyvalent qu'un &eacute;diteurXML normal. 
                     </p>
                  </li>
                  <li>
                     <p><span class="emphasis"><em>Console :</em></span> la console est une nouvelle vue d'Eclipse. En plus de la vue d'ensemble arborescente de vos configurations de console, vous
                        obtenez aussi une vue interactive de vos classes persistantes et de leurs relations. La console vous permet d'ex&eacute;cuter des
                        requ&ecirc;te HQL dans votre base de donn&eacute;es et de parcourir les r&eacute;sultats directement dans Eclipse. 
                     </p>
                  </li>
                  <li>
                     <p><span class="emphasis"><em>Development Wizards :</em></span> plusieurs assistants sont fournis avec les outils d'Hibernate pour Eclipse ; vous pouvez utiliser un assistant pour g&eacute;n&eacute;rer
                        rapidement les fichiers de configuration d'Hibernate (cfg.xml), ou vous pouvez m&ecirc;me compl&egrave;tement g&eacute;n&eacute;rer les fichiers de mapping
                        Hibernate et les sources des POJOs &agrave; partir d'un sch&eacute;ma de base de donn&eacute;es existant. L'assistant d'ing&eacute;nierie inverse supporte
                        les mod&egrave;les utilisateur. 
                     </p>
                  </li>
                  <li>
                     <p>
                        <span class="emphasis"><em>T&acirc;ches Ant :</em></span>
                        
                     </p>
                  </li>
               </ul>
            </div>
            <p>Veuillez-vous r&eacute;f&eacute;rer au paquet <span class="emphasis"><em>outils Hibernate</em></span> et sa documentation pour plus d'informations. 
            </p>
            <p>Pourtant, le paquet principal d'Hibernate arrive avec un lot d'outils int&eacute;gr&eacute;s (il peut m&ecirc;me &ecirc;tre utilis&eacute; de "l'int&eacute;rieur"
               d'Hibernate &agrave; la vol&eacute;e) : <span class="emphasis"><em>SchemaExport</em></span> aussi connu comme <code class="literal">hbm2ddl</code>. 
            </p>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="toolsetguide-s1"></a>20.1.&nbsp;G&eacute;n&eacute;ration automatique du sch&eacute;ma
                        </h2>
                     </div>
                  </div>
               </div>
               <p>La DDL peut &ecirc;tre g&eacute;n&eacute;r&eacute;e &agrave; partir de vos fichiers de mapping par un utilitaire d'Hibernate. Le sch&eacute;ma g&eacute;n&eacute;r&eacute; inclut les contraintes
                  d'int&eacute;grit&eacute; r&eacute;f&eacute;rentielle (clefs primaires et &eacute;trang&egrave;res) pour les tables d'entit&eacute;s et de collections. Les tables et les s&eacute;quences
                  sont aussi cr&eacute;&eacute;es pour les g&eacute;n&eacute;rateurs d'identifiant mapp&eacute;s. 
               </p>
               <p>Vous <span class="emphasis"><em>devez</em></span> sp&eacute;cifier un <code class="literal">Dialect</code> SQL via la propri&eacute;t&eacute; <code class="literal">hibernate.dialect</code> lors de l'utilisation de cet outils, puisque la DDL est fortement d&eacute;pendante de la base de donn&eacute;es. 
               </p>
               <p>D'abord, personnalisez vos fichiers de mapping pour am&eacute;liorer le sch&eacute;ma g&eacute;n&eacute;r&eacute;. </p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="toolsetguide-s1-2"></a>20.1.1.&nbsp;Personnaliser le sch&eacute;ma
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Plusieurs &eacute;l&eacute;ments du mapping hibernate d&eacute;finissent des attributs optionnels nomm&eacute;s <code class="literal">length</code>, <code class="literal">precision</code> et <code class="literal">scale</code>. Vous pouvez param&eacute;trer la longueur, la pr&eacute;cision,... d'une colonne avec ces attributs. 
                  </p><pre class="programlisting">&lt;property name="zip" length="5"/&gt;</pre><pre class="programlisting">&lt;property name="balance" precision="12" scale="2"/&gt;</pre><p>Certains &eacute;l&eacute;ments acceptent aussi un attribut <code class="literal">not-null</code> (utilis&eacute; pour g&eacute;n&eacute;rer les contraintes de colonnes <code class="literal">NOT NULL</code>) et un attribut <code class="literal">unique</code> (pour g&eacute;n&eacute;rer une contrainte de colonne <code class="literal">UNIQUE</code>). 
                  </p><pre class="programlisting">&lt;many-to-one name="bar" column="barId" not-null="true"/&gt;</pre><pre class="programlisting">&lt;element column="serialNumber" type="long" not-null="true" unique="true"/&gt;</pre><p>Un attribut <code class="literal">unique-key</code> peut &ecirc;tre utilis&eacute; pour grouper les colonnes en une seule contrainte d'unicit&eacute;. Actuellement, la valeur sp&eacute;cifi&eacute;e par l'attribut
                     <code class="literal">unique-key</code> n'est <span class="emphasis"><em>pas</em></span> utilis&eacute;e pour nommer la contrainte dans le DDL g&eacute;n&eacute;r&eacute;, elle sert juste &agrave; grouper les colonnes dans le fichier de mapping.
                     
                  </p><pre class="programlisting">&lt;many-to-one name="org" column="orgId" unique-key="OrgEmployeeId"/&gt;
&lt;property name="employeeId" unique-key="OrgEmployee"/&gt;</pre><p>Un attribut <code class="literal">index</code> indique le nom d'un index qui sera cr&eacute;&eacute; en utilisant la ou les colonnes mapp&eacute;es. Plusieurs colonnes peuvent &ecirc;tre group&eacute;es
                     dans un m&ecirc;me index, en sp&eacute;cifiant le m&ecirc;me nom d'index. 
                  </p><pre class="programlisting">&lt;property name="lastName" index="CustName"/&gt;
&lt;property name="firstName" index="CustName"/&gt;</pre><p>Un attribut <code class="literal">foreign-key</code> peut &ecirc;tre utilis&eacute; pour surcharger le nom des cl&eacute;s &eacute;trang&egrave;res g&eacute;n&eacute;r&eacute;es. 
                  </p><pre class="programlisting">&lt;many-to-one name="bar" column="barId" foreign-key="FKFooBar"/&gt;</pre><p>Plusieurs &eacute;l&eacute;ments de mapping acceptent aussi un &eacute;l&eacute;ment fils <code class="literal">&lt;column&gt;</code>. Ceci est utile pour les type multi-colonnes: 
                  </p><pre class="programlisting">&lt;property name="name" type="my.customtypes.Name"/&gt;
    &lt;column name="last" not-null="true" index="bar_idx" length="30"/&gt;
    &lt;column name="first" not-null="true" index="bar_idx" length="20"/&gt;
    &lt;column name="initial"/&gt;
&lt;/property&gt;</pre><p>L'attribut <code class="literal">default</code> vous laisse sp&eacute;cifier une valeur par d&eacute;faut pour une colonnes (vous devriez assigner la m&ecirc;me valeur &agrave; la propri&eacute;t&eacute; mapp&eacute;e
                     avant de sauvegarder une nouvelle instance de la classe mapp&eacute;e). 
                  </p><pre class="programlisting">&lt;property name="credits" type="integer" insert="false"&gt;
    &lt;column name="credits" default="10"/&gt;
&lt;/property&gt;</pre><pre class="programlisting">&lt;version name="version" type="integer" insert="false"&gt;
    &lt;column name="version" default="0"/&gt;
&lt;/property&gt;</pre><p>L'attribut <code class="literal">sql-type</code> laisse l'utilisateur surcharger le mapping par d&eacute;faut du type Hibernate vers un type SQL. 
                  </p><pre class="programlisting">&lt;property name="balance" type="float"&gt;
    &lt;column name="balance" sql-type="decimal(13,3)"/&gt;
&lt;/property&gt;</pre><p>L'attribut <code class="literal">check</code> permet de sp&eacute;cifier une contrainte de v&eacute;rification. 
                  </p><pre class="programlisting">&lt;property name="foo" type="integer"&gt;
    &lt;column name="foo" check="foo &gt; 10"/&gt;
&lt;/property&gt;</pre><pre class="programlisting">&lt;class name="Foo" table="foos" check="bar &lt; 100.0"&gt;
    ...
    &lt;property name="bar" type="float"/&gt;
&lt;/class&gt;</pre><div class="table"><a name="schemattributes-summary"></a><p class="title"><b>Tableau&nbsp;20.1.&nbsp;Summary</b></p>
                     <div class="table-contents">
                        <table summary="Summary" border="1">
                           <colgroup>
                              <col>
                              <col>
                              <col>
                           </colgroup>
                           <thead>
                              <tr>
                                 <th>Attribut</th>
                                 <th>Valeur</th>
                                 <th>Interpr&eacute;tation</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr>
                                 <td><code class="literal">length</code></td>
                                 <td>num&eacute;rique</td>
                                 <td>taille d'une colonne</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">precision</code></td>
                                 <td>num&eacute;rique</td>
                                 <td>pr&eacute;cision d&eacute;cimale de la colonne</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">scale</code></td>
                                 <td>num&eacute;rique</td>
                                 <td>scale d&eacute;cimale de la colonne</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">not-null</code></td>
                                 <td><code class="literal">true|false</code></td>
                                 <td>sp&eacute;cifie que la colonne doit &ecirc;tre non-nulle</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">unique</code></td>
                                 <td><code class="literal">true|false</code></td>
                                 <td>sp&eacute;cifie que la colonne doit avoir une contrainte d'unicit&eacute;</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">index</code></td>
                                 <td><code class="literal">index_name</code></td>
                                 <td>sp&eacute;cifie le nom d'un index (multi-colonnes)</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">unique-key</code></td>
                                 <td><code class="literal">unique_key_name</code></td>
                                 <td>sp&eacute;cifie le nom d'une contrainte d'unicit&eacute; multi-colonnes</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">foreign-key</code></td>
                                 <td><code class="literal">foreign_key_name</code></td>
                                 <td>specifies the name of the foreign key constraint generated for an association, for a <code class="literal">&lt;one-to-one&gt;</code>, <code class="literal">&lt;many-to-one&gt;</code>, <code class="literal">&lt;key&gt;</code>, or <code class="literal">&lt;many-to-many&gt;</code> mapping element. Note that <code class="literal">inverse="true"</code> sides will not be considered by <code class="literal">SchemaExport</code>. 
                                 </td>
                              </tr>
                              <tr>
                                 <td><code class="literal">sql-type</code></td>
                                 <td><code class="literal">SQL column_type</code></td>
                                 <td>overrides the default column type (attribute of <code class="literal">&lt;column&gt;</code> element only) 
                                 </td>
                              </tr>
                              <tr>
                                 <td><code class="literal">default</code></td>
                                 <td>SQL expression</td>
                                 <td>sp&eacute;cifie une valeur par d&eacute;faut pour la colonne </td>
                              </tr>
                              <tr>
                                 <td><code class="literal">check</code></td>
                                 <td>SQL expression</td>
                                 <td>cr&eacute;e une contrainte de v&eacute;rification sur la table ou la colonne </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                  </div><br class="table-break"><p>L'&eacute;l&eacute;ment <code class="literal">&lt;comment&gt;</code> vous permet de sp&eacute;cifier un commentaire pour le sch&eacute;ma g&eacute;n&eacute;r&eacute;. 
                  </p><pre class="programlisting">&lt;class name="Customer" table="CurCust"&gt;
    &lt;comment&gt;Current customers only&lt;/comment&gt;
    ...
&lt;/class&gt;</pre><pre class="programlisting">&lt;property name="balance"&gt;
    &lt;column name="bal"&gt;
        &lt;comment&gt;Balance in USD&lt;/comment&gt;
    &lt;/column&gt;
&lt;/property&gt;</pre><p>Ceci a pour r&eacute;sultat une expression <code class="literal">comment on table</code> ou <code class="literal">comment on column</code> dans la DDL g&eacute;n&eacute;r&eacute;e (o&ugrave; support&eacute;e). 
                  </p>
               </div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="toolsetguide-s1-3"></a>20.1.2.&nbsp;Ex&eacute;cuter l'outil
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>L'outil <code class="literal">SchemaExport</code> g&eacute;n&egrave;re un script DDL vers la sortie standard et/ou ex&eacute;cute les ordres DDL. 
                  </p>
                  <p><code class="literal">java -cp </code><span class="emphasis"><em>hibernate_classpaths</em></span> <code class="literal">org.hibernate.tool.hbm2ddl.SchemaExport</code> <span class="emphasis"><em>options mapping_files</em></span> 
                  </p>
                  <div class="table"><a name="d0e15502"></a><p class="title"><b>Tableau&nbsp;20.2.&nbsp;<code class="literal">SchemaExport</code> Options de la ligne de commande</b></p>
                     <div class="table-contents">
                        <table summary="SchemaExport Options de la ligne de commande" border="1">
                           <colgroup>
                              <col>
                              <col>
                           </colgroup>
                           <thead>
                              <tr>
                                 <th>Option</th>
                                 <th>Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr>
                                 <td><code class="literal">--quiet</code></td>
                                 <td>don't output the script to stdout</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">--drop</code></td>
                                 <td>supprime seuleument les tables</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">--create</code></td>
                                 <td>ne cr&eacute;&eacute; que les tables</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">--text</code></td>
                                 <td>ne pas ex&eacute;cuter sur la base de donn&eacute;es</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">--output=my_schema.ddl</code></td>
                                 <td>&eacute;crit le script ddl vers un fichier</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">--naming=eg.MyNamingStrategy</code></td>
                                 <td>select a <code class="literal">NamingStrategy</code></td>
                              </tr>
                              <tr>
                                 <td><code class="literal">--config=hibernate.cfg.xml</code></td>
                                 <td>lit la configuration Hibernate &agrave; partir d'un fichier XML</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">--properties=hibernate.properties</code></td>
                                 <td>read database properties from a file</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">--format</code></td>
                                 <td>formatte proprement le SQL g&eacute;n&eacute;r&eacute; dans le script</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">--delimiter=x</code></td>
                                 <td>param&egrave;tre un d&eacute;limiteur de fin de ligne pour le script</td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                  </div><br class="table-break"><p>Vous pouvez m&ecirc;me int&eacute;grer <code class="literal">SchemaExport</code> dans votre application : 
                  </p><pre class="programlisting">Configuration cfg = ....;
new SchemaExport(cfg).create(false, true);</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="toolsetguide-s1-4"></a>20.1.3.&nbsp;Propri&eacute;t&eacute;s
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Les propri&eacute;t&eacute;s de la base de donn&eacute;es peuvent &ecirc;tre sp&eacute;cifi&eacute;es </p>
                  <div class="itemizedlist">
                     <ul type="disc" compact>
                        <li>
                           <p>comme propri&eacute;t&eacute;s syst&egrave;me avec <code class="literal">-D</code><span class="emphasis"><em>&lt;property&gt;</em></span></p>
                        </li>
                        <li>
                           <p>dans <code class="literal">hibernate.properties</code></p>
                        </li>
                        <li>
                           <p>dans un fichier de propri&eacute;t&eacute;s d&eacute;clar&eacute; avec <code class="literal">--properties</code></p>
                        </li>
                     </ul>
                  </div>
                  <p>Les propri&eacute;t&eacute;s n&eacute;cessaires sont : </p>
                  <div class="table"><a name="d0e15611"></a><p class="title"><b>Tableau&nbsp;20.3.&nbsp;SchemaExport Connection Properties</b></p>
                     <div class="table-contents">
                        <table summary="SchemaExport Connection Properties" border="1">
                           <colgroup>
                              <col>
                              <col>
                           </colgroup>
                           <thead>
                              <tr>
                                 <th>Nom de la propri&eacute;t&eacute;</th>
                                 <th>Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr>
                                 <td><code class="literal">hibernate.connection.driver_class</code></td>
                                 <td>classe du driver JDBC</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">hibernate.connection.url</code></td>
                                 <td>URL JDBC</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">hibernate.connection.username</code></td>
                                 <td>utilisateur de la base de donn&eacute;es</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">hibernate.connection.password</code></td>
                                 <td>mot de passe de l'utilisateur</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">hibernate.dialect</code></td>
                                 <td>dialecte</td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                  </div><br class="table-break"></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="toolsetguide-s1-5"></a>20.1.4.&nbsp;Utiliser Ant
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Vous pouvez appeler <code class="literal">SchemaExport</code> depuis votre script de construction Ant : 
                  </p><pre class="programlisting">&lt;target name="schemaexport"&gt;
    &lt;taskdef name="schemaexport"
        classname="org.hibernate.tool.hbm2ddl.SchemaExportTask"
        classpathref="class.path"/&gt;
    
    &lt;schemaexport
        properties="hibernate.properties"
        quiet="no"
        text="no"
        drop="no"
        delimiter=";"
        output="schema-export.sql"&gt;
        &lt;fileset dir="src"&gt;
            &lt;include name="**/*.hbm.xml"/&gt;
        &lt;/fileset&gt;
    &lt;/schemaexport&gt;
&lt;/target&gt;</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="toolsetguide-s1-6"></a>20.1.5.&nbsp;Mises &agrave; jour incr&eacute;mentales du sch&eacute;ma
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>L'outil <code class="literal">SchemaUpdate</code> mettra &agrave; jour un sch&eacute;ma existant en effectuant les changement par "incr&eacute;ment". Notez que <code class="literal">SchemaUpdate</code> d&eacute;pends beaucoup de l'API JDBC metadata, il ne fonctionnera donc pas avec tous les drivers JDBC. 
                  </p>
                  <p><code class="literal">java -cp </code><span class="emphasis"><em>hibernate_classpaths</em></span> <code class="literal">org.hibernate.tool.hbm2ddl.SchemaUpdate</code> <span class="emphasis"><em>options mapping_files</em></span> 
                  </p>
                  <div class="table"><a name="d0e15687"></a><p class="title"><b>Tableau&nbsp;20.4.&nbsp;<code class="literal">SchemaUpdate</code> Options de ligne de commande</b></p>
                     <div class="table-contents">
                        <table summary="SchemaUpdate Options de ligne de commande" border="1">
                           <colgroup>
                              <col>
                              <col>
                           </colgroup>
                           <thead>
                              <tr>
                                 <th>Option</th>
                                 <th>Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr>
                                 <td><code class="literal">--quiet</code></td>
                                 <td>don't output the script to stdout</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">--text</code></td>
                                 <td>ne pas exporter vers la base de donn&eacute;es</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">--naming=eg.MyNamingStrategy</code></td>
                                 <td>select a <code class="literal">NamingStrategy</code></td>
                              </tr>
                              <tr>
                                 <td><code class="literal">--properties=hibernate.properties</code></td>
                                 <td>read database properties from a file</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">--config=hibernate.cfg.xml</code></td>
                                 <td>specify a <code class="literal">.cfg.xml</code> file
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                  </div><br class="table-break"><p>Vous pouvez int&eacute;grer <code class="literal">SchemaUpdate</code> dans votre application : 
                  </p><pre class="programlisting">Configuration cfg = ....;
new SchemaUpdate(cfg).execute(false);</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="toolsetguide-s1-7"></a>20.1.6.&nbsp;Utiliser Ant pour des mises &agrave; jour de sch&eacute;ma par incr&eacute;ment
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Vous pouvez appeler <code class="literal">SchemaUpdate</code> depuis le script Ant : 
                  </p><pre class="programlisting">&lt;target name="schemaupdate"&gt;
    &lt;taskdef name="schemaupdate"
        classname="org.hibernate.tool.hbm2ddl.SchemaUpdateTask"
        classpathref="class.path"/&gt;
    
    &lt;schemaupdate
        properties="hibernate.properties"
        quiet="no"&gt;
        &lt;fileset dir="src"&gt;
            &lt;include name="**/*.hbm.xml"/&gt;
        &lt;/fileset&gt;
    &lt;/schemaupdate&gt;
&lt;/target&gt;</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="toolsetguide-s1-8"></a>20.1.7.&nbsp;Validation du sch&eacute;ma
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>L'outil <code class="literal">SchemaValidator</code> validera que le sch&eacute;ma existant correspond &agrave; vos documents de mapping. Notez que le <code class="literal">SchemaValidator</code> d&eacute;pends de l'API metadata de JDBC, il ne fonctionnera donc pas avec tous les drivers JDBC. Cet outil est extr&ecirc;mement utile
                     pour tester. 
                  </p>
                  <p><code class="literal">java -cp </code><span class="emphasis"><em>hibernate_classpaths</em></span> <code class="literal">org.hibernate.tool.hbm2ddl.SchemaValidator</code> <span class="emphasis"><em>options mapping_files</em></span> 
                  </p>
                  <div class="table"><a name="d0e15777"></a><p class="title"><b>Tableau&nbsp;20.5.&nbsp;<code class="literal">SchemaValidator</code> Options de ligne de commande</b></p>
                     <div class="table-contents">
                        <table summary="SchemaValidator Options de ligne de commande" border="1">
                           <colgroup>
                              <col>
                              <col>
                           </colgroup>
                           <thead>
                              <tr>
                                 <th>Option</th>
                                 <th>Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr>
                                 <td><code class="literal">--naming=eg.MyNamingStrategy</code></td>
                                 <td>select a <code class="literal">NamingStrategy</code></td>
                              </tr>
                              <tr>
                                 <td><code class="literal">--properties=hibernate.properties</code></td>
                                 <td>read database properties from a file</td>
                              </tr>
                              <tr>
                                 <td><code class="literal">--config=hibernate.cfg.xml</code></td>
                                 <td>specify a <code class="literal">.cfg.xml</code> file
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                  </div><br class="table-break"><p>Vous pouvez inclure <code class="literal">SchemaValidator</code> dans votre application: 
                  </p><pre class="programlisting">Configuration cfg = ....;
new SchemaValidator(cfg).validate();</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="toolsetguide-s1-9"></a>20.1.8.&nbsp;Utiliser Ant pour la validation du Sch&eacute;ma
                           </h3>
                        </div>
                     </div>
                  </div>
                  <p>Vous pouvez appeler <code class="literal">SchemaValidator</code> depuis le script Ant: 
                  </p><pre class="programlisting">&lt;target name="schemavalidate"&gt;
    &lt;taskdef name="schemavalidator"
        classname="org.hibernate.tool.hbm2ddl.SchemaValidatorTask"
        classpathref="class.path"/&gt;
    
    &lt;schemavalidator
        properties="hibernate.properties"&gt;
        &lt;fileset dir="src"&gt;
            &lt;include name="**/*.hbm.xml"/&gt;
        &lt;/fileset&gt;
    &lt;/schemavalidator&gt;
&lt;/target&gt;</pre></div>
            </div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="example-parentchild"></a>Chapitre&nbsp;21.&nbsp;Exemple : P&egrave;re/Fils
                     </h2>
                  </div>
               </div>
            </div>
            <p>L'une des premi&egrave;res choses que les nouveaux utilisateurs essaient de faire avec Hibernate est de mod&eacute;liser une relation p&egrave;re/fils.
               Il y a deux approches diff&eacute;rentes pour cela. Pour un certain nombre de raisons, la m&eacute;thode la plus courante, en particulier
               pour les nouveaux utilisateurs, est de mod&eacute;liser les deux relations <code class="literal">P&egrave;re</code> et <code class="literal">Fils</code> comme des classes entit&eacute;s li&eacute;es par une association <code class="literal">&lt;one-to-many&gt;</code> du <code class="literal">P&egrave;re</code> vers le <code class="literal">Fils</code> (l'autre approche est de d&eacute;clarer le <code class="literal">Fils</code> comme un <code class="literal">&lt;composite-element&gt;</code>). Il est &eacute;vident que le sens de l'association un vers plusieurs (dans Hibernate) est bien moins proche du sens habituel d'une
               relation p&egrave;re/fils que ne l'est celui d'un &eacute;l&eacute;ment cmposite. Nous allons vous expliquer comment utiliser une association <span class="emphasis"><em>un vers plusieurs bidirectionnelle avec cascade</em></span> afin de mod&eacute;liser efficacement et &eacute;l&eacute;gamment une relation p&egrave;re/fils, ce n'est vraiment pas difficile ! 
            </p>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="example-parentchild-collections"></a>21.1.&nbsp;Une note &agrave; propos des collections
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Les collections Hibernate sont consid&eacute;r&eacute;es comme &eacute;tant une partie logique de l'entit&eacute; dans laquelle elles sont contenues ;
                  jamais des entit&eacute;s qu'elle contient. C'est une distinction crutiale ! Les cons&eacute;quences sont les suivantes : 
               </p>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        <p>Quand nous ajoutons / retirons un objet d'une collection, le num&eacute;ro de version du propri&eacute;taire de la collection est incr&eacute;ment&eacute;.
                           
                        </p>
                     </li>
                     <li>
                        <p>Si un objet qui a &eacute;t&eacute; enlev&eacute; d'une collection est une instance de type valeur (ex : &eacute;l&eacute;ment composite), cet objet cessera
                           d'&ecirc;tre persistant et son &eacute;tat sera compl&egrave;tement effac&eacute; de la base de donn&eacute;es. Par ailleurs, ajouter une instance de type valeur
                           dans une collection aura pour cons&eacute;quence que son &eacute;tat sera imm&eacute;diatement persistant. 
                        </p>
                     </li>
                     <li>
                        <p>Si une entit&eacute; est enlev&eacute;e d'une collection (association un-vers-plusieurs ou plusieurs-vers-plusieurs), par d&eacute;faut, elle ne
                           sera pas effac&eacute;e. Ce comportement est compl&egrave;tement logique - une modification de l'un des &eacute;tats internes d'une entit&eacute; ne doit
                           pas causer la disparition de l'entit&eacute; associ&eacute;e ! De m&ecirc;me, l'ajout d'une entit&eacute; dans une collection n'engendre pas, par d&eacute;faut,
                           la persistance de cette entit&eacute;. 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Le comportement par d&eacute;faut est donc que l'ajout d'une entit&eacute; dans une collection cr&eacute;&eacute; simplement le lien entre les deux entit&eacute;s,
                  et qu'effacer une entit&eacute; supprime ce lien. C'est le comportement le plus appropri&eacute; dans la plupart des cas. Ce comportement
                  n'est cependant pas appropri&eacute; lorsque la vie du fils est li&eacute;e au cycle de vie du p&egrave;re. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="example-parentchild-bidir"></a>21.2.&nbsp;un-vers-plusieurs bidirectionnel
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Supposons que nous ayons une simple association <code class="literal">&lt;one-to-many&gt;</code> de <code class="literal">Parent</code> vers <code class="literal">Child</code>. 
               </p><pre class="programlisting">&lt;set name="children"&gt;
    &lt;key column="parent_id"/&gt;
    &lt;one-to-many class="Child"/&gt;
&lt;/set&gt;</pre><p>Si nous executions le code suivant </p><pre class="programlisting">Parent p = .....;
Child c = new Child();
p.getChildren().add(c);
session.save(c);
session.flush();</pre><p>Hibernate ex&eacute;cuterait deux ordres SQL: </p>
               <div class="itemizedlist">
                  <ul type="disc">
                     <li>
                        <p>un <code class="literal">INSERT</code> pour cr&eacute;er l'enregistrement pour <code class="literal">c</code></p>
                     </li>
                     <li>
                        <p>un <code class="literal">UPDATE</code> pour cr&eacute;er le lien de <code class="literal">p</code> vers <code class="literal">c</code> 
                        </p>
                     </li>
                  </ul>
               </div>
               <p>Ceci est non seuleument inefficace, mais viole aussi toute contrainte <code class="literal">NOT NULL</code> sur la colonne <code class="literal">parent_id</code>. Nous pouvons r&eacute;parer la contrainte de nullit&eacute; en sp&eacute;cifiant <code class="literal">not-null="true"</code> dans le mapping de la collection : 
               </p><pre class="programlisting">&lt;set name="children"&gt;
    &lt;key column="parent_id" not-null="true"/&gt;
    &lt;one-to-many class="Child"/&gt;
&lt;/set&gt;</pre><p>Cependant ce n'est pas la solution recommand&eacute;e. </p>
               <p>La cause sous jacente &agrave; ce comportement est que le lien (la cl&eacute; &eacute;trang&egrave;re <code class="literal">parent_id</code>) de <code class="literal">p</code> vers <code class="literal">c</code> n'est pas consid&eacute;r&eacute;e comme faisant partie de l'&eacute;tat de l'objet <code class="literal">Child</code> et n'est donc pas cr&eacute;&eacute; par l'<code class="literal">INSERT</code>. La solution est donc que ce lien fasse partie du mapping de <code class="literal">Child</code>. 
               </p><pre class="programlisting">&lt;many-to-one name="parent" column="parent_id" not-null="true"/&gt;</pre><p>(Nous avons aussi besoin d'ajouter la propri&eacute;t&eacute; <code class="literal">parent</code> dans la classe <code class="literal">Child</code>). 
               </p>
               <p>Maintenant que l'&eacute;tat du lien est g&eacute;r&eacute; par l'entit&eacute; <code class="literal">Child</code>, nous sp&eacute;cifions &agrave; la collection de ne pas mettre &agrave; jour le lien. Nous utilisons l'attribut <code class="literal">inverse</code>. 
               </p><pre class="programlisting">&lt;set name="children" inverse="true"&gt;
    &lt;key column="parent_id"/&gt;
    &lt;one-to-many class="Child"/&gt;
&lt;/set&gt;</pre><p>Le code suivant serait utilis&eacute; pour ajouter un nouveau <code class="literal">Child</code> 
               </p><pre class="programlisting">Parent p = (Parent) session.load(Parent.class, pid);
Child c = new Child();
c.setParent(p);
p.getChildren().add(c);
session.save(c);
session.flush();</pre><p>Maintenant, seul un <code class="literal">INSERT</code> SQL est n&eacute;cessaire ! 
               </p>
               <p>Pour all&eacute;ger encore un peu les choses, nous devrions cr&eacute;er une m&eacute;thode <code class="literal">addChild()</code> dans <code class="literal">Parent</code>. 
               </p><pre class="programlisting">public void addChild(Child c) {
    c.setParent(this);
    children.add(c);
}</pre><p>Le code d'ajout d'un <code class="literal">Child</code> serait alors 
               </p><pre class="programlisting">Parent p = (Parent) session.load(Parent.class, pid);
Child c = new Child();
p.addChild(c);
session.save(c);
session.flush();</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="example-parentchild-cascades"></a>21.3.&nbsp;Cycle de vie en cascade
                        </h2>
                     </div>
                  </div>
               </div>
               <p>L'appel explicite de <code class="literal">save()</code> est un peu fastidieux. Nous pouvons simplifier cela en utilisant les cascades. 
               </p><pre class="programlisting">&lt;set name="children" inverse="true" cascade="all"&gt;
    &lt;key column="parent_id"/&gt;
    &lt;one-to-many class="Child"/&gt;
&lt;/set&gt;</pre><p>Simplifie le code pr&eacute;c&eacute;dent en </p><pre class="programlisting">Parent p = (Parent) session.load(Parent.class, pid);
Child c = new Child();
p.addChild(c);
session.flush();</pre><p>De la m&ecirc;me mani&egrave;re, nous n'avons pas &agrave; it&eacute;rer sur les fils lorsque nous sauvons ou effacons un <code class="literal">Parent</code>. Le code suivant efface <code class="literal">p</code> et tous ses fils de la base de donn&eacute;es. 
               </p><pre class="programlisting">Parent p = (Parent) session.load(Parent.class, pid);
session.delete(p);
session.flush();</pre><p>Par contre, ce code </p><pre class="programlisting">Parent p = (Parent) session.load(Parent.class, pid);
Child c = (Child) p.getChildren().iterator().next();
p.getChildren().remove(c);
c.setParent(null);
session.flush();</pre><p>n'effacera pas <code class="literal">c</code> de la base de donn&eacute;es, il enl&egrave;vera seulement le lien vers <code class="literal">p</code> (et causera une violation de contrainte <code class="literal">NOT NULL</code>, dans ce cas). Vous devez explicitement utiliser <code class="literal">delete()</code> sur <code class="literal">Child</code>. 
               </p><pre class="programlisting">Parent p = (Parent) session.load(Parent.class, pid);
Child c = (Child) p.getChildren().iterator().next();
p.getChildren().remove(c);
session.delete(c);
session.flush();</pre><p>Dans notre cas, un <code class="literal">Child</code> ne peut pas vraiment exister sans son p&egrave;re. Si nous effacons un <code class="literal">Child</code> de la collection, nous voulons vraiment qu'il soit effac&eacute;. Pour cela, nous devons utiliser <code class="literal">cascade="all-delete-orphan"</code>. 
               </p><pre class="programlisting">&lt;set name="children" inverse="true" cascade="all-delete-orphan"&gt;
    &lt;key column="parent_id"/&gt;
    &lt;one-to-many class="Child"/&gt;
&lt;/set&gt;</pre><p>A noter : m&ecirc;me si le mapping de la collection sp&eacute;cifie <code class="literal">inverse="true"</code>, les cascades sont toujours assur&eacute;es par l'it&eacute;ration sur les &eacute;l&eacute;ments de la collection. Donc, si vous avez besoin qu'un objet
                  soit enregistr&eacute;, effac&eacute; ou mis &agrave; jour par cascade, vous devez l'ajouter dans la colleciton. Il ne suffit pas d'appeler explicitement
                  <code class="literal">setParent()</code>. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="example-parentchild-update"></a>21.4.&nbsp;Cascades et <code class="literal">unsaved-value</code></h2>
                     </div>
                  </div>
               </div>
               <p>Supposons que nous ayons charg&eacute; un <code class="literal">Parent</code> dans une <code class="literal">Session</code>, que nous l'ayons ensuite modifi&eacute; et que voulions persiter ces modifications dans une nouvelle session en appelant <code class="literal">update()</code>. Le <code class="literal">Parent</code> contiendra une collection de fils et, puisque la cascade est activ&eacute;e, Hibernate a besoin de savoir quels fils viennent d'&ecirc;tre
                  instanci&eacute;s et quels fils proviennent de la base de donn&eacute;es. Supposons aussi que <code class="literal">Parent</code> et <code class="literal">Child</code> ont tous deux des identifiants du type <code class="literal">Long</code>. Hibernate utilisera la propri&eacute;t&eacute; de l'identifiant et la propri&eacute;t&eacute; de la version/horodatage pour d&eacute;terminer quels fils sont
                  nouveaux (vous pouvez aussi utiliser la propri&eacute;t&eacute; version ou timestamp, voir <a href="#">???</a>). <span class="emphasis"><em>Dans Hibernate3, il n'est plus n&eacute;cessaire de sp&eacute;cifier une <code class="literal">unsaved-value</code> explicitement.</em></span> 
               </p>
               <p>Le code suivant mettra &agrave; jour <code class="literal">parent</code> et <code class="literal">child</code> et ins&eacute;rera <code class="literal">newChild</code>. 
               </p><pre class="programlisting">//parent and child were both loaded in a previous session
parent.addChild(child);
Child newChild = new Child();
parent.addChild(newChild);
session.update(parent);
session.flush();</pre><p>Ceci est tr&egrave;s bien pour des identifiants g&eacute;n&eacute;r&eacute;s, mais qu'en est-il des identifiants assign&eacute;s et des identifiants compos&eacute;s
                  ? C'est plus difficile, puisqu'Hibernate ne peut pas utiliser la propri&eacute;t&eacute; de l'identifiant pour distinguer un objet nouvellement
                  instanci&eacute; (avec un identifiant assign&eacute; par l'utilisateur) d'un objet charg&eacute; dans une session pr&eacute;c&eacute;dente. Dans ce cas, Hibernate
                  utilisera soit la propri&eacute;t&eacute; de version ou d'horodatage, soit effectuera vraiment une requ&ecirc;te au cache de second niveau, soit,
                  dans le pire des cas, &agrave; la base de donn&eacute;es, pour voir si la ligne existe. 
               </p>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="example-parentchild-conclusion"></a>21.5.&nbsp;Conclusion
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Il y a quelques principes &agrave; ma&icirc;triser dans ce chapitre et tout cela peut para&icirc;tre d&eacute;routant la premi&egrave;re fois. Cependant, dans
                  la pratique, tout fonctionne parfaitement. La plupart des applications Hibernate utilisent le pattern p&egrave;re / fils. 
               </p>
               <p>Nous avons &eacute;voqu&eacute; une alternative dans le premier paragraphe. Aucun des points trait&eacute;s pr&eacute;c&eacute;demment n'existe dans le cas d'un
                  mapping <code class="literal">&lt;composite-element&gt;</code> qui poss&egrave;de exactement la s&eacute;mantique d'une relation p&egrave;re / fils. Malheureusement, il y a deux grandes limitations pour les
                  classes &eacute;l&eacute;ments composites : les &eacute;l&eacute;ments composites ne peuvent contenir de collections, et ils ne peuvent &ecirc;tre les fils
                  d'entit&eacute;s autres que l'unique parent. 
               </p>
            </div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="example-weblog"></a>Chapitre&nbsp;22.&nbsp;Exemple : application Weblog
                     </h2>
                  </div>
               </div>
            </div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="example-weblog-classes"></a>22.1.&nbsp;Classes persistantes
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Les classes persistantes representent un weblog, et un article post&eacute; dans un weblog. Il seront mod&eacute;lis&eacute;s comme une relation
                  p&egrave;re/fils standard, mais nous allons utiliser un "bag" tri&eacute; au lieu d'un set. 
               </p><pre class="programlisting">package eg;

import java.util.List;

public class Blog {
    private Long _id;
    private String _name;
    private List _items;

    public Long getId() {
        return _id;
    }
    public List getItems() {
        return _items;
    }
    public String getName() {
        return _name;
    }
    public void setId(Long long1) {
        _id = long1;
    }
    public void setItems(List list) {
        _items = list;
    }
    public void setName(String string) {
        _name = string;
    }
}</pre><pre class="programlisting">package eg;

import java.text.DateFormat;
import java.util.Calendar;

public class BlogItem {
    private Long _id;
    private Calendar _datetime;
    private String _text;
    private String _title;
    private Blog _blog;

    public Blog getBlog() {
        return _blog;
    }
    public Calendar getDatetime() {
        return _datetime;
    }
    public Long getId() {
        return _id;
    }
    public String getText() {
        return _text;
    }
    public String getTitle() {
        return _title;
    }
    public void setBlog(Blog blog) {
        _blog = blog;
    }
    public void setDatetime(Calendar calendar) {
        _datetime = calendar;
    }
    public void setId(Long long1) {
        _id = long1;
    }
    public void setText(String string) {
        _text = string;
    }
    public void setTitle(String string) {
        _title = string;
    }
}</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="example-weblog-mappings"></a>22.2.&nbsp;Mappings Hibernate
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Le mapping XML doit maintenant &ecirc;tre relativement simple &agrave; vos yeux. </p><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE hibernate-mapping PUBLIC
    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"&gt;

&lt;hibernate-mapping package="eg"&gt;

    &lt;class
        name="Blog"
        table="BLOGS"&gt;

        &lt;id
            name="id"
            column="BLOG_ID"&gt;

            &lt;generator class="native"/&gt;

        &lt;/id&gt;

        &lt;property
            name="name"
            column="NAME"
            not-null="true"
            unique="true"/&gt;

        &lt;bag
            name="items"
            inverse="true"
            order-by="DATE_TIME"
            cascade="all"&gt;

            &lt;key column="BLOG_ID"/&gt;
            &lt;one-to-many class="BlogItem"/&gt;

        &lt;/bag&gt;

    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE hibernate-mapping PUBLIC
    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"&gt;

&lt;hibernate-mapping package="eg"&gt;

    &lt;class
        name="BlogItem"
        table="BLOG_ITEMS"
        dynamic-update="true"&gt;

        &lt;id
            name="id"
            column="BLOG_ITEM_ID"&gt;

            &lt;generator class="native"/&gt;

        &lt;/id&gt;

        &lt;property
            name="title"
            column="TITLE"
            not-null="true"/&gt;

        &lt;property
            name="text"
            column="TEXT"
            not-null="true"/&gt;

        &lt;property
            name="datetime"
            column="DATE_TIME"
            not-null="true"/&gt;

        &lt;many-to-one
            name="blog"
            column="BLOG_ID"
            not-null="true"/&gt;

    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="example-weblog-code"></a>22.3.&nbsp;Code Hibernate
                        </h2>
                     </div>
                  </div>
               </div>
               <p>La classe suivante montre quelques utilisations que nous pouvons faire de ces classes. </p><pre class="programlisting">package eg;

import java.util.ArrayList;
import java.util.Calendar;
import java.util.Iterator;
import java.util.List;

import org.hibernate.HibernateException;
import org.hibernate.Query;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.Transaction;
import org.hibernate.cfg.Configuration;
import org.hibernate.tool.hbm2ddl.SchemaExport;

public class BlogMain {
    
    private SessionFactory _sessions;
    
    public void configure() throws HibernateException {
        _sessions = new Configuration()
            .addClass(Blog.class)
            .addClass(BlogItem.class)
            .buildSessionFactory();
    }
    
    public void exportTables() throws HibernateException {
        Configuration cfg = new Configuration()
            .addClass(Blog.class)
            .addClass(BlogItem.class);
        new SchemaExport(cfg).create(true, true);
    }
    
    public Blog createBlog(String name) throws HibernateException {
        
        Blog blog = new Blog();
        blog.setName(name);
        blog.setItems( new ArrayList() );
        
        Session session = _sessions.openSession();
        Transaction tx = null;
        try {
            tx = session.beginTransaction();
            session.persist(blog);
            tx.commit();
        }
        catch (HibernateException he) {
            if (tx!=null) tx.rollback();
            throw he;
        }
        finally {
            session.close();
        }
        return blog;
    }
    
    public BlogItem createBlogItem(Blog blog, String title, String text)
                        throws HibernateException {
        
        BlogItem item = new BlogItem();
        item.setTitle(title);
        item.setText(text);
        item.setBlog(blog);
        item.setDatetime( Calendar.getInstance() );
        blog.getItems().add(item);
        
        Session session = _sessions.openSession();
        Transaction tx = null;
        try {
            tx = session.beginTransaction();
            session.update(blog);
            tx.commit();
        }
        catch (HibernateException he) {
            if (tx!=null) tx.rollback();
            throw he;
        }
        finally {
            session.close();
        }
        return item;
    }
    
    public BlogItem createBlogItem(Long blogid, String title, String text)
                        throws HibernateException {
        
        BlogItem item = new BlogItem();
        item.setTitle(title);
        item.setText(text);
        item.setDatetime( Calendar.getInstance() );
        
        Session session = _sessions.openSession();
        Transaction tx = null;
        try {
            tx = session.beginTransaction();
            Blog blog = (Blog) session.load(Blog.class, blogid);
            item.setBlog(blog);
            blog.getItems().add(item);
            tx.commit();
        }
        catch (HibernateException he) {
            if (tx!=null) tx.rollback();
            throw he;
        }
        finally {
            session.close();
        }
        return item;
    }
    
    public void updateBlogItem(BlogItem item, String text)
                    throws HibernateException {
        
        item.setText(text);
        
        Session session = _sessions.openSession();
        Transaction tx = null;
        try {
            tx = session.beginTransaction();
            session.update(item);
            tx.commit();
        }
        catch (HibernateException he) {
            if (tx!=null) tx.rollback();
            throw he;
        }
        finally {
            session.close();
        }
    }
    
    public void updateBlogItem(Long itemid, String text)
                    throws HibernateException {
    
        Session session = _sessions.openSession();
        Transaction tx = null;
        try {
            tx = session.beginTransaction();
            BlogItem item = (BlogItem) session.load(BlogItem.class, itemid);
            item.setText(text);
            tx.commit();
        }
        catch (HibernateException he) {
            if (tx!=null) tx.rollback();
            throw he;
        }
        finally {
            session.close();
        }
    }
    
    public List listAllBlogNamesAndItemCounts(int max)
                    throws HibernateException {
        
        Session session = _sessions.openSession();
        Transaction tx = null;
        List result = null;
        try {
            tx = session.beginTransaction();
            Query q = session.createQuery(
                "select blog.id, blog.name, count(blogItem) " +
                "from Blog as blog " +
                "left outer join blog.items as blogItem " +
                "group by blog.name, blog.id " +
                "order by max(blogItem.datetime)"
            );
            q.setMaxResults(max);
            result = q.list();
            tx.commit();
        }
        catch (HibernateException he) {
            if (tx!=null) tx.rollback();
            throw he;
        }
        finally {
            session.close();
        }
        return result;
    }
    
    public Blog getBlogAndAllItems(Long blogid)
                    throws HibernateException {
        
        Session session = _sessions.openSession();
        Transaction tx = null;
        Blog blog = null;
        try {
            tx = session.beginTransaction();
            Query q = session.createQuery(
                "from Blog as blog " +
                "left outer join fetch blog.items " +
                "where blog.id = :blogid"
            );
            q.setParameter("blogid", blogid);
            blog  = (Blog) q.uniqueResult();
            tx.commit();
        }
        catch (HibernateException he) {
            if (tx!=null) tx.rollback();
            throw he;
        }
        finally {
            session.close();
        }
        return blog;
    }
    
    public List listBlogsAndRecentItems() throws HibernateException {
        
        Session session = _sessions.openSession();
        Transaction tx = null;
        List result = null;
        try {
            tx = session.beginTransaction();
            Query q = session.createQuery(
                "from Blog as blog " +
                "inner join blog.items as blogItem " +
                "where blogItem.datetime &gt; :minDate"
            );

            Calendar cal = Calendar.getInstance();
            cal.roll(Calendar.MONTH, false);
            q.setCalendar("minDate", cal);
            
            result = q.list();
            tx.commit();
        }
        catch (HibernateException he) {
            if (tx!=null) tx.rollback();
            throw he;
        }
        finally {
            session.close();
        }
        return result;
    }
}</pre></div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="example-mappings"></a>Chapitre&nbsp;23.&nbsp;Exemple : quelques mappings
                     </h2>
                  </div>
               </div>
            </div>
            <p>Ce chapitre montre quelques mappings plus complexes. </p>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="example-mappings-emp"></a>23.1.&nbsp;Employeur/Employ&eacute; (Employer/Employee)
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Le mod&egrave;le suivant de relation entre <code class="literal">Employer</code> et <code class="literal">Employee</code> utilise une vraie classe entit&eacute; (<code class="literal">Employment</code>) pour repr&eacute;senter l'association. On a fait cela parce qu'il peut y avoir plus d'une p&eacute;riode d'emploi pour les deux m&ecirc;mes
                  parties. Des composants sont utilis&eacute;s pour mod&eacute;liser les valeurs mon&eacute;taires et les noms des employ&eacute;s. 
               </p>
               <div class="mediaobject" align="center"><img src="images/EmployerEmployee.png" align="middle"></div>
               <p>Voici un document de mapping possible : </p><pre class="programlisting">&lt;hibernate-mapping&gt;
        
    &lt;class name="Employer" table="employers"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"&gt;
                &lt;param name="sequence"&gt;employer_id_seq&lt;/param&gt;
            &lt;/generator&gt;
        &lt;/id&gt;
        &lt;property name="name"/&gt;
    &lt;/class&gt;

    &lt;class name="Employment" table="employment_periods"&gt;

        &lt;id name="id"&gt;
            &lt;generator class="sequence"&gt;
                &lt;param name="sequence"&gt;employment_id_seq&lt;/param&gt;
            &lt;/generator&gt;
        &lt;/id&gt;
        &lt;property name="startDate" column="start_date"/&gt;
        &lt;property name="endDate" column="end_date"/&gt;

        &lt;component name="hourlyRate" class="MonetaryAmount"&gt;
            &lt;property name="amount"&gt;
                &lt;column name="hourly_rate" sql-type="NUMERIC(12, 2)"/&gt;
            &lt;/property&gt;
            &lt;property name="currency" length="12"/&gt;
        &lt;/component&gt;

        &lt;many-to-one name="employer" column="employer_id" not-null="true"/&gt;
        &lt;many-to-one name="employee" column="employee_id" not-null="true"/&gt;

    &lt;/class&gt;

    &lt;class name="Employee" table="employees"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"&gt;
                &lt;param name="sequence"&gt;employee_id_seq&lt;/param&gt;
            &lt;/generator&gt;
        &lt;/id&gt;
        &lt;property name="taxfileNumber"/&gt;
        &lt;component name="name" class="Name"&gt;
            &lt;property name="firstName"/&gt;
            &lt;property name="initial"/&gt;
            &lt;property name="lastName"/&gt;
        &lt;/component&gt;
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre><p>Et voici le sch&eacute;ma des tables g&eacute;n&eacute;r&eacute;es par <code class="literal">SchemaExport</code>. 
               </p><pre class="programlisting">create table employers (
    id BIGINT not null, 
    name VARCHAR(255), 
    primary key (id)
)

create table employment_periods (
    id BIGINT not null,
    hourly_rate NUMERIC(12, 2),
    currency VARCHAR(12), 
    employee_id BIGINT not null, 
    employer_id BIGINT not null, 
    end_date TIMESTAMP, 
    start_date TIMESTAMP, 
    primary key (id)
)

create table employees (
    id BIGINT not null, 
    firstName VARCHAR(255), 
    initial CHAR(1), 
    lastName VARCHAR(255), 
    taxfileNumber VARCHAR(255), 
    primary key (id)
)

alter table employment_periods 
    add constraint employment_periodsFK0 foreign key (employer_id) references employers
alter table employment_periods 
    add constraint employment_periodsFK1 foreign key (employee_id) references employees
create sequence employee_id_seq
create sequence employment_id_seq
create sequence employer_id_seq</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="example-mappings-authorwork"></a>23.2.&nbsp;Auteur/Travail (Author/Work)
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Soit le mod&egrave;le de la relation entre <code class="literal">Work</code>, <code class="literal">Author</code> et <code class="literal">Person</code>. Nous repr&eacute;sentons la relation entre <code class="literal">Work</code> et <code class="literal">Author</code> comme une association plusieurs-vers-plusieurs. Nous avons choisi de repr&eacute;senter la relation entre <code class="literal">Author</code> et <code class="literal">Person</code> comme une association un-vers-un. Une autre possibilit&eacute; aurait &eacute;t&eacute; que <code class="literal">Author</code> h&eacute;rite de <code class="literal">Person</code>. 
               </p>
               <div class="mediaobject" align="center"><img src="images/AuthorWork.png" align="middle"></div>
               <p>Le mapping suivant repr&eacute;sente exactement ces relations : </p><pre class="programlisting">&lt;hibernate-mapping&gt;

    &lt;class name="Work" table="works" discriminator-value="W"&gt;

        &lt;id name="id" column="id"&gt;
            &lt;generator class="native"/&gt;
        &lt;/id&gt;
        &lt;discriminator column="type" type="character"/&gt;

        &lt;property name="title"/&gt;
        &lt;set name="authors" table="author_work"&gt;
            &lt;key column name="work_id"/&gt;
            &lt;many-to-many class="Author" column name="author_id"/&gt;
        &lt;/set&gt;

        &lt;subclass name="Book" discriminator-value="B"&gt;
            &lt;property name="text"/&gt;
        &lt;/subclass&gt;

        &lt;subclass name="Song" discriminator-value="S"&gt;
            &lt;property name="tempo"/&gt;
            &lt;property name="genre"/&gt;
        &lt;/subclass&gt;

    &lt;/class&gt;

    &lt;class name="Author" table="authors"&gt;

        &lt;id name="id" column="id"&gt;
            &lt;!-- The Author must have the same identifier as the Person --&gt;
            &lt;generator class="assigned"/&gt; 
        &lt;/id&gt;

        &lt;property name="alias"/&gt;
        &lt;one-to-one name="person" constrained="true"/&gt;

        &lt;set name="works" table="author_work" inverse="true"&gt;
            &lt;key column="author_id"/&gt;
            &lt;many-to-many class="Work" column="work_id"/&gt;
        &lt;/set&gt;

    &lt;/class&gt;

    &lt;class name="Person" table="persons"&gt;
        &lt;id name="id" column="id"&gt;
            &lt;generator class="native"/&gt;
        &lt;/id&gt;
        &lt;property name="name"/&gt;
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre><p>Il y a quatre tables dans ce mapping. <code class="literal">works</code>, <code class="literal">authors</code> et <code class="literal">persons</code> qui contiennent respectivement les donn&eacute;es de work, author et person. <code class="literal">author_work</code> est une table d'association qui lie authors &agrave; works. Voici le sch&eacute;ma de tables, g&eacute;n&eacute;r&eacute; par <code class="literal">SchemaExport</code>. 
               </p><pre class="programlisting">create table works (
    id BIGINT not null generated by default as identity, 
    tempo FLOAT, 
    genre VARCHAR(255), 
    text INTEGER, 
    title VARCHAR(255), 
    type CHAR(1) not null, 
    primary key (id)
)

create table author_work (
    author_id BIGINT not null, 
    work_id BIGINT not null, 
    primary key (work_id, author_id)
)

create table authors (
    id BIGINT not null generated by default as identity, 
    alias VARCHAR(255), 
    primary key (id)
)

create table persons (
    id BIGINT not null generated by default as identity, 
    name VARCHAR(255), 
    primary key (id)
)

alter table authors 
    add constraint authorsFK0 foreign key (id) references persons
alter table author_work 
    add constraint author_workFK0 foreign key (author_id) references authors
alter table author_work
    add constraint author_workFK1 foreign key (work_id) references works</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="example-mappings-customerorderproduct"></a>23.3.&nbsp;Client/Commande/Produit (Customer/Order/Product)
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Imaginons maintenant le mod&egrave;le de relation entre <code class="literal">Customer</code>, <code class="literal">Order</code>, <code class="literal">LineItem</code> et <code class="literal">Product</code>. Il y a une association un-vers-plusieurs entre <code class="literal">Customer</code> et <code class="literal">Order</code>, mais comment devrions nous repr&eacute;senter <code class="literal">Order</code> / <code class="literal">LineItem</code> / <code class="literal">Product</code>? J'ai choisi de mapper <code class="literal">LineItem</code> comme une classe d'association repr&eacute;sentant l'association plusieurs-vers-plusieurs entre <code class="literal">Order</code> et <code class="literal">Product</code>. Dans Hibernate, on appelle cela un &eacute;l&eacute;ment composite. 
               </p>
               <div class="mediaobject" align="center"><img src="images/CustomerOrderProduct.png" align="middle"></div>
               <p>Le document de mapping : </p><pre class="programlisting">&lt;hibernate-mapping&gt;

    &lt;class name="Customer" table="customers"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="native"/&gt;
        &lt;/id&gt;
        &lt;property name="name"/&gt;
        &lt;set name="orders" inverse="true"&gt;
            &lt;key column="customer_id"/&gt;
            &lt;one-to-many class="Order"/&gt;
        &lt;/set&gt;
    &lt;/class&gt;

    &lt;class name="Order" table="orders"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="native"/&gt;
        &lt;/id&gt;
        &lt;property name="date"/&gt;
        &lt;many-to-one name="customer" column="customer_id"/&gt;
        &lt;list name="lineItems" table="line_items"&gt;
            &lt;key column="order_id"/&gt;
            &lt;list-index column="line_number"/&gt;
            &lt;composite-element class="LineItem"&gt;
                &lt;property name="quantity"/&gt;
                &lt;many-to-one name="product" column="product_id"/&gt;
            &lt;/composite-element&gt;
        &lt;/list&gt;
    &lt;/class&gt;

    &lt;class name="Product" table="products"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="native"/&gt;
        &lt;/id&gt;
        &lt;property name="serialNumber"/&gt;
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre><p><code class="literal">customers</code>, <code class="literal">orders</code>, <code class="literal">line_items</code> et <code class="literal">products</code> contiennent les donn&eacute;es de customer, order, order line item et product. <code class="literal">line_items</code> est aussi la table d'association liant orders &agrave; products. 
               </p><pre class="programlisting">create table customers (
    id BIGINT not null generated by default as identity, 
    name VARCHAR(255), 
    primary key (id)
)

create table orders (
    id BIGINT not null generated by default as identity, 
    customer_id BIGINT, 
    date TIMESTAMP, 
    primary key (id)
)

create table line_items (
    line_number INTEGER not null, 
    order_id BIGINT not null, 
    product_id BIGINT, 
    quantity INTEGER, 
    primary key (order_id, line_number)
)

create table products (
    id BIGINT not null generated by default as identity, 
    serialNumber VARCHAR(255), 
    primary key (id)
)

alter table orders 
    add constraint ordersFK0 foreign key (customer_id) references customers
alter table line_items
    add constraint line_itemsFK0 foreign key (product_id) references products
alter table line_items
    add constraint line_itemsFK1 foreign key (order_id) references orders</pre></div>
            <div class="sect1" lang="fr-FR">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title" style="clear: both"><a name="misc"></a>23.4.&nbsp;Divers mappings d'exemple
                        </h2>
                     </div>
                  </div>
               </div>
               <p>Ces exemples sont tous pris de la suite de tests d'Hibernate. Vous en trouverez beaucoup d'autres. Regardez dans le dossier
                  <code class="literal">test</code> de la distribution d'Hibernate. 
               </p>
               <p>TODO: put words around this stuff</p>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="example-mappings-typed-onetone"></a>23.4.1.&nbsp;"Typed" one-to-one association
                           </h3>
                        </div>
                     </div>
                  </div><pre class="programlisting">&lt;class name="Person"&gt;
    &lt;id name="name"/&gt;
    &lt;one-to-one name="address" 
            cascade="all"&gt;
        &lt;formula&gt;name&lt;/formula&gt;
        &lt;formula&gt;'HOME'&lt;/formula&gt;
    &lt;/one-to-one&gt;
    &lt;one-to-one name="mailingAddress" 
            cascade="all"&gt;
        &lt;formula&gt;name&lt;/formula&gt;
        &lt;formula&gt;'MAILING'&lt;/formula&gt;
    &lt;/one-to-one&gt;
&lt;/class&gt;

&lt;class name="Address" batch-size="2" 
        check="addressType in ('MAILING', 'HOME', 'BUSINESS')"&gt;
    &lt;composite-id&gt;
        &lt;key-many-to-one name="person" 
                column="personName"/&gt;
        &lt;key-property name="type" 
                column="addressType"/&gt;
    &lt;/composite-id&gt;
    &lt;property name="street" type="text"/&gt;
    &lt;property name="state"/&gt;
    &lt;property name="zip"/&gt;
&lt;/class&gt;</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="example-mappings-composite-key"></a>23.4.2.&nbsp;Exemple de clef compos&eacute;e
                           </h3>
                        </div>
                     </div>
                  </div><pre class="programlisting">&lt;class name="Customer"&gt;

    &lt;id name="customerId"
        length="10"&gt;
        &lt;generator class="assigned"/&gt;
    &lt;/id&gt;

    &lt;property name="name" not-null="true" length="100"/&gt;
    &lt;property name="address" not-null="true" length="200"/&gt;

    &lt;list name="orders"
            inverse="true"
            cascade="save-update"&gt;
        &lt;key column="customerId"/&gt;
        &lt;index column="orderNumber"/&gt;
        &lt;one-to-many class="Order"/&gt;
    &lt;/list&gt;

&lt;/class&gt;

&lt;class name="Order" table="CustomerOrder" lazy="true"&gt;
    &lt;synchronize table="LineItem"/&gt;
    &lt;synchronize table="Product"/&gt;
    
    &lt;composite-id name="id" 
            class="Order$Id"&gt;
        &lt;key-property name="customerId" length="10"/&gt;
        &lt;key-property name="orderNumber"/&gt;
    &lt;/composite-id&gt;
    
    &lt;property name="orderDate" 
            type="calendar_date"
            not-null="true"/&gt;
    
    &lt;property name="total"&gt;
        &lt;formula&gt;
            ( select sum(li.quantity*p.price) 
            from LineItem li, Product p 
            where li.productId = p.productId 
                and li.customerId = customerId 
                and li.orderNumber = orderNumber )
        &lt;/formula&gt;
    &lt;/property&gt;
    
    &lt;many-to-one name="customer"
            column="customerId"
            insert="false"
            update="false" 
            not-null="true"/&gt;
        
    &lt;bag name="lineItems"
            fetch="join" 
            inverse="true"
            cascade="save-update"&gt;
        &lt;key&gt;
            &lt;column name="customerId"/&gt;
            &lt;column name="orderNumber"/&gt;
        &lt;/key&gt;
        &lt;one-to-many class="LineItem"/&gt;
    &lt;/bag&gt;
    
&lt;/class&gt;
    
&lt;class name="LineItem"&gt;
    
    &lt;composite-id name="id" 
            class="LineItem$Id"&gt;
        &lt;key-property name="customerId" length="10"/&gt;
        &lt;key-property name="orderNumber"/&gt;
        &lt;key-property name="productId" length="10"/&gt;
    &lt;/composite-id&gt;
    
    &lt;property name="quantity"/&gt;
    
    &lt;many-to-one name="order"
            insert="false"
            update="false" 
            not-null="true"&gt;
        &lt;column name="customerId"/&gt;
        &lt;column name="orderNumber"/&gt;
    &lt;/many-to-one&gt;
    
    &lt;many-to-one name="product"
            insert="false"
            update="false" 
            not-null="true"
            column="productId"/&gt;
        
&lt;/class&gt;

&lt;class name="Product"&gt;
    &lt;synchronize table="LineItem"/&gt;

    &lt;id name="productId"
        length="10"&gt;
        &lt;generator class="assigned"/&gt;
    &lt;/id&gt;
    
    &lt;property name="description" 
        not-null="true" 
        length="200"/&gt;
    &lt;property name="price" length="3"/&gt;
    &lt;property name="numberAvailable"/&gt;
    
    &lt;property name="numberOrdered"&gt;
        &lt;formula&gt;
            ( select sum(li.quantity) 
            from LineItem li 
            where li.productId = productId )
        &lt;/formula&gt;
    &lt;/property&gt;
    
&lt;/class&gt;</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="example-mappings-composite-key-manytomany"></a>23.4.3.&nbsp;Many-to-many avec une clef compos&eacute;e partag&eacute;e
                           </h3>
                        </div>
                     </div>
                  </div><pre class="programlisting">&lt;class name="User" table="`User`"&gt;
    &lt;composite-id&gt;
        &lt;key-property name="name"/&gt;
        &lt;key-property name="org"/&gt;
    &lt;/composite-id&gt;
    &lt;set name="groups" table="UserGroup"&gt;
        &lt;key&gt;
            &lt;column name="userName"/&gt;
            &lt;column name="org"/&gt;
        &lt;/key&gt;
        &lt;many-to-many class="Group"&gt;
            &lt;column name="groupName"/&gt;
            &lt;formula&gt;org&lt;/formula&gt;
        &lt;/many-to-many&gt;
    &lt;/set&gt;
&lt;/class&gt;
    
&lt;class name="Group" table="`Group`"&gt;
    &lt;composite-id&gt;
        &lt;key-property name="name"/&gt;
        &lt;key-property name="org"/&gt;
    &lt;/composite-id&gt;
    &lt;property name="description"/&gt;
    &lt;set name="users" table="UserGroup" inverse="true"&gt;
        &lt;key&gt;
            &lt;column name="groupName"/&gt;
            &lt;column name="org"/&gt;
        &lt;/key&gt;
        &lt;many-to-many class="User"&gt;
            &lt;column name="userName"/&gt;
            &lt;formula&gt;org&lt;/formula&gt;
        &lt;/many-to-many&gt;
    &lt;/set&gt;
&lt;/class&gt;
</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="example-mappings-content-discrimination"></a>23.4.4.&nbsp;Contenu bas&eacute; sur une discrimination
                           </h3>
                        </div>
                     </div>
                  </div><pre class="programlisting">&lt;class name="Person"
    discriminator-value="P"&gt;
    
    &lt;id name="id" 
        column="person_id" 
        unsaved-value="0"&gt;
        &lt;generator class="native"/&gt;
    &lt;/id&gt;
    
            
    &lt;discriminator 
        type="character"&gt;
        &lt;formula&gt;
            case 
                when title is not null then 'E' 
                when salesperson is not null then 'C' 
                else 'P' 
            end
        &lt;/formula&gt;
    &lt;/discriminator&gt;

    &lt;property name="name" 
        not-null="true"
        length="80"/&gt;
        
    &lt;property name="sex" 
        not-null="true"
        update="false"/&gt;
    
    &lt;component name="address"&gt;
        &lt;property name="address"/&gt;
        &lt;property name="zip"/&gt;
        &lt;property name="country"/&gt;
    &lt;/component&gt;
    
    &lt;subclass name="Employee" 
        discriminator-value="E"&gt;
            &lt;property name="title"
                length="20"/&gt;
            &lt;property name="salary"/&gt;
            &lt;many-to-one name="manager"/&gt;
    &lt;/subclass&gt;
    
    &lt;subclass name="Customer" 
        discriminator-value="C"&gt;
            &lt;property name="comments"/&gt;
            &lt;many-to-one name="salesperson"/&gt;
    &lt;/subclass&gt;
    
&lt;/class&gt;</pre></div>
               <div class="sect2" lang="fr-FR">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="example-mappings-association-alternatekeys"></a>23.4.5.&nbsp;Associations sur des clefs altern&eacute;es
                           </h3>
                        </div>
                     </div>
                  </div><pre class="programlisting">&lt;class name="Person"&gt;
    
    &lt;id name="id"&gt;
        &lt;generator class="hilo"/&gt;
    &lt;/id&gt;
    
    &lt;property name="name" length="100"/&gt;
    
    &lt;one-to-one name="address" 
        property-ref="person"
        cascade="all"
        fetch="join"/&gt;
    
    &lt;set name="accounts" 
        inverse="true"&gt;
        &lt;key column="userId"
            property-ref="userId"/&gt;
        &lt;one-to-many class="Account"/&gt;
    &lt;/set&gt;
    
    &lt;property name="userId" length="8"/&gt;

&lt;/class&gt;

&lt;class name="Address"&gt;

    &lt;id name="id"&gt;
        &lt;generator class="hilo"/&gt;
    &lt;/id&gt;

    &lt;property name="address" length="300"/&gt;
    &lt;property name="zip" length="5"/&gt;
    &lt;property name="country" length="25"/&gt;
    &lt;many-to-one name="person" unique="true" not-null="true"/&gt;

&lt;/class&gt;

&lt;class name="Account"&gt;
    &lt;id name="accountId" length="32"&gt;
        &lt;generator class="uuid"/&gt;
    &lt;/id&gt;
    
    &lt;many-to-one name="user"
        column="userId"
        property-ref="userId"/&gt;
    
    &lt;property name="type" not-null="true"/&gt;
    
&lt;/class&gt;</pre></div>
            </div>
         </div>
         <div class="chapter" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="best-practices"></a>Chapitre&nbsp;24.&nbsp;Meilleures pratiques
                     </h2>
                  </div>
               </div>
            </div>
            <div class="variablelist">
               <dl>
                  <dt><span class="term">D&eacute;coupez finement vos classes et mappez les en utilisant <code class="literal">&lt;component&gt;</code>.</span></dt>
                  <dd>
                     <p>Utilisez une classe <code class="literal">Adresse</code> pour encapsuler <code class="literal">Rue</code>, <code class="literal">Region</code>, <code class="literal">CodePostal</code>. Ceci permet la r&eacute;utilisation du code et simplifie la maintenance. 
                     </p>
                  </dd>
                  <dt><span class="term">D&eacute;clarez des propri&eacute;t&eacute;s d'identifiants dans les classes persistantes.</span></dt>
                  <dd>
                     <p>Hibernate rend les propri&eacute;t&eacute;s d'identifiants optionnelles. Il existe beaucoup de raisons pour lesquelles vous devriez les
                        utiliser. Nous recommandons que vous utilisiez des identifiants techniques (g&eacute;n&eacute;r&eacute;s, et sans connotation m&eacute;tier). 
                     </p>
                  </dd>
                  <dt><span class="term">Identifiez les clefs naturelles.</span></dt>
                  <dd>
                     <p>Identifiez les clefs naturelles pour toutes les entit&eacute;s, et mappez les avec <code class="literal">&lt;natural-id&gt;</code>. Impl&eacute;mentez <code class="literal">equals()</code> et <code class="literal">hashCode()</code> pour comparer les propri&eacute;t&eacute;s qui composent la clef naturelle. 
                     </p>
                  </dd>
                  <dt><span class="term">Placez chaque mapping de classe dans son propre fichier.</span></dt>
                  <dd>
                     <p>N'utilisez pas un unique document de mapping. Mappez <code class="literal">com.eg.Foo</code> dans le fichier <code class="literal">com/eg/Foo.hbm.xml</code>. Cela prend tout son sens lors d'un travail en &eacute;quipe. 
                     </p>
                  </dd>
                  <dt><span class="term">Chargez les mappings comme des ressources.</span></dt>
                  <dd>
                     <p>D&eacute;ployez les mappings en m&ecirc;me temps que les classes qu'ils mappent. </p>
                  </dd>
                  <dt><span class="term">Pensez &agrave; externaliser les cha&icirc;nes de caract&egrave;res.</span></dt>
                  <dd>
                     <p>Ceci est une bonne habitude si vos requ&ecirc;tes appellent des fonctions SQL qui ne sont pas au standard ANSI. Cette externalisation
                        dans les fichiers de mapping rendra votre application plus portable. 
                     </p>
                  </dd>
                  <dt><span class="term">Utilisez les variables "bind&eacute;es".</span></dt>
                  <dd>
                     <p>Comme en JDBC, remplacez toujours les valeurs non constantes par "?". N'utilisez jamais la manipulation des cha&icirc;nes de caract&egrave;res
                        pour remplacer des valeurs non constantes dans une requ&ecirc;te ! Encore mieux, utilisez les param&egrave;tres nomm&eacute;s dans les requ&ecirc;tes.
                        
                     </p>
                  </dd>
                  <dt><span class="term">Ne g&eacute;rez pas vous m&ecirc;me les connexions JDBC.</span></dt>
                  <dd>
                     <p>Hibernate laisse l'application g&eacute;rer les connexions JDBC. Vous ne devriez g&eacute;rer vos connexions qu'en dernier recours. Si vous
                        ne pouvez pas utiliser les syst&egrave;mes de connexions livr&eacute;s, r&eacute;fl&eacute;chissez &agrave; l'id&eacute;e de fournir votre propre impl&eacute;mentation de
                        <code class="literal">org.hibernate.connection.ConnectionProvider</code>. 
                     </p>
                  </dd>
                  <dt><span class="term">Pensez &agrave; utiliser les types utilisateurs.</span></dt>
                  <dd>
                     <p>Supposez que vous ayez une type Java, de telle biblioth&egrave;que, qui a besoin d'&ecirc;tre persist&eacute; mais qui ne fournit pas les accesseurs
                        n&eacute;cessaires pour le mapper comme composant. Vous devriez impl&eacute;menter <code class="literal">org.hibernate.UserType</code>.Cette approche lib&egrave;re le code de l'application de l'impl&eacute;mentation des transformations vers / depuis les types Hibernate.
                        
                     </p>
                  </dd>
                  <dt><span class="term">Utilisez du JDBC pur dans les goulets d'&eacute;tranglement.</span></dt>
                  <dd>
                     <p>Dans certaines parties critiques de votre syst&egrave;me d'un point de vue performance, quelques op&eacute;rations peuvent tirer partie
                        d'un appel JDBC natif. Mais attendez de <span class="emphasis"><em>savoir</em></span> que c'est un goulet d'&eacute;tranglement. Ne supposez jamais qu'un appel JDBC sera forc&eacute;ment plus rapide. Si vous avez besoin d'utiliser
                        JDBC directement, ouvrez une <code class="literal">Session</code> Hibernate et utilisez la connexion SQL sous-jacente. Ainsi vous pourrez utiliser la m&ecirc;me strat&eacute;gie de transation et la m&ecirc;me
                        gestion des connexions. 
                     </p>
                  </dd>
                  <dt><span class="term">Comprendre le flush de <code class="literal">Session</code>.</span></dt>
                  <dd>
                     <p>De temps en temps la Session synchronise ses &eacute;tats persistants avec la base de donn&eacute;es. Les performances seront affect&eacute;es
                        si ce processus arrive trop souvent. Vous pouvez parfois minimiser les flush non n&eacute;cessaires en d&eacute;sactivant le flush automatique
                        ou m&ecirc;me en changeant l'ordre des op&eacute;rations men&eacute;es dans une transaction particuli&egrave;re. 
                     </p>
                  </dd>
                  <dt><span class="term">Dans une architecture &agrave; trois couches, pensez &agrave; utiliser <code class="literal">saveOrUpdate()</code>.</span></dt>
                  <dd>
                     <p>Quand vous utilisez une architecture &agrave; base de servlet / session bean, vous pourriez passer des objets charg&eacute;s dans le bean
                        session vers et depuis la couche servlet / JSP. Utilisez une nouvelle session pour traiter chaque requ&ecirc;te. Utilisez <code class="literal">Session.merge()</code> ou <code class="literal">Session.saveOrUpdate()</code> pour synchroniser les objets avec la base de donn&eacute;es. 
                     </p>
                  </dd>
                  <dt><span class="term">Dans une architecture &agrave; deux couches, pensez &agrave; utiliser la d&eacute;connexion de session.</span></dt>
                  <dd>
                     <p>Les transactions de bases de donn&eacute;es doivent &ecirc;tre aussi courtes que possible pour une meilleure mont&eacute;e en charge.Cependant,
                        il est souvent n&eacute;cessaire d'impl&eacute;menter de longues <span class="emphasis"><em>transactions applicatives</em></span>, une simple unit&eacute; de travail du point de vue de l'utilisateur. Une transaction applicative peut s'&eacute;taler sur plusieurs cycles
                        de requ&ecirc;tes/r&eacute;ponses du client. Il est commun d'utiliser des objets d&eacute;tach&eacute;s pour impl&eacute;menter des transactions applicatives.
                        Une alternative, extr&ecirc;mement appropri&eacute;e dans une architecture &agrave; 2 couches, est de maintenir un seul contact de persistance
                        ouvert (session) pour toute la dur&eacute;e de vie de la transaction applicative et simplement se d&eacute;connecter de la connexion JDBC
                        &agrave; la fin de chaque requ&ecirc;te, et se reconnecter au d&eacute;but de la requ&ecirc;te suivante. Ne partagez jamais une seule session avec plus
                        d'une transaction applicative, ou vous travaillerez avec des donn&eacute;es p&eacute;rim&eacute;es. 
                     </p>
                  </dd>
                  <dt><span class="term">Consid&eacute;rez que les exceptions ne sont pas rattrapables.</span></dt>
                  <dd>
                     <p>Il s'agit plus d'une pratique obligatoire que d'une "meilleure pratique". Quand une exception intervient, il faut faire un
                        rollback de la <code class="literal">Transaction</code> et fermer la <code class="literal">Session</code>. Sinon, Hibernate ne peut garantir l'int&eacute;grit&eacute; des &eacute;tats persistants en m&eacute;moire. En particulier, n'utilisez pas <code class="literal">Session.load()</code> pour d&eacute;terminer si une instance avec un identifiant donn&eacute; existe en base de donn&eacute;es, utilisez <code class="literal">Session.get()</code> ou un requ&ecirc;te. 
                     </p>
                  </dd>
                  <dt><span class="term">Pr&eacute;f&eacute;rez le chargement tardif des associations.</span></dt>
                  <dd>
                     <p>Utilisez le chargement complet avec mod&eacute;ration. Utilisez les proxies et les collections charg&eacute;es tardivement pour la plupart
                        des associations vers des classes qui ne sont pas susceptibles d'&ecirc;tre compl&egrave;tement retenues dans le cache de second niveau.
                        Pour les assocations de classes en cache, o&ugrave; il y a une extr&ecirc;mement forte probabilit&eacute; que l'&eacute;l&eacute;ment soit en cache, d&eacute;sactivez
                        explicitement le chargement par jointures ouvertes en utilisant <code class="literal">outer-join="false"</code>. Lorsqu'un chargement par jointure ouverte est appropri&eacute; pour un cas d'utilisation particulier, utilisez une requ&ecirc;te avec
                        un <code class="literal">left join fetch</code>. 
                     </p>
                  </dd>
                  <dt><span class="term">Utilisez le pattern <span class="emphasis"><em>d'une ouverture de session dans une vue</em></span>, ou une <span class="emphasis"><em>phase d'assemblage</em></span> disciplin&eacute;e pour &eacute;viter des probl&egrave;mes avec des donn&eacute;es non rapatri&eacute;es. </span></dt>
                  <dd>
                     <p>Hibernate lib&egrave;re les d&eacute;veloppeurs de l'&eacute;criture fastidieuse des <span class="emphasis"><em>objets de transfert de donn&eacute;es (NdT : Data Transfer Objects)</em></span> (DTO). Dans une architecture EJB traditionnelle, les DTOs ont deux buts : premi&egrave;rement, ils contournent le probl&egrave;me des "entity
                        bean" qui ne sont pas s&eacute;rialisables ; deuxi&egrave;mement, ils d&eacute;finissent implicitement une phase d'assemblage o&ugrave; toutes les donn&eacute;es
                        utilis&eacute;es par la vue sont rapatri&eacute;es et organis&eacute;es dans les DTOs avant de retourner sous le contr&ocirc;le de la couche de pr&eacute;sentation.
                        Hibernate &eacute;limine le premier but. Pourtant, vous aurez encore besoin d'une phase d'assemblage (pensez vos m&eacute;thodes m&eacute;tier
                        comme ayant un contrat strict avec la couche de pr&eacute;sentation &agrave; propos de quelles donn&eacute;es sont disponibles dans les objets
                        d&eacute;tach&eacute;s) &agrave; moins que vous soyez pr&eacute;par&eacute;s &agrave; garder le contexte de persistance (la session) ouvert &agrave; travers tout le processus
                        de rendu de la vue. 
                     </p>
                  </dd>
                  <dt><span class="term">Pensez &agrave; abstraite votre logique m&eacute;tier d'Hibernate.</span></dt>
                  <dd>
                     <p>Cachez le m&eacute;canisme d'acc&egrave;s aux donn&eacute;es (Hibernate) derri&egrave;re une interface. Combinez les patterns <span class="emphasis"><em>DAO</em></span> et <span class="emphasis"><em>Thread Local Session</em></span>. Vous pouvez m&ecirc;me avoir quelques classes persist&eacute;es par du JDBC pur, associ&eacute;es &agrave; Hibernate via un <code class="literal">UserType</code> (ce conseil est valable pour des applications de taille respectables ; il n'est pas valable pour une application avec cinq
                        tables). 
                     </p>
                  </dd>
                  <dt><span class="term">N'utilisez pas d'associations de mapping exotiques.</span></dt>
                  <dd>
                     <p>De bons cas d'utilisation pour de vraies associations plusieurs-vers-plusieurs sont rares. La plupart du temps vous avez besoin
                        d'informations additionnelles stock&eacute;es dans la table d'association. Dans ce cas, il est pr&eacute;f&eacute;rable d'utiliser deux associations
                        un-vers-plusieurs vers une classe de liaisons interm&eacute;diaire. En fait, nous pensons que la plupart des associations sont de
                        type un-vers-plusieurs ou plusieurs-vers-un, vous devez &ecirc;tre tr&egrave;s attentifs lorsque vous utilisez autre chose et vous demander
                        si c'est vraiment n&eacute;cessaire. 
                     </p>
                  </dd>
                  <dt><span class="term">Pr&eacute;f&eacute;rez les associations bidirectionnelles.</span></dt>
                  <dd>
                     <p>Les associations unidirectionnelles sont plus difficiles &agrave; questionner. Dans une grande application, la plupart des associations
                        devraient &ecirc;tre navigables dans les deux directions dans les requ&ecirc;tes. 
                     </p>
                  </dd>
               </dl>
            </div>
         </div>
      </div>
   </body>
</html>