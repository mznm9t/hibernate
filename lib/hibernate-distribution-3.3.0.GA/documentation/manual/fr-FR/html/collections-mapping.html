<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>6.2.&nbsp;Mapper une collection</title>
      <link rel="stylesheet" href="css/html.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
      <link rel="start" href="index.html" title="HIBERNATE - Persistance relationnelle en Java standard">
      <link rel="up" href="collections.html" title="Chapitre&nbsp;6.&nbsp;Mapping des collections">
      <link rel="prev" href="collections.html" title="Chapitre&nbsp;6.&nbsp;Mapping des collections">
      <link rel="next" href="collections-advancedmappings.html" title="6.3.&nbsp;Mappings de collection avanc&eacute;s">
   </head>
   <body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
      <div class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center">6.2.&nbsp;Mapper une collection</th>
            </tr>
            <tr>
               <td width="20%" align="left"><a accesskey="p" href="collections.html">Pr&eacute;c&eacute;dent</a>&nbsp;
               </td>
               <th width="60%" align="center">Chapitre&nbsp;6.&nbsp;Mapping des collections</th>
               <td width="20%" align="right">&nbsp;<a accesskey="n" href="collections-advancedmappings.html">Suivant</a></td>
            </tr>
         </table>
         <hr>
      </div>
      <div class="sect1" lang="fr-FR">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title" style="clear: both"><a name="collections-mapping"></a>6.2.&nbsp;Mapper une collection
                  </h2>
               </div>
            </div>
         </div>
         <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
            <h3 class="title">Astuce</h3>
            <p>Il y a pas mal de vari&eacute;t&eacute;s de mappings qui peuvent &ecirc;tre g&eacute;n&eacute;r&eacute;s pour les collections, couvrant beaucoup des mod&egrave;les relationnels
               communs. Nous vous sugg&eacute;rons d'exp&eacute;rimenter avec l'outil de g&eacute;n&eacute;ration de sch&eacute;ma pour avoir une id&eacute;e de comment traduire les
               diff&eacute;rentes d&eacute;clarations de mapping vers des table de la base de donn&eacute;es. 
            </p>
         </div>
         <p>L'&eacute;l&eacute;ment de mapping d'Hibernate utilis&eacute; pour mapper une collection d&eacute;pend du type de l'interface. Par exemple, un &eacute;l&eacute;ment
            <code class="literal">&lt;set&gt;</code> est utilis&eacute; pour mapper des propri&eacute;t&eacute;s de type <code class="literal">Set</code>. 
         </p><pre class="programlisting">&lt;class name="Product"&gt;
    &lt;id name="serialNumber" column="productSerialNumber"/&gt;
    &lt;set name="parts"&gt;
        &lt;key column="productSerialNumber" not-null="true"/&gt;
        &lt;one-to-many class="Part"/&gt;
    &lt;/set&gt;
&lt;/class&gt;</pre><p>&Agrave; part <code class="literal">&lt;set&gt;</code>, il y aussi les &eacute;l&eacute;ments de mapping <code class="literal">&lt;list&gt;</code>, <code class="literal">&lt;map&gt;</code>, <code class="literal">&lt;bag&gt;</code>, <code class="literal">&lt;array&gt;</code> et <code class="literal">&lt;primitive-array&gt;</code>. L'&eacute;l&eacute;ment <code class="literal">&lt;map&gt;</code> est repr&eacute;sentatif : 
         </p>
         <div class="programlistingco"><pre class="programlisting">&lt;map
    name="propertyName"                                         <span class="co">(1)</span>
    table="table_name"                                          <span class="co">(2)</span>
    schema="schema_name"                                        <span class="co">(3)</span>
    lazy="true|extra|false"                                     <span class="co">(4)</span>
    inverse="true|false"                                        <span class="co">(5)</span>
    cascade="all|none|save-update|delete|all-delete-orphan|delet<span class="co">(6)</span>e-orphan"
    sort="unsorted|natural|comparatorClass"                     <span class="co">(7)</span>
    order-by="column_name asc|desc"                             <span class="co">(8)</span>
    where="arbitrary sql where condition"                       <span class="co">(9)</span>
    fetch="join|select|subselect"                               <span class="co">(10)</span>
    batch-size="N"                                              <span class="co">(11)</span>
    access="field|property|ClassName"                           <span class="co">(12)</span>
    optimistic-lock="true|false"                                <span class="co">(13)</span>
    mutable="true|false"                                        <span class="co">(14)</span>
    node="element-name|."
    embed-xml="true|false"
&gt;

    &lt;key .... /&gt;
    &lt;map-key .... /&gt;
    &lt;element .... /&gt;
&lt;/map&gt;</pre><div class="calloutlist">
               <table border="0" summary="Callout list">
                  <tr>
                     <td width="5%" valign="top" align="left">
                        <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                     </td>
                     <td valign="top" align="left">
                        <p><code class="literal">name</code> : le nom de la propri&eacute;t&eacute; contenant la collection 
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td width="5%" valign="top" align="left">
                        <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                     </td>
                     <td valign="top" align="left">
                        <p><code class="literal">table</code> (optionnel - par d&eacute;faut = nom de la propri&eacute;t&eacute;) : le nom de la table de la collection (non utilis&eacute; pour les associations one-to-many)
                           
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td width="5%" valign="top" align="left">
                        <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                     </td>
                     <td valign="top" align="left">
                        <p><code class="literal">schema</code> (optionnel) : le nom du sch&eacute;ma pour surcharger le sch&eacute;ma d&eacute;clar&eacute; dans l'&eacute;l&eacute;ment racine 
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td width="5%" valign="top" align="left">
                        <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                     </td>
                     <td valign="top" align="left">
                        <p><code class="literal">lazy</code> (optionnel - par d&eacute;faut = <code class="literal">true</code>) : peut &ecirc;tre utilis&eacute; pour d&eacute;sactiver l'initialisation tardive et sp&eacute;cifier que l'association est toujours rapport&eacute;e, ou pour
                           activer la r&eacute;cup&eacute;ration extra-paresseuse (NdT : extra-lazy) o&ugrave; la plupart des op&eacute;rations n'initialisent pas la collection
                           (appropri&eacute; pour de tr&egrave;s grosses collections) 
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td width="5%" valign="top" align="left">
                        <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                     </td>
                     <td valign="top" align="left">
                        <p><code class="literal">inverse</code> (optionnel - par d&eacute;faut = <code class="literal">false</code>) : d&eacute;finit cette collection comme l'extr&ecirc;mit&eacute; "inverse" de l'association bidirectionnelle 
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td width="5%" valign="top" align="left">
                        <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(6)</fo:inline>
                     </td>
                     <td valign="top" align="left">
                        <p><code class="literal">cascade</code> (optionnel - par d&eacute;faut = <code class="literal">none</code>) : active les op&eacute;rations de cascade vers les entit&eacute;s filles 
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td width="5%" valign="top" align="left">
                        <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(7)</fo:inline>
                     </td>
                     <td valign="top" align="left">
                        <p><code class="literal">sort</code> (optionnel) : sp&eacute;cifie une collection tri&eacute;e via un ordre de tri <code class="literal">naturel</code>, ou via une classe comparateur donn&eacute;e (impl&eacute;mentant Comparator) 
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td width="5%" valign="top" align="left">
                        <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(8)</fo:inline>
                     </td>
                     <td valign="top" align="left">
                        <p><code class="literal">order-by</code> (optionnel, seulement &agrave; partir du JDK1.4) : sp&eacute;cifie une colonne de table (ou des colonnes) qui d&eacute;finit l'ordre d'it&eacute;ration
                           de <code class="literal">Map</code>, <code class="literal">Set</code> ou Bag, avec en option <code class="literal">asc</code> ou <code class="literal">desc</code> 
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td width="5%" valign="top" align="left">
                        <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(9)</fo:inline>
                     </td>
                     <td valign="top" align="left">
                        <p><code class="literal">where</code> (optionnel) : sp&eacute;cifie une condition SQL arbitraire <code class="literal">WHERE</code> &agrave; utiliser au chargement ou &agrave; la suppression d'une collection (utile si la collection ne doit contenir qu'un sous ensemble
                           des donn&eacute;es disponibles) 
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td width="5%" valign="top" align="left">
                        <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(10)</fo:inline>
                     </td>
                     <td valign="top" align="left">
                        <p><code class="literal">fetch</code> (optionnel, par d&eacute;faut = <code class="literal">select</code>) : &agrave; choisir entre r&eacute;cup&eacute;ration par jointures externes, r&eacute;cup&eacute;ration par selects s&eacute;quentiels, et r&eacute;cup&eacute;ration par sous-selects
                           s&eacute;quentiels 
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td width="5%" valign="top" align="left">
                        <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(11)</fo:inline>
                     </td>
                     <td valign="top" align="left">
                        <p><code class="literal">batch-size</code> (optionnel, par d&eacute;faut = <code class="literal">1</code>) : une taille de batch (batch size) utilis&eacute;e pour charger plusieurs instances de cette collection en initialisation tardive
                           
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td width="5%" valign="top" align="left">
                        <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(12)</fo:inline>
                     </td>
                     <td valign="top" align="left">
                        <p><code class="literal">access</code> (optionnel - par d&eacute;faut = <code class="literal">property</code>) : La strat&eacute;gie qu'Hibernate doit utiliser pour acc&eacute;der &agrave; la valeur de la propri&eacute;t&eacute; 
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td width="5%" valign="top" align="left">
                        <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(13)</fo:inline>
                     </td>
                     <td valign="top" align="left">
                        <p><code class="literal">optimistic-lock</code> (optionnel - par d&eacute;faut = <code class="literal">true</code>) : sp&eacute;cifie que changer l'&eacute;tat de la collection entra&icirc;ne l'incr&eacute;mentation de la version appartenant &agrave; l'entit&eacute; (Pour une
                           association un vers plusieurs, il est souvent raisonnable de d&eacute;sactiver ce param&egrave;tre) 
                        </p>
                     </td>
                  </tr>
                  <tr>
                     <td width="5%" valign="top" align="left">
                        <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(14)</fo:inline>
                     </td>
                     <td valign="top" align="left">
                        <p><code class="literal">mutable</code> (optionnel - par d&eacute;faut = <code class="literal">true</code>) : une valeur &agrave; <code class="literal">false</code> sp&eacute;cifie que les &eacute;l&eacute;ments de la collection ne changent jamais (une optimisation mineure dans certains cas) 
                        </p>
                     </td>
                  </tr>
               </table>
            </div>
         </div>
         <div class="sect2" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="collections-foreignkeys"></a>6.2.1.&nbsp;Les clefs &eacute;trang&egrave;res d'une collection
                     </h3>
                  </div>
               </div>
            </div>
            <p>Les instances d'une collection sont distingu&eacute;es dans la base par la clef &eacute;trang&egrave;re de l'entit&eacute; qui poss&egrave;de la collection.
               Cette clef &eacute;trang&egrave;re est r&eacute;f&eacute;renc&eacute;e comme la(es) <span class="emphasis"><em>colonne(s) de la clef de la collection</em></span> de la table de la collection. La colonne de la clef de la collection est mapp&eacute;e par l'&eacute;l&eacute;ment <code class="literal">&lt;key&gt;</code>. 
            </p>
            <p>Il peut y avoir une contrainte de nullit&eacute; sur la colonne de la clef &eacute;trang&egrave;re. Pour les associations unidirectionnelles un
               vers plusieurs, la colonne de la clef &eacute;trang&egrave;re peut &ecirc;tre nulle par d&eacute;faut, donc vous pourriez avoir besoin de sp&eacute;cifier <code class="literal">not-null="true"</code>. 
            </p><pre class="programlisting">&lt;key column="productSerialNumber" not-null="true"/&gt;</pre><p>La contraite de la clef &eacute;trang&egrave;re peut utiliser <code class="literal">ON DELETE CASCADE</code>. 
            </p><pre class="programlisting">&lt;key column="productSerialNumber" on-delete="cascade"/&gt;</pre><p>Voir le chapitre pr&eacute;c&eacute;dent pour une d&eacute;finition compl&egrave;te de l'&eacute;l&eacute;ment <code class="literal">&lt;key&gt;</code>. 
            </p>
         </div>
         <div class="sect2" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="collections-elements"></a>6.2.2.&nbsp;Les &eacute;l&eacute;ments d'une collection
                     </h3>
                  </div>
               </div>
            </div>
            <p>Les collections peuvent contenir la plupart des autres types Hibernate, dont tous les types basiques, les types utilisateur,
               les composants, et bien s&ucirc;r, les r&eacute;f&eacute;rences vers d'autres entit&eacute;s. C'est une distinction importante : un objet dans une collection
               pourrait &ecirc;tre g&eacute;r&eacute; avec une s&eacute;mantique de "valeur" (sa dur&eacute;e de vie d&eacute;pend compl&egrave;tement du propri&eacute;taire de la collection)
               ou il pourrait avoir une r&eacute;f&eacute;rence vers une autre entit&eacute;, avec sa propre dur&eacute;e de vie. Dans le dernier cas, seul le "lien"
               entre les 2 objets est consid&eacute;r&eacute; &ecirc;tre l'&eacute;tat retenu par la collection. 
            </p>
            <p>Le type contenu est r&eacute;f&eacute;renc&eacute; comme le <span class="emphasis"><em>type de l'&eacute;l&eacute;ment de la collection</em></span>. Les &eacute;l&eacute;ments de la collections sont mapp&eacute;s par <code class="literal">&lt;element&gt;</code> ou <code class="literal">&lt;composite-element&gt;</code>, ou dans le cas des r&eacute;f&eacute;rences d'entit&eacute;, avec <code class="literal">&lt;one-to-many&gt;</code> ou <code class="literal">&lt;many-to-many&gt;</code>. Les deux premiers mappent des &eacute;l&eacute;ments avec un s&eacute;mantique de valeur, les deux suivants sont utilis&eacute;s pour mapper des associations
               d'entit&eacute;. 
            </p>
         </div>
         <div class="sect2" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="collections-indexed"></a>6.2.3.&nbsp;Collections index&eacute;es
                     </h3>
                  </div>
               </div>
            </div>
            <p>Tous les mappings de collection, except&eacute;s ceux avec les s&eacute;mantiques d'ensemble (NdT : set) et de sac (NdT : bag), ont besoin
               d'une <span class="emphasis"><em>colonne d'index</em></span> dans la table de la collection - une colonne qui mappe un index de tableau, ou un index de <code class="literal">List</code>, ou une clef de <code class="literal">Map</code>. L'index d'une <code class="literal">Map</code> peut &ecirc;tre n'importe quel type basique, mapp&eacute; avec <code class="literal">&lt;map-key&gt;</code>, &ccedil;a peut &ecirc;tre une r&eacute;f&eacute;rence d'entit&eacute; mapp&eacute;e avec <code class="literal">&lt;map-key-many-to-many&gt;</code>, ou &ccedil;a peut &ecirc;tre un type compos&eacute;, mapp&eacute; avec <code class="literal">&lt;composite-map-key&gt;</code>. L'index d'un tableau ou d'une liste est toujours de type <code class="literal">integer</code> et est mapp&eacute; en utilisant l'&eacute;l&eacute;ment <code class="literal">&lt;list-index&gt;</code>. Les colonnes mapp&eacute;es contiennent des entiers s&eacute;quentiels (num&eacute;rot&eacute;s &agrave; partir de z&eacute;ro par d&eacute;faut). 
            </p>
            <div class="programlistingco"><pre class="programlisting">&lt;list-index 
        column="column_name"                <span class="co">(1)</span>
        base="0|1|..."/&gt;</pre><div class="calloutlist">
                  <table border="0" summary="Callout list">
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">column_name</code> (required): The name of the column holding the collection index values. 
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">base</code> (optional, defaults to <code class="literal">0</code>): The value of the index column that corresponds to the first element of the list or array. 
                           </p>
                        </td>
                     </tr>
                  </table>
               </div>
            </div>
            <div class="programlistingco"><pre class="programlisting">&lt;map-key 
        column="column_name"                <span class="co">(1)</span>
        formula="any SQL expression"        <span class="co">(2)</span>
        type="type_name"                    <span class="co">(3)</span>
        node="@attribute-name"
        length="N"/&gt;</pre><div class="calloutlist">
                  <table border="0" summary="Callout list">
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">column</code> (optional): The name of the column holding the collection index values. 
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">formula</code> (optional): A SQL formula used to evaluate the key of the map. 
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">type</code> (reguired): The type of the map keys. 
                           </p>
                        </td>
                     </tr>
                  </table>
               </div>
            </div>
            <div class="programlistingco"><pre class="programlisting">&lt;map-key-many-to-many
        column="column_name"                <span class="co">(1)</span>
        formula="any SQL expression"        <span class="co">(2)</span><span class="co">(3)</span>
        class="ClassName"
/&gt;</pre><div class="calloutlist">
                  <table border="0" summary="Callout list">
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">column</code> (optional): The name of the foreign key column for the collection index values. 
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">formula</code> (optional): A SQL formula used to evaluate the foreign key of the map key. 
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">class</code> (required): The entity class used as the map key. 
                           </p>
                        </td>
                     </tr>
                  </table>
               </div>
            </div>
            <p>Si votre table n'a pas de colonne d'index, et que vous souhaitez tout de m&ecirc;me utiliser <code class="literal">List</code> comme type de propri&eacute;t&eacute;, vous devriez mapper la propri&eacute;t&eacute; comme un <span class="emphasis"><em>&lt;bag&gt;</em></span> Hibernate. Un sac (NdT : bag) ne garde pas son ordre quand il est r&eacute;cup&eacute;r&eacute; de la base de donn&eacute;es, mais il peut &ecirc;tre optionnellement
               tri&eacute; ou ordonn&eacute;. 
            </p>
         </div>
         <div class="sect2" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="collections-ofvalues"></a>6.2.4.&nbsp;Collections de valeurs et associations plusieurs-vers-plusieurs
                     </h3>
                  </div>
               </div>
            </div>
            <p>N'importe quelle collection de valeurs ou association plusieurs-vers-plusieurs requiert une <span class="emphasis"><em>table de collection</em></span> avec une(des) colonne(s) de clef &eacute;trang&egrave;re, une(des) <span class="emphasis"><em>colonne(s) d'&eacute;l&eacute;ment de la collection</em></span> ou des colonnes et possiblement une(des) colonne(s) d'index. 
            </p>
            <p>Pour une collection de valeurs, nous utilisons la balise <code class="literal">&lt;element&gt;</code>. 
            </p>
            <div class="programlistingco"><pre class="programlisting">&lt;element
        column="column_name"                     <span class="co">(1)</span>
        formula="any SQL expression"             <span class="co">(2)</span>
        type="typename"                          <span class="co">(3)</span>
        length="L"
        precision="P"
        scale="S"
        not-null="true|false"
        unique="true|false"
        node="element-name"
/&gt;</pre><div class="calloutlist">
                  <table border="0" summary="Callout list">
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">column</code> (optional): The name of the column holding the collection element values. 
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">formula</code> (optional): An SQL formula used to evaluate the element. 
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">type</code> (required): The type of the collection element. 
                           </p>
                        </td>
                     </tr>
                  </table>
               </div>
            </div>
            <p> A <span class="emphasis"><em>many-to-many association</em></span> is specified using the <code class="literal">&lt;many-to-many&gt;</code> element. 
            </p>
            <div class="programlistingco"><pre class="programlisting">&lt;many-to-many
        column="column_name"                               <span class="co">(1)</span>
        formula="any SQL expression"                       <span class="co">(2)</span>
        class="ClassName"                                  <span class="co">(3)</span>
        fetch="select|join"                                <span class="co">(4)</span>
        unique="true|false"                                <span class="co">(5)</span>
        not-found="ignore|exception"                       <span class="co">(6)</span>
        entity-name="EntityName"                           <span class="co">(7)</span>
        property-ref="propertyNameFromAssociatedClass"     <span class="co">(8)</span>
        node="element-name"
        embed-xml="true|false"
    /&gt;</pre><div class="calloutlist">
                  <table border="0" summary="Callout list">
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">column</code> (optional): The name of the element foreign key column. 
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">formula</code> (optional): An SQL formula used to evaluate the element foreign key value. 
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">class</code> (required): The name of the associated class. 
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(4)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">fetch</code> (optional - defaults to <code class="literal">join</code>): enables outer-join or sequential select fetching for this association. This is a special case; for full eager fetching
                              (in a single <code class="literal">SELECT</code>) of an entity and its many-to-many relationships to other entities, you would enable <code class="literal">join</code> fetching not only of the collection itself, but also with this attribute on the <code class="literal">&lt;many-to-many&gt;</code> nested element. 
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(5)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">unique</code> (optional): Enable the DDL generation of a unique constraint for the foreign-key column. This makes the association multiplicity
                              effectively one to many. 
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(6)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">not-found</code> (optional - defaults to <code class="literal">exception</code>): Specifies how foreign keys that reference missing rows will be handled: <code class="literal">ignore</code> will treat a missing row as a null association. 
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(7)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">entity-name</code> (optional): The entity name of the associated class, as an alternative to <code class="literal">class</code>. 
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(8)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p> <code class="literal">property-ref</code>: (optional) The name of a property of the associated class that is joined to this foreign key. If not specified, the primary
                              key of the associated class is used. 
                           </p>
                        </td>
                     </tr>
                  </table>
               </div>
            </div>
            <p>Quelques exemples, d'abord, un ensemble de cha&icirc;nes de caract&egrave;res : </p><pre class="programlisting">&lt;set name="names" table="person_names"&gt;
    &lt;key column="person_id"/&gt;
    &lt;element column="person_name" type="string"/&gt;
&lt;/set&gt;</pre><p>Un bag contenant des entiers (avec un ordre d'it&eacute;ration d&eacute;termin&eacute; par l'attribut <code class="literal">order-by</code>) : 
            </p><pre class="programlisting">&lt;bag name="sizes" 
        table="item_sizes" 
        order-by="size asc"&gt;
    &lt;key column="item_id"/&gt;
    &lt;element column="size" type="integer"/&gt;
&lt;/bag&gt;</pre><p>Un tableau d'entit&eacute;s - dans ce cas, une association plusieurs-vers-plusieurs : </p><pre class="programlisting">&lt;array name="addresses" 
        table="PersonAddress" 
        cascade="persist"&gt;
    &lt;key column="personId"/&gt;
    &lt;list-index column="sortOrder"/&gt;
    &lt;many-to-many column="addressId" class="Address"/&gt;
&lt;/array&gt;</pre><p>Une map de cha&icirc;nes de caract&egrave;res vers des dates : </p><pre class="programlisting">&lt;map name="holidays" 
        table="holidays" 
        schema="dbo" 
        order-by="hol_name asc"&gt;
    &lt;key column="id"/&gt;
    &lt;map-key column="hol_name" type="string"/&gt;
    &lt;element column="hol_date" type="date"/&gt;
&lt;/map&gt;</pre><p>Une liste de composants (discute dans le prochain chapitre) : </p><pre class="programlisting">&lt;list name="carComponents" 
        table="CarComponents"&gt;
    &lt;key column="carId"/&gt;
    &lt;list-index column="sortOrder"/&gt;
    &lt;composite-element class="CarComponent"&gt;
        &lt;property name="price"/&gt;
        &lt;property name="type"/&gt;
        &lt;property name="serialNumber" column="serialNum"/&gt;
    &lt;/composite-element&gt;
&lt;/list&gt;</pre></div>
         <div class="sect2" lang="fr-FR">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="collections-onetomany"></a>6.2.5.&nbsp;Association un-vers-plusieurs
                     </h3>
                  </div>
               </div>
            </div>
            <p>Une <span class="emphasis"><em>association un vers plusieurs</em></span> lie les tables de deux classes par une clef &eacute;trang&egrave;re, sans l'intervention d'une table de collection. Ce mapping perd certaines
               s&eacute;mantiques des collections Java normales : 
            </p>
            <div class="itemizedlist">
               <ul type="disc" compact>
                  <li>
                     <p>Une instance de la classe de l'entit&eacute; contenue ne peut pas appartenir &agrave; plus d'une instance de la collection </p>
                  </li>
                  <li>
                     <p>Une instance de la classe de l'entit&eacute; contenue ne peut pas appara&icirc;tre plus plus d'une valeur d'index de la collection </p>
                  </li>
               </ul>
            </div>
            <p>Une association de <code class="literal">Product</code> vers <code class="literal">Part</code> requiert l'existence d'une clef &eacute;trang&egrave;re et possiblement une colonne d'index pour la table <code class="literal">Part</code>. Une balise <code class="literal">&lt;one-to-many&gt;</code> indique que c'est une association un vers plusieurs. 
            </p>
            <div class="programlistingco"><pre class="programlisting">&lt;one-to-many 
        class="ClassName"                                  <span class="co">(1)</span>
        not-found="ignore|exception"                       <span class="co">(2)</span>
        entity-name="EntityName"                           <span class="co">(3)</span>
        node="element-name"
        embed-xml="true|false"
    /&gt;</pre><div class="calloutlist">
                  <table border="0" summary="Callout list">
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(1)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p><code class="literal">class</code> (requis) : le nom de la classe associ&eacute;e 
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(2)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p><code class="literal">not-found</code> (optionnel - par d&eacute;faut <code class="literal">exception</code>) : sp&eacute;cifie comment les identifiants cach&eacute;s qui r&eacute;f&eacute;rencent des lignes manquantes seront g&eacute;r&eacute;s : <code class="literal">ignore</code> traitera une ligne manquante comme une association nulle 
                           </p>
                        </td>
                     </tr>
                     <tr>
                        <td width="5%" valign="top" align="left">
                           <fo:inline xmlns:fo="http://www.w3.org/1999/XSL/Format" color="black" padding-top="0.1em" padding-bottom="0.1em" padding-start="0.2em" padding-end="0.2em" baseline-shift="0.1em" font-weight="bold" font-size="75%">(3)</fo:inline>
                        </td>
                        <td valign="top" align="left">
                           <p><code class="literal">entity-name</code> (optional): The entity name of the associated class, as an alternative to <code class="literal">class</code>. 
                           </p>
                        </td>
                     </tr>
                  </table>
               </div>
            </div>
            <p>Notez que l'&eacute;l&eacute;ment <code class="literal">&lt;one-to-many&gt;</code> n'a pas besoin de d&eacute;clarer de colonnes. Il n'est pas non plus n&eacute;cessaire de sp&eacute;cifier le nom de la table nulle part. 
            </p>
            <p><span class="emphasis"><em>Note tr&egrave;s importante :</em></span> si la colonne de la clef d'une association <code class="literal">&lt;one-to-many&gt;</code> est d&eacute;clar&eacute;e <code class="literal">NOT NULL</code>, vous devez d&eacute;clarer le mapping de <code class="literal">&lt;key&gt;</code> avec <code class="literal">not-null="true"</code> ou <span class="emphasis"><em>utiliser une association bidirectionnelle</em></span> avec le mapping de la collection marqu&eacute; <code class="literal">inverse="true"</code>. Voir la discussion sur les associations bidirectionnelles plus tard dans ce chapitre. 
            </p>
            <p>Cet exemple montre une map d'entit&eacute;s <code class="literal">Part</code> par nom (o&ugrave; <code class="literal">partName</code> est une propri&eacute;t&eacute; persistante de <code class="literal">Part</code>). Notez l'utilisation d'un index bas&eacute; sur une formule. 
            </p><pre class="programlisting">&lt;map name="parts"
        cascade="all"&gt;
    &lt;key column="productId" not-null="true"/&gt;
    &lt;map-key formula="partName"/&gt;
    &lt;one-to-many class="Part"/&gt;
&lt;/map&gt;</pre></div>
      </div>
      <div class="navfooter">
         <hr>
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left"><a accesskey="p" href="collections.html">Pr&eacute;c&eacute;dent</a>&nbsp;
               </td>
               <td width="20%" align="center"><a accesskey="u" href="collections.html">Niveau sup&eacute;rieur</a></td>
               <td width="40%" align="right">&nbsp;<a accesskey="n" href="collections-advancedmappings.html">Suivant</a></td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top">Chapitre&nbsp;6.&nbsp;Mapping des collections&nbsp;</td>
               <td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td>
               <td width="40%" align="right" valign="top">&nbsp;6.3.&nbsp;Mappings de collection avanc&eacute;s</td>
            </tr>
         </table>
      </div>
   </body>
</html>